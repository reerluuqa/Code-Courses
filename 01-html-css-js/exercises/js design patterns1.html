<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéØ JS Design Patterns Mastery</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0b0e1f;--bg2:#111432;--bg3:#181c3a;--bg4:#1f2452;
  --accent:#6c5ce7;--accent2:#fd79a8;--accent3:#00cec9;--accent4:#fdcb6e;
  --text:#d6d8f0;--dim:#6c6f93;--success:#00b894;--error:#ff6b6b;
  --radius:12px;--shadow:0 4px 24px rgba(0,0,0,.4);
}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;min-height:100vh}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--bg2)}
::-webkit-scrollbar-thumb{background:var(--accent);border-radius:3px}

#app{display:grid;grid-template-columns:280px 1fr;grid-template-rows:60px 1fr;min-height:100vh}

header{grid-column:1/-1;background:var(--bg2);display:flex;align-items:center;justify-content:space-between;padding:0 24px;border-bottom:1px solid var(--bg4);position:sticky;top:0;z-index:100}
.logo{font-size:1.3rem;font-weight:800;display:flex;align-items:center;gap:10px}
.logo span{background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.progress-wrap{display:flex;align-items:center;gap:12px;font-size:.85rem;color:var(--dim)}
.progress-bar{width:200px;height:8px;background:var(--bg4);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent3));border-radius:4px;transition:width .5s ease}
.xp-badge{background:var(--bg4);padding:4px 14px;border-radius:20px;font-weight:700;color:var(--accent4)}

aside{background:var(--bg2);border-right:1px solid var(--bg4);overflow-y:auto;padding:16px 0}
.nav-section{margin-bottom:8px}
.nav-title{padding:10px 20px;font-size:.7rem;text-transform:uppercase;letter-spacing:2px;color:var(--dim);font-weight:700}
.nav-item{padding:10px 20px;cursor:pointer;display:flex;align-items:center;gap:10px;font-size:.9rem;transition:all .2s;border-left:3px solid transparent;position:relative}
.nav-item:hover{background:var(--bg3);color:#fff}
.nav-item.active{background:var(--bg3);border-left-color:var(--accent);color:#fff;font-weight:600}
.nav-item .icon{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.85rem;flex-shrink:0}
.nav-item .check{position:absolute;right:14px;font-size:.7rem;color:var(--success)}
.cat-creational .icon{background:#6c5ce722;color:var(--accent)}
.cat-structural .icon{background:#00cec922;color:var(--accent3)}
.cat-behavioral .icon{background:#fd79a822;color:var(--accent2)}
.cat-special .icon{background:#fdcb6e22;color:var(--accent4)}

main{overflow-y:auto;padding:32px;max-height:calc(100vh - 60px)}
.view{display:none;animation:fadeUp .4s ease}
.view.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}

.hero{text-align:center;padding:60px 20px}
.hero h1{font-size:2.8rem;font-weight:800;margin-bottom:12px;background:linear-gradient(135deg,var(--accent),var(--accent2),var(--accent3));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{color:var(--dim);font-size:1.1rem;max-width:600px;margin:0 auto 32px}
.hero-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;max-width:960px;margin:0 auto}
.hero-card{background:var(--bg3);border-radius:var(--radius);padding:28px;text-align:left;border:1px solid var(--bg4);transition:all .3s;cursor:pointer}
.hero-card:hover{transform:translateY(-4px);box-shadow:var(--shadow);border-color:var(--accent)}
.hero-card .hc-icon{font-size:2rem;margin-bottom:12px}
.hero-card h3{margin-bottom:6px;font-size:1rem}
.hero-card p{font-size:.8rem;color:var(--dim)}

.pattern-header{margin-bottom:32px}
.pattern-header .breadcrumb{font-size:.8rem;color:var(--dim);margin-bottom:8px}
.pattern-header h2{font-size:2rem;font-weight:800;margin-bottom:4px}
.pattern-header .subtitle{color:var(--dim);font-size:1rem}
.pattern-tags{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.tag{padding:4px 12px;border-radius:20px;font-size:.75rem;font-weight:600}
.tag-creational{background:#6c5ce722;color:var(--accent)}
.tag-structural{background:#00cec922;color:var(--accent3)}
.tag-behavioral{background:#fd79a822;color:var(--accent2)}
.tag-difficulty{background:var(--bg4);color:var(--accent4)}

.tabs{display:flex;gap:4px;margin-bottom:24px;border-bottom:2px solid var(--bg4);padding-bottom:0;overflow-x:auto}
.tab{padding:10px 20px;cursor:pointer;font-size:.85rem;font-weight:600;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .2s;white-space:nowrap;color:var(--dim)}
.tab:hover{color:var(--text)}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-content{display:none;animation:fadeUp .3s}
.tab-content.active{display:block}

.visual-box{background:var(--bg3);border-radius:var(--radius);padding:40px;margin-bottom:24px;border:1px solid var(--bg4);overflow:hidden;position:relative;min-height:280px}

.code-block{background:var(--bg);border-radius:var(--radius);margin:16px 0;overflow:hidden;border:1px solid var(--bg4)}
.code-header{background:var(--bg3);padding:8px 16px;display:flex;justify-content:space-between;align-items:center;font-size:.8rem;color:var(--dim)}
.code-header .lang{color:var(--accent);font-weight:600}
.copy-btn{background:var(--bg4);border:none;color:var(--text);padding:4px 12px;border-radius:6px;cursor:pointer;font-size:.75rem;transition:all .2s}
.copy-btn:hover{background:var(--accent);color:#fff}
.code-body{padding:16px;overflow-x:auto;font-family:'Fira Code',Consolas,'Courier New',monospace;font-size:.85rem;line-height:1.7;white-space:pre;tab-size:2}
.code-body .kw{color:#c792ea}
.code-body .fn{color:#82aaff}
.code-body .str{color:#c3e88d}
.code-body .num{color:#f78c6c}
.code-body .cm{color:#546e7a;font-style:italic}
.code-body .op{color:#89ddff}
.code-body .pr{color:#f07178}
.code-body .cls{color:#ffcb6b}

.info-box{border-radius:var(--radius);padding:20px;margin:16px 0;display:flex;gap:12px}
.info-box.tip{background:#00b89411;border-left:4px solid var(--success)}
.info-box.warn{background:#fdcb6e11;border-left:4px solid var(--accent4)}
.info-box.danger{background:#ff6b6b11;border-left:4px solid var(--error)}
.info-box .ib-icon{font-size:1.2rem;flex-shrink:0}
.info-box .ib-content{font-size:.9rem;line-height:1.6}
.info-box .ib-content strong{display:block;margin-bottom:4px}

.mistake-card{background:var(--bg3);border-radius:var(--radius);padding:20px;margin:12px 0;border:1px solid var(--bg4)}
.mistake-card h4{color:var(--error);margin-bottom:8px;display:flex;align-items:center;gap:8px}
.mistake-card .fix h4{color:var(--success)}

.quiz-container{background:var(--bg3);border-radius:var(--radius);padding:24px;margin:16px 0;border:1px solid var(--bg4)}
.quiz-q{font-size:1rem;font-weight:600;margin-bottom:16px}
.quiz-q .q-num{color:var(--accent);margin-right:8px}
.quiz-opts{display:flex;flex-direction:column;gap:8px}
.quiz-opt{padding:12px 16px;border-radius:8px;background:var(--bg);border:2px solid var(--bg4);cursor:pointer;transition:all .2s;font-size:.9rem;display:flex;align-items:center;gap:10px}
.quiz-opt:hover{border-color:var(--accent);background:var(--bg2)}
.quiz-opt.selected{border-color:var(--accent);background:#6c5ce722}
.quiz-opt.correct{border-color:var(--success);background:#00b89422}
.quiz-opt.wrong{border-color:var(--error);background:#ff6b6b22}
.quiz-opt .opt-letter{width:24px;height:24px;border-radius:50%;background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;flex-shrink:0}
.quiz-explain{margin-top:12px;padding:12px;border-radius:8px;font-size:.85rem;display:none}
.quiz-explain.show{display:block}
.quiz-explain.correct{background:#00b89411;border:1px solid #00b89444}
.quiz-explain.wrong{background:#ff6b6b11;border:1px solid #ff6b6b44}
.quiz-nav{display:flex;justify-content:space-between;align-items:center;margin-top:16px}

.exercise-area{background:var(--bg3);border-radius:var(--radius);padding:24px;margin:16px 0;border:1px solid var(--bg4)}
.exercise-area h3{margin-bottom:8px}
.exercise-desc{color:var(--dim);font-size:.9rem;margin-bottom:16px}
.code-editor{width:100%;min-height:200px;background:var(--bg);border:1px solid var(--bg4);border-radius:8px;padding:16px;font-family:'Fira Code',Consolas,monospace;font-size:.85rem;color:var(--text);resize:vertical;line-height:1.7;tab-size:2}
.code-editor:focus{outline:none;border-color:var(--accent)}
.run-btn{background:linear-gradient(135deg,var(--accent),var(--accent2));border:none;color:#fff;padding:10px 24px;border-radius:8px;cursor:pointer;font-weight:600;margin-top:12px;font-size:.9rem;transition:all .2s}
.run-btn:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(108,92,231,.4)}
.output-area{background:var(--bg);border-radius:8px;padding:16px;margin-top:12px;font-family:monospace;font-size:.85rem;border:1px solid var(--bg4);min-height:60px;white-space:pre-wrap}
.output-area.success{border-color:var(--success)}
.output-area.error{border-color:var(--error)}

.comparison-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.compare-card{background:var(--bg3);border-radius:var(--radius);padding:20px;border:1px solid var(--bg4);transition:all .3s}
.compare-card:hover{border-color:var(--accent);transform:translateY(-2px)}
.compare-card h4{font-size:1rem;margin-bottom:8px}
.compare-card .use-when{font-size:.85rem;color:var(--dim);margin-bottom:12px}
.compare-card .examples{display:flex;gap:6px;flex-wrap:wrap}
.compare-card .ex-tag{background:var(--bg);padding:3px 10px;border-radius:12px;font-size:.75rem;color:var(--accent3)}

.section-title{font-size:1.4rem;font-weight:700;margin:32px 0 16px;display:flex;align-items:center;gap:10px}
.section-title::after{content:'';flex:1;height:1px;background:var(--bg4)}

.btn{padding:8px 20px;border-radius:8px;border:none;cursor:pointer;font-weight:600;font-size:.85rem;transition:all .2s}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:#5a4bd6}
.btn-outline{background:transparent;border:2px solid var(--bg4);color:var(--text)}
.btn-outline:hover{border-color:var(--accent)}
.btn-success{background:var(--success);color:#fff}

.score-display{text-align:center;padding:40px;background:var(--bg3);border-radius:var(--radius);margin:20px 0}
.score-big{font-size:3rem;font-weight:800;margin-bottom:8px}
.score-label{color:var(--dim)}

/* Visual Diagrams */
.vis-singleton{display:flex;align-items:center;justify-content:center;gap:40px;flex-wrap:wrap}
.vis-clients{display:flex;flex-direction:column;gap:12px}
.vis-client{background:var(--bg);padding:10px 20px;border-radius:8px;border:2px solid var(--accent);font-size:.85rem;animation:pulseIn .5s ease both;text-align:center}
.vis-client:nth-child(2){animation-delay:.1s}
.vis-client:nth-child(3){animation-delay:.2s}
.vis-arrows{display:flex;flex-direction:column;gap:12px;align-items:center}
.vis-arrow{color:var(--accent);font-size:1.2rem;animation:arrowMove 1.5s ease infinite}
.vis-arrow:nth-child(2){animation-delay:.2s}
.vis-arrow:nth-child(3){animation-delay:.4s}
@keyframes arrowMove{0%,100%{transform:translateX(0);opacity:.5}50%{transform:translateX(8px);opacity:1}}
.vis-instance{background:linear-gradient(135deg,var(--accent),var(--accent2));padding:24px 32px;border-radius:12px;font-weight:700;font-size:1.1rem;box-shadow:0 0 30px rgba(108,92,231,.3);animation:glow 2s ease infinite}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(108,92,231,.2)}50%{box-shadow:0 0 40px rgba(108,92,231,.5)}}
@keyframes pulseIn{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}

.vis-factory{display:flex;align-items:center;justify-content:center;gap:24px;flex-wrap:wrap}
.vis-input{background:var(--bg);padding:12px 20px;border-radius:8px;border:2px dashed var(--dim);font-size:.85rem}
.vis-machine{background:linear-gradient(135deg,var(--accent3),#00b894);padding:30px;border-radius:16px;font-size:2rem;position:relative;animation:machineWork 2s ease infinite}
@keyframes machineWork{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.vis-products{display:flex;flex-direction:column;gap:8px}
.vis-product{padding:10px 20px;border-radius:8px;font-size:.85rem;font-weight:600;animation:slideOut .5s ease both}
.vis-product:nth-child(1){background:#6c5ce733;border:1px solid var(--accent);animation-delay:.3s}
.vis-product:nth-child(2){background:#fd79a833;border:1px solid var(--accent2);animation-delay:.5s}
.vis-product:nth-child(3){background:#00cec933;border:1px solid var(--accent3);animation-delay:.7s}
@keyframes slideOut{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:none}}

.vis-observer{text-align:center}
.vis-publisher{background:linear-gradient(135deg,var(--accent2),var(--accent));padding:20px 32px;border-radius:12px;font-weight:700;display:inline-block;margin-bottom:20px;animation:pulse 2s ease infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}
.vis-waves{margin:12px 0}
.vis-wave{width:200px;height:200px;border-radius:50%;border:2px solid var(--accent);position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);animation:waveOut 2s ease infinite;opacity:0}
.vis-wave:nth-child(2){animation-delay:.4s}
.vis-wave:nth-child(3){animation-delay:.8s}
@keyframes waveOut{0%{width:20px;height:20px;opacity:.8}100%{width:200px;height:200px;opacity:0}}
.vis-subs{display:flex;justify-content:center;gap:16px;margin-top:20px;flex-wrap:wrap}
.vis-sub{background:var(--bg);padding:10px 20px;border-radius:8px;border:2px solid var(--accent3);font-size:.85rem;animation:popIn .5s ease both}
.vis-sub:nth-child(2){animation-delay:.2s}
.vis-sub:nth-child(3){animation-delay:.4s}
.vis-sub:nth-child(4){animation-delay:.6s}
@keyframes popIn{from{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}

.vis-module{display:flex;gap:0;justify-content:center}
.vis-mod-box{border-radius:12px;overflow:hidden;width:300px;border:2px solid var(--accent)}
.vis-mod-header{background:var(--accent);padding:10px;text-align:center;font-weight:700;font-size:.9rem;color:#fff}
.vis-mod-private{background:#ff6b6b22;padding:16px;border-bottom:1px dashed var(--bg4)}
.vis-mod-private h5{color:var(--error);font-size:.75rem;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px}
.vis-mod-public{background:#00b89422;padding:16px}
.vis-mod-public h5{color:var(--success);font-size:.75rem;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px}
.vis-mod-item{background:var(--bg);padding:6px 12px;border-radius:6px;font-size:.8rem;margin:4px 0;font-family:monospace}

.vis-decorator{display:flex;align-items:center;justify-content:center}
.vis-dec-layers{position:relative;width:240px;height:240px}
.vis-dec-layer{position:absolute;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:600;animation:layerPulse 3s ease infinite}
.vis-dec-layer.l1{width:240px;height:240px;background:#fd79a822;border:2px solid var(--accent2);animation-delay:.4s}
.vis-dec-layer.l2{width:170px;height:170px;left:35px;top:35px;background:#6c5ce722;border:2px solid var(--accent);animation-delay:.2s}
.vis-dec-layer.l3{width:100px;height:100px;left:70px;top:70px;background:#00cec922;border:2px solid var(--accent3)}
@keyframes layerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}

.vis-strategy{display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap}
.vis-context{background:linear-gradient(135deg,var(--accent4),#e17055);padding:20px;border-radius:12px;font-weight:700;font-size:.9rem}
.vis-strategies{display:flex;flex-direction:column;gap:10px}
.vis-strat{padding:12px 20px;border-radius:8px;font-size:.85rem;cursor:pointer;transition:all .3s;border:2px solid transparent}
.vis-strat:hover,.vis-strat.active{transform:translateX(8px);border-color:var(--accent)}
.vis-strat:nth-child(1){background:#6c5ce733}
.vis-strat:nth-child(2){background:#fd79a833}
.vis-strat:nth-child(3){background:#00cec933}

.final-quiz .quiz-progress{display:flex;gap:6px;margin-bottom:24px;flex-wrap:wrap}
.final-quiz .qp-dot{width:28px;height:28px;border-radius:50%;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:600}
.final-quiz .qp-dot.current{background:var(--accent);color:#fff}
.final-quiz .qp-dot.answered{background:var(--success);color:#fff}
.final-quiz .qp-dot.wrong{background:var(--error);color:#fff}

.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:900px){
  #app{grid-template-columns:1fr}
  aside{display:none;position:fixed;left:0;top:60px;bottom:0;width:280px;z-index:99}
  aside.open{display:block}
  .grid-2{grid-template-columns:1fr}
  .hero h1{font-size:1.8rem}
  .vis-singleton,.vis-factory,.vis-observer{flex-direction:column}
}
.mobile-toggle{display:none;background:none;border:none;color:var(--text);font-size:1.5rem;cursor:pointer}
@media(max-width:900px){.mobile-toggle{display:block}}

.confetti{position:fixed;pointer-events:none;z-index:9999}
</style>
</head>
<body>
<div id="app">
  <header>
    <div style="display:flex;align-items:center;gap:16px">
      <button class="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞</button>
      <div class="logo">üéØ <span>Pattern Mastery</span></div>
    </div>
    <div class="progress-wrap">
      <span id="progressText">0% Complete</span>
      <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
      <div class="xp-badge">‚ö° <span id="xpCount">0</span> XP</div>
    </div>
  </header>
  <aside id="sidebar"></aside>
  <main id="main"></main>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA: All Patterns & Content
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const patterns = [
  {
    id:'singleton', name:'Singleton', icon:'üîí', cat:'creational',
    difficulty:'Beginner',
    subtitle:'One instance to rule them all',
    description:'The Singleton pattern ensures a class has only <strong>one instance</strong> and provides a global point of access to it. Think of it like the President ‚Äî there can only be one at a time.',
    whenToUse:[
      'Database connections ‚Äî avoid opening multiple connections',
      'Application configuration / settings',
      'Logging service across your app',
      'Caching layer',
      'Managing shared resources (thread pools, connection pools)'
    ],
    visual:'singleton',
    examples:[
      {
        title:'Basic Singleton',
        code:`<span class="kw">class</span> <span class="cls">Singleton</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">if</span> (<span class="cls">Singleton</span>.instance) {
      <span class="kw">return</span> <span class="cls">Singleton</span>.instance;
    }
    <span class="kw">this</span>.timestamp = <span class="cls">Date</span>.<span class="fn">now</span>();
    <span class="cls">Singleton</span>.instance = <span class="kw">this</span>;
  }
}

<span class="kw">const</span> a = <span class="kw">new</span> <span class="cls">Singleton</span>();
<span class="kw">const</span> b = <span class="kw">new</span> <span class="cls">Singleton</span>();
console.<span class="fn">log</span>(a === b); <span class="cm">// true ‚úÖ Same instance!</span>
console.<span class="fn">log</span>(a.timestamp === b.timestamp); <span class="cm">// true</span>`
      },
      {
        title:'Practical: Config Manager',
        code:`<span class="kw">const</span> <span class="cls">ConfigManager</span> = (() => {
  <span class="kw">let</span> instance;

  <span class="kw">function</span> <span class="fn">createInstance</span>() {
    <span class="kw">const</span> config = {};
    <span class="kw">return</span> {
      <span class="fn">set</span>(key, value) { config[key] = value; },
      <span class="fn">get</span>(key) { <span class="kw">return</span> config[key]; },
      <span class="fn">getAll</span>() { <span class="kw">return</span> { ...config }; }
    };
  }

  <span class="kw">return</span> {
    <span class="fn">getInstance</span>() {
      <span class="kw">if</span> (!instance) {
        instance = <span class="fn">createInstance</span>();
      }
      <span class="kw">return</span> instance;
    }
  };
})();

<span class="kw">const</span> config1 = <span class="cls">ConfigManager</span>.<span class="fn">getInstance</span>();
<span class="kw">const</span> config2 = <span class="cls">ConfigManager</span>.<span class="fn">getInstance</span>();
config1.<span class="fn">set</span>(<span class="str">'theme'</span>, <span class="str">'dark'</span>);
console.<span class="fn">log</span>(config2.<span class="fn">get</span>(<span class="str">'theme'</span>)); <span class="cm">// 'dark' ‚Äî same instance!</span>`
      },
      {
        title:'ES Module Singleton (Modern)',
        code:`<span class="cm">// logger.js ‚Äî ES modules are singletons by default!</span>
<span class="kw">class</span> <span class="cls">Logger</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">this</span>.logs = [];
  }

  <span class="fn">log</span>(message) {
    <span class="kw">const</span> entry = {
      message,
      timestamp: <span class="kw">new</span> <span class="cls">Date</span>().<span class="fn">toISOString</span>()
    };
    <span class="kw">this</span>.logs.<span class="fn">push</span>(entry);
    console.<span class="fn">log</span>(<span class="str">\`[\${entry.timestamp}] \${message}\`</span>);
  }

  <span class="fn">getHistory</span>() {
    <span class="kw">return</span> [...<span class="kw">this</span>.logs];
  }
}

<span class="cm">// Export a single instance</span>
<span class="kw">export default new</span> <span class="cls">Logger</span>();

<span class="cm">// Every file that imports this gets the SAME instance</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Not handling constructor calls properly',
        bad:`<span class="kw">class</span> <span class="cls">Bad</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">this</span>.data = [];
  }
}
<span class="cm">// Nothing stops multiple instances!</span>
<span class="kw">const</span> a = <span class="kw">new</span> <span class="cls">Bad</span>();
<span class="kw">const</span> b = <span class="kw">new</span> <span class="cls">Bad</span>(); <span class="cm">// Different instance!</span>`,
        good:`<span class="kw">class</span> <span class="cls">Good</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">if</span> (<span class="cls">Good</span>.instance) <span class="kw">return</span> <span class="cls">Good</span>.instance;
    <span class="kw">this</span>.data = [];
    <span class="cls">Good</span>.instance = <span class="kw">this</span>;
  }
}
<span class="kw">const</span> a = <span class="kw">new</span> <span class="cls">Good</span>();
<span class="kw">const</span> b = <span class="kw">new</span> <span class="cls">Good</span>(); <span class="cm">// Same instance ‚úÖ</span>`
      },
      {
        title:'‚ùå Using Singleton when you don\'t need it',
        desc:'Singletons introduce <strong>global state</strong> and make testing harder. Don\'t use them just because ‚Äî use dependency injection instead when possible.'
      }
    ],
    quiz:[
      {
        q:'What is the main purpose of the Singleton pattern?',
        opts:['To create multiple instances efficiently','To ensure only one instance of a class exists','To hide implementation details','To notify objects of changes'],
        correct:1,
        explain:'The Singleton pattern restricts instantiation to a single instance and provides global access to it.'
      },
      {
        q:'Which is a valid use case for Singleton?',
        opts:['Creating user profile objects','Managing a database connection pool','Rendering UI components','Sorting arrays'],
        correct:1,
        explain:'Database connection pools should be shared across the app ‚Äî a perfect Singleton use case.'
      },
      {
        q:'What is a major drawback of the Singleton pattern?',
        opts:['It uses too much memory','It makes unit testing difficult due to global state','It\'s too slow','It only works in Node.js'],
        correct:1,
        explain:'Singletons create hidden dependencies and global state, making isolated unit testing challenging.'
      }
    ],
    exercise:{
      title:'Build a Singleton Cache',
      desc:'Create a Cache singleton that stores key-value pairs. It should have set(key, val), get(key), has(key), and clear() methods. Multiple getInstance() calls should return the same instance.',
      starter:`const Cache = (() => {
  let instance;

  function createInstance() {
    // TODO: Create a cache using a Map or object
    // Return methods: set, get, has, clear, size
  }

  return {
    getInstance() {
      // TODO: Return existing or new instance
    }
  };
})();

// Test it:
const c1 = Cache.getInstance();
const c2 = Cache.getInstance();
c1.set('name', 'JavaScript');
console.log(c2.get('name')); // Should print: JavaScript
console.log(c1 === c2);       // Should print: true
console.log(c1.size());       // Should print: 1`,
      solution:`const Cache = (() => {
  let instance;

  function createInstance() {
    const store = new Map();
    return {
      set(key, val) { store.set(key, val); },
      get(key) { return store.get(key); },
      has(key) { return store.has(key); },
      clear() { store.clear(); },
      size() { return store.size; }
    };
  }

  return {
    getInstance() {
      if (!instance) instance = createInstance();
      return instance;
    }
  };
})();`
    }
  },
  {
    id:'factory', name:'Factory', icon:'üè≠', cat:'creational',
    difficulty:'Beginner',
    subtitle:'Object creation without the mess',
    description:'The Factory pattern provides an interface for creating objects without specifying their exact class. Like ordering food ‚Äî you say "burger" and the kitchen (factory) handles the details.',
    whenToUse:[
      'When object creation logic is complex',
      'When you need different object types based on input',
      'When you want to decouple creation from usage',
      'When working with plugins or extensions',
      'When the type of object isn\'t known until runtime'
    ],
    visual:'factory',
    examples:[
      {
        title:'Simple Factory',
        code:`<span class="kw">class</span> <span class="cls">Car</span> {
  <span class="kw">constructor</span>(make, model, price) {
    <span class="kw">this</span>.make = make;
    <span class="kw">this</span>.model = model;
    <span class="kw">this</span>.price = price;
    <span class="kw">this</span>.type = <span class="str">'car'</span>;
  }
}

<span class="kw">class</span> <span class="cls">Truck</span> {
  <span class="kw">constructor</span>(make, model, price) {
    <span class="kw">this</span>.make = make;
    <span class="kw">this</span>.model = model;
    <span class="kw">this</span>.price = price;
    <span class="kw">this</span>.type = <span class="str">'truck'</span>;
  }
}

<span class="kw">class</span> <span class="cls">VehicleFactory</span> {
  <span class="kw">static</span> <span class="fn">create</span>(type, make, model, price) {
    <span class="kw">switch</span> (type) {
      <span class="kw">case</span> <span class="str">'car'</span>: <span class="kw">return new</span> <span class="cls">Car</span>(make, model, price);
      <span class="kw">case</span> <span class="str">'truck'</span>: <span class="kw">return new</span> <span class="cls">Truck</span>(make, model, price);
      <span class="kw">default</span>: <span class="kw">throw new</span> <span class="cls">Error</span>(<span class="str">\`Unknown: \${type}\`</span>);
    }
  }
}

<span class="kw">const</span> car = <span class="cls">VehicleFactory</span>.<span class="fn">create</span>(<span class="str">'car'</span>, <span class="str">'Tesla'</span>, <span class="str">'Model 3'</span>, <span class="num">35000</span>);
<span class="kw">const</span> truck = <span class="cls">VehicleFactory</span>.<span class="fn">create</span>(<span class="str">'truck'</span>, <span class="str">'Ford'</span>, <span class="str">'F-150'</span>, <span class="num">45000</span>);
console.<span class="fn">log</span>(car);  <span class="cm">// Car { make:'Tesla', ... }</span>
console.<span class="fn">log</span>(truck); <span class="cm">// Truck { make:'Ford', ... }</span>`
      },
      {
        title:'Notification Factory (Real World)',
        code:`<span class="kw">class</span> <span class="cls">EmailNotification</span> {
  <span class="fn">send</span>(to, msg) {
    <span class="kw">return</span> <span class="str">\`üìß Email to \${to}: \${msg}\`</span>;
  }
}

<span class="kw">class</span> <span class="cls">SMSNotification</span> {
  <span class="fn">send</span>(to, msg) {
    <span class="kw">return</span> <span class="str">\`üì± SMS to \${to}: \${msg}\`</span>;
  }
}

<span class="kw">class</span> <span class="cls">PushNotification</span> {
  <span class="fn">send</span>(to, msg) {
    <span class="kw">return</span> <span class="str">\`üîî Push to \${to}: \${msg}\`</span>;
  }
}

<span class="kw">const</span> <span class="cls">NotificationFactory</span> = {
  creators: {
    email: () => <span class="kw">new</span> <span class="cls">EmailNotification</span>(),
    sms:   () => <span class="kw">new</span> <span class="cls">SMSNotification</span>(),
    push:  () => <span class="kw">new</span> <span class="cls">PushNotification</span>(),
  },

  <span class="fn">create</span>(type) {
    <span class="kw">const</span> creator = <span class="kw">this</span>.creators[type];
    <span class="kw">if</span> (!creator) <span class="kw">throw new</span> <span class="cls">Error</span>(<span class="str">\`Unknown type: \${type}\`</span>);
    <span class="kw">return</span> <span class="fn">creator</span>();
  },

  <span class="cm">// Extensible! Add new types dynamically</span>
  <span class="fn">register</span>(type, creator) {
    <span class="kw">this</span>.creators[type] = creator;
  }
};

<span class="kw">const</span> notif = <span class="cls">NotificationFactory</span>.<span class="fn">create</span>(<span class="str">'email'</span>);
console.<span class="fn">log</span>(notif.<span class="fn">send</span>(<span class="str">'john@test.com'</span>, <span class="str">'Hello!'</span>));
<span class="cm">// üìß Email to john@test.com: Hello!</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Giant switch statements that never end',
        desc:'If your factory has 20+ cases, consider using a <strong>registry pattern</strong> (map of constructors) instead. Makes it extensible without modifying the factory.'
      },
      {
        title:'‚ùå Using factory for trivially simple objects',
        desc:'Don\'t wrap <code>new User(name)</code> in a factory just because. Factories shine when creation is <em>complex</em> or <em>conditional</em>.'
      }
    ],
    quiz:[
      {
        q:'What problem does the Factory pattern solve?',
        opts:['Ensuring only one instance exists','Decoupling object creation from the code that uses it','Observing state changes','Hiding implementation details'],
        correct:1,
        explain:'Factory pattern separates the creation logic so client code doesn\'t need to know specifics.'
      },
      {
        q:'When should you NOT use a Factory?',
        opts:['When creating complex objects','When the object type depends on runtime input','When you\'re just doing `new SimpleClass()`','When working with plugins'],
        correct:2,
        explain:'For simple, straightforward creation, a factory adds unnecessary complexity.'
      }
    ],
    exercise:{
      title:'Build a Shape Factory',
      desc:'Create a ShapeFactory that creates Circle, Rectangle, and Triangle objects. Each shape should have an area() method and a describe() method.',
      starter:`class Circle {
  constructor(radius) {
    this.radius = radius;
  }
  area() {
    // TODO: return œÄ * r¬≤
  }
  describe() {
    return \`Circle (r=\${this.radius}), area=\${this.area().toFixed(2)}\`;
  }
}

// TODO: Create Rectangle class (width, height)
// TODO: Create Triangle class (base, height)

class ShapeFactory {
  static create(type, ...args) {
    // TODO: return the right shape
  }
}

// Test:
const c = ShapeFactory.create('circle', 5);
const r = ShapeFactory.create('rectangle', 4, 6);
const t = ShapeFactory.create('triangle', 3, 8);
console.log(c.describe());
console.log(r.describe());
console.log(t.describe());`,
      solution:`class Circle {
  constructor(r) { this.radius = r; }
  area() { return Math.PI * this.radius ** 2; }
  describe() { return \`Circle (r=\${this.radius}), area=\${this.area().toFixed(2)}\`; }
}
class Rectangle {
  constructor(w, h) { this.width = w; this.height = h; }
  area() { return this.width * this.height; }
  describe() { return \`Rectangle (\${this.width}x\${this.height}), area=\${this.area().toFixed(2)}\`; }
}
class Triangle {
  constructor(b, h) { this.base = b; this.height = h; }
  area() { return 0.5 * this.base * this.height; }
  describe() { return \`Triangle (b=\${this.base}, h=\${this.height}), area=\${this.area().toFixed(2)}\`; }
}
class ShapeFactory {
  static create(type, ...args) {
    const shapes = { circle: Circle, rectangle: Rectangle, triangle: Triangle };
    const Shape = shapes[type];
    if (!Shape) throw new Error('Unknown shape');
    return new Shape(...args);
  }
}`
    }
  },
  {
    id:'observer', name:'Observer', icon:'üëÅÔ∏è', cat:'behavioral',
    difficulty:'Intermediate',
    subtitle:'Subscribe, listen, react',
    description:'The Observer pattern defines a <strong>one-to-many</strong> dependency. When one object (subject) changes state, all its dependents (observers) are notified automatically. Think of YouTube subscriptions ‚Äî you subscribe to a channel and get notified of new videos.',
    whenToUse:[
      'Event handling systems',
      'State management (like Redux / MobX)',
      'Real-time data feeds',
      'UI updates when data changes',
      'Logging / analytics systems',
      'Chat applications'
    ],
    visual:'observer',
    examples:[
      {
        title:'Event Emitter',
        code:`<span class="kw">class</span> <span class="cls">EventEmitter</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">this</span>.listeners = {};
  }

  <span class="fn">on</span>(event, callback) {
    <span class="kw">if</span> (!<span class="kw">this</span>.listeners[event]) {
      <span class="kw">this</span>.listeners[event] = [];
    }
    <span class="kw">this</span>.listeners[event].<span class="fn">push</span>(callback);
    <span class="kw">return</span> <span class="kw">this</span>; <span class="cm">// chainable</span>
  }

  <span class="fn">off</span>(event, callback) {
    <span class="kw">if</span> (!<span class="kw">this</span>.listeners[event]) <span class="kw">return</span>;
    <span class="kw">this</span>.listeners[event] = <span class="kw">this</span>.listeners[event]
      .<span class="fn">filter</span>(cb => cb !== callback);
  }

  <span class="fn">emit</span>(event, ...args) {
    <span class="kw">if</span> (!<span class="kw">this</span>.listeners[event]) <span class="kw">return</span>;
    <span class="kw">this</span>.listeners[event]
      .<span class="fn">forEach</span>(cb => <span class="fn">cb</span>(...args));
  }
}

<span class="kw">const</span> emitter = <span class="kw">new</span> <span class="cls">EventEmitter</span>();

emitter.<span class="fn">on</span>(<span class="str">'userLogin'</span>, user => {
  console.<span class="fn">log</span>(<span class="str">\`üìß Send welcome email to \${user}\`</span>);
});

emitter.<span class="fn">on</span>(<span class="str">'userLogin'</span>, user => {
  console.<span class="fn">log</span>(<span class="str">\`üìä Log analytics for \${user}\`</span>);
});

emitter.<span class="fn">emit</span>(<span class="str">'userLogin'</span>, <span class="str">'Alice'</span>);
<span class="cm">// üìß Send welcome email to Alice</span>
<span class="cm">// üìä Log analytics for Alice</span>`
      },
      {
        title:'Reactive Store (Mini Redux)',
        code:`<span class="kw">class</span> <span class="cls">Store</span> {
  <span class="kw">constructor</span>(initialState) {
    <span class="kw">this</span>._state = initialState;
    <span class="kw">this</span>._listeners = <span class="kw">new</span> <span class="cls">Set</span>();
  }

  <span class="fn">getState</span>() {
    <span class="kw">return</span> { ...<span class="kw">this</span>._state };
  }

  <span class="fn">setState</span>(newState) {
    <span class="kw">this</span>._state = { ...<span class="kw">this</span>._state, ...newState };
    <span class="kw">this</span>.<span class="fn">_notify</span>();
  }

  <span class="fn">subscribe</span>(listener) {
    <span class="kw">this</span>._listeners.<span class="fn">add</span>(listener);
    <span class="cm">// Return unsubscribe function!</span>
    <span class="kw">return</span> () => <span class="kw">this</span>._listeners.<span class="fn">delete</span>(listener);
  }

  <span class="fn">_notify</span>() {
    <span class="kw">this</span>._listeners.<span class="fn">forEach</span>(
      fn => <span class="fn">fn</span>(<span class="kw">this</span>._state)
    );
  }
}

<span class="kw">const</span> store = <span class="kw">new</span> <span class="cls">Store</span>({ count: <span class="num">0</span>, user: <span class="kw">null</span> });

<span class="kw">const</span> unsub = store.<span class="fn">subscribe</span>(state => {
  console.<span class="fn">log</span>(<span class="str">'State changed:'</span>, state);
});

store.<span class="fn">setState</span>({ count: <span class="num">1</span> }); <span class="cm">// State changed: {count:1, user:null}</span>
store.<span class="fn">setState</span>({ user: <span class="str">'Bob'</span> }); <span class="cm">// State changed: {count:1, user:'Bob'}</span>
<span class="fn">unsub</span>(); <span class="cm">// Stop listening</span>
store.<span class="fn">setState</span>({ count: <span class="num">2</span> }); <span class="cm">// No output ‚Äî unsubscribed!</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Memory leaks: Forgetting to unsubscribe',
        desc:'Always provide and call unsubscribe functions, especially in SPAs. Leaked listeners keep objects in memory and cause ghost updates.'
      },
      {
        title:'‚ùå Infinite loops from observers triggering each other',
        desc:'Observer A modifies state, which notifies Observer B, which modifies state, which notifies Observer A... Use guards or batched updates.'
      }
    ],
    quiz:[
      {
        q:'In the Observer pattern, what is the "Subject"?',
        opts:['The function that listens for changes','The object being observed that notifies subscribers','The data being passed','The event name'],
        correct:1,
        explain:'The Subject maintains a list of observers and notifies them of state changes.'
      },
      {
        q:'Why is returning an unsubscribe function important?',
        opts:['It makes the code look cleaner','It\'s not important','It prevents memory leaks from dangling references','It speeds up the code'],
        correct:2,
        explain:'Without unsubscribing, old listeners keep running and prevent garbage collection.'
      },
      {
        q:'Which real-world JS API uses the Observer pattern?',
        opts:['Array.map()','addEventListener()','JSON.parse()','Math.random()'],
        correct:1,
        explain:'addEventListener is the browser\'s built-in Observer pattern implementation!'
      }
    ],
    exercise:{
      title:'Build a News Agency System',
      desc:'Create a NewsAgency (publisher) and Subscriber class. The agency should support publishing articles and subscribers should receive them. Include subscribe, unsubscribe, and publish methods.',
      starter:`class NewsAgency {
  constructor(name) {
    this.name = name;
    this.subscribers = [];
    this.articles = [];
  }

  subscribe(subscriber) {
    // TODO: Add subscriber to list
  }

  unsubscribe(subscriber) {
    // TODO: Remove subscriber from list
  }

  publish(article) {
    // TODO: Save article & notify all subscribers
  }
}

class Subscriber {
  constructor(name) {
    this.name = name;
    this.inbox = [];
  }

  receive(article) {
    // TODO: Add to inbox & log it
  }
}

// Test:
const bbc = new NewsAgency('BBC');
const alice = new Subscriber('Alice');
const bob = new Subscriber('Bob');

bbc.subscribe(alice);
bbc.subscribe(bob);
bbc.publish({ title: 'JS is awesome', category: 'Tech' });
// Both should receive it

bbc.unsubscribe(bob);
bbc.publish({ title: 'Design Patterns', category: 'Dev' });
// Only Alice should receive this one

console.log('Alice inbox:', alice.inbox.length); // 2
console.log('Bob inbox:', bob.inbox.length);     // 1`,
      solution:`class NewsAgency {
  constructor(name) { this.name = name; this.subscribers = []; this.articles = []; }
  subscribe(sub) { this.subscribers.push(sub); }
  unsubscribe(sub) { this.subscribers = this.subscribers.filter(s => s !== sub); }
  publish(article) {
    article.source = this.name;
    this.articles.push(article);
    this.subscribers.forEach(s => s.receive(article));
  }
}
class Subscriber {
  constructor(name) { this.name = name; this.inbox = []; }
  receive(article) {
    this.inbox.push(article);
    console.log(\`\${this.name} received: "\${article.title}" from \${article.source}\`);
  }
}`
    }
  },
  {
    id:'module', name:'Module', icon:'üì¶', cat:'structural',
    difficulty:'Beginner',
    subtitle:'Encapsulate & organize your code',
    description:'The Module pattern encapsulates code into self-contained units with <strong>private</strong> and <strong>public</strong> parts. It uses closures (IIFE) to create privacy. Think of it as a box with a lock ‚Äî some things are hidden inside, some are exposed through a window.',
    whenToUse:[
      'Organizing code into logical units',
      'Creating private variables and methods',
      'Avoiding global namespace pollution',
      'Building reusable libraries/utilities',
      'Legacy codebases (before ES modules)'
    ],
    visual:'module',
    examples:[
      {
        title:'Revealing Module Pattern',
        code:`<span class="kw">const</span> <span class="cls">Calculator</span> = (() => {
  <span class="cm">// ‚ùå PRIVATE ‚Äî can't access from outside</span>
  <span class="kw">let</span> history = [];

  <span class="kw">function</span> <span class="fn">_saveToHistory</span>(operation) {
    history.<span class="fn">push</span>({
      ...operation,
      timestamp: <span class="cls">Date</span>.<span class="fn">now</span>()
    });
  }

  <span class="cm">// ‚úÖ PUBLIC ‚Äî exposed through return</span>
  <span class="kw">function</span> <span class="fn">add</span>(a, b) {
    <span class="kw">const</span> result = a + b;
    <span class="fn">_saveToHistory</span>({ op: <span class="str">'add'</span>, a, b, result });
    <span class="kw">return</span> result;
  }

  <span class="kw">function</span> <span class="fn">subtract</span>(a, b) {
    <span class="kw">const</span> result = a - b;
    <span class="fn">_saveToHistory</span>({ op: <span class="str">'sub'</span>, a, b, result });
    <span class="kw">return</span> result;
  }

  <span class="kw">function</span> <span class="fn">getHistory</span>() {
    <span class="kw">return</span> [...history]; <span class="cm">// return copy</span>
  }

  <span class="kw">return</span> { add, subtract, getHistory };
})();

console.<span class="fn">log</span>(<span class="cls">Calculator</span>.<span class="fn">add</span>(<span class="num">5</span>, <span class="num">3</span>));     <span class="cm">// 8</span>
console.<span class="fn">log</span>(<span class="cls">Calculator</span>.<span class="fn">subtract</span>(<span class="num">10</span>, <span class="num">4</span>)); <span class="cm">// 6</span>
console.<span class="fn">log</span>(<span class="cls">Calculator</span>.<span class="fn">getHistory</span>());  <span class="cm">// [...]</span>
console.<span class="fn">log</span>(<span class="cls">Calculator</span>.history);  <span class="cm">// undefined ‚ùå Private!</span>
console.<span class="fn">log</span>(<span class="cls">Calculator</span>._saveToHistory); <span class="cm">// undefined ‚ùå</span>`
      },
      {
        title:'Shopping Cart Module',
        code:`<span class="kw">const</span> <span class="cls">ShoppingCart</span> = (() => {
  <span class="kw">let</span> items = [];
  <span class="kw">let</span> discount = <span class="num">0</span>;

  <span class="kw">const</span> <span class="fn">_calculateTotal</span> = () =>
    items.<span class="fn">reduce</span>((sum, item) =>
      sum + item.price * item.qty, <span class="num">0</span>);

  <span class="kw">return</span> {
    <span class="fn">addItem</span>(name, price, qty = <span class="num">1</span>) {
      <span class="kw">const</span> existing = items.<span class="fn">find</span>(i => i.name === name);
      <span class="kw">if</span> (existing) existing.qty += qty;
      <span class="kw">else</span> items.<span class="fn">push</span>({ name, price, qty });
    },
    <span class="fn">removeItem</span>(name) {
      items = items.<span class="fn">filter</span>(i => i.name !== name);
    },
    <span class="fn">setDiscount</span>(pct) { discount = pct; },
    <span class="fn">getTotal</span>() {
      <span class="kw">const</span> total = <span class="fn">_calculateTotal</span>();
      <span class="kw">return</span> total * (<span class="num">1</span> - discount / <span class="num">100</span>);
    },
    <span class="fn">getItems</span>() { <span class="kw">return</span> [...items]; },
    <span class="fn">clear</span>() { items = []; discount = <span class="num">0</span>; }
  };
})();

<span class="cls">ShoppingCart</span>.<span class="fn">addItem</span>(<span class="str">'Laptop'</span>, <span class="num">999</span>);
<span class="cls">ShoppingCart</span>.<span class="fn">addItem</span>(<span class="str">'Mouse'</span>, <span class="num">29</span>);
<span class="cls">ShoppingCart</span>.<span class="fn">setDiscount</span>(<span class="num">10</span>);
console.<span class="fn">log</span>(<span class="cls">ShoppingCart</span>.<span class="fn">getTotal</span>()); <span class="cm">// 925.2</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Mutating returned private data directly',
        desc:'Always return <strong>copies</strong> of private arrays/objects. If you return the original reference, external code can modify your private state!'
      },
      {
        title:'‚ùå Not using IIFE ‚Äî forgetting the ()',
        bad:`<span class="kw">const</span> myModule = () => { ... }; <span class="cm">// This is just a function!</span>`,
        good:`<span class="kw">const</span> myModule = (() => { ... })(); <span class="cm">// Immediately invoked ‚úÖ</span>`
      }
    ],
    quiz:[
      {
        q:'How does the Module pattern achieve privacy?',
        opts:['Using the private keyword','Using closures and IIFE','Using Symbol','Using WeakMap'],
        correct:1,
        explain:'JavaScript uses closures to create scope-based privacy. Variables inside the IIFE are not accessible from outside.'
      },
      {
        q:'What does IIFE stand for?',
        opts:['Internal Inline Function Expression','Immediately Invoked Function Expression','Imported Interface Function Extension','Iterative Inline Function Execution'],
        correct:1,
        explain:'An IIFE is a function that runs immediately when defined: (function() { ... })();'
      }
    ],
    exercise:{
      title:'Build a Counter Module',
      desc:'Create a counter module with private count variable. Expose increment(), decrement(), getCount(), and reset() methods.',
      starter:`const Counter = (() => {
  // TODO: Private variable
  // TODO: Return public methods

})();

// Test:
Counter.increment();
Counter.increment();
Counter.increment();
console.log(Counter.getCount()); // 3
Counter.decrement();
console.log(Counter.getCount()); // 2
Counter.reset();
console.log(Counter.getCount()); // 0
console.log(Counter.count);      // undefined (private!)`,
      solution:`const Counter = (() => {
  let count = 0;
  return {
    increment() { count++; },
    decrement() { count--; },
    getCount() { return count; },
    reset() { count = 0; }
  };
})();`
    }
  },
  {
    id:'builder', name:'Builder', icon:'üî®', cat:'creational',
    difficulty:'Intermediate',
    subtitle:'Step-by-step complex object construction',
    description:'The Builder pattern constructs complex objects step by step. Instead of a constructor with 15 parameters, you chain method calls. Think of ordering a custom pizza ‚Äî you add each topping one at a time.',
    whenToUse:[
      'Objects with many optional parameters',
      'Creating different representations of the same type',
      'Query builders (SQL, API requests)',
      'UI component configuration',
      'Test data factories'
    ],
    visual:'builder',
    examples:[
      {
        title:'Query Builder',
        code:`<span class="kw">class</span> <span class="cls">QueryBuilder</span> {
  <span class="kw">constructor</span>(table) {
    <span class="kw">this</span>._table = table;
    <span class="kw">this</span>._conditions = [];
    <span class="kw">this</span>._columns = [<span class="str">'*'</span>];
    <span class="kw">this</span>._orderBy = <span class="kw">null</span>;
    <span class="kw">this</span>._limit = <span class="kw">null</span>;
  }

  <span class="fn">select</span>(...cols) {
    <span class="kw">this</span>._columns = cols;
    <span class="kw">return this</span>; <span class="cm">// Enable chaining</span>
  }

  <span class="fn">where</span>(condition) {
    <span class="kw">this</span>._conditions.<span class="fn">push</span>(condition);
    <span class="kw">return this</span>;
  }

  <span class="fn">orderBy</span>(col, dir = <span class="str">'ASC'</span>) {
    <span class="kw">this</span>._orderBy = <span class="str">\`\${col} \${dir}\`</span>;
    <span class="kw">return this</span>;
  }

  <span class="fn">limit</span>(n) {
    <span class="kw">this</span>._limit = n;
    <span class="kw">return this</span>;
  }

  <span class="fn">build</span>() {
    <span class="kw">let</span> query = <span class="str">\`SELECT \${this._columns.join(', ')}
FROM \${this._table}\`</span>;
    <span class="kw">if</span> (<span class="kw">this</span>._conditions.length) {
      query += <span class="str">\` WHERE \${this._conditions.join(' AND ')}\`</span>;
    }
    <span class="kw">if</span> (<span class="kw">this</span>._orderBy) query += <span class="str">\` ORDER BY \${this._orderBy}\`</span>;
    <span class="kw">if</span> (<span class="kw">this</span>._limit) query += <span class="str">\` LIMIT \${this._limit}\`</span>;
    <span class="kw">return</span> query;
  }
}

<span class="kw">const</span> query = <span class="kw">new</span> <span class="cls">QueryBuilder</span>(<span class="str">'users'</span>)
  .<span class="fn">select</span>(<span class="str">'name'</span>, <span class="str">'email'</span>)
  .<span class="fn">where</span>(<span class="str">'age > 18'</span>)
  .<span class="fn">where</span>(<span class="str">"status = 'active'"</span>)
  .<span class="fn">orderBy</span>(<span class="str">'name'</span>)
  .<span class="fn">limit</span>(<span class="num">10</span>)
  .<span class="fn">build</span>();

console.<span class="fn">log</span>(query);
<span class="cm">// SELECT name, email FROM users
// WHERE age > 18 AND status = 'active'
// ORDER BY name ASC LIMIT 10</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Forgetting to return `this` for chaining',
        desc:'Every builder method must <code>return this</code> to enable method chaining. Without it, the chain breaks.'
      }
    ],
    quiz:[
      {
        q:'What is the key benefit of the Builder pattern?',
        opts:['It\'s faster than constructors','It allows step-by-step construction with readable code','It uses less memory','It\'s required for async code'],
        correct:1,
        explain:'Builder replaces complex constructors with a readable, chainable API.'
      }
    ],
    exercise:{
      title:'Build a Pizza Builder',
      desc:'Create a PizzaBuilder with methods: size(), crust(), addTopping(), sauce(), and build(). build() returns a pizza object.',
      starter:`class PizzaBuilder {
  constructor() {
    this._size = 'medium';
    this._crust = 'regular';
    this._sauce = 'tomato';
    this._toppings = [];
  }
  // TODO: Add chaining methods
  // TODO: Add build() method
}

// Test:
const pizza = new PizzaBuilder()
  .size('large')
  .crust('thin')
  .sauce('bbq')
  .addTopping('cheese')
  .addTopping('pepperoni')
  .addTopping('mushrooms')
  .build();

console.log(pizza);`,
      solution:`class PizzaBuilder {
  constructor() {
    this._size = 'medium'; this._crust = 'regular';
    this._sauce = 'tomato'; this._toppings = [];
  }
  size(s) { this._size = s; return this; }
  crust(c) { this._crust = c; return this; }
  sauce(s) { this._sauce = s; return this; }
  addTopping(t) { this._toppings.push(t); return this; }
  build() {
    return { size: this._size, crust: this._crust, sauce: this._sauce, toppings: [...this._toppings] };
  }
}`
    }
  },
  {
    id:'prototype', name:'Prototype', icon:'üß¨', cat:'creational',
    difficulty:'Beginner',
    subtitle:'Clone and extend objects',
    description:'The Prototype pattern creates new objects by <strong>cloning existing ones</strong>. JavaScript is inherently prototype-based, making this pattern natural. Think of it as photocopying a template and modifying the copy.',
    whenToUse:[
      'When object creation is expensive (DB queries, API calls)',
      'Creating variations of a base object',
      'When you need many similar objects with slight differences',
      'Configuration presets'
    ],
    visual:'prototype',
    examples:[
      {
        title:'Cloning Objects',
        code:`<span class="kw">const</span> carPrototype = {
  wheels: <span class="num">4</span>,
  <span class="fn">drive</span>() { <span class="kw">return</span> <span class="str">\`Driving \${this.make} \${this.model}\`</span>; },
  <span class="fn">clone</span>() {
    <span class="kw">return</span> <span class="cls">Object</span>.<span class="fn">create</span>(<span class="kw">this</span>);
  }
};

<span class="kw">const</span> tesla = carPrototype.<span class="fn">clone</span>();
tesla.make = <span class="str">'Tesla'</span>;
tesla.model = <span class="str">'Model 3'</span>;
tesla.electric = <span class="kw">true</span>;

<span class="kw">const</span> ford = carPrototype.<span class="fn">clone</span>();
ford.make = <span class="str">'Ford'</span>;
ford.model = <span class="str">'Mustang'</span>;

console.<span class="fn">log</span>(tesla.<span class="fn">drive</span>()); <span class="cm">// Driving Tesla Model 3</span>
console.<span class="fn">log</span>(ford.<span class="fn">drive</span>());  <span class="cm">// Driving Ford Mustang</span>
console.<span class="fn">log</span>(tesla.wheels);  <span class="cm">// 4 (inherited)</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Shallow copy vs Deep copy',
        desc:'<code>Object.assign</code> and spread only do shallow copies. Nested objects are still references! Use <code>structuredClone()</code> or a deep clone library for nested data.'
      }
    ],
    quiz:[
      {
        q:'What is the main advantage of the Prototype pattern?',
        opts:['Better performance for simple objects','Avoiding expensive object creation by cloning','Making objects immutable','Enforcing a single instance'],
        correct:1,
        explain:'Cloning avoids re-running expensive initialization logic.'
      }
    ],
    exercise:null
  },
  {
    id:'decorator', name:'Decorator', icon:'üé®', cat:'structural',
    difficulty:'Intermediate',
    subtitle:'Wrap objects with superpowers',
    description:'The Decorator pattern <strong>adds new behavior to objects dynamically</strong> by wrapping them. Like adding toppings to ice cream ‚Äî the base stays the same, but you can add as many extras as you want.',
    whenToUse:[
      'Adding logging, caching, or validation without modifying original code',
      'When you can\'t use inheritance (too many combinations)',
      'Adding features to third-party code',
      'Express.js middleware pattern',
      'React Higher-Order Components'
    ],
    visual:'decorator',
    examples:[
      {
        title:'Function Decorators',
        code:`<span class="cm">// üéØ Generic decorator functions</span>

<span class="kw">function</span> <span class="fn">withLogging</span>(fn) {
  <span class="kw">return function</span>(...args) {
    console.<span class="fn">log</span>(<span class="str">\`üìù Calling \${fn.name} with:\`</span>, args);
    <span class="kw">const</span> result = fn.<span class="fn">apply</span>(<span class="kw">this</span>, args);
    console.<span class="fn">log</span>(<span class="str">\`‚úÖ Result:\`</span>, result);
    <span class="kw">return</span> result;
  };
}

<span class="kw">function</span> <span class="fn">withTiming</span>(fn) {
  <span class="kw">return function</span>(...args) {
    <span class="kw">const</span> start = performance.<span class="fn">now</span>();
    <span class="kw">const</span> result = fn.<span class="fn">apply</span>(<span class="kw">this</span>, args);
    <span class="kw">const</span> ms = (performance.<span class="fn">now</span>() - start).<span class="fn">toFixed</span>(<span class="num">2</span>);
    console.<span class="fn">log</span>(<span class="str">\`‚è±Ô∏è \${fn.name} took \${ms}ms\`</span>);
    <span class="kw">return</span> result;
  };
}

<span class="kw">function</span> <span class="fn">multiply</span>(a, b) { <span class="kw">return</span> a * b; }

<span class="cm">// Stack decorators!</span>
<span class="kw">const</span> enhanced = <span class="fn">withLogging</span>(<span class="fn">withTiming</span>(multiply));
<span class="fn">enhanced</span>(<span class="num">5</span>, <span class="num">3</span>);
<span class="cm">// üìù Calling multiply with: [5, 3]</span>
<span class="cm">// ‚è±Ô∏è multiply took 0.01ms</span>
<span class="cm">// ‚úÖ Result: 15</span>`
      },
      {
        title:'Class Decorator Pattern',
        code:`<span class="kw">class</span> <span class="cls">Coffee</span> {
  <span class="fn">cost</span>() { <span class="kw">return</span> <span class="num">5</span>; }
  <span class="fn">description</span>() { <span class="kw">return</span> <span class="str">'Coffee'</span>; }
}

<span class="kw">class</span> <span class="cls">MilkDecorator</span> {
  <span class="kw">constructor</span>(coffee) { <span class="kw">this</span>.coffee = coffee; }
  <span class="fn">cost</span>() { <span class="kw">return this</span>.coffee.<span class="fn">cost</span>() + <span class="num">2</span>; }
  <span class="fn">description</span>() {
    <span class="kw">return this</span>.coffee.<span class="fn">description</span>() + <span class="str">' + Milk'</span>;
  }
}

<span class="kw">class</span> <span class="cls">SugarDecorator</span> {
  <span class="kw">constructor</span>(coffee) { <span class="kw">this</span>.coffee = coffee; }
  <span class="fn">cost</span>() { <span class="kw">return this</span>.coffee.<span class="fn">cost</span>() + <span class="num">1</span>; }
  <span class="fn">description</span>() {
    <span class="kw">return this</span>.coffee.<span class="fn">description</span>() + <span class="str">' + Sugar'</span>;
  }
}

<span class="kw">let</span> order = <span class="kw">new</span> <span class="cls">Coffee</span>();
order = <span class="kw">new</span> <span class="cls">MilkDecorator</span>(order);
order = <span class="kw">new</span> <span class="cls">SugarDecorator</span>(order);

console.<span class="fn">log</span>(order.<span class="fn">description</span>()); <span class="cm">// Coffee + Milk + Sugar</span>
console.<span class="fn">log</span>(order.<span class="fn">cost</span>());        <span class="cm">// 8</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Too many decorators = unreadable stack',
        desc:'10 layers of decoration makes debugging a nightmare. Keep decorator chains short and meaningful.'
      }
    ],
    quiz:[
      {
        q:'How is the Decorator pattern different from inheritance?',
        opts:['Decorators are slower','Decorators add behavior at runtime, not compile time','There is no difference','Decorators only work with functions'],
        correct:1,
        explain:'Decorators wrap objects dynamically, allowing flexible combinations without rigid class hierarchies.'
      }
    ],
    exercise:null
  },
  {
    id:'strategy', name:'Strategy', icon:'üéØ', cat:'behavioral',
    difficulty:'Intermediate',
    subtitle:'Swap algorithms on the fly',
    description:'The Strategy pattern defines a family of <strong>interchangeable algorithms</strong>. Instead of hardcoding one way to do something, you make it pluggable. Think of GPS navigation ‚Äî same destination, different route strategies (fastest, shortest, scenic).',
    whenToUse:[
      'When you have multiple algorithms for the same task',
      'Form validation with different rules',
      'Payment processing (credit card, PayPal, crypto)',
      'Sorting with different strategies',
      'Shipping cost calculation',
      'Authentication methods'
    ],
    visual:'strategy',
    examples:[
      {
        title:'Payment Processing',
        code:`<span class="kw">const</span> strategies = {
  creditCard: {
    <span class="fn">pay</span>(amount) {
      <span class="kw">return</span> <span class="str">\`üí≥ Paid $\${amount} via Credit Card\`</span>;
    },
    <span class="fn">validate</span>(data) {
      <span class="kw">return</span> data.number && data.cvv && data.expiry;
    }
  },
  paypal: {
    <span class="fn">pay</span>(amount) {
      <span class="kw">return</span> <span class="str">\`üÖøÔ∏è Paid $\${amount} via PayPal\`</span>;
    },
    <span class="fn">validate</span>(data) {
      <span class="kw">return</span> data.email && data.password;
    }
  },
  crypto: {
    <span class="fn">pay</span>(amount) {
      <span class="kw">return</span> <span class="str">\`‚Çø Paid $\${amount} via Crypto\`</span>;
    },
    <span class="fn">validate</span>(data) {
      <span class="kw">return</span> data.walletAddress;
    }
  }
};

<span class="kw">class</span> <span class="cls">PaymentProcessor</span> {
  <span class="kw">constructor</span>(strategy) {
    <span class="kw">this</span>.strategy = strategies[strategy];
  }

  <span class="fn">setStrategy</span>(strategy) {
    <span class="kw">this</span>.strategy = strategies[strategy];
  }

  <span class="fn">checkout</span>(amount, data) {
    <span class="kw">if</span> (!<span class="kw">this</span>.strategy.<span class="fn">validate</span>(data)) {
      <span class="kw">throw new</span> <span class="cls">Error</span>(<span class="str">'Invalid payment data'</span>);
    }
    <span class="kw">return this</span>.strategy.<span class="fn">pay</span>(amount);
  }
}

<span class="kw">const</span> processor = <span class="kw">new</span> <span class="cls">PaymentProcessor</span>(<span class="str">'creditCard'</span>);
console.<span class="fn">log</span>(processor.<span class="fn">checkout</span>(<span class="num">99</span>, {
  number: <span class="str">'4111...'</span>, cvv: <span class="str">'123'</span>, expiry: <span class="str">'12/25'</span>
}));
<span class="cm">// üí≥ Paid $99 via Credit Card</span>

processor.<span class="fn">setStrategy</span>(<span class="str">'paypal'</span>); <span class="cm">// Switch!</span>
console.<span class="fn">log</span>(processor.<span class="fn">checkout</span>(<span class="num">49</span>, {
  email: <span class="str">'a@b.com'</span>, password: <span class="str">'***'</span>
}));
<span class="cm">// üÖøÔ∏è Paid $49 via PayPal</span>`
      },
      {
        title:'Validation Strategy',
        code:`<span class="kw">const</span> validators = {
  <span class="fn">required</span>(val)  { <span class="kw">return</span> val !== <span class="str">''</span> && val != <span class="kw">null</span>; },
  <span class="fn">email</span>(val)     { <span class="kw">return</span> <span class="str">/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/</span>.<span class="fn">test</span>(val); },
  <span class="fn">minLength</span>(n)   { <span class="kw">return</span> val => val.length >= n; },
  <span class="fn">maxLength</span>(n)   { <span class="kw">return</span> val => val.length <= n; },
  <span class="fn">isNumber</span>(val)  { <span class="kw">return</span> !<span class="fn">isNaN</span>(val); },
};

<span class="kw">function</span> <span class="fn">validate</span>(value, ...rules) {
  <span class="kw">return</span> rules.<span class="fn">every</span>(rule => <span class="fn">rule</span>(value));
}

console.<span class="fn">log</span>(<span class="fn">validate</span>(<span class="str">'hello@test.com'</span>,
  validators.required,
  validators.email
)); <span class="cm">// true</span>

console.<span class="fn">log</span>(<span class="fn">validate</span>(<span class="str">''</span>,
  validators.required
)); <span class="cm">// false</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Hardcoding if/else chains instead of strategies',
        desc:'If you have <code>if (type === "a") ... else if (type === "b") ... </code> growing forever, you need the Strategy pattern.'
      }
    ],
    quiz:[
      {
        q:'What does the Strategy pattern replace?',
        opts:['Switch statements with dynamic algorithm selection','Class inheritance','Global variables','Event listeners'],
        correct:0,
        explain:'Strategy replaces rigid conditional logic with pluggable, interchangeable algorithms.'
      },
      {
        q:'In the Strategy pattern, what is the "Context"?',
        opts:['The algorithm itself','The object that uses the strategy','The input data','The return value'],
        correct:1,
        explain:'The Context holds a reference to the current strategy and delegates work to it.'
      }
    ],
    exercise:null
  },
  {
    id:'facade', name:'Facade', icon:'üèõÔ∏è', cat:'structural',
    difficulty:'Beginner',
    subtitle:'Simple interface, complex internals',
    description:'The Facade pattern provides a <strong>simplified interface</strong> to a complex subsystem. Like a hotel concierge ‚Äî you just say what you need, and they handle all the complex coordination behind the scenes.',
    whenToUse:[
      'Simplifying complex library APIs',
      'Wrapping multiple API calls into one',
      'Providing a clean interface to legacy code',
      'Cross-browser compatibility layers',
      'jQuery is a giant Facade!'
    ],
    visual:'facade',
    examples:[
      {
        title:'Computer Boot Facade',
        code:`<span class="cm">// Complex subsystem classes</span>
<span class="kw">class</span> <span class="cls">CPU</span> {
  <span class="fn">freeze</span>()  { console.<span class="fn">log</span>(<span class="str">'CPU: Freezing...'</span>); }
  <span class="fn">jump</span>(pos) { console.<span class="fn">log</span>(<span class="str">\`CPU: Jumping to \${pos}\`</span>); }
  <span class="fn">execute</span>() { console.<span class="fn">log</span>(<span class="str">'CPU: Executing...'</span>); }
}

<span class="kw">class</span> <span class="cls">Memory</span> {
  <span class="fn">load</span>(pos, data) {
    console.<span class="fn">log</span>(<span class="str">\`Memory: Loading "\${data}" at \${pos}\`</span>);
  }
}

<span class="kw">class</span> <span class="cls">HardDrive</span> {
  <span class="fn">read</span>(sector, size) {
    console.<span class="fn">log</span>(<span class="str">\`HD: Reading sector \${sector}\`</span>);
    <span class="kw">return</span> <span class="str">'boot_data'</span>;
  }
}

<span class="cm">// üèõÔ∏è FACADE ‚Äî One simple method!</span>
<span class="kw">class</span> <span class="cls">ComputerFacade</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">this</span>.cpu = <span class="kw">new</span> <span class="cls">CPU</span>();
    <span class="kw">this</span>.memory = <span class="kw">new</span> <span class="cls">Memory</span>();
    <span class="kw">this</span>.hd = <span class="kw">new</span> <span class="cls">HardDrive</span>();
  }

  <span class="fn">start</span>() {
    <span class="kw">this</span>.cpu.<span class="fn">freeze</span>();
    <span class="kw">this</span>.memory.<span class="fn">load</span>(<span class="num">0</span>, <span class="kw">this</span>.hd.<span class="fn">read</span>(<span class="num">0</span>, <span class="num">1024</span>));
    <span class="kw">this</span>.cpu.<span class="fn">jump</span>(<span class="num">0</span>);
    <span class="kw">this</span>.cpu.<span class="fn">execute</span>();
    console.<span class="fn">log</span>(<span class="str">'‚úÖ Computer started!'</span>);
  }
}

<span class="cm">// Client: One line instead of five!</span>
<span class="kw">const</span> computer = <span class="kw">new</span> <span class="cls">ComputerFacade</span>();
computer.<span class="fn">start</span>();`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Making the Facade do too much (God object)',
        desc:'A facade should <em>delegate</em> to subsystems, not contain all the logic itself. Keep it thin!'
      }
    ],
    quiz:[
      {
        q:'What\'s a real-world example of the Facade pattern in JS?',
        opts:['Array.prototype.map','jQuery ($)','Promise.resolve','console.log'],
        correct:1,
        explain:'jQuery wraps complex DOM manipulation, AJAX, and animations behind a simple $ interface.'
      }
    ],
    exercise:null
  },
  {
    id:'adapter', name:'Adapter', icon:'üîå', cat:'structural',
    difficulty:'Intermediate',
    subtitle:'Bridge incompatible interfaces',
    description:'The Adapter pattern converts one interface into another that clients expect. Like a power adapter when traveling ‚Äî the outlet is different, but your device still works.',
    whenToUse:[
      'Integrating third-party libraries with different APIs',
      'Working with legacy code that can\'t be modified',
      'Normalizing data from different sources',
      'Switching between API versions'
    ],
    visual:'adapter',
    examples:[
      {
        title:'API Response Adapter',
        code:`<span class="cm">// Old API returns XML-style objects</span>
<span class="kw">const</span> oldApi = {
  <span class="fn">getUsers</span>() {
    <span class="kw">return</span> {
      data: { items: [
        { user_name: <span class="str">'john_doe'</span>, e_mail: <span class="str">'john@x.com'</span> },
        { user_name: <span class="str">'jane'</span>, e_mail: <span class="str">'jane@x.com'</span> },
      ]}
    };
  }
};

<span class="cm">// New code expects this format:</span>
<span class="cm">// [{ username, email }]</span>

<span class="cm">// üîå ADAPTER</span>
<span class="kw">class</span> <span class="cls">UserApiAdapter</span> {
  <span class="kw">constructor</span>(oldApi) {
    <span class="kw">this</span>.api = oldApi;
  }

  <span class="fn">getUsers</span>() {
    <span class="kw">const</span> rawData = <span class="kw">this</span>.api.<span class="fn">getUsers</span>();
    <span class="kw">return</span> rawData.data.items.<span class="fn">map</span>(user => ({
      username: user.user_name,
      email: user.e_mail,
    }));
  }
}

<span class="kw">const</span> adapter = <span class="kw">new</span> <span class="cls">UserApiAdapter</span>(oldApi);
console.<span class="fn">log</span>(adapter.<span class="fn">getUsers</span>());
<span class="cm">// [{ username:'john_doe', email:'john@x.com' }, ...]</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Adapting everything ‚Äî might signal a bigger design problem',
        desc:'If you have adapters everywhere, maybe the underlying interfaces need to be redesigned instead.'
      }
    ],
    quiz:[
      {
        q:'When is the Adapter pattern most useful?',
        opts:['When building new code from scratch','When integrating code with incompatible interfaces','When you need better performance','When storing data'],
        correct:1,
        explain:'Adapters shine when connecting systems that weren\'t designed to work together.'
      }
    ],
    exercise:null
  },
  {
    id:'command', name:'Command', icon:'üìú', cat:'behavioral',
    difficulty:'Advanced',
    subtitle:'Encapsulate actions as objects',
    description:'The Command pattern encapsulates a request as an object, allowing you to parameterize, queue, log, and <strong>undo operations</strong>. Think of a TV remote ‚Äî each button is a command object.',
    whenToUse:[
      'Undo/Redo functionality',
      'Task queues and scheduling',
      'Macro recording (replay sequences of actions)',
      'Transaction systems',
      'Menu items and toolbar buttons'
    ],
    visual:'command',
    examples:[
      {
        title:'Undo/Redo System',
        code:`<span class="kw">class</span> <span class="cls">TextEditor</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">this</span>.content = <span class="str">''</span>;
    <span class="kw">this</span>.history = [];
    <span class="kw">this</span>.redoStack = [];
  }

  <span class="fn">execute</span>(command) {
    command.<span class="fn">execute</span>();
    <span class="kw">this</span>.history.<span class="fn">push</span>(command);
    <span class="kw">this</span>.redoStack = []; <span class="cm">// clear redo on new action</span>
  }

  <span class="fn">undo</span>() {
    <span class="kw">const</span> cmd = <span class="kw">this</span>.history.<span class="fn">pop</span>();
    <span class="kw">if</span> (cmd) {
      cmd.<span class="fn">undo</span>();
      <span class="kw">this</span>.redoStack.<span class="fn">push</span>(cmd);
    }
  }

  <span class="fn">redo</span>() {
    <span class="kw">const</span> cmd = <span class="kw">this</span>.redoStack.<span class="fn">pop</span>();
    <span class="kw">if</span> (cmd) {
      cmd.<span class="fn">execute</span>();
      <span class="kw">this</span>.history.<span class="fn">push</span>(cmd);
    }
  }
}

<span class="kw">class</span> <span class="cls">InsertTextCommand</span> {
  <span class="kw">constructor</span>(editor, text) {
    <span class="kw">this</span>.editor = editor;
    <span class="kw">this</span>.text = text;
  }
  <span class="fn">execute</span>() { <span class="kw">this</span>.editor.content += <span class="kw">this</span>.text; }
  <span class="fn">undo</span>()    {
    <span class="kw">this</span>.editor.content = <span class="kw">this</span>.editor.content
      .<span class="fn">slice</span>(<span class="num">0</span>, -<span class="kw">this</span>.text.length);
  }
}

<span class="kw">const</span> editor = <span class="kw">new</span> <span class="cls">TextEditor</span>();
editor.<span class="fn">execute</span>(<span class="kw">new</span> <span class="cls">InsertTextCommand</span>(editor, <span class="str">'Hello '</span>));
editor.<span class="fn">execute</span>(<span class="kw">new</span> <span class="cls">InsertTextCommand</span>(editor, <span class="str">'World'</span>));
console.<span class="fn">log</span>(editor.content); <span class="cm">// "Hello World"</span>

editor.<span class="fn">undo</span>();
console.<span class="fn">log</span>(editor.content); <span class="cm">// "Hello "</span>

editor.<span class="fn">redo</span>();
console.<span class="fn">log</span>(editor.content); <span class="cm">// "Hello World"</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Forgetting to implement undo()',
        desc:'A command without undo is just a function call. The power of Command pattern lies in reversibility.'
      }
    ],
    quiz:[
      {
        q:'What makes the Command pattern special compared to regular function calls?',
        opts:['It\'s faster','Commands can be queued, undone, and replayed','It uses less memory','Commands are asynchronous'],
        correct:1,
        explain:'By encapsulating actions as objects, you gain undo/redo, queuing, and logging capabilities.'
      }
    ],
    exercise:null
  },
  {
    id:'iterator', name:'Iterator', icon:'üîÑ', cat:'behavioral',
    difficulty:'Intermediate',
    subtitle:'Traverse collections elegantly',
    description:'The Iterator pattern provides a way to access elements of a collection <strong>sequentially without exposing its underlying structure</strong>. JavaScript has built-in iterator protocol (Symbol.iterator) and generators.',
    whenToUse:[
      'Custom data structures that need to be iterable',
      'Lazy evaluation (compute values on demand)',
      'Infinite sequences',
      'Streaming data processing',
      'Tree/graph traversal'
    ],
    visual:'iterator',
    examples:[
      {
        title:'Custom Iterable Range',
        code:`<span class="kw">class</span> <span class="cls">Range</span> {
  <span class="kw">constructor</span>(start, end, step = <span class="num">1</span>) {
    <span class="kw">this</span>.start = start;
    <span class="kw">this</span>.end = end;
    <span class="kw">this</span>.step = step;
  }

  <span class="cm">// Make it work with for...of!</span>
  [<span class="cls">Symbol</span>.iterator]() {
    <span class="kw">let</span> current = <span class="kw">this</span>.start;
    <span class="kw">const</span> end = <span class="kw">this</span>.end;
    <span class="kw">const</span> step = <span class="kw">this</span>.step;

    <span class="kw">return</span> {
      <span class="fn">next</span>() {
        <span class="kw">if</span> (current <= end) {
          <span class="kw">const</span> value = current;
          current += step;
          <span class="kw">return</span> { value, done: <span class="kw">false</span> };
        }
        <span class="kw">return</span> { done: <span class="kw">true</span> };
      }
    };
  }
}

<span class="kw">for</span> (<span class="kw">const</span> n <span class="kw">of new</span> <span class="cls">Range</span>(<span class="num">1</span>, <span class="num">10</span>, <span class="num">2</span>)) {
  console.<span class="fn">log</span>(n); <span class="cm">// 1, 3, 5, 7, 9</span>
}

<span class="cm">// Works with spread too!</span>
console.<span class="fn">log</span>([...<span class="kw">new</span> <span class="cls">Range</span>(<span class="num">1</span>, <span class="num">5</span>)]); <span class="cm">// [1, 2, 3, 4, 5]</span>`
      },
      {
        title:'Generator-based Iterator',
        code:`<span class="kw">function</span>* <span class="fn">fibonacci</span>(limit = <span class="cls">Infinity</span>) {
  <span class="kw">let</span> [a, b] = [<span class="num">0</span>, <span class="num">1</span>];
  <span class="kw">while</span> (a <= limit) {
    <span class="kw">yield</span> a;
    [a, b] = [b, a + b];
  }
}

<span class="cm">// Lazy! Only computes when needed</span>
<span class="kw">for</span> (<span class="kw">const</span> n <span class="kw">of</span> <span class="fn">fibonacci</span>(<span class="num">100</span>)) {
  console.<span class="fn">log</span>(n);
  <span class="cm">// 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89</span>
}

<span class="cm">// Take first N items from infinite sequence</span>
<span class="kw">function</span>* <span class="fn">take</span>(iterable, n) {
  <span class="kw">let</span> i = <span class="num">0</span>;
  <span class="kw">for</span> (<span class="kw">const</span> item <span class="kw">of</span> iterable) {
    <span class="kw">if</span> (i++ >= n) <span class="kw">return</span>;
    <span class="kw">yield</span> item;
  }
}

console.<span class="fn">log</span>([...<span class="fn">take</span>(<span class="fn">fibonacci</span>(), <span class="num">8</span>)]);
<span class="cm">// [0, 1, 1, 2, 3, 5, 8, 13]</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Not using generators when they would simplify code',
        desc:'Generators make iterators much simpler. If you\'re manually managing state in next(), use a generator function instead.'
      }
    ],
    quiz:[
      {
        q:'Which Symbol makes an object iterable with for...of?',
        opts:['Symbol.iterator','Symbol.toPrimitive','Symbol.species','Symbol.hasInstance'],
        correct:0,
        explain:'Symbol.iterator defines the default iterator for an object, enabling for...of loops.'
      }
    ],
    exercise:null
  },
  {
    id:'proxy', name:'Proxy', icon:'üõ°Ô∏è', cat:'structural',
    difficulty:'Advanced',
    subtitle:'Control access to objects',
    description:'The Proxy pattern provides a <strong>surrogate or placeholder</strong> for another object to control access to it. JavaScript has a built-in <code>Proxy</code> object. Think of a bouncer at a club ‚Äî they control who gets in.',
    whenToUse:[
      'Input validation on property setting',
      'Lazy initialization (virtual proxy)',
      'Logging/auditing property access',
      'Access control (protection proxy)',
      'Caching expensive operations'
    ],
    visual:'proxy',
    examples:[
      {
        title:'Validation Proxy',
        code:`<span class="kw">const</span> <span class="fn">createValidatedUser</span> = (user) => {
  <span class="kw">return new</span> <span class="cls">Proxy</span>(user, {
    <span class="fn">set</span>(target, prop, value) {
      <span class="kw">if</span> (prop === <span class="str">'age'</span>) {
        <span class="kw">if</span> (<span class="kw">typeof</span> value !== <span class="str">'number'</span>) {
          <span class="kw">throw new</span> <span class="cls">TypeError</span>(<span class="str">'Age must be a number'</span>);
        }
        <span class="kw">if</span> (value < <span class="num">0</span> || value > <span class="num">150</span>) {
          <span class="kw">throw new</span> <span class="cls">RangeError</span>(<span class="str">'Age must be 0-150'</span>);
        }
      }
      <span class="kw">if</span> (prop === <span class="str">'email'</span>) {
        <span class="kw">if</span> (!<span class="str">/\\S+@\\S+\\.\\S+/</span>.<span class="fn">test</span>(value)) {
          <span class="kw">throw new</span> <span class="cls">Error</span>(<span class="str">'Invalid email'</span>);
        }
      }
      target[prop] = value;
      console.<span class="fn">log</span>(<span class="str">\`‚úÖ Set \${prop} = \${value}\`</span>);
      <span class="kw">return true</span>;
    },

    <span class="fn">get</span>(target, prop) {
      <span class="kw">if</span> (prop <span class="kw">in</span> target) {
        console.<span class="fn">log</span>(<span class="str">\`üìñ Accessed \${prop}\`</span>);
        <span class="kw">return</span> target[prop];
      }
      <span class="kw">return</span> <span class="kw">undefined</span>;
    }
  });
};

<span class="kw">const</span> user = <span class="fn">createValidatedUser</span>({});
user.name = <span class="str">'Alice'</span>;  <span class="cm">// ‚úÖ Set name = Alice</span>
user.age = <span class="num">25</span>;       <span class="cm">// ‚úÖ Set age = 25</span>
<span class="cm">// user.age = -5;      // ‚ùå RangeError!</span>
<span class="cm">// user.age = 'old';   // ‚ùå TypeError!</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Performance overhead of Proxy traps',
        desc:'Proxy traps run on every property access/set. Don\'t use Proxy in hot loops or performance-critical code.'
      }
    ],
    quiz:[
      {
        q:'What built-in JS feature implements the Proxy pattern?',
        opts:['Object.freeze()','The Proxy constructor','Object.defineProperty()','Reflect API only'],
        correct:1,
        explain:'JavaScript has a native Proxy object that intercepts operations on another object.'
      }
    ],
    exercise:null
  },
  {
    id:'mediator', name:'Mediator', icon:'üó£Ô∏è', cat:'behavioral',
    difficulty:'Advanced',
    subtitle:'Central communication hub',
    description:'The Mediator pattern defines an object that encapsulates how a set of objects interact. Instead of objects talking directly to each other (chaos!), they communicate through the mediator. Think of an air traffic controller.',
    whenToUse:[
      'Chat rooms (users don\'t message each other directly)',
      'Form components that depend on each other',
      'UI components coordination',
      'Game entity interaction'
    ],
    visual:'mediator',
    examples:[
      {
        title:'Chat Room Mediator',
        code:`<span class="kw">class</span> <span class="cls">ChatRoom</span> {
  <span class="kw">constructor</span>() {
    <span class="kw">this</span>.users = <span class="kw">new</span> <span class="cls">Map</span>();
  }

  <span class="fn">join</span>(user) {
    <span class="kw">this</span>.users.<span class="fn">set</span>(user.name, user);
    user.chatRoom = <span class="kw">this</span>;
    <span class="kw">this</span>.<span class="fn">broadcast</span>(
      <span class="str">\`\${user.name} joined the chat\`</span>, user
    );
  }

  <span class="fn">send</span>(message, from, to) {
    <span class="kw">if</span> (to) {
      <span class="cm">// Direct message</span>
      <span class="kw">const</span> target = <span class="kw">this</span>.users.<span class="fn">get</span>(to);
      <span class="kw">if</span> (target) target.<span class="fn">receive</span>(message, from.name);
    } <span class="kw">else</span> {
      <span class="cm">// Broadcast to all</span>
      <span class="kw">this</span>.<span class="fn">broadcast</span>(message, from);
    }
  }

  <span class="fn">broadcast</span>(message, sender) {
    <span class="kw">this</span>.users.<span class="fn">forEach</span>((user, name) => {
      <span class="kw">if</span> (name !== sender?.name) {
        user.<span class="fn">receive</span>(message, sender?.name || <span class="str">'System'</span>);
      }
    });
  }
}

<span class="kw">class</span> <span class="cls">User</span> {
  <span class="kw">constructor</span>(name) {
    <span class="kw">this</span>.name = name;
    <span class="kw">this</span>.chatRoom = <span class="kw">null</span>;
    <span class="kw">this</span>.messages = [];
  }

  <span class="fn">send</span>(msg, to) {
    <span class="kw">this</span>.chatRoom.<span class="fn">send</span>(msg, <span class="kw">this</span>, to);
  }

  <span class="fn">receive</span>(msg, from) {
    <span class="kw">this</span>.messages.<span class="fn">push</span>({ msg, from });
    console.<span class="fn">log</span>(<span class="str">\`[\${this.name}] \${from}: \${msg}\`</span>);
  }
}

<span class="kw">const</span> room = <span class="kw">new</span> <span class="cls">ChatRoom</span>();
<span class="kw">const</span> alice = <span class="kw">new</span> <span class="cls">User</span>(<span class="str">'Alice'</span>);
<span class="kw">const</span> bob = <span class="kw">new</span> <span class="cls">User</span>(<span class="str">'Bob'</span>);

room.<span class="fn">join</span>(alice);
room.<span class="fn">join</span>(bob);
alice.<span class="fn">send</span>(<span class="str">'Hey Bob!'</span>, <span class="str">'Bob'</span>);  <span class="cm">// DM</span>
bob.<span class="fn">send</span>(<span class="str">'Hello everyone!'</span>);     <span class="cm">// Broadcast</span>`
      }
    ],
    mistakes:[
      {
        title:'‚ùå Making the mediator a God object',
        desc:'The mediator should coordinate, not contain all business logic. Keep it focused on routing communication.'
      }
    ],
    quiz:[
      {
        q:'What problem does the Mediator pattern solve?',
        opts:['Slow performance','Tight coupling between many objects that communicate','Memory leaks','Async operations'],
        correct:1,
        explain:'Mediator centralizes complex communications between multiple objects, reducing direct dependencies.'
      }
    ],
    exercise:null
  }
];

const allQuiz = [
  { q:'Which pattern ensures a class has only one instance?', opts:['Factory','Singleton','Builder','Prototype'], correct:1, explain:'Singleton restricts instantiation to a single instance.' },
  { q:'Which pattern creates objects without specifying exact classes?', opts:['Observer','Command','Factory','Decorator'], correct:2, explain:'Factory pattern handles object creation based on input type.' },
  { q:'Which pattern is best for implementing undo/redo?', opts:['Strategy','Command','Observer','Singleton'], correct:1, explain:'Command pattern encapsulates actions as objects, making them reversible.' },
  { q:'Which pattern is built into JavaScript\'s prototype chain?', opts:['Factory','Singleton','Prototype','Module'], correct:2, explain:'JavaScript is inherently prototype-based ‚Äî objects can inherit from other objects.' },
  { q:'addEventListener() is an example of which pattern?', opts:['Singleton','Factory','Strategy','Observer'], correct:3, explain:'addEventListener follows the Observer/Pub-Sub pattern.' },
  { q:'Which pattern is used when you need to simplify a complex API?', opts:['Adapter','Facade','Decorator','Builder'], correct:1, explain:'Facade provides a simplified interface to a complex subsystem.' },
  { q:'Which pattern should you use for step-by-step object construction?', opts:['Factory','Prototype','Builder','Singleton'], correct:2, explain:'Builder lets you construct complex objects step by step with method chaining.' },
  { q:'Which pattern wraps an object to add new behavior?', opts:['Adapter','Proxy','Decorator','Facade'], correct:2, explain:'Decorator dynamically adds responsibilities to an object.' },
  { q:'What is the key feature of the Strategy pattern?', opts:['Single instance','Interchangeable algorithms','Object cloning','Event subscription'], correct:1, explain:'Strategy allows swapping algorithms at runtime.' },
  { q:'Which pattern converts one interface to another?', opts:['Facade','Bridge','Adapter','Proxy'], correct:2, explain:'Adapter makes incompatible interfaces work together.' },
  { q:'Symbol.iterator is associated with which pattern?', opts:['Observer','Iterator','Command','Strategy'], correct:1, explain:'Symbol.iterator defines how an object is iterated with for...of.' },
  { q:'Which structural pattern controls access to an object?', opts:['Decorator','Adapter','Proxy','Module'], correct:2, explain:'Proxy intercepts and controls operations on another object.' },
  { q:'In the Module pattern, what creates privacy?', opts:['The private keyword','Closures / IIFE','Symbols','WeakMap'], correct:1, explain:'Module pattern uses closures to keep variables private within the function scope.' },
  { q:'Which pattern acts as a central hub for communication?', opts:['Observer','Mediator','Command','Facade'], correct:1, explain:'Mediator centralizes communication between multiple objects.' },
  { q:'What is the main risk of overusing the Singleton pattern?', opts:['Too much memory usage','Hard to test due to global state','Makes code faster','No risks at all'], correct:1, explain:'Singletons introduce global state and hidden dependencies, making unit testing difficult.' },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let state = {
  currentView: 'dashboard',
  xp: 0,
  completed: JSON.parse(localStorage.getItem('dp_completed') || '{}'),
  quizAnswers: {},
  finalQuizIndex: 0,
  finalQuizAnswers: {},
  finalQuizSubmitted: false
};

function saveState() {
  localStorage.setItem('dp_completed', JSON.stringify(state.completed));
}

function addXP(amount) {
  state.xp += amount;
  document.getElementById('xpCount').textContent = state.xp;
}

function updateProgress() {
  const total = patterns.length;
  const done = Object.keys(state.completed).length;
  const pct = Math.round((done / total) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = pct + '% Complete';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SIDEBAR RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSidebar() {
  const sidebar = document.getElementById('sidebar');
  const categories = [
    { key: 'dashboard', label: 'üè† Dashboard', items: [] },
    { key: 'creational', label: 'üî® CREATIONAL', items: patterns.filter(p => p.cat === 'creational') },
    { key: 'structural', label: 'üèóÔ∏è STRUCTURAL', items: patterns.filter(p => p.cat === 'structural') },
    { key: 'behavioral', label: 'üé≠ BEHAVIORAL', items: patterns.filter(p => p.cat === 'behavioral') },
    { key: 'quiz', label: 'üèÜ Grand Quiz', items: [] },
    { key: 'cheatsheet', label: 'üìã Cheat Sheet', items: [] }
  ];

  let html = '';
  categories.forEach(cat => {
    if (cat.items.length > 0) {
      html += `<div class="nav-section"><div class="nav-title">${cat.label}</div>`;
      cat.items.forEach(p => {
        const isActive = state.currentView === p.id;
        const isDone = state.completed[p.id];
        html += `<div class="nav-item cat-${p.cat} ${isActive ? 'active' : ''}" data-view="${p.id}">
          <span class="icon">${p.icon}</span> ${p.name}
          ${isDone ? '<span class="check">‚úÖ</span>' : ''}
        </div>`;
      });
      html += `</div>`;
    } else {
      const isActive = state.currentView === cat.key;
      html += `<div class="nav-item ${isActive ? 'active' : ''}" data-view="${cat.key}" style="margin:4px 0">
        <span>${cat.label}</span>
      </div>`;
    }
  });

  sidebar.innerHTML = html;
  sidebar.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', () => {
      navigateTo(item.dataset.view);
      document.getElementById('sidebar').classList.remove('open');
    });
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VIEW RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function navigateTo(viewId) {
  state.currentView = viewId;
  renderSidebar();
  renderMain();
}

function renderMain() {
  const main = document.getElementById('main');
  const view = state.currentView;

  if (view === 'dashboard') {
    main.innerHTML = renderDashboard();
  } else if (view === 'quiz') {
    main.innerHTML = renderFinalQuiz();
    setupFinalQuiz();
  } else if (view === 'cheatsheet') {
    main.innerHTML = renderCheatSheet();
  } else {
    const pattern = patterns.find(p => p.id === view);
    if (pattern) {
      main.innerHTML = renderPatternDetail(pattern);
      setupPatternInteractions(pattern);
    }
  }
}

function renderDashboard() {
  const completed = Object.keys(state.completed).length;
  const total = patterns.length;
  return `
  <div class="view active">
    <div class="hero">
      <h1>JavaScript Design Patterns</h1>
      <p>Master the patterns that top companies expect you to know. Interactive lessons, visual explanations, real-world examples, and hands-on exercises.</p>
      <div style="margin-bottom:40px">
        <span style="font-size:1.1rem;color:var(--dim)">${completed}/${total} patterns completed</span>
      </div>
      <div class="hero-cards">
        <div class="hero-card" onclick="navigateTo('${patterns.find(p=>p.cat==='creational').id}')">
          <div class="hc-icon">üî®</div>
          <h3>Creational Patterns</h3>
          <p>Singleton, Factory, Builder, Prototype ‚Äî smart ways to create objects</p>
        </div>
        <div class="hero-card" onclick="navigateTo('${patterns.find(p=>p.cat==='structural').id}')">
          <div class="hc-icon">üèóÔ∏è</div>
          <h3>Structural Patterns</h3>
          <p>Module, Decorator, Facade, Adapter, Proxy ‚Äî organize and compose objects</p>
        </div>
        <div class="hero-card" onclick="navigateTo('${patterns.find(p=>p.cat==='behavioral').id}')">
          <div class="hc-icon">üé≠</div>
          <h3>Behavioral Patterns</h3>
          <p>Observer, Strategy, Command, Iterator, Mediator ‚Äî manage communication</p>
        </div>
        <div class="hero-card" onclick="navigateTo('quiz')">
          <div class="hc-icon">üèÜ</div>
          <h3>Grand Quiz</h3>
          <p>Test your knowledge with ${allQuiz.length} challenging questions across all patterns</p>
        </div>
      </div>
    </div>
    <div class="section-title">üìö All Patterns</div>
    <div class="comparison-grid">
      ${patterns.map(p => `
        <div class="compare-card" onclick="navigateTo('${p.id}')" style="cursor:pointer">
          <h4>${p.icon} ${p.name} ${state.completed[p.id] ? '‚úÖ' : ''}</h4>
          <div class="use-when">${p.subtitle}</div>
          <div class="examples">
            <span class="ex-tag">${p.cat}</span>
            <span class="ex-tag">${p.difficulty}</span>
          </div>
        </div>
      `).join('')}
    </div>
  </div>`;
}

function renderPatternDetail(p) {
  const catColors = { creational: 'creational', structural: 'structural', behavioral: 'behavioral' };
  return `
  <div class="view active">
    <div class="pattern-header">
      <div class="breadcrumb">${p.cat.toUpperCase()} PATTERNS</div>
      <h2>${p.icon} ${p.name} Pattern</h2>
      <div class="subtitle">${p.subtitle}</div>
      <div class="pattern-tags">
        <span class="tag tag-${catColors[p.cat]}">${p.cat}</span>
        <span class="tag tag-difficulty">üìä ${p.difficulty}</span>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="visual">üé® Visual</div>
      <div class="tab" data-tab="examples">üíª Examples</div>
      <div class="tab" data-tab="mistakes">‚ö†Ô∏è Pitfalls</div>
      ${p.exercise ? '<div class="tab" data-tab="exercise">üèãÔ∏è Exercise</div>' : ''}
      <div class="tab" data-tab="quiz">‚ùì Quiz</div>
    </div>

    <div class="tab-content active" id="tab-visual">
      <div style="font-size:.95rem;line-height:1.8;margin-bottom:20px">${p.description}</div>
      <div class="visual-box" id="visual-area">
        ${renderVisual(p.visual)}
      </div>
      <div class="section-title">üìå When to Use</div>
      <div class="info-box tip">
        <div class="ib-icon">‚úÖ</div>
        <div class="ib-content">
          <ul style="list-style:none;padding:0">
            ${p.whenToUse.map(w => `<li style="margin:6px 0">‚Ä¢ ${w}</li>`).join('')}
          </ul>
        </div>
      </div>
    </div>

    <div class="tab-content" id="tab-examples">
      ${p.examples.map(ex => `
        <div class="section-title">${ex.title}</div>
        <div class="code-block">
          <div class="code-header">
            <span class="lang">JavaScript</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
          </div>
          <div class="code-body">${ex.code}</div>
        </div>
      `).join('')}
    </div>

    <div class="tab-content" id="tab-mistakes">
      <div class="section-title">‚ö†Ô∏è Common Mistakes & Pitfalls</div>
      ${p.mistakes.map(m => `
        <div class="mistake-card">
          <h4>${m.title}</h4>
          ${m.desc ? `<p style="font-size:.9rem;color:var(--dim);margin-bottom:12px">${m.desc}</p>` : ''}
          ${m.bad ? `
            <div style="margin-bottom:8px">
              <span style="color:var(--error);font-weight:600;font-size:.8rem">‚ùå BAD</span>
              <div class="code-block"><div class="code-body">${m.bad}</div></div>
            </div>
          ` : ''}
          ${m.good ? `
            <div>
              <span style="color:var(--success);font-weight:600;font-size:.8rem">‚úÖ GOOD</span>
              <div class="code-block"><div class="code-body">${m.good}</div></div>
            </div>
          ` : ''}
        </div>
      `).join('')}
      <div class="info-box warn" style="margin-top:20px">
        <div class="ib-icon">üí°</div>
        <div class="ib-content"><strong>Pro Tip</strong>Don't force patterns where they're not needed. The best code uses patterns naturally, not religiously. If a simple function solves the problem, use a simple function!</div>
      </div>
    </div>

    ${p.exercise ? `
    <div class="tab-content" id="tab-exercise">
      <div class="exercise-area">
        <h3>üèãÔ∏è ${p.exercise.title}</h3>
        <div class="exercise-desc">${p.exercise.desc}</div>
        <textarea class="code-editor" id="exerciseEditor" spellcheck="false">${p.exercise.starter}</textarea>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="run-btn" onclick="runExercise('${p.id}')">‚ñ∂ Run Code</button>
          <button class="btn btn-outline" onclick="showSolution('${p.id}')">üëÅÔ∏è Show Solution</button>
          <button class="btn btn-outline" onclick="resetExercise('${p.id}')">üîÑ Reset</button>
        </div>
        <div class="output-area" id="exerciseOutput">Click "Run Code" to see output...</div>
        <div class="code-block" id="solutionBlock" style="display:none">
          <div class="code-header"><span class="lang">Solution</span></div>
          <div class="code-body" style="color:var(--success)">${p.exercise.solution}</div>
        </div>
      </div>
    </div>
    ` : ''}

    <div class="tab-content" id="tab-quiz">
      <div class="section-title">‚ùì Knowledge Check</div>
      <div id="patternQuiz">
        ${p.quiz.map((q, i) => renderQuizQuestion(q, i, 'pq_' + p.id + '_')).join('')}
      </div>
      <button class="btn btn-primary" style="margin-top:16px" onclick="markPatternComplete('${p.id}')">
        ‚úÖ Mark as Complete
      </button>
    </div>
  </div>`;
}

function renderVisual(type) {
  const visuals = {
    singleton: `
      <div class="vis-singleton">
        <div class="vis-clients">
          <div class="vis-client">üë§ Client A</div>
          <div class="vis-client">üë§ Client B</div>
          <div class="vis-client">üë§ Client C</div>
        </div>
        <div class="vis-arrows">
          <div class="vis-arrow">‚Üí ‚Üí ‚Üí</div>
          <div class="vis-arrow">‚Üí ‚Üí ‚Üí</div>
          <div class="vis-arrow">‚Üí ‚Üí ‚Üí</div>
        </div>
        <div style="text-align:center">
          <div class="vis-instance">‚òùÔ∏è Single<br>Instance</div>
          <div style="margin-top:12px;font-size:.8rem;color:var(--dim)">All clients share the same instance</div>
        </div>
      </div>`,
    factory: `
      <div class="vis-factory">
        <div style="text-align:center">
          <div class="vis-input">type: "car"</div>
          <div class="vis-input" style="margin-top:8px">type: "truck"</div>
          <div class="vis-input" style="margin-top:8px">type: "bike"</div>
        </div>
        <div class="vis-arrows"><div class="vis-arrow">‚Üí ‚Üí ‚Üí</div></div>
        <div class="vis-machine">üè≠</div>
        <div class="vis-arrows"><div class="vis-arrow">‚Üí ‚Üí ‚Üí</div></div>
        <div class="vis-products">
          <div class="vis-product">üöó Car Object</div>
          <div class="vis-product">üöõ Truck Object</div>
          <div class="vis-product">üèçÔ∏è Bike Object</div>
        </div>
      </div>`,
    observer: `
      <div class="vis-observer">
        <div class="vis-publisher">üì° Publisher / Subject</div>
        <div style="font-size:2rem;margin:16px 0;animation:pulse 1.5s infinite">üì¢</div>
        <div style="color:var(--dim);font-size:.85rem;margin-bottom:16px">emit('dataChanged', payload)</div>
        <div class="vis-subs">
          <div class="vis-sub">üìß Email Service</div>
          <div class="vis-sub">üìä Analytics</div>
          <div class="vis-sub">üñ•Ô∏è UI Component</div>
          <div class="vis-sub">üìù Logger</div>
        </div>
      </div>`,
    module: `
      <div class="vis-module">
        <div class="vis-mod-box">
          <div class="vis-mod-header">üì¶ Module</div>
          <div class="vis-mod-private">
            <h5>üîí Private (hidden)</h5>
            <div class="vis-mod-item">let count = 0</div>
            <div class="vis-mod-item">function _validate()</div>
            <div class="vis-mod-item">const SECRET_KEY</div>
          </div>
          <div class="vis-mod-public">
            <h5>üåê Public (exposed)</h5>
            <div class="vis-mod-item">increment()</div>
            <div class="vis-mod-item">getCount()</div>
            <div class="vis-mod-item">reset()</div>
          </div>
        </div>
      </div>`,
    builder: `
      <div style="display:flex;align-items:center;justify-content:center;gap:16px;flex-wrap:wrap">
        <div style="display:flex;flex-direction:column;gap:8px">
          ${['new Builder()', '.select("name")', '.where("age > 18")', '.orderBy("name")', '.limit(10)', '.build()'].map((step, i) => `
            <div style="background:var(--bg);padding:8px 16px;border-radius:8px;border-left:3px solid var(--accent);font-family:monospace;font-size:.8rem;animation:slideOut .4s ease both;animation-delay:${i*.15}s">${step}</div>
          `).join('')}
        </div>
        <div style="font-size:2rem;animation:arrowMove 1.5s ease infinite">‚Üí</div>
        <div style="background:linear-gradient(135deg,var(--accent3),var(--success));padding:20px;border-radius:12px;font-weight:700;animation:glow 2s ease infinite">
          üìÑ Complete<br>Object
        </div>
      </div>`,
    prototype: `
      <div style="display:flex;align-items:center;justify-content:center;gap:24px;flex-wrap:wrap">
        <div style="background:linear-gradient(135deg,var(--accent),var(--accent2));padding:24px;border-radius:12px;font-weight:700;text-align:center">
          üß¨ Prototype<br><span style="font-size:.8rem;font-weight:400">Original Object</span>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
          <div style="font-size:1.5rem">‚Üí clone()</div>
          <div style="font-size:1.5rem">‚Üí clone()</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div style="background:var(--bg);border:2px solid var(--accent);padding:12px 20px;border-radius:8px;animation:popIn .5s both">üìã Copy A <span style="color:var(--accent3);font-size:.8rem">+ customized</span></div>
          <div style="background:var(--bg);border:2px solid var(--accent2);padding:12px 20px;border-radius:8px;animation:popIn .5s both .2s">üìã Copy B <span style="color:var(--accent3);font-size:.8rem">+ modified</span></div>
        </div>
      </div>`,
    decorator: `
      <div class="vis-decorator">
        <div class="vis-dec-layers">
          <div class="vis-dec-layer l1" style="display:flex;align-items:flex-start;justify-content:center;padding-top:12px">
            <span>üé® WithLogging</span>
          </div>
          <div class="vis-dec-layer l2" style="display:flex;align-items:flex-start;justify-content:center;padding-top:12px">
            <span>‚è±Ô∏è WithTiming</span>
          </div>
          <div class="vis-dec-layer l3">‚ö° Core<br>Function</div>
        </div>
        <div style="margin-left:24px;font-size:.85rem;color:var(--dim)">
          <p>Each layer <strong>wraps</strong> the inner one</p>
          <p>Adds behavior without modifying core</p>
        </div>
      </div>`,
    strategy: `
      <div class="vis-strategy">
        <div class="vis-context">üì¶ Context<br><span style="font-size:.75rem;font-weight:400">Uses current strategy</span></div>
        <div style="font-size:1.5rem;animation:arrowMove 1.5s ease infinite">‚áÑ</div>
        <div class="vis-strategies">
          <div class="vis-strat active">üÖ∞Ô∏è Strategy A ‚Äî Quick Sort</div>
          <div class="vis-strat">üÖ±Ô∏è Strategy B ‚Äî Merge Sort</div>
          <div class="vis-strat">üÖ≤Ô∏è Strategy C ‚Äî Bubble Sort</div>
        </div>
      </div>`,
    facade: `
      <div style="display:flex;align-items:center;justify-content:center;gap:24px;flex-wrap:wrap">
        <div style="background:var(--bg);padding:16px;border-radius:8px;border:2px solid var(--accent3);text-align:center">
          <div style="font-size:1.5rem">üë§</div>
          <div style="font-size:.8rem">Client Code</div>
          <div style="font-family:monospace;font-size:.75rem;margin-top:4px;color:var(--accent3)">facade.start()</div>
        </div>
        <div style="font-size:1.5rem;animation:arrowMove 1.5s ease infinite">‚Üí</div>
        <div style="background:linear-gradient(135deg,var(--accent),var(--accent2));padding:20px;border-radius:12px;text-align:center;font-weight:700">
          üèõÔ∏è Facade<br><span style="font-size:.75rem;font-weight:400">Simple Interface</span>
        </div>
        <div style="font-size:1.5rem;animation:arrowMove 1.5s ease infinite">‚Üí</div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <div style="background:var(--bg);padding:8px 16px;border-radius:6px;font-size:.8rem;border:1px solid var(--bg4)">‚öôÔ∏è Subsystem A</div>
          <div style="background:var(--bg);padding:8px 16px;border-radius:6px;font-size:.8rem;border:1px solid var(--bg4)">‚öôÔ∏è Subsystem B</div>
          <div style="background:var(--bg);padding:8px 16px;border-radius:6px;font-size:.8rem;border:1px solid var(--bg4)">‚öôÔ∏è Subsystem C</div>
        </div>
      </div>`,
    adapter: `
      <div style="display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap">
        <div style="background:var(--bg);padding:16px;border-radius:8px;border:2px solid var(--error);text-align:center">
          <div style="font-size:1.5rem">üî¥</div>
          <div style="font-size:.8rem">Old Interface</div>
          <div style="font-family:monospace;font-size:.7rem;color:var(--error)">{ user_name, e_mail }</div>
        </div>
        <div style="font-size:1.5rem;animation:arrowMove 1.5s ease infinite">‚Üí</div>
        <div style="background:linear-gradient(135deg,var(--accent4),#e17055);padding:20px;border-radius:12px;text-align:center;font-weight:700">
          üîå Adapter<br><span style="font-size:.75rem;font-weight:400">Transforms interface</span>
        </div>
        <div style="font-size:1.5rem;animation:arrowMove 1.5s ease infinite">‚Üí</div>
        <div style="background:var(--bg);padding:16px;border-radius:8px;border:2px solid var(--success);text-align:center">
          <div style="font-size:1.5rem">üü¢</div>
          <div style="font-size:.8rem">Expected Interface</div>
          <div style="font-family:monospace;font-size:.7rem;color:var(--success)">{ username, email }</div>
        </div>
      </div>`,
    command: `
      <div style="display:flex;align-items:center;justify-content:center;gap:16px;flex-wrap:wrap">
        <div style="display:flex;flex-direction:column;gap:6px">
          <div style="background:#6c5ce733;padding:8px 16px;border-radius:6px;font-size:.8rem;border:1px solid var(--accent);animation:slideOut .4s both">üìú InsertText("Hello")</div>
          <div style="background:#fd79a833;padding:8px 16px;border-radius:6px;font-size:.8rem;border:1px solid var(--accent2);animation:slideOut .4s both .1s">üìú Bold()</div>
          <div style="background:#00cec933;padding:8px 16px;border-radius:6px;font-size:.8rem;border:1px solid var(--accent3);animation:slideOut .4s both .2s">üìú InsertText(" World")</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:center;gap:4px">
          <div style="font-size:1rem;animation:arrowMove 1.5s ease infinite">‚Üí execute()</div>
          <div style="font-size:1rem;color:var(--error);animation:arrowMove 1.5s ease infinite reverse">‚Üê undo()</div>
        </div>
        <div style="background:linear-gradient(135deg,var(--accent),var(--accent3));padding:20px;border-radius:12px;text-align:center;font-weight:700">
          üìù Receiver<br><span style="font-size:.75rem;font-weight:400">"Hello World"</span>
        </div>
      </div>`,
    iterator: `
      <div style="display:flex;align-items:center;justify-content:center;gap:16px;flex-wrap:wrap">
        <div style="display:flex;gap:6px">
          ${[1,2,3,4,5].map((n,i) => `<div style="width:44px;height:44px;background:${i===0?'var(--accent)':'var(--bg)'};border:2px solid var(--accent);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;animation:popIn .4s both ${i*.1}s">${n}</div>`).join('')}
        </div>
        <div style="text-align:center;font-size:.8rem">
          <div style="font-size:1.5rem">üëÜ</div>
          <div style="color:var(--accent);font-family:monospace">iterator.next()</div>
          <div style="color:var(--dim);margin-top:4px">{ value: 1, done: false }</div>
        </div>
      </div>`,
    proxy: `
      <div style="display:flex;align-items:center;justify-content:center;gap:20px;flex-wrap:wrap">
        <div style="background:var(--bg);padding:16px;border-radius:8px;border:2px solid var(--accent3);text-align:center">
          <div style="font-size:1.5rem">üë§</div>
          <div style="font-size:.8rem">Client</div>
        </div>
        <div style="font-size:1.5rem;animation:arrowMove 1.5s ease infinite">‚Üí</div>
        <div style="background:linear-gradient(135deg,var(--error),var(--accent2));padding:20px;border-radius:12px;text-align:center;font-weight:700;position:relative">
          üõ°Ô∏è Proxy<br>
          <span style="font-size:.7rem;font-weight:400">validate, log, cache</span>
        </div>
        <div style="font-size:1.5rem;animation:arrowMove 1.5s ease infinite">‚Üí</div>
        <div style="background:linear-gradient(135deg,var(--accent),var(--accent3));padding:20px;border-radius:12px;text-align:center;font-weight:700">
          üì¶ Real<br>Object
        </div>
      </div>`,
    mediator: `
      <div style="text-align:center">
        <div style="display:flex;justify-content:center;gap:16px;margin-bottom:16px;flex-wrap:wrap">
          <div style="background:var(--bg);padding:10px 16px;border-radius:8px;border:2px solid var(--accent);font-size:.85rem">üë§ User A</div>
          <div style="background:var(--bg);padding:10px 16px;border-radius:8px;border:2px solid var(--accent2);font-size:.85rem">üë§ User B</div>
        </div>
        <div style="font-size:.8rem;color:var(--dim)">‚Üï ‚Üï</div>
        <div style="background:linear-gradient(135deg,var(--accent4),#e17055);padding:20px 40px;border-radius:12px;font-weight:700;display:inline-block;margin:12px 0;animation:pulse 2s ease infinite">
          üó£Ô∏è Mediator<br><span style="font-size:.75rem;font-weight:400">(Chat Room)</span>
        </div>
        <div style="font-size:.8rem;color:var(--dim)">‚Üï ‚Üï</div>
        <div style="display:flex;justify-content:center;gap:16px;margin-top:16px;flex-wrap:wrap">
          <div style="background:var(--bg);padding:10px 16px;border-radius:8px;border:2px solid var(--accent3);font-size:.85rem">üë§ User C</div>
          <div style="background:var(--bg);padding:10px 16px;border-radius:8px;border:2px solid var(--success);font-size:.85rem">üë§ User D</div>
        </div>
        <div style="margin-top:16px;font-size:.8rem;color:var(--dim)">Users communicate through the mediator, not directly</div>
      </div>`
  };
  return visuals[type] || '<div style="text-align:center;padding:40px;color:var(--dim)">Visual diagram</div>';
}

function renderQuizQuestion(q, index, prefix) {
  return `
  <div class="quiz-container" id="${prefix}${index}">
    <div class="quiz-q"><span class="q-num">Q${index+1}.</span> ${q.q}</div>
    <div class="quiz-opts">
      ${q.opts.map((opt, oi) => `
        <div class="quiz-opt" data-qi="${prefix}${index}" data-oi="${oi}" data-correct="${q.correct}" onclick="answerQuiz(this, '${prefix}${index}', ${oi}, ${q.correct})">
          <span class="opt-letter">${String.fromCharCode(65+oi)}</span>
          <span>${opt}</span>
        </div>
      `).join('')}
    </div>
    <div class="quiz-explain" id="${prefix}${index}_explain">${q.explain}</div>
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INTERACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setupPatternInteractions(pattern) {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
    });
  });
}

function answerQuiz(el, qid, selected, correct) {
  const container = document.getElementById(qid);
  if (container.dataset.answered) return;
  container.dataset.answered = 'true';

  const opts = container.querySelectorAll('.quiz-opt');
  opts.forEach((opt, i) => {
    if (i === correct) opt.classList.add('correct');
    if (i === selected && i !== correct) opt.classList.add('wrong');
  });

  const explain = document.getElementById(qid + '_explain');
  explain.classList.add('show');
  if (selected === correct) {
    explain.classList.add('correct');
    addXP(10);
  } else {
    explain.classList.add('wrong');
  }
}

function copyCode(btn) {
  const code = btn.closest('.code-block').querySelector('.code-body').textContent;
  navigator.clipboard.writeText(code).then(() => {
    btn.textContent = '‚úÖ Copied!';
    setTimeout(() => btn.textContent = 'üìã Copy', 2000);
  });
}

function markPatternComplete(id) {
  state.completed[id] = true;
  saveState();
  addXP(50);
  updateProgress();
  renderSidebar();

  // Mini confetti
  const colors = ['#6c5ce7','#fd79a8','#00cec9','#fdcb6e','#00b894'];
  for (let i = 0; i < 30; i++) {
    const conf = document.createElement('div');
    conf.className = 'confetti';
    conf.style.cssText = `left:${Math.random()*100}vw;top:-10px;width:${6+Math.random()*6}px;height:${6+Math.random()*6}px;background:${colors[Math.floor(Math.random()*colors.length)]};border-radius:${Math.random()>.5?'50%':'0'};position:fixed;z-index:9999;pointer-events:none;`;
    document.body.appendChild(conf);
    const duration = 1000 + Math.random() * 2000;
    conf.animate([
      { transform: 'translateY(0) rotate(0)', opacity: 1 },
      { transform: `translateY(${window.innerHeight + 50}px) rotate(${Math.random()*720}deg)`, opacity: 0 }
    ], { duration, easing: 'ease-in' }).onfinish = () => conf.remove();
  }
}

// Exercise functions
function runExercise(patternId) {
  const code = document.getElementById('exerciseEditor').value;
  const output = document.getElementById('exerciseOutput');
  let logs = [];
  const originalLog = console.log;
  console.log = (...args) => logs.push(args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' '));
  try {
    eval(code);
    output.textContent = logs.join('\n') || '(No output)';
    output.className = 'output-area success';
    addXP(25);
  } catch (e) {
    output.textContent = '‚ùå Error: ' + e.message;
    output.className = 'output-area error';
  }
  console.log = originalLog;
}

function showSolution(patternId) {
  const block = document.getElementById('solutionBlock');
  block.style.display = block.style.display === 'none' ? 'block' : 'none';
}

function resetExercise(patternId) {
  const pattern = patterns.find(p => p.id === patternId);
  if (pattern && pattern.exercise) {
    document.getElementById('exerciseEditor').value = pattern.exercise.starter;
    document.getElementById('exerciseOutput').textContent = 'Click "Run Code" to see output...';
    document.getElementById('exerciseOutput').className = 'output-area';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FINAL QUIZ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFinalQuiz() {
  if (state.finalQuizSubmitted) {
    return renderFinalQuizResults();
  }
  const shuffled = [...allQuiz].sort(() => Math.random() - 0.5);
  state.finalQuizShuffled = shuffled;
  return `
  <div class="view active final-quiz">
    <div class="pattern-header">
      <h2>üèÜ Grand Design Patterns Quiz</h2>
      <div class="subtitle">${allQuiz.length} questions covering all patterns ‚Äî Good luck!</div>
    </div>
    <div class="quiz-progress" id="quizProgress">
      ${shuffled.map((_, i) => `<div class="qp-dot ${i === 0 ? 'current' : ''}" data-i="${i}">${i+1}</div>`).join('')}
    </div>
    <div id="finalQuizContent">
      ${shuffled.map((q, i) => `
        <div class="quiz-container" id="fq_${i}" style="display:${i === 0 ? 'block' : 'none'}">
          <div class="quiz-q"><span class="q-num">Q${i+1}/${shuffled.length}</span> ${q.q}</div>
          <div class="quiz-opts">
            ${q.opts.map((opt, oi) => `
              <div class="quiz-opt" onclick="selectFinalAnswer(${i}, ${oi})">
                <span class="opt-letter">${String.fromCharCode(65+oi)}</span>
                <span>${opt}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('')}
    </div>
    <div class="quiz-nav">
      <button class="btn btn-outline" id="prevBtn" onclick="navFinalQuiz(-1)" disabled>‚Üê Previous</button>
      <span id="quizCounter" style="color:var(--dim)">1 / ${shuffled.length}</span>
      <button class="btn btn-primary" id="nextBtn" onclick="navFinalQuiz(1)">Next ‚Üí</button>
    </div>
    <div style="text-align:center;margin-top:24px">
      <button class="btn btn-success" onclick="submitFinalQuiz()" style="padding:12px 40px;font-size:1rem">üìù Submit Quiz</button>
    </div>
  </div>`;
}

function setupFinalQuiz() {
  state.finalQuizIndex = 0;
  state.finalQuizAnswers = {};
  state.finalQuizSubmitted = false;
}

function selectFinalAnswer(qi, oi) {
  state.finalQuizAnswers[qi] = oi;
  const container = document.getElementById('fq_' + qi);
  container.querySelectorAll('.quiz-opt').forEach((opt, i) => {
    opt.classList.toggle('selected', i === oi);
  });
  // Update dot
  const dot = document.querySelector(`.qp-dot[data-i="${qi}"]`);
  if (dot) dot.classList.add('answered');
}

function navFinalQuiz(dir) {
  const total = state.finalQuizShuffled.length;
  const prev = state.finalQuizIndex;
  state.finalQuizIndex = Math.max(0, Math.min(total - 1, prev + dir));
  const curr = state.finalQuizIndex;

  document.getElementById('fq_' + prev).style.display = 'none';
  document.getElementById('fq_' + curr).style.display = 'block';

  document.querySelectorAll('.qp-dot').forEach((d, i) => {
    d.classList.toggle('current', i === curr);
  });

  document.getElementById('prevBtn').disabled = curr === 0;
  document.getElementById('nextBtn').textContent = curr === total - 1 ? 'Finish' : 'Next ‚Üí';
  document.getElementById('quizCounter').textContent = `${curr + 1} / ${total}`;
}

function submitFinalQuiz() {
  const answered = Object.keys(state.finalQuizAnswers).length;
  if (answered < allQuiz.length) {
    if (!confirm(`You've answered ${answered}/${allQuiz.length} questions. Submit anyway?`)) return;
  }

  state.finalQuizSubmitted = true;
  let score = 0;
  state.finalQuizShuffled.forEach((q, i) => {
    if (state.finalQuizAnswers[i] === q.correct) score++;
  });
  state.finalQuizScore = score;
  addXP(score * 20);

  const main = document.getElementById('main');
  main.innerHTML = renderFinalQuizResults();
}

function renderFinalQuizResults() {
  const score = state.finalQuizScore || 0;
  const total = allQuiz.length;
  const pct = Math.round((score / total) * 100);
  const grade = pct >= 90 ? 'üèÜ Master!' : pct >= 70 ? '‚≠ê Great Job!' : pct >= 50 ? 'üëç Good Try!' : 'üìö Keep Learning!';
  const color = pct >= 70 ? 'var(--success)' : pct >= 50 ? 'var(--accent4)' : 'var(--error)';

  let reviewHTML = '';
  if (state.finalQuizShuffled) {
    reviewHTML = state.finalQuizShuffled.map((q, i) => {
      const userAnswer = state.finalQuizAnswers[i];
      const isCorrect = userAnswer === q.correct;
      return `
        <div class="quiz-container" style="border-left:4px solid ${isCorrect ? 'var(--success)' : 'var(--error)'}">
          <div class="quiz-q">${isCorrect ? '‚úÖ' : '‚ùå'} ${q.q}</div>
          <div style="font-size:.85rem;margin:8px 0">
            ${userAnswer !== undefined ? `Your answer: <strong>${q.opts[userAnswer]}</strong>` : '<em>Not answered</em>'}<br>
            Correct: <strong style="color:var(--success)">${q.opts[q.correct]}</strong>
          </div>
          <div style="font-size:.85rem;color:var(--dim);background:var(--bg);padding:10px;border-radius:6px">${q.explain}</div>
        </div>`;
    }).join('');
  }

  return `
  <div class="view active">
    <div class="score-display">
      <div style="font-size:4rem;margin-bottom:12px">${pct >= 70 ? 'üéâ' : 'üí™'}</div>
      <div class="score-big" style="color:${color}">${score}/${total}</div>
      <div style="font-size:1.3rem;margin-bottom:4px">${grade}</div>
      <div class="score-label">${pct}% correct</div>
      <div style="margin-top:20px;display:flex;gap:12px;justify-content:center">
        <button class="btn btn-primary" onclick="state.finalQuizSubmitted=false;state.finalQuizAnswers={};navigateTo('quiz')">üîÑ Retake Quiz</button>
        <button class="btn btn-outline" onclick="navigateTo('dashboard')">üè† Dashboard</button>
      </div>
    </div>
    <div class="section-title">üìã Review Answers</div>
    ${reviewHTML}
  </div>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHEAT SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // Complete the renderCheatSheet function
  function renderCheatSheet() {
    const data = [
      { pattern: 'üîí Singleton', type: 'Creational', purpose: 'Ensure single instance', useWhen: 'Shared resources, config, DB connections', avoid: 'When it\'s just global state in disguise' },
      { pattern: 'üè≠ Factory', type: 'Creational', purpose: 'Create objects by type', useWhen: 'Complex creation, type decided at runtime', avoid: 'Simple `new Class()` is enough' },
      { pattern: 'üî® Builder', type: 'Creational', purpose: 'Step-by-step construction', useWhen: 'Many optional params, complex objects', avoid: 'Objects with few properties' },
      { pattern: 'üß¨ Prototype', type: 'Creational', purpose: 'Clone existing objects', useWhen: 'Expensive creation, similar objects', avoid: 'Deep nesting without deep clone' },
      { pattern: 'üì¶ Module', type: 'Structural', purpose: 'Encapsulate with privacy', useWhen: 'Organizing code, hiding internals', avoid: 'Over-hiding (test difficulties)' },
      { pattern: 'üé® Decorator', type: 'Structural', purpose: 'Add behavior dynamically', useWhen: 'Logging, caching, middleware', avoid: 'Too many layers (debugging hell)' },
      { pattern: 'üèõÔ∏è Facade', type: 'Structural', purpose: 'Simplify complex systems', useWhen: 'Wrapping complex APIs, libraries', avoid: 'Becoming a God object' },
      { pattern: 'üîå Adapter', type: 'Structural', purpose: 'Bridge incompatible interfaces', useWhen: 'Integrating 3rd-party code, migrations', avoid: 'Adapters everywhere = bad design' },
      { pattern: 'üõ°Ô∏è Proxy', type: 'Structural', purpose: 'Control access to objects', useWhen: 'Validation, lazy loading, logging', avoid: 'Performance-critical hot paths' },
      { pattern: 'üëÅÔ∏è Observer', type: 'Behavioral', purpose: 'React to state changes', useWhen: 'Events, state mgmt, real-time data', avoid: 'Forgetting to unsubscribe (leaks!)' },
      { pattern: 'üéØ Strategy', type: 'Behavioral', purpose: 'Swap algorithms at runtime', useWhen: 'Multiple ways to do same thing', avoid: 'Only one algorithm exists' },
      { pattern: 'üìú Command', type: 'Behavioral', purpose: 'Encapsulate actions as objects', useWhen: 'Undo/redo, queues, macros', avoid: 'Simple one-off actions' },
      { pattern: 'üîÑ Iterator', type: 'Behavioral', purpose: 'Sequential access to collections', useWhen: 'Custom data structures, lazy eval', avoid: 'Simple arrays (use built-ins)' },
      { pattern: 'üó£Ô∏è Mediator', type: 'Behavioral', purpose: 'Central communication hub', useWhen: 'Many objects interacting, chat rooms', avoid: 'God mediator with all logic' },
    ];

    return `
    <div class="view active">
      <div class="pattern-header">
        <h2>üìã Design Patterns Cheat Sheet</h2>
        <div class="subtitle">Quick reference ‚Äî when to use and when to avoid each pattern</div>
      </div>

      <div style="overflow-x:auto">
        <table style="width:100%;border-collapse:collapse;font-size:.85rem">
          <thead>
            <tr style="background:var(--bg3);text-align:left">
              <th style="padding:12px;border-bottom:2px solid var(--bg4)">Pattern</th>
              <th style="padding:12px;border-bottom:2px solid var(--bg4)">Type</th>
              <th style="padding:12px;border-bottom:2px solid var(--bg4)">Purpose</th>
              <th style="padding:12px;border-bottom:2px solid var(--bg4)">‚úÖ Use When</th>
              <th style="padding:12px;border-bottom:2px solid var(--bg4)">‚ùå Avoid When</th>
            </tr>
          </thead>
          <tbody>
            ${data.map(d => `
            <tr>
              <td style="padding:10px;border-bottom:1px solid var(--bg4)">${d.pattern}</td>
              <td style="padding:10px;border-bottom:1px solid var(--bg4)">${d.type}</td>
              <td style="padding:10px;border-bottom:1px solid var(--bg4)">${d.purpose}</td>
              <td style="padding:10px;border-bottom:1px solid var(--bg4)">${d.useWhen}</td>
              <td style="padding:10px;border-bottom:1px solid var(--bg4)">${d.avoid}</td>
            </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    </div>`;
  }

  // Initialize the app when the DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    renderSidebar();
    renderMain();
    updateProgress();
  });
</script>
</body>
</html>