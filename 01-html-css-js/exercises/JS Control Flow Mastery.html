<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Control Flow Mastery</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@400;600;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0f0f1a;
            --card: #1a1a2e;
            --card-hover: #1f1f35;
            --primary: #6c63ff;
            --primary-glow: rgba(108, 99, 255, 0.3);
            --secondary: #00d4aa;
            --secondary-glow: rgba(0, 212, 170, 0.3);
            --accent: #ff6b9d;
            --warning: #ffa726;
            --text: #e8e8f0;
            --text-dim: #8888a0;
            --success: #4caf50;
            --error: #f44336;
            --code-bg: #12121f;
            --border: #2a2a45;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .bg-animation .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.15;
            animation: floatUp linear infinite;
        }

        @keyframes floatUp {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            10% { opacity: 0.15; }
            90% { opacity: 0.15; }
            100% { transform: translateY(-10vh) scale(1); opacity: 0; }
        }

        /* Header */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(15, 15, 26, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 800;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 var(--primary-glow); }
            50% { box-shadow: 0 0 20px 5px var(--primary-glow); }
        }

        .progress-bar-container {
            flex: 1;
            max-width: 400px;
            margin: 0 24px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 4px;
        }

        .progress-bar {
            height: 8px;
            background: var(--card);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 20px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3));
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .xp-badge {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 6px 16px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .xp-badge .xp-icon {
            color: var(--warning);
        }

        /* Main layout */
        .app-container {
            display: flex;
            min-height: calc(100vh - 65px);
            position: relative;
            z-index: 1;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--card);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            overflow-y: auto;
            position: sticky;
            top: 65px;
            height: calc(100vh - 65px);
        }

        .sidebar-title {
            padding: 0 20px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-dim);
            margin-bottom: 12px;
        }

        .topic-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            font-size: 14px;
        }

        .topic-item:hover {
            background: var(--card-hover);
        }

        .topic-item.active {
            background: rgba(108, 99, 255, 0.1);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .topic-item.completed {
            color: var(--secondary);
        }

        .topic-item.locked {
            color: var(--text-dim);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .topic-icon {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .topic-item.completed .topic-icon {
            background: var(--secondary-glow);
        }

        .topic-item.active .topic-icon {
            background: var(--primary-glow);
        }

        .topic-item.locked .topic-icon {
            background: rgba(136, 136, 160, 0.1);
        }

        /* Main content */
        .main-content {
            flex: 1;
            padding: 32px;
            max-width: 900px;
        }

        /* Section styles */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: 32px;
        }

        .section-badge {
            display: inline-block;
            background: var(--primary-glow);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--text), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-desc {
            color: var(--text-dim);
            font-size: 16px;
            line-height: 1.6;
        }

        /* Content cards */
        .content-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            transition: all 0.3s;
        }

        .content-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 20px rgba(108, 99, 255, 0.1);
        }

        .content-card h3 {
            font-size: 18px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .content-card p {
            color: var(--text-dim);
            line-height: 1.7;
            margin-bottom: 16px;
        }

        /* Analogy boxes */
        .analogy-box {
            background: linear-gradient(135deg, rgba(108, 99, 255, 0.1), rgba(0, 212, 170, 0.1));
            border: 1px solid rgba(108, 99, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
        }

        .analogy-box .analogy-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analogy-box p {
            color: var(--text);
            font-size: 14px;
        }

        /* Code blocks */
        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin: 16px 0;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid var(--border);
        }

        .code-dots {
            display: flex;
            gap: 6px;
        }

        .code-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .code-dot:nth-child(1) { background: #ff5f57; }
        .code-dot:nth-child(2) { background: #ffbd2e; }
        .code-dot:nth-child(3) { background: #28c840; }

        .code-label {
            font-size: 12px;
            color: var(--text-dim);
            font-family: 'Fira Code', monospace;
        }

        .code-body {
            padding: 16px;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            line-height: 1.8;
            overflow-x: auto;
        }

        .code-body pre {
            white-space: pre;
        }

        /* Syntax highlighting */
        .kw { color: #c792ea; }
        .str { color: #c3e88d; }
        .num { color: #f78c6c; }
        .cm { color: #546e7a; font-style: italic; }
        .fn { color: #82aaff; }
        .op { color: #89ddff; }
        .var { color: #eeffff; }
        .bool { color: #ff9cac; }
        .cons { color: #82aaff; }

        /* Run button */
        .run-btn {
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .run-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px var(--primary-glow);
        }

        .output-box {
            background: #0a0a12;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 8px;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            color: var(--secondary);
            min-height: 40px;
            white-space: pre-wrap;
        }

        .output-label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 12px;
            margin-bottom: 4px;
        }

        /* Interactive playground */
        .playground {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            margin: 16px 0;
        }

        .playground-header {
            padding: 12px 20px;
            background: rgba(108, 99, 255, 0.1);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .playground-title {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .playground-body {
            padding: 20px;
        }

        .code-editor {
            width: 100%;
            min-height: 120px;
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            font-family: 'Fira Code', monospace;
            font-size: 13px;
            color: var(--text);
            resize: vertical;
            line-height: 1.8;
            outline: none;
            transition: border-color 0.2s;
        }

        .code-editor:focus {
            border-color: var(--primary);
        }

        /* Quiz styles */
        .quiz-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }

        .quiz-question {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .quiz-question-number {
            color: var(--primary);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 14px 18px;
            background: var(--code-bg);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.05);
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(76, 175, 80, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--error);
            background: rgba(244, 67, 54, 0.1);
        }

        .quiz-option-letter {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            background: var(--card);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            flex-shrink: 0;
        }

        .quiz-option code {
            font-family: 'Fira Code', monospace;
            background: rgba(108, 99, 255, 0.15);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 13px;
        }

        .quiz-feedback {
            margin-top: 16px;
            padding: 16px;
            border-radius: 10px;
            font-size: 14px;
            line-height: 1.6;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .quiz-feedback.correct {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: var(--success);
        }

        .quiz-feedback.incorrect {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: var(--error);
        }

        .quiz-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--primary-glow);
        }

        .btn-secondary {
            background: var(--card);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #66bb6a);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Exercise styles */
        .exercise-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .difficulty-badge {
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .difficulty-easy {
            background: rgba(76, 175, 80, 0.15);
            color: var(--success);
        }

        .difficulty-medium {
            background: rgba(255, 167, 38, 0.15);
            color: var(--warning);
        }

        .difficulty-hard {
            background: rgba(244, 67, 54, 0.15);
            color: var(--error);
        }

        .hint-box {
            background: rgba(255, 167, 38, 0.1);
            border: 1px solid rgba(255, 167, 38, 0.2);
            border-radius: 8px;
            padding: 12px 16px;
            margin: 12px 0;
            font-size: 13px;
            color: var(--warning);
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        /* Flowchart visual */
        .flowchart {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin: 20px 0;
            padding: 24px;
            background: var(--code-bg);
            border-radius: 12px;
        }

        .flow-node {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            min-width: 160px;
            transition: all 0.3s;
        }

        .flow-start { 
            background: rgba(108, 99, 255, 0.2); 
            border: 2px solid var(--primary);
            border-radius: 24px;
        }

        .flow-condition {
            background: rgba(255, 167, 38, 0.2);
            border: 2px solid var(--warning);
            transform: rotate(0deg);
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            padding: 24px 40px;
        }

        .flow-action {
            background: rgba(0, 212, 170, 0.2);
            border: 2px solid var(--secondary);
        }

        .flow-end {
            background: rgba(255, 107, 157, 0.2);
            border: 2px solid var(--accent);
            border-radius: 24px;
        }

        .flow-arrow {
            font-size: 20px;
            color: var(--text-dim);
        }

        .flow-branch {
            display: flex;
            gap: 40px;
            align-items: start;
        }

        .flow-branch-label {
            font-size: 12px;
            color: var(--text-dim);
            text-align: center;
        }

        /* Interactive visual */
        .visual-demo {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            text-align: center;
        }

        .visual-demo .demo-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .demo-btn {
            padding: 8px 16px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            transition: all 0.2s;
        }

        .demo-btn:hover {
            border-color: var(--primary);
        }

        .demo-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .demo-output {
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            padding: 16px;
            background: var(--card);
            border-radius: 8px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Step indicator */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            margin: 24px 0;
        }

        .step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.3s;
        }

        .step-dot.active {
            background: var(--primary);
            width: 24px;
            border-radius: 4px;
        }

        .step-dot.completed {
            background: var(--secondary);
        }

        /* Navigation buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 20px;
            background: var(--code-bg);
            border-radius: 10px;
            padding: 4px;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-dim);
            border: none;
            background: none;
            font-family: 'Inter', sans-serif;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab:hover:not(.active) {
            color: var(--text);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Celebration */
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            text-align: center;
            display: none;
        }

        .celebration.show {
            display: block;
            animation: celebrateIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes celebrateIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .celebration-card {
            background: var(--card);
            border: 2px solid var(--secondary);
            border-radius: 24px;
            padding: 40px 60px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .celebration-emoji {
            font-size: 60px;
            margin-bottom: 16px;
        }

        .celebration-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .celebration-xp {
            color: var(--warning);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* Confetti */
        .confetti-piece {
            position: fixed;
            z-index: 1001;
            width: 10px;
            height: 10px;
            pointer-events: none;
        }

        /* Score display in quiz */
        .quiz-score {
            text-align: center;
            padding: 24px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 800;
        }

        .score-pass {
            background: rgba(76, 175, 80, 0.15);
            border: 3px solid var(--success);
            color: var(--success);
        }

        .score-fail {
            background: rgba(244, 67, 54, 0.15);
            border: 3px solid var(--error);
            color: var(--error);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main-content {
                padding: 20px;
            }

            .section-title {
                font-size: 24px;
            }

            .app-header {
                padding: 10px 16px;
            }

            .progress-bar-container {
                margin: 0 12px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card);
            border: 1px solid var(--border);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        .highlight-box {
            border-left: 4px solid var(--primary);
            padding: 16px;
            background: rgba(108,99,255,0.05);
            border-radius: 0 8px 8px 0;
            margin: 12px 0;
        }

        .highlight-box p {
            color: var(--text) !important;
            margin: 0 !important;
        }

        /* Results table */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
        }

        .results-table th, .results-table td {
            padding: 10px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        .results-table th {
            color: var(--text-dim);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 1px;
        }

        .emoji-lg {
            font-size: 48px;
            text-align: center;
            margin: 16px 0;
        }
    </style>
</head>
<body>

<div class="bg-animation" id="bgAnimation"></div>

<header class="app-header">
    <div class="logo">
        <div class="logo-icon">‚ö°</div>
        <span>FlowMaster JS</span>
    </div>
    <div class="progress-bar-container">
        <div class="progress-info">
            <span id="progressLabel">Topic 1 of 6</span>
            <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
    </div>
    <div class="xp-badge">
        <span class="xp-icon">‚≠ê</span>
        <span id="totalXP">0 XP</span>
    </div>
</header>

<div class="app-container">
    <nav class="sidebar" id="sidebar"></nav>
    <main class="main-content" id="mainContent"></main>
</div>

<div class="overlay" id="overlay"></div>
<div class="celebration" id="celebration">
    <div class="celebration-card">
        <div class="celebration-emoji" id="celebEmoji">üéâ</div>
        <div class="celebration-title" id="celebTitle">Topic Complete!</div>
        <div class="celebration-xp" id="celebXP">+50 XP</div>
        <button class="btn btn-success" onclick="closeCelebration()">Continue ‚Üí</button>
    </div>
</div>

<script>
// ============ APP STATE ============
const state = {
    currentTopic: 0,
    currentTab: 'learn',
    xp: 0,
    topicStatus: {},
    quizAnswers: {},
    exerciseResults: {},
    quizScores: {}
};

// ============ TOPICS DATA ============
const topics = [
    {
        id: 'intro',
        title: 'What is Control Flow?',
        icon: 'üåä',
        xp: 30,
        learn: {
            badge: 'Foundation',
            title: 'What is Control Flow?',
            desc: 'Understand how JavaScript reads and executes your code ‚Äî and why control flow matters.',
            cards: [
                {
                    title: 'ü§î The Big Picture',
                    content: `<p>Imagine you're reading a book. You start at page 1 and read every line from top to bottom. <strong>That's exactly how JavaScript reads your code by default</strong> ‚Äî line by line, top to bottom.</p>
                    <p>This is called <strong>"normal flow"</strong> or <strong>"sequential execution"</strong>.</p>
                    <div class="analogy-box">
                        <div class="analogy-title">üí° Real-Life Analogy</div>
                        <p>Think of a recipe: "Preheat oven ‚Üí Mix ingredients ‚Üí Pour batter ‚Üí Bake for 30 min." You follow each step in order. Control flow is like adding decisions to your recipe: "IF you want chocolate, add cocoa powder. OTHERWISE, add vanilla."</p>
                    </div>`
                },
                {
                    title: 'üìú Sequential Execution (Default)',
                    content: `<p>Without any special keywords, JavaScript runs code from top to bottom:</p>`,
                    code: {
                        label: 'sequential.js',
                        content: `<span class="cm">// JavaScript runs these lines 1, 2, 3 in order</span>
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Step 1: Wake up"</span>);
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Step 2: Brush teeth"</span>);
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Step 3: Eat breakfast"</span>);`,
                        runnable: true,
                        js: `console.log("Step 1: Wake up");
console.log("Step 2: Brush teeth");
console.log("Step 3: Eat breakfast");`
                    }
                },
                {
                    title: 'üîÄ Why We Need Control Flow',
                    content: `<p>Real programs need to <strong>make decisions</strong>, <strong>repeat actions</strong>, and <strong>skip code</strong>. That's what control flow gives us!</p>
                    <p>There are <strong>3 types</strong> of control flow:</p>
                    <div class="highlight-box">
                        <p>1Ô∏è‚É£ <strong>Conditional Statements</strong> ‚Äî Make decisions (if/else, switch)<br>
                        2Ô∏è‚É£ <strong>Loops</strong> ‚Äî Repeat actions (for, while, do...while)<br>
                        3Ô∏è‚É£ <strong>Error Handling</strong> ‚Äî Handle problems (try/catch)</p>
                    </div>`
                },
                {
                    title: 'üó∫Ô∏è Visual: How Control Flow Works',
                    content: `<div class="flowchart">
                        <div class="flow-node flow-start">Start Program</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-action">Run Code Line by Line</div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-condition" style="clip-path: none; border-radius: 8px; border-style: dashed;">Decision Point?</div>
                        <div class="flow-branch">
                            <div>
                                <div class="flow-branch-label">‚úÖ Yes</div>
                                <div class="flow-arrow">‚Üì</div>
                                <div class="flow-node flow-action">Do This</div>
                            </div>
                            <div>
                                <div class="flow-branch-label">‚ùå No</div>
                                <div class="flow-arrow">‚Üì</div>
                                <div class="flow-node flow-action">Do That</div>
                            </div>
                        </div>
                        <div class="flow-arrow">‚Üì</div>
                        <div class="flow-node flow-end">Continue / End</div>
                    </div>`
                }
            ]
        },
        examples: [
            {
                title: 'üå§Ô∏è Weather Decision',
                desc: 'Deciding what to wear based on weather ‚Äî shows why we need conditions.',
                code: `<span class="cm">// Without control flow ‚Äî always runs ALL lines</span>
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Grab umbrella"</span>);
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Wear sunglasses"</span>);
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Put on snow boots"</span>);

<span class="cm">// With control flow ‚Äî only runs what makes sense!</span>
<span class="kw">let</span> weather <span class="op">=</span> <span class="str">"rainy"</span>;
<span class="kw">if</span> (weather <span class="op">===</span> <span class="str">"rainy"</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚òî Grab umbrella!"</span>);
}`,
                js: `console.log("--- Without control flow ---");
console.log("Grab umbrella");
console.log("Wear sunglasses");
console.log("Put on snow boots");
console.log("");
console.log("--- With control flow ---");
let weather = "rainy";
if (weather === "rainy") {
    console.log("‚òî Grab umbrella!");
}`
            },
            {
                title: 'üî¢ Counting with Loops',
                desc: 'Instead of writing console.log 5 times, we use a loop!',
                code: `<span class="cm">// Without loops (tedious!)</span>
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Count: 1"</span>);
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Count: 2"</span>);
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Count: 3"</span>);

<span class="cm">// With a loop (clean!)</span>
<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">1</span>; i <span class="op"><=</span> <span class="num">5</span>; i<span class="op">++</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Count: "</span> <span class="op">+</span> i);
}`,
                js: `console.log("--- Without loops ---");
console.log("Count: 1");
console.log("Count: 2");
console.log("Count: 3");
console.log("");
console.log("--- With a loop ---");
for (let i = 1; i <= 5; i++) {
    console.log("Count: " + i);
}`
            }
        ],
        exercises: [
            {
                title: 'Predict the Output',
                difficulty: 'easy',
                desc: 'What will this code print? Type the output below.',
                startCode: `// What gets printed?\nconsole.log("Hello");\nconsole.log("World");`,
                hint: 'Remember: JavaScript runs code top to bottom, one line at a time.',
                solution: 'Hello\nWorld',
                validate: (output) => output.trim() === 'Hello\nWorld'
            },
            {
                title: 'Add a Third Step',
                difficulty: 'easy',
                desc: 'Add a third console.log that prints "Step 3: Go to school" after the existing steps.',
                startCode: `console.log("Step 1: Wake up");\nconsole.log("Step 2: Eat breakfast");\n// Add Step 3 below\n`,
                hint: 'Use console.log("Step 3: Go to school"); on a new line.',
                solution: 'Step 1: Wake up\nStep 2: Eat breakfast\nStep 3: Go to school',
                validate: (output) => output.includes('Step 3') && output.indexOf('Step 2') < output.indexOf('Step 3')
            }
        ],
        quiz: [
            {
                question: 'By default, how does JavaScript execute code?',
                options: ['Randomly', 'Top to bottom, line by line', 'Bottom to top', 'All at once'],
                correct: 1,
                explanation: 'JavaScript executes code sequentially ‚Äî from the first line to the last, one at a time. This is the default "flow" of the program.'
            },
            {
                question: 'Which is NOT a type of control flow?',
                options: ['Conditional statements (if/else)', 'Loops (for/while)', 'Variable declarations (let/const)', 'Error handling (try/catch)'],
                correct: 2,
                explanation: 'Variable declarations (let, const, var) are statements, not control flow. The three types of control flow are: conditionals, loops, and error handling.'
            },
            {
                question: 'What will this code output?\n\nconsole.log("A");\nconsole.log("B");\nconsole.log("C");',
                options: ['C, B, A', 'A, B, C', 'Only A', 'Error'],
                correct: 1,
                explanation: 'JavaScript runs each line in order from top to bottom: first "A", then "B", then "C".'
            }
        ]
    },
    {
        id: 'if-else',
        title: 'If / Else Statements',
        icon: 'üîÄ',
        xp: 50,
        learn: {
            badge: 'Conditionals',
            title: 'If / Else Statements',
            desc: 'The most fundamental way to make decisions in JavaScript.',
            cards: [
                {
                    title: 'üéØ The if Statement',
                    content: `<p>An <code>if</code> statement checks a <strong>condition</strong>. If the condition is <strong>true</strong>, the code inside the curly braces <code>{}</code> runs. If it's <strong>false</strong>, it gets skipped.</p>
                    <div class="analogy-box">
                        <div class="analogy-title">üí° Real-Life Analogy</div>
                        <p>"IF it's raining, THEN take an umbrella." You only take the umbrella when the condition (raining) is true!</p>
                    </div>`,
                    code: {
                        label: 'if-basic.js',
                        content: `<span class="kw">let</span> age <span class="op">=</span> <span class="num">18</span>;

<span class="kw">if</span> (age <span class="op">>=</span> <span class="num">18</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"You can vote! üó≥Ô∏è"</span>);
}
<span class="cm">// This always runs (it's outside the if)</span>
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Program continues..."</span>);`,
                        runnable: true,
                        js: `let age = 18;\n\nif (age >= 18) {\n    console.log("You can vote! üó≥Ô∏è");\n}\nconsole.log("Program continues...");`
                    }
                },
                {
                    title: 'üîÑ The else Clause',
                    content: `<p>The <code>else</code> block runs when the <code>if</code> condition is <strong>false</strong>. Think of it as the "otherwise" option.</p>`,
                    code: {
                        label: 'if-else.js',
                        content: `<span class="kw">let</span> temperature <span class="op">=</span> <span class="num">35</span>;

<span class="kw">if</span> (temperature <span class="op">></span> <span class="num">30</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"It's hot! ü•µ Stay hydrated!"</span>);
} <span class="kw">else</span> {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Nice weather! üòä"</span>);
}`,
                        runnable: true,
                        js: `let temperature = 35;\n\nif (temperature > 30) {\n    console.log("It's hot! ü•µ Stay hydrated!");\n} else {\n    console.log("Nice weather! üòä");\n}`
                    }
                },
                {
                    title: 'ü™ú else if ‚Äî Multiple Conditions',
                    content: `<p>Need to check multiple conditions? Chain them with <code>else if</code>. JavaScript checks each condition from top to bottom and runs the <strong>first one that's true</strong>.</p>`,
                    code: {
                        label: 'else-if.js',
                        content: `<span class="kw">let</span> score <span class="op">=</span> <span class="num">85</span>;

<span class="kw">if</span> (score <span class="op">>=</span> <span class="num">90</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Grade: A ‚≠ê"</span>);
} <span class="kw">else if</span> (score <span class="op">>=</span> <span class="num">80</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Grade: B üëç"</span>);
} <span class="kw">else if</span> (score <span class="op">>=</span> <span class="num">70</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Grade: C üìù"</span>);
} <span class="kw">else</span> {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Grade: F üò¨ Study more!"</span>);
}`,
                        runnable: true,
                        js: `let score = 85;\n\nif (score >= 90) {\n    console.log("Grade: A ‚≠ê");\n} else if (score >= 80) {\n    console.log("Grade: B üëç");\n} else if (score >= 70) {\n    console.log("Grade: C üìù");\n} else {\n    console.log("Grade: F üò¨ Study more!");\n}`
                    }
                },
                {
                    title: '‚ö° Comparison Operators Cheat Sheet',
                    content: `<p>These operators return <code>true</code> or <code>false</code> ‚Äî perfect for conditions:</p>
                    <table class="results-table">
                        <tr><th>Operator</th><th>Meaning</th><th>Example</th></tr>
                        <tr><td><code>===</code></td><td>Strict equal</td><td><code>5 === 5</code> ‚Üí true</td></tr>
                        <tr><td><code>!==</code></td><td>Not equal</td><td><code>5 !== 3</code> ‚Üí true</td></tr>
                        <tr><td><code>></code></td><td>Greater than</td><td><code>10 > 5</code> ‚Üí true</td></tr>
                        <tr><td><code><</code></td><td>Less than</td><td><code>3 < 7</code> ‚Üí true</td></tr>
                        <tr><td><code>>=</code></td><td>Greater or equal</td><td><code>5 >= 5</code> ‚Üí true</td></tr>
                        <tr><td><code><=</code></td><td>Less or equal</td><td><code>4 <= 9</code> ‚Üí true</td></tr>
                    </table>
                    <div class="highlight-box"><p>‚ö†Ô∏è Always use <code>===</code> (triple equals) instead of <code>==</code> (double equals). Triple equals checks both value AND type, which is safer!</p></div>`
                }
            ]
        },
        examples: [
            {
                title: 'üéÇ Age Verification',
                desc: 'A website checking if a user is old enough.',
                code: `<span class="kw">let</span> userAge <span class="op">=</span> <span class="num">16</span>;

<span class="kw">if</span> (userAge <span class="op">>=</span> <span class="num">18</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚úÖ Welcome! You can access this site."</span>);
} <span class="kw">else</span> {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚ùå Sorry, you must be 18 or older."</span>);
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Come back in "</span> <span class="op">+</span> (<span class="num">18</span> <span class="op">-</span> userAge) <span class="op">+</span> <span class="str">" years!"</span>);
}`,
                js: `let userAge = 16;\n\nif (userAge >= 18) {\n    console.log("‚úÖ Welcome! You can access this site.");\n} else {\n    console.log("‚ùå Sorry, you must be 18 or older.");\n    console.log("Come back in " + (18 - userAge) + " years!");\n}`
            },
            {
                title: 'üõí Shopping Discount',
                desc: 'Applying different discounts based on cart total.',
                code: `<span class="kw">let</span> cartTotal <span class="op">=</span> <span class="num">75</span>;
<span class="kw">let</span> discount <span class="op">=</span> <span class="num">0</span>;

<span class="kw">if</span> (cartTotal <span class="op">>=</span> <span class="num">100</span>) {
    discount <span class="op">=</span> <span class="num">20</span>;
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üéâ 20% off!"</span>);
} <span class="kw">else if</span> (cartTotal <span class="op">>=</span> <span class="num">50</span>) {
    discount <span class="op">=</span> <span class="num">10</span>;
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üéä 10% off!"</span>);
} <span class="kw">else</span> {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Add more for a discount!"</span>);
}

<span class="kw">let</span> finalPrice <span class="op">=</span> cartTotal <span class="op">-</span> (cartTotal <span class="op">*</span> discount <span class="op">/</span> <span class="num">100</span>);
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Final: $"</span> <span class="op">+</span> finalPrice);`,
                js: `let cartTotal = 75;\nlet discount = 0;\n\nif (cartTotal >= 100) {\n    discount = 20;\n    console.log("üéâ 20% off!");\n} else if (cartTotal >= 50) {\n    discount = 10;\n    console.log("üéä 10% off!");\n} else {\n    console.log("Add more for a discount!");\n}\n\nlet finalPrice = cartTotal - (cartTotal * discount / 100);\nconsole.log("Final: $" + finalPrice);`
            },
            {
                title: 'üå°Ô∏è Weather Advisor',
                desc: 'Multiple else-if chain for weather recommendations.',
                code: `<span class="kw">let</span> temp <span class="op">=</span> <span class="num">5</span>;

<span class="kw">if</span> (temp <span class="op">>=</span> <span class="num">35</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üî• Extreme heat! Stay indoors."</span>);
} <span class="kw">else if</span> (temp <span class="op">>=</span> <span class="num">25</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚òÄÔ∏è Warm! Wear light clothes."</span>);
} <span class="kw">else if</span> (temp <span class="op">>=</span> <span class="num">15</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üß• Cool! Bring a jacket."</span>);
} <span class="kw">else if</span> (temp <span class="op">>=</span> <span class="num">0</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"ü•∂ Cold! Bundle up!"</span>);
} <span class="kw">else</span> {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚ùÑÔ∏è Freezing! Stay home!"</span>);
}`,
                js: `let temp = 5;\n\nif (temp >= 35) {\n    console.log("üî• Extreme heat! Stay indoors.");\n} else if (temp >= 25) {\n    console.log("‚òÄÔ∏è Warm! Wear light clothes.");\n} else if (temp >= 15) {\n    console.log("üß• Cool! Bring a jacket.");\n} else if (temp >= 0) {\n    console.log("ü•∂ Cold! Bundle up!");\n} else {\n    console.log("‚ùÑÔ∏è Freezing! Stay home!");\n}`
            }
        ],
        exercises: [
            {
                title: 'Even or Odd Checker',
                difficulty: 'easy',
                desc: 'Write an if/else that checks if the variable `num` is even or odd. Print "Even" or "Odd".',
                startCode: `let num = 7;\n\n// Write your if/else here\n// Hint: use the % (modulo) operator\n// num % 2 gives the remainder when dividing by 2\n`,
                hint: 'If num % 2 === 0, it\'s even. Otherwise, it\'s odd.',
                solution: 'Odd',
                validate: (output) => output.trim() === 'Odd'
            },
            {
                title: 'Ticket Price Calculator',
                difficulty: 'medium',
                desc: 'Set ticket price based on age: Under 5 = Free, 5-12 = $5, 13-64 = $10, 65+ = $7. Print the price.',
                startCode: `let age = 8;\nlet price;\n\n// Write your if/else if/else chain\n\n// Then print: console.log("Ticket: $" + price);\n`,
                hint: 'Use else if to check multiple ranges. Start with the youngest age and work up.',
                solution: 'Ticket: $5',
                validate: (output) => output.includes('$5')
            },
            {
                title: 'Login Validator',
                difficulty: 'medium',
                desc: 'Check if username is "admin" AND password is "1234". Print "Access granted" or "Access denied".',
                startCode: `let username = "admin";\nlet password = "1234";\n\n// Check BOTH conditions using &&\n`,
                hint: 'Use the && (AND) operator to check two conditions at once: if (a === "x" && b === "y")',
                solution: 'Access granted',
                validate: (output) => output.toLowerCase().includes('access granted')
            }
        ],
        quiz: [
            {
                question: 'What does this code print?\n\nlet x = 5;\nif (x > 10) {\n    console.log("big");\n} else {\n    console.log("small");\n}',
                options: ['"big"', '"small"', 'Nothing', 'Error'],
                correct: 1,
                explanation: 'x is 5, which is NOT greater than 10, so the condition is false. The else block runs, printing "small".'
            },
            {
                question: 'How many else if blocks can you have?',
                options: ['Only 1', 'Maximum 3', 'Maximum 10', 'As many as you need'],
                correct: 3,
                explanation: 'You can chain as many else if blocks as needed! Though if you have too many, a switch statement might be cleaner.'
            },
            {
                question: 'What operator should you use to check if two values are equal?',
                options: ['= (single)', '== (double)', '=== (triple)', '!= (not equal)'],
                correct: 2,
                explanation: 'Use === (strict equality) to check if values are equal. Single = is for assignment, and == does type coercion which can cause bugs.'
            },
            {
                question: 'What does this print?\n\nlet age = 25;\nif (age >= 18) {\n    console.log("A");\n} else if (age >= 21) {\n    console.log("B");\n}',
                options: ['"A" and "B"', 'Only "A"', 'Only "B"', 'Nothing'],
                correct: 1,
                explanation: 'Even though age 25 is also >= 21, JavaScript stops at the FIRST true condition. Since 25 >= 18 is true, it prints "A" and skips the rest.'
            },
            {
                question: 'Which correctly checks if a number is between 10 and 20 (inclusive)?',
                options: ['if (10 <= num <= 20)', 'if (num >= 10 && num <= 20)', 'if (num > 10 || num < 20)', 'if (num === 10-20)'],
                correct: 1,
                explanation: 'Use && (AND) to combine two conditions. Both must be true. The first option looks mathematical but doesn\'t work in JS!'
            }
        ]
    },
    {
        id: 'switch',
        title: 'Switch Statements',
        icon: 'üîå',
        xp: 50,
        learn: {
            badge: 'Conditionals',
            title: 'Switch Statements',
            desc: 'A cleaner way to handle multiple specific values.',
            cards: [
                {
                    title: 'üîå What is a Switch Statement?',
                    content: `<p>A <code>switch</code> statement is like a TV remote ‚Äî you pick a specific channel (value) and it goes directly there. It's perfect when you're comparing <strong>one variable</strong> against <strong>many specific values</strong>.</p>
                    <div class="analogy-box">
                        <div class="analogy-title">üí° Real-Life Analogy</div>
                        <p>Think of a vending machine: Press A1 ‚Üí get chips, B2 ‚Üí get soda, C3 ‚Üí get candy. Each button maps to a specific item. That's a switch!</p>
                    </div>`
                },
                {
                    title: 'üìù Basic Syntax',
                    content: `<p>The switch checks a value and jumps to the matching <code>case</code>. Don't forget <code>break</code> ‚Äî otherwise it "falls through" to the next case!</p>`,
                    code: {
                        label: 'switch-basic.js',
                        content: `<span class="kw">let</span> day <span class="op">=</span> <span class="str">"Monday"</span>;

<span class="kw">switch</span> (day) {
    <span class="kw">case</span> <span class="str">"Monday"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üò´ Start of the week"</span>);
        <span class="kw">break</span>;
    <span class="kw">case</span> <span class="str">"Friday"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üéâ TGIF!"</span>);
        <span class="kw">break</span>;
    <span class="kw">case</span> <span class="str">"Saturday"</span>:
    <span class="kw">case</span> <span class="str">"Sunday"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üòé Weekend vibes!"</span>);
        <span class="kw">break</span>;
    <span class="kw">default</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üìÖ Regular day"</span>);
}`,
                        runnable: true,
                        js: `let day = "Monday";\n\nswitch (day) {\n    case "Monday":\n        console.log("üò´ Start of the week");\n        break;\n    case "Friday":\n        console.log("üéâ TGIF!");\n        break;\n    case "Saturday":\n    case "Sunday":\n        console.log("üòé Weekend vibes!");\n        break;\n    default:\n        console.log("üìÖ Regular day");\n}`
                    }
                },
                {
                    title: '‚ö†Ô∏è The break Keyword',
                    content: `<p><strong>Critical Rule:</strong> Always include <code>break</code> after each case (unless you intentionally want fall-through). Without it, JavaScript keeps running the next cases!</p>`,
                    code: {
                        label: 'break-importance.js',
                        content: `<span class="cm">// ‚ùå WITHOUT break ‚Äî runs ALL cases after match!</span>
<span class="kw">let</span> fruit <span class="op">=</span> <span class="str">"apple"</span>;
<span class="kw">switch</span> (fruit) {
    <span class="kw">case</span> <span class="str">"apple"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üçé"</span>);
        <span class="cm">// No break! Falls through...</span>
    <span class="kw">case</span> <span class="str">"banana"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üçå"</span>);
        <span class="cm">// Still no break!</span>
    <span class="kw">case</span> <span class="str">"cherry"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üçí"</span>);
}
<span class="cm">// Prints: üçé, üçå, AND üçí!</span>`,
                        runnable: true,
                        js: `let fruit = "apple";\nswitch (fruit) {\n    case "apple":\n        console.log("üçé");\n    case "banana":\n        console.log("üçå");\n    case "cherry":\n        console.log("üçí");\n}\nconsole.log("--- All three printed because of missing breaks! ---");`
                    }
                },
                {
                    title: 'üÜö Switch vs If/Else ‚Äî When to Use Which?',
                    content: `<table class="results-table">
                        <tr><th>Use Switch When...</th><th>Use If/Else When...</th></tr>
                        <tr><td>Comparing ONE variable to many exact values</td><td>Checking ranges (>, <, >=)</td></tr>
                        <tr><td>The values are strings or numbers</td><td>Checking complex conditions</td></tr>
                        <tr><td>You have many options (4+)</td><td>You need logical operators (&&, ||)</td></tr>
                    </table>`
                }
            ]
        },
        examples: [
            {
                title: 'üéÆ Game Command',
                desc: 'Processing different game commands with switch.',
                code: `<span class="kw">let</span> command <span class="op">=</span> <span class="str">"attack"</span>;

<span class="kw">switch</span> (command) {
    <span class="kw">case</span> <span class="str">"attack"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚öîÔ∏è You swing your sword!"</span>);
        <span class="kw">break</span>;
    <span class="kw">case</span> <span class="str">"defend"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üõ°Ô∏è You raise your shield!"</span>);
        <span class="kw">break</span>;
    <span class="kw">case</span> <span class="str">"heal"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üíö You drink a potion!"</span>);
        <span class="kw">break</span>;
    <span class="kw">case</span> <span class="str">"run"</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üèÉ You flee the battle!"</span>);
        <span class="kw">break</span>;
    <span class="kw">default</span>:
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚ùì Unknown command!"</span>);
}`,
                js: `let command = "attack";\n\nswitch (command) {\n    case "attack":\n        console.log("‚öîÔ∏è You swing your sword!");\n        break;\n    case "defend":\n        console.log("üõ°Ô∏è You raise your shield!");\n        break;\n    case "heal":\n        console.log("üíö You drink a potion!");\n        break;\n    case "run":\n        console.log("üèÉ You flee the battle!");\n        break;\n    default:\n        console.log("‚ùì Unknown command!");\n}`
            },
            {
                title: 'üìÖ Month Days Calculator',
                desc: 'Using fall-through intentionally to group months.',
                code: `<span class="kw">let</span> month <span class="op">=</span> <span class="num">2</span>;
<span class="kw">let</span> days;

<span class="kw">switch</span> (month) {
    <span class="kw">case</span> <span class="num">2</span>:
        days <span class="op">=</span> <span class="num">28</span>;
        <span class="kw">break</span>;
    <span class="kw">case</span> <span class="num">4</span>: <span class="kw">case</span> <span class="num">6</span>:
    <span class="kw">case</span> <span class="num">9</span>: <span class="kw">case</span> <span class="num">11</span>:
        days <span class="op">=</span> <span class="num">30</span>;
        <span class="kw">break</span>;
    <span class="kw">default</span>:
        days <span class="op">=</span> <span class="num">31</span>;
}
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Month "</span> <span class="op">+</span> month <span class="op">+</span> <span class="str">" has "</span> <span class="op">+</span> days <span class="op">+</span> <span class="str">" days"</span>);`,
                js: `let month = 2;\nlet days;\n\nswitch (month) {\n    case 2:\n        days = 28;\n        break;\n    case 4: case 6:\n    case 9: case 11:\n        days = 30;\n        break;\n    default:\n        days = 31;\n}\nconsole.log("Month " + month + " has " + days + " days");`
            }
        ],
        exercises: [
            {
                title: 'Day Type Checker',
                difficulty: 'easy',
                desc: 'Write a switch that prints "Weekday" for Mon-Fri and "Weekend" for Sat-Sun.',
                startCode: `let day = "Saturday";\n\n// Write your switch statement\n// Use fall-through for grouping!\n`,
                hint: 'Group Saturday and Sunday cases together without break between them.',
                solution: 'Weekend',
                validate: (output) => output.trim() === 'Weekend'
            },
            {
                title: 'Simple Calculator',
                difficulty: 'medium',
                desc: 'Create a switch-based calculator. Given two numbers and an operator (+, -, *, /), print the result.',
                startCode: `let a = 10;\nlet b = 3;\nlet operator = "+";\n\n// Write a switch on the operator variable\n// Print the result with console.log\n`,
                hint: 'Switch on the operator variable. For "+", log a + b, for "-", log a - b, etc.',
                solution: '13',
                validate: (output) => output.trim() === '13'
            }
        ],
        quiz: [
            {
                question: 'What happens if you forget the break keyword in a switch case?',
                options: ['Error', 'It only runs the matching case', 'It falls through to the next case(s)', 'The switch is skipped entirely'],
                correct: 2,
                explanation: 'Without break, JavaScript "falls through" ‚Äî it keeps executing the next cases until it hits a break or the end of the switch. This is a common bug!'
            },
            {
                question: 'What does the "default" case do?',
                options: ['Runs first', 'Runs when no other case matches', 'Always runs', 'Prevents errors'],
                correct: 1,
                explanation: 'The default case is like "else" ‚Äî it runs when none of the other cases match the switch expression.'
            },
            {
                question: 'When should you use switch instead of if/else?',
                options: ['When checking ranges like > or <', 'When comparing one value to many exact matches', 'Always', 'Never'],
                correct: 1,
                explanation: 'Switch is ideal for comparing one variable against many specific values (strings or numbers). For ranges and complex conditions, use if/else.'
            },
            {
                question: 'What does this print?\n\nswitch("b") {\n  case "a": console.log(1);\n  case "b": console.log(2);\n  case "c": console.log(3);\n}',
                options: ['2', '2 and 3', '1, 2, and 3', 'Nothing'],
                correct: 1,
                explanation: 'It matches case "b" and prints 2, then falls through to case "c" and prints 3 (no break statements!).'
            }
        ]
    },
    {
        id: 'for-loops',
        title: 'For Loops',
        icon: 'üîÅ',
        xp: 60,
        learn: {
            badge: 'Loops',
            title: 'For Loops',
            desc: 'Repeat code efficiently ‚Äî the workhorse of programming.',
            cards: [
                {
                    title: 'üîÅ Why Loops?',
                    content: `<p>Imagine you need to print "Hello" 100 times. Writing 100 console.log statements would be insane! Loops let you write the instruction <strong>once</strong> and repeat it as many times as you need.</p>
                    <div class="analogy-box">
                        <div class="analogy-title">üí° Real-Life Analogy</div>
                        <p>A loop is like a washing machine cycle: "Wash ‚Üí Rinse ‚Üí Spin. Repeat 3 times." You set the instructions once and the machine repeats them.</p>
                    </div>`
                },
                {
                    title: 'üìê The For Loop ‚Äî Anatomy',
                    content: `<p>A for loop has <strong>3 parts</strong> inside the parentheses:</p>
                    <div class="highlight-box">
                        <p><code>for (</code><strong>initialization</strong><code>;</code> <strong>condition</strong><code>;</code> <strong>update</strong><code>)</code><br><br>
                        1Ô∏è‚É£ <strong>Initialization</strong> ‚Äî Runs once at the start (create counter)<br>
                        2Ô∏è‚É£ <strong>Condition</strong> ‚Äî Checked before each loop (keep going?)<br>
                        3Ô∏è‚É£ <strong>Update</strong> ‚Äî Runs after each loop (change counter)</p>
                    </div>`,
                    code: {
                        label: 'for-loop.js',
                        content: `<span class="cm">//    init      condition   update</span>
<span class="cm">//     ‚Üì           ‚Üì         ‚Üì</span>
<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">1</span>; i <span class="op"><=</span> <span class="num">5</span>; i<span class="op">++</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Loop #"</span> <span class="op">+</span> i);
}
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Done! üéâ"</span>);`,
                        runnable: true,
                        js: `for (let i = 1; i <= 5; i++) {\n    console.log("Loop #" + i);\n}\nconsole.log("Done! üéâ");`
                    }
                },
                {
                    title: 'üîç Step-by-Step Execution',
                    content: `<p>Let's trace through <code>for (let i = 0; i < 3; i++)</code>:</p>
                    <table class="results-table">
                        <tr><th>Step</th><th>i value</th><th>Condition i < 3</th><th>Action</th></tr>
                        <tr><td>1</td><td>0</td><td>‚úÖ true</td><td>Run body, then i becomes 1</td></tr>
                        <tr><td>2</td><td>1</td><td>‚úÖ true</td><td>Run body, then i becomes 2</td></tr>
                        <tr><td>3</td><td>2</td><td>‚úÖ true</td><td>Run body, then i becomes 3</td></tr>
                        <tr><td>4</td><td>3</td><td>‚ùå false</td><td>STOP ‚Äî exit loop</td></tr>
                    </table>`
                },
                {
                    title: 'üéØ Common For Loop Patterns',
                    content: ``,
                    code: {
                        label: 'patterns.js',
                        content: `<span class="cm">// Count DOWN</span>
<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">5</span>; i <span class="op">>=</span> <span class="num">1</span>; i<span class="op">--</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(i);
}
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Liftoff! üöÄ"</span>);

<span class="cm">// Count by 2s</span>
<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">0</span>; i <span class="op"><=</span> <span class="num">10</span>; i <span class="op">+=</span> <span class="num">2</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Even: "</span> <span class="op">+</span> i);
}

<span class="cm">// Loop through a string</span>
<span class="kw">let</span> name <span class="op">=</span> <span class="str">"JavaScript"</span>;
<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">0</span>; i <span class="op"><</span> name.length; i<span class="op">++</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(name[i]);
}`,
                        runnable: true,
                        js: `// Count DOWN\nfor (let i = 5; i >= 1; i--) {\n    console.log(i);\n}\nconsole.log("Liftoff! üöÄ");\n\nconsole.log("");\n\n// Count by 2s\nfor (let i = 0; i <= 10; i += 2) {\n    console.log("Even: " + i);\n}\n\nconsole.log("");\n\n// Loop through a string\nlet name = "JavaScript";\nfor (let i = 0; i < name.length; i++) {\n    console.log(name[i]);\n}`
                    }
                }
            ]
        },
        examples: [
            {
                title: 'üìä Sum Calculator',
                desc: 'Adding numbers 1 through 10 using a loop.',
                code: `<span class="kw">let</span> sum <span class="op">=</span> <span class="num">0</span>;

<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">1</span>; i <span class="op"><=</span> <span class="num">10</span>; i<span class="op">++</span>) {
    sum <span class="op">+=</span> i;
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Adding "</span> <span class="op">+</span> i <span class="op">+</span> <span class="str">" ‚Üí Total: "</span> <span class="op">+</span> sum);
}

<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Final sum: "</span> <span class="op">+</span> sum);`,
                js: `let sum = 0;\n\nfor (let i = 1; i <= 10; i++) {\n    sum += i;\n    console.log("Adding " + i + " ‚Üí Total: " + sum);\n}\n\nconsole.log("Final sum: " + sum);`
            },
            {
                title: '‚≠ê Star Pattern',
                desc: 'Building a triangle pattern with nested strings.',
                code: `<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">1</span>; i <span class="op"><=</span> <span class="num">5</span>; i<span class="op">++</span>) {
    <span class="kw">let</span> stars <span class="op">=</span> <span class="str">""</span>;
    <span class="kw">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="num">0</span>; j <span class="op"><</span> i; j<span class="op">++</span>) {
        stars <span class="op">+=</span> <span class="str">"‚≠ê"</span>;
    }
    <span class="cons">console</span>.<span class="fn">log</span>(stars);
}`,
                js: `for (let i = 1; i <= 5; i++) {\n    let stars = "";\n    for (let j = 0; j < i; j++) {\n        stars += "‚≠ê";\n    }\n    console.log(stars);\n}`
            },
            {
                title: 'üîç FizzBuzz',
                desc: 'The classic programming challenge!',
                code: `<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">1</span>; i <span class="op"><=</span> <span class="num">20</span>; i<span class="op">++</span>) {
    <span class="kw">if</span> (i <span class="op">%</span> <span class="num">3</span> <span class="op">===</span> <span class="num">0</span> <span class="op">&&</span> i <span class="op">%</span> <span class="num">5</span> <span class="op">===</span> <span class="num">0</span>) {
        <span class="cons">console</span>.<span class="fn">log</span>(i <span class="op">+</span> <span class="str">" - FizzBuzz! üéâ"</span>);
    } <span class="kw">else if</span> (i <span class="op">%</span> <span class="num">3</span> <span class="op">===</span> <span class="num">0</span>) {
        <span class="cons">console</span>.<span class="fn">log</span>(i <span class="op">+</span> <span class="str">" - Fizz"</span>);
    } <span class="kw">else if</span> (i <span class="op">%</span> <span class="num">5</span> <span class="op">===</span> <span class="num">0</span>) {
        <span class="cons">console</span>.<span class="fn">log</span>(i <span class="op">+</span> <span class="str">" - Buzz"</span>);
    } <span class="kw">else</span> {
        <span class="cons">console</span>.<span class="fn">log</span>(i);
    }
}`,
                js: `for (let i = 1; i <= 20; i++) {\n    if (i % 3 === 0 && i % 5 === 0) {\n        console.log(i + " - FizzBuzz! üéâ");\n    } else if (i % 3 === 0) {\n        console.log(i + " - Fizz");\n    } else if (i % 5 === 0) {\n        console.log(i + " - Buzz");\n    } else {\n        console.log(i);\n    }\n}`
            }
        ],
        exercises: [
            {
                title: 'Countdown Timer',
                difficulty: 'easy',
                desc: 'Create a for loop that counts from 10 down to 1, then prints "Go! üöÄ"',
                startCode: `// Count from 10 to 1\n// Then print "Go! üöÄ"\n`,
                hint: 'Start i at 10, condition i >= 1, update with i-- (decrement).',
                solution: '10\n9\n8\n7\n6\n5\n4\n3\n2\n1\nGo! üöÄ',
                validate: (output) => output.includes('10') && output.includes('1') && output.includes('Go')
            },
            {
                title: 'Multiplication Table',
                difficulty: 'medium',
                desc: 'Print the multiplication table for 7 (7x1=7, 7x2=14, ... 7x10=70)',
                startCode: `// Print: "7 x 1 = 7", "7 x 2 = 14", etc.\n`,
                hint: 'Use a for loop from 1 to 10. Inside: console.log("7 x " + i + " = " + (7 * i))',
                solution: '7 x 1 = 7',
                validate: (output) => output.includes('7 x 1 = 7') && output.includes('7 x 10 = 70')
            },
            {
                title: 'Sum of Even Numbers',
                difficulty: 'medium',
                desc: 'Calculate the sum of all even numbers from 2 to 20. Print the final sum.',
                startCode: `let sum = 0;\n\n// Loop through even numbers 2 to 20\n// Add each to sum\n\n// Print the result\n`,
                hint: 'Use for (let i = 2; i <= 20; i += 2) to step by 2. Add each i to sum.',
                solution: '110',
                validate: (output) => output.includes('110')
            }
        ],
        quiz: [
            {
                question: 'What are the 3 parts of a for loop?',
                options: ['start, middle, end', 'initialization, condition, update', 'begin, check, change', 'create, test, increment'],
                correct: 1,
                explanation: 'A for loop has: initialization (runs once), condition (checked each time), and update (runs after each iteration).'
            },
            {
                question: 'How many times does this loop run?\n\nfor (let i = 0; i < 5; i++) { }',
                options: ['4 times', '5 times', '6 times', 'Infinite'],
                correct: 1,
                explanation: 'i starts at 0 and goes up to (but not including) 5: i=0, 1, 2, 3, 4. That\'s 5 iterations.'
            },
            {
                question: 'What does i++ mean?',
                options: ['i = i * 2', 'i = i + 1', 'i = i - 1', 'i = 0'],
                correct: 1,
                explanation: 'i++ is shorthand for i = i + 1. It increments i by 1. Similarly, i-- decrements by 1.'
            },
            {
                question: 'What happens if the condition is always true?\n\nfor (let i = 0; i >= 0; i++) { }',
                options: ['Nothing happens', 'Runs once', 'Runs 10 times', 'Infinite loop! üíÄ'],
                correct: 3,
                explanation: 'Since i starts at 0 and keeps increasing, i >= 0 is always true. This creates an infinite loop that will crash the browser!'
            },
            {
                question: 'What does this print?\n\nfor (let i = 0; i < 3; i++) {\n    console.log(i);\n}',
                options: ['1, 2, 3', '0, 1, 2', '0, 1, 2, 3', '1, 2'],
                correct: 1,
                explanation: 'i starts at 0 and the condition is i < 3 (not <=). So it prints 0, 1, 2 and stops when i becomes 3.'
            }
        ]
    },
    {
        id: 'while-loops',
        title: 'While & Do...While',
        icon: 'üîÑ',
        xp: 50,
        learn: {
            badge: 'Loops',
            title: 'While & Do...While Loops',
            desc: 'Loops that keep going until a condition changes.',
            cards: [
                {
                    title: 'üîÑ The While Loop',
                    content: `<p>A <code>while</code> loop is simpler than a for loop ‚Äî it just checks a condition and keeps running as long as it's <strong>true</strong>.</p>
                    <div class="analogy-box">
                        <div class="analogy-title">üí° Real-Life Analogy</div>
                        <p>"WHILE you're still hungry, keep eating." You don't know how many bites you'll take ‚Äî you just keep going until you're full!</p>
                    </div>`,
                    code: {
                        label: 'while.js',
                        content: `<span class="kw">let</span> count <span class="op">=</span> <span class="num">1</span>;

<span class="kw">while</span> (count <span class="op"><=</span> <span class="num">5</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Count: "</span> <span class="op">+</span> count);
    count<span class="op">++</span>; <span class="cm">// Don't forget this!</span>
}
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Done!"</span>);`,
                        runnable: true,
                        js: `let count = 1;\n\nwhile (count <= 5) {\n    console.log("Count: " + count);\n    count++;\n}\nconsole.log("Done!");`
                    }
                },
                {
                    title: '‚ö†Ô∏è Danger: Infinite Loops!',
                    content: `<p>If you forget to update the variable in the condition, the loop runs <strong>forever</strong> and crashes your browser! Always make sure the condition will eventually become false.</p>
                    <div class="highlight-box">
                        <p>üö® <strong>Rule:</strong> The variable in the condition MUST change inside the loop. Otherwise ‚Üí infinite loop ‚Üí crash!</p>
                    </div>`
                },
                {
                    title: 'üîÉ Do...While Loop',
                    content: `<p>A <code>do...while</code> loop is special ‚Äî it runs the code <strong>at least once</strong>, THEN checks the condition. The check happens at the end, not the beginning.</p>`,
                    code: {
                        label: 'do-while.js',
                        content: `<span class="cm">// Runs AT LEAST once, even if condition is false!</span>
<span class="kw">let</span> num <span class="op">=</span> <span class="num">10</span>;

<span class="kw">do</span> {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"num is: "</span> <span class="op">+</span> num);
    num<span class="op">++</span>;
} <span class="kw">while</span> (num <span class="op"><</span> <span class="num">5</span>);

<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Ran once even though 10 < 5 is false!"</span>);`,
                        runnable: true,
                        js: `let num = 10;\n\ndo {\n    console.log("num is: " + num);\n    num++;\n} while (num < 5);\n\nconsole.log("Ran once even though 10 < 5 is false!");`
                    }
                },
                {
                    title: 'üÜö For vs While vs Do...While',
                    content: `<table class="results-table">
                        <tr><th>Loop</th><th>Use When</th><th>Checks</th></tr>
                        <tr><td><strong>for</strong></td><td>You know how many times to repeat</td><td>Before each run</td></tr>
                        <tr><td><strong>while</strong></td><td>You don't know how many times</td><td>Before each run</td></tr>
                        <tr><td><strong>do...while</strong></td><td>Must run at least once</td><td>After each run</td></tr>
                    </table>`
                }
            ]
        },
        examples: [
            {
                title: 'üéØ Guessing Game Simulation',
                desc: 'Keep guessing until you get the right answer.',
                code: `<span class="kw">let</span> secretNumber <span class="op">=</span> <span class="num">7</span>;
<span class="kw">let</span> guess <span class="op">=</span> <span class="num">0</span>;
<span class="kw">let</span> attempts <span class="op">=</span> <span class="num">0</span>;
<span class="kw">let</span> guesses <span class="op">=</span> [<span class="num">3</span>, <span class="num">5</span>, <span class="num">9</span>, <span class="num">7</span>]; <span class="cm">// Simulated guesses</span>

<span class="kw">while</span> (guess <span class="op">!==</span> secretNumber) {
    guess <span class="op">=</span> guesses[attempts];
    attempts<span class="op">++</span>;
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Guess #"</span> <span class="op">+</span> attempts <span class="op">+</span> <span class="str">": "</span> <span class="op">+</span> guess);
}
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üéâ Got it in "</span> <span class="op">+</span> attempts <span class="op">+</span> <span class="str">" tries!"</span>);`,
                js: `let secretNumber = 7;\nlet guess = 0;\nlet attempts = 0;\nlet guesses = [3, 5, 9, 7];\n\nwhile (guess !== secretNumber) {\n    guess = guesses[attempts];\n    attempts++;\n    console.log("Guess #" + attempts + ": " + guess);\n}\nconsole.log("üéâ Got it in " + attempts + " tries!");`
            },
            {
                title: 'üí∞ Savings Goal',
                desc: 'How many months to save $1000?',
                code: `<span class="kw">let</span> savings <span class="op">=</span> <span class="num">0</span>;
<span class="kw">let</span> monthlyDeposit <span class="op">=</span> <span class="num">150</span>;
<span class="kw">let</span> months <span class="op">=</span> <span class="num">0</span>;

<span class="kw">while</span> (savings <span class="op"><</span> <span class="num">1000</span>) {
    savings <span class="op">+=</span> monthlyDeposit;
    months<span class="op">++</span>;
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Month "</span> <span class="op">+</span> months <span class="op">+</span> <span class="str">": $"</span> <span class="op">+</span> savings);
}
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"üéØ Goal reached in "</span> <span class="op">+</span> months <span class="op">+</span> <span class="str">" months!"</span>);`,
                js: `let savings = 0;\nlet monthlyDeposit = 150;\nlet months = 0;\n\nwhile (savings < 1000) {\n    savings += monthlyDeposit;\n    months++;\n    console.log("Month " + months + ": $" + savings);\n}\nconsole.log("üéØ Goal reached in " + months + " months!");`
            }
        ],
        exercises: [
            {
                title: 'Halving Numbers',
                difficulty: 'easy',
                desc: 'Start with 64. Keep halving it while it\'s greater than 1. Print each value.',
                startCode: `let num = 64;\n\n// Use a while loop to keep halving num\n// Print each value\n`,
                hint: 'While num > 1, print num and set num = num / 2.',
                solution: '64\n32\n16\n8\n4\n2',
                validate: (output) => output.includes('64') && output.includes('2') && !output.includes('1\n')
            },
            {
                title: 'Password Retry (do...while)',
                difficulty: 'medium',
                desc: 'Simulate 3 password attempts using do...while. The correct password is "secret". Simulate tries: ["wrong", "nope", "secret"].',
                startCode: `let passwords = ["wrong", "nope", "secret"];\nlet attempt = 0;\nlet correct = "secret";\n\n// Use do...while\n// Each loop, check passwords[attempt]\n// Print "Attempt X: [password]"\n// Stop when correct or out of tries\n`,
                hint: 'Use do { ... } while (passwords[attempt-1] !== correct && attempt < passwords.length)',
                solution: 'Attempt 1',
                validate: (output) => output.includes('Attempt 1') && output.includes('secret')
            }
        ],
        quiz: [
            {
                question: 'What is the key difference between while and do...while?',
                options: ['while is faster', 'do...while always runs at least once', 'while can count, do...while cannot', 'No difference'],
                correct: 1,
                explanation: 'do...while checks the condition AFTER running the code, so it always executes at least once. while checks BEFORE, so it might never run.'
            },
            {
                question: 'What causes an infinite loop?',
                options: ['Using let instead of var', 'The condition never becomes false', 'Having too much code inside', 'Using console.log'],
                correct: 1,
                explanation: 'If the condition never becomes false, the loop runs forever. Always make sure something inside the loop changes the condition!'
            },
            {
                question: 'When should you use while instead of for?',
                options: ['Always', 'When you don\'t know how many iterations ahead of time', 'When counting from 1 to 10', 'Never'],
                correct: 1,
                explanation: 'Use while when the number of iterations is unknown ‚Äî like waiting for user input or a condition to change. Use for when you know exactly how many times.'
            },
            {
                question: 'How many times does this run?\n\nlet x = 10;\ndo {\n    console.log(x);\n    x++;\n} while (x < 3);',
                options: ['0 times', '1 time', '3 times', '10 times'],
                correct: 1,
                explanation: 'do...while runs the body FIRST (printing 10), then checks x < 3. Since 11 < 3 is false, it stops. It ran exactly 1 time.'
            }
        ]
    },
    {
        id: 'break-continue',
        title: 'Break, Continue & Nesting',
        icon: '‚è≠Ô∏è',
        xp: 50,
        learn: {
            badge: 'Advanced',
            title: 'Break, Continue & Nesting',
            desc: 'Fine-tune your loops with precision control.',
            cards: [
                {
                    title: 'üõë The break Statement',
                    content: `<p><code>break</code> immediately <strong>exits</strong> the loop ‚Äî no more iterations. It's like an emergency stop button.</p>
                    <div class="analogy-box">
                        <div class="analogy-title">üí° Real-Life Analogy</div>
                        <p>You're flipping through a book looking for a specific word. Once you find it, you STOP flipping. That's break!</p>
                    </div>`,
                    code: {
                        label: 'break.js',
                        content: `<span class="cm">// Find the first number > 5</span>
<span class="kw">let</span> numbers <span class="op">=</span> [<span class="num">2</span>, <span class="num">4</span>, <span class="num">6</span>, <span class="num">8</span>, <span class="num">10</span>];

<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">0</span>; i <span class="op"><</span> numbers.length; i<span class="op">++</span>) {
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Checking: "</span> <span class="op">+</span> numbers[i]);
    <span class="kw">if</span> (numbers[i] <span class="op">></span> <span class="num">5</span>) {
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Found it: "</span> <span class="op">+</span> numbers[i] <span class="op">+</span> <span class="str">" üéØ"</span>);
        <span class="kw">break</span>; <span class="cm">// Stop searching!</span>
    }
}`,
                        runnable: true,
                        js: `let numbers = [2, 4, 6, 8, 10];\n\nfor (let i = 0; i < numbers.length; i++) {\n    console.log("Checking: " + numbers[i]);\n    if (numbers[i] > 5) {\n        console.log("Found it: " + numbers[i] + " üéØ");\n        break;\n    }\n}`
                    }
                },
                {
                    title: '‚è≠Ô∏è The continue Statement',
                    content: `<p><code>continue</code> <strong>skips</strong> the rest of the current iteration and jumps to the next one. It's like saying "skip this one, move on."</p>`,
                    code: {
                        label: 'continue.js',
                        content: `<span class="cm">// Print only odd numbers</span>
<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">1</span>; i <span class="op"><=</span> <span class="num">10</span>; i<span class="op">++</span>) {
    <span class="kw">if</span> (i <span class="op">%</span> <span class="num">2</span> <span class="op">===</span> <span class="num">0</span>) {
        <span class="kw">continue</span>; <span class="cm">// Skip even numbers</span>
    }
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Odd: "</span> <span class="op">+</span> i);
}`,
                        runnable: true,
                        js: `for (let i = 1; i <= 10; i++) {\n    if (i % 2 === 0) {\n        continue;\n    }\n    console.log("Odd: " + i);\n}`
                    }
                },
                {
                    title: 'ü™Ü Nested Loops',
                    content: `<p>A loop inside another loop! The inner loop runs <strong>completely</strong> for each iteration of the outer loop.</p>`,
                    code: {
                        label: 'nested.js',
                        content: `<span class="cm">// Multiplication table (3x3)</span>
<span class="kw">for</span> (<span class="kw">let</span> row <span class="op">=</span> <span class="num">1</span>; row <span class="op"><=</span> <span class="num">3</span>; row<span class="op">++</span>) {
    <span class="kw">let</span> line <span class="op">=</span> <span class="str">""</span>;
    <span class="kw">for</span> (<span class="kw">let</span> col <span class="op">=</span> <span class="num">1</span>; col <span class="op"><=</span> <span class="num">3</span>; col<span class="op">++</span>) {
        line <span class="op">+=</span> (row <span class="op">*</span> col) <span class="op">+</span> <span class="str">"\\t"</span>;
    }
    <span class="cons">console</span>.<span class="fn">log</span>(line);
}`,
                        runnable: true,
                        js: `for (let row = 1; row <= 3; row++) {\n    let line = "";\n    for (let col = 1; col <= 3; col++) {\n        line += (row * col) + "\\t";\n    }\n    console.log(line);\n}`
                    }
                },
                {
                    title: 'üÜö break vs continue ‚Äî Visual',
                    content: `<div class="flowchart">
                        <div class="flow-branch" style="gap: 80px;">
                            <div style="text-align: center;">
                                <div style="font-weight: 700; margin-bottom: 12px;">üõë break</div>
                                <div class="flow-node flow-action" style="font-size: 12px;">Loop: 1, 2, 3...</div>
                                <div class="flow-arrow">‚Üì</div>
                                <div class="flow-node flow-action" style="font-size: 12px; border-color: var(--error);">break at 3!</div>
                                <div class="flow-arrow">‚Üì</div>
                                <div class="flow-node flow-end" style="font-size: 12px;">EXIT loop completely</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-weight: 700; margin-bottom: 12px;">‚è≠Ô∏è continue</div>
                                <div class="flow-node flow-action" style="font-size: 12px;">Loop: 1, 2, 3...</div>
                                <div class="flow-arrow">‚Üì</div>
                                <div class="flow-node flow-action" style="font-size: 12px; border-color: var(--warning);">skip 3</div>
                                <div class="flow-arrow">‚Üì</div>
                                <div class="flow-node flow-action" style="font-size: 12px;">Continue: 4, 5...</div>
                            </div>
                        </div>
                    </div>`
                }
            ]
        },
        examples: [
            {
                title: 'üîç Search & Stop',
                desc: 'Finding a name in a list ‚Äî stop when found.',
                code: `<span class="kw">let</span> names <span class="op">=</span> [<span class="str">"Alice"</span>, <span class="str">"Bob"</span>, <span class="str">"Charlie"</span>, <span class="str">"Diana"</span>];
<span class="kw">let</span> search <span class="op">=</span> <span class="str">"Charlie"</span>;

<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">0</span>; i <span class="op"><</span> names.length; i<span class="op">++</span>) {
    <span class="kw">if</span> (names[i] <span class="op">===</span> search) {
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"‚úÖ Found "</span> <span class="op">+</span> search <span class="op">+</span> <span class="str">" at index "</span> <span class="op">+</span> i);
        <span class="kw">break</span>;
    }
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Checking: "</span> <span class="op">+</span> names[i] <span class="op">+</span> <span class="str">"..."</span>);
}`,
                js: `let names = ["Alice", "Bob", "Charlie", "Diana"];\nlet search = "Charlie";\n\nfor (let i = 0; i < names.length; i++) {\n    if (names[i] === search) {\n        console.log("‚úÖ Found " + search + " at index " + i);\n        break;\n    }\n    console.log("Checking: " + names[i] + "...");\n}`
            },
            {
                title: 'üö´ Skip Negatives',
                desc: 'Sum only positive numbers, skip negatives with continue.',
                code: `<span class="kw">let</span> values <span class="op">=</span> [<span class="num">5</span>, <span class="op">-</span><span class="num">3</span>, <span class="num">8</span>, <span class="op">-</span><span class="num">1</span>, <span class="num">10</span>, <span class="op">-</span><span class="num">7</span>, <span class="num">2</span>];
<span class="kw">let</span> sum <span class="op">=</span> <span class="num">0</span>;

<span class="kw">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="num">0</span>; i <span class="op"><</span> values.length; i<span class="op">++</span>) {
    <span class="kw">if</span> (values[i] <span class="op"><</span> <span class="num">0</span>) {
        <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Skipping "</span> <span class="op">+</span> values[i]);
        <span class="kw">continue</span>;
    }
    sum <span class="op">+=</span> values[i];
    <span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Added "</span> <span class="op">+</span> values[i] <span class="op">+</span> <span class="str">" ‚Üí Sum: "</span> <span class="op">+</span> sum);
}
<span class="cons">console</span>.<span class="fn">log</span>(<span class="str">"Total: "</span> <span class="op">+</span> sum);`,
                js: `let values = [5, -3, 8, -1, 10, -7, 2];\nlet sum = 0;\n\nfor (let i = 0; i < values.length; i++) {\n    if (values[i] < 0) {\n        console.log("Skipping " + values[i]);\n        continue;\n    }\n    sum += values[i];\n    console.log("Added " + values[i] + " ‚Üí Sum: " + sum);\n}\nconsole.log("Total: " + sum);`
            }
        ],
        exercises: [
            {
                title: 'First Multiple of 7',
                difficulty: 'easy',
                desc: 'Loop from 1 to 100. Print the first number divisible by 7, then break.',
                startCode: `// Find the first number from 1-100 divisible by 7\n// Print it and stop\n`,
                hint: 'Use if (i % 7 === 0) then console.log and break.',
                solution: '7',
                validate: (output) => output.trim() === '7'
            },
            {
                title: 'Skip Vowels',
                difficulty: 'medium',
                desc: 'Loop through "JavaScript" and print only consonants (skip a, e, i, o, u).',
                startCode: `let word = "JavaScript";\nlet vowels = "aeiouAEIOU";\n\nfor (let i = 0; i < word.length; i++) {\n    // If the character is a vowel, skip it\n    // Otherwise, print it\n}\n`,
                hint: 'Use vowels.includes(word[i]) to check if a character is a vowel.',
                solution: 'J\nv\nS\nc\nr\np\nt',
                validate: (output) => !output.includes('a') && output.includes('J') && output.includes('v')
            }
        ],
        quiz: [
            {
                question: 'What does break do in a loop?',
                options: ['Pauses the loop', 'Exits the loop immediately', 'Skips to next iteration', 'Restarts the loop'],
                correct: 1,
                explanation: 'break immediately exits the entire loop. No more iterations happen after break is reached.'
            },
            {
                question: 'What does continue do?',
                options: ['Exits the loop', 'Skips the rest of the current iteration', 'Skips to the last iteration', 'Does nothing'],
                correct: 1,
                explanation: 'continue skips the remaining code in the current iteration and jumps to the next loop cycle.'
            },
            {
                question: 'How many times does the inner loop run in total?\n\nfor (let i = 0; i < 3; i++) {\n    for (let j = 0; j < 4; j++) { }\n}',
                options: ['3 times', '4 times', '7 times', '12 times'],
                correct: 3,
                explanation: 'The inner loop runs 4 times for EACH outer iteration. 3 √ó 4 = 12 total inner loop runs.'
            },
            {
                question: 'What does this print?\n\nfor (let i = 1; i <= 5; i++) {\n    if (i === 3) continue;\n    console.log(i);\n}',
                options: ['1, 2, 3, 4, 5', '1, 2, 4, 5', '1, 2', '3'],
                correct: 1,
                explanation: 'continue skips the console.log when i is 3, but the loop continues. So it prints 1, 2, 4, 5 (skipping 3).'
            }
        ]
    }
];

// ============ RENDER FUNCTIONS ============

function createParticles() {
    const bg = document.getElementById('bgAnimation');
    for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + '%';
        p.style.animationDuration = (5 + Math.random() * 10) + 's';
        p.style.animationDelay = Math.random() * 5 + 's';
        p.style.background = ['var(--primary)', 'var(--secondary)', 'var(--accent)'][Math.floor(Math.random() * 3)];
        bg.appendChild(p);
    }
}

function renderSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.innerHTML = '<div class="sidebar-title">Course Topics</div>';
    
    topics.forEach((topic, i) => {
        const status = getTopicStatus(i);
        const item = document.createElement('div');
        item.className = `topic-item ${status}`;
        item.innerHTML = `
            <div class="topic-icon">${status === 'completed' ? '‚úÖ' : topic.icon}</div>
            <span>${topic.title}</span>
        `;
        if (status !== 'locked') {
            item.onclick = () => navigateToTopic(i);
        }
        sidebar.appendChild(item);
    });
}

function getTopicStatus(index) {
    if (index === state.currentTopic) return 'active';
    if (state.topicStatus[index] === 'completed') return 'completed';
    if (index === 0) return 'active';
    // Allow next uncompleted topic
    if (index <= getHighestUnlockedTopic()) return '';
    return 'locked';
}

function getHighestUnlockedTopic() {
    let highest = 0;
    for (let i = 0; i < topics.length; i++) {
        if (state.topicStatus[i] === 'completed') {
            highest = i + 1;
        }
    }
    return Math.min(highest, topics.length - 1);
}

function navigateToTopic(index) {
    state.currentTopic = index;
    state.currentTab = 'learn';
    renderSidebar();
    renderMainContent();
    updateProgress();
}

function updateProgress() {
    const completed = Object.keys(state.topicStatus).filter(k => state.topicStatus[k] === 'completed').length;
    const percent = Math.round((completed / topics.length) * 100);
    document.getElementById('progressFill').style.width = percent + '%';
    document.getElementById('progressPercent').textContent = percent + '%';
    document.getElementById('progressLabel').textContent = `Topic ${state.currentTopic + 1} of ${topics.length}`;
    document.getElementById('totalXP').textContent = state.xp + ' XP';
}

function renderMainContent() {
    const main = document.getElementById('mainContent');
    const topic = topics[state.currentTopic];
    
    main.innerHTML = `
        <div class="section active">
            <div class="section-header">
                <div class="section-badge">${topic.learn.badge}</div>
                <h1 class="section-title">${topic.learn.title}</h1>
                <p class="section-desc">${topic.learn.desc}</p>
            </div>
            
            <div class="tabs">
                <button class="tab ${state.currentTab === 'learn' ? 'active' : ''}" onclick="switchTab('learn')">üìñ Learn</button>
                <button class="tab ${state.currentTab === 'examples' ? 'active' : ''}" onclick="switchTab('examples')">üí° Examples</button>
                <button class="tab ${state.currentTab === 'exercises' ? 'active' : ''}" onclick="switchTab('exercises')">üèãÔ∏è Exercises</button>
                <button class="tab ${state.currentTab === 'quiz' ? 'active' : ''}" onclick="switchTab('quiz')">üß† Quiz</button>
            </div>
            
            <div class="tab-content ${state.currentTab === 'learn' ? 'active' : ''}" id="tab-learn">
                ${renderLearnContent(topic)}
            </div>
            
            <div class="tab-content ${state.currentTab === 'examples' ? 'active' : ''}" id="tab-examples">
                ${renderExamples(topic)}
            </div>
            
            <div class="tab-content ${state.currentTab === 'exercises' ? 'active' : ''}" id="tab-exercises">
                ${renderExercises(topic)}
            </div>
            
            <div class="tab-content ${state.currentTab === 'quiz' ? 'active' : ''}" id="tab-quiz">
                ${renderQuiz(topic)}
            </div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" ${state.currentTopic === 0 ? 'disabled' : ''} onclick="navigateToTopic(${state.currentTopic - 1})">
                    ‚Üê Previous
                </button>
                <button class="btn btn-primary" ${state.currentTopic === topics.length - 1 && state.topicStatus[state.currentTopic] !== 'completed' ? 'disabled' : ''} onclick="goNext()">
                    ${state.currentTopic === topics.length - 1 ? 'üéì Finish Course' : 'Next Topic ‚Üí'}
                </button>
            </div>
        </div>
    `;
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function renderLearnContent(topic) {
    return topic.learn.cards.map(card => `
        <div class="content-card">
            <h3>${card.title}</h3>
            ${card.content}
            ${card.code ? renderCodeBlock(card.code) : ''}
        </div>
    `).join('');
}

function renderCodeBlock(code) {
    const id = 'code_' + Math.random().toString(36).substr(2, 9);
    return `
        <div class="code-block">
            <div class="code-header">
                <div class="code-dots">
                    <div class="code-dot"></div>
                    <div class="code-dot"></div>
                    <div class="code-dot"></div>
                </div>
                <span class="code-label">${code.label}</span>
                ${code.runnable ? `<button class="run-btn" onclick="runCode('${id}', \`${escapeForTemplate(code.js)}\`)">‚ñ∂ Run</button>` : ''}
            </div>
            <div class="code-body"><pre>${code.content}</pre></div>
            ${code.runnable ? `
                <div style="padding: 0 16px 16px;">
                    <div class="output-label">Output</div>
                    <div class="output-box" id="${id}">Click "Run" to see output...</div>
                </div>
            ` : ''}
        </div>
    `;
}

function escapeForTemplate(str) {
    return str.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/\$/g, '\\$');
}

function renderExamples(topic) {
    if (!topic.examples || topic.examples.length === 0) {
        return '<p style="color: var(--text-dim);">No examples for this topic yet.</p>';
    }
    return topic.examples.map((ex, i) => {
        const id = 'example_' + state.currentTopic + '_' + i;
        return `
            <div class="content-card">
                <h3>${ex.title}</h3>
                <p>${ex.desc}</p>
                <div class="code-block">
                    <div class="code-header">
                        <div class="code-dots">
                            <div class="code-dot"></div>
                            <div class="code-dot"></div>
                            <div class="code-dot"></div>
                        </div>
                        <span class="code-label">example.js</span>
                        <button class="run-btn" onclick="runCode('${id}', \`${escapeForTemplate(ex.js)}\`)">‚ñ∂ Run</button>
                    </div>
                    <div class="code-body"><pre>${ex.code}</pre></div>
                    <div style="padding: 0 16px 16px;">
                        <div class="output-label">Output</div>
                        <div class="output-box" id="${id}">Click "Run" to see output...</div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function renderExercises(topic) {
    if (!topic.exercises || topic.exercises.length === 0) {
        return '<p style="color: var(--text-dim);">No exercises for this topic yet.</p>';
    }
    return topic.exercises.map((ex, i) => {
        const id = 'exercise_' + state.currentTopic + '_' + i;
        return `
            <div class="exercise-container">
                <div class="exercise-header">
                    <div>
                        <h3 style="margin-bottom: 4px;">Exercise ${i + 1}: ${ex.title}</h3>
                        <p style="color: var(--text-dim); font-size: 14px;">${ex.desc}</p>
                    </div>
                    <span class="difficulty-badge difficulty-${ex.difficulty}">${ex.difficulty}</span>
                </div>
                
                <div class="playground">
                    <div class="playground-header">
                        <div class="playground-title">‚úèÔ∏è Your Code</div>
                        <div style="display: flex; gap: 8px;">
                            <button class="demo-btn" onclick="toggleHint('hint_${id}')">üí° Hint</button>
                            <button class="run-btn" onclick="runExercise('${id}')">‚ñ∂ Run</button>
                        </div>
                    </div>
                    <div class="playground-body">
                        <div class="hint-box" id="hint_${id}">${ex.hint}</div>
                        <textarea class="code-editor" id="editor_${id}">${ex.startCode}</textarea>
                        <div class="output-label">Output</div>
                        <div class="output-box" id="output_${id}">Run your code to see output...</div>
                        <div class="quiz-feedback" id="feedback_${id}"></div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function renderQuiz(topic) {
    if (!topic.quiz || topic.quiz.length === 0) {
        return '<p style="color: var(--text-dim);">No quiz for this topic yet.</p>';
    }
    
    const quizKey = 'quiz_' + state.currentTopic;
    const answers = state.quizAnswers[quizKey] || {};
    const submitted = state.quizScores[quizKey] !== undefined;
    
    let html = `
        <div class="content-card" style="border-color: var(--primary);">
            <h3>üß† Quiz: ${topic.title}</h3>
            <p>Answer all questions correctly to unlock the next topic. You need <strong>at least 80%</strong> to pass!</p>
        </div>
    `;
    
    topic.quiz.forEach((q, i) => {
        const qKey = 'q' + i;
        const answered = answers[qKey] !== undefined;
        
        html += `
            <div class="quiz-container" id="quiz_${state.currentTopic}_${i}">
                <div class="quiz-question-number">Question ${i + 1} of ${topic.quiz.length}</div>
                <div class="quiz-question">${q.question.replace(/\n/g, '<br>')}</div>
                <div class="quiz-options">
                    ${q.options.map((opt, j) => {
                        let cls = 'quiz-option';
                        if (submitted && answers[qKey] === j) {
                            cls += j === q.correct ? ' correct' : ' incorrect';
                        } else if (submitted && j === q.correct) {
                            cls += ' correct';
                        } else if (!submitted && answers[qKey] === j) {
                            cls += ' selected';
                        }
                        return `
                            <div class="${cls}" onclick="${submitted ? '' : `selectQuizAnswer(${i}, ${j})`}" style="${submitted ? 'cursor: default;' : ''}">
                                <div class="quiz-option-letter">${String.fromCharCode(65 + j)}</div>
                                <span>${opt}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
                ${submitted ? `
                    <div class="quiz-feedback show ${answers[qKey] === q.correct ? 'correct' : 'incorrect'}">
                        ${answers[qKey] === q.correct ? '‚úÖ Correct! ' : '‚ùå Incorrect. '}${q.explanation}
                    </div>
                ` : ''}
            </div>
        `;
    });
    
    if (submitted) {
        const score = state.quizScores[quizKey];
        const passed = score >= 80;
        html += `
            <div class="content-card" style="text-align: center;">
                <div class="quiz-score">
                    <div class="score-circle ${passed ? 'score-pass' : 'score-fail'}">${score}%</div>
                    <h3 style="margin: 16px 0 8px;">${passed ? 'üéâ Congratulations!' : 'üòî Not quite...'}</h3>
                    <p style="color: var(--text-dim);">${passed ? 'You passed! You can now move on to the next topic.' : 'You need 80% to pass. Review the material and try again!'}</p>
                    <div style="margin-top: 16px;">
                        ${!passed ? `<button class="btn btn-primary" onclick="retakeQuiz()">üîÑ Retake Quiz</button>` : ''}
                    </div>
                </div>
            </div>
        `;
    } else {
        html += `
            <div style="text-align: center; margin: 24px 0;">
                <button class="btn btn-success" onclick="submitQuiz()" id="submitQuizBtn">
                    ‚úÖ Submit Quiz
                </button>
            </div>
        `;
    }
    
    return html;
}

// ============ INTERACTIONS ============

function switchTab(tab) {
    state.currentTab = tab;
    renderMainContent();
}

function runCode(outputId, code) {
    const outputEl = document.getElementById(outputId);
    if (!outputEl) return;
    
    let output = [];
    const originalLog = console.log;
    console.log = (...args) => {
        output.push(args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '));
    };
    
    try {
        eval(code);
        outputEl.textContent = output.join('\n') || '(no output)';
        outputEl.style.color = 'var(--secondary)';
    } catch (e) {
        outputEl.textContent = '‚ùå Error: ' + e.message;
        outputEl.style.color = 'var(--error)';
    }
    
    console.log = originalLog;
}

function runExercise(id) {
    const editor = document.getElementById('editor_' + id);
    const outputEl = document.getElementById('output_' + id);
    const feedbackEl = document.getElementById('feedback_' + id);
    if (!editor || !outputEl) return;
    
    const code = editor.value;
    let output = [];
    const originalLog = console.log;
    console.log = (...args) => {
        output.push(args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '));
    };
    
    try {
        eval(code);
        const outputStr = output.join('\n');
        outputEl.textContent = outputStr || '(no output)';
        outputEl.style.color = 'var(--secondary)';
        
        // Find the exercise to validate
        const parts = id.split('_');
        const topicIdx = parseInt(parts[1]);
        const exIdx = parseInt(parts[2]);
        const exercise = topics[topicIdx].exercises[exIdx];
        
        if (exercise.validate(outputStr)) {
            feedbackEl.className = 'quiz-feedback show correct';
            feedbackEl.textContent = '‚úÖ Excellent! Your solution is correct!';
            state.exerciseResults[id] = true;
        } else {
            feedbackEl.className = 'quiz-feedback show incorrect';
            feedbackEl.textContent = '‚ùå Not quite right. Check your output and try again. Expected output should include: ' + exercise.solution.substring(0, 50) + '...';
        }
    } catch (e) {
        outputEl.textContent = '‚ùå Error: ' + e.message;
        outputEl.style.color = 'var(--error)';
        feedbackEl.className = 'quiz-feedback show incorrect';
        feedbackEl.textContent = '‚ùå Code error: ' + e.message;
    }
    
    console.log = originalLog;
}

function toggleHint(id) {
    const hint = document.getElementById(id);
    if (hint) {
        hint.classList.toggle('show');
    }
}

function selectQuizAnswer(questionIdx, optionIdx) {
    const quizKey = 'quiz_' + state.currentTopic;
    if (!state.quizAnswers[quizKey]) {
        state.quizAnswers[quizKey] = {};
    }
    state.quizAnswers[quizKey]['q' + questionIdx] = optionIdx;
    renderMainContent();
    // Keep scroll position
}

function submitQuiz() {
    const quizKey = 'quiz_' + state.currentTopic;
    const topic = topics[state.currentTopic];
    const answers = state.quizAnswers[quizKey] || {};
    
    // Check all answered
    const totalQuestions = topic.quiz.length;
    const answeredCount = Object.keys(answers).length;
    
    if (answeredCount < totalQuestions) {
        alert('Please answer all questions before submitting!');
        return;
    }
    
    // Calculate score
    let correct = 0;
    topic.quiz.forEach((q, i) => {
        if (answers['q' + i] === q.correct) correct++;
    });
    
    const score = Math.round((correct / totalQuestions) * 100);
    state.quizScores[quizKey] = score;
    
    if (score >= 80) {
        state.topicStatus[state.currentTopic] = 'completed';
        state.xp += topic.xp;
        showCelebration(topic);
    }
    
    renderMainContent();
    renderSidebar();
    updateProgress();
}

function retakeQuiz() {
    const quizKey = 'quiz_' + state.currentTopic;
    delete state.quizAnswers[quizKey];
    delete state.quizScores[quizKey];
    renderMainContent();
}

function showCelebration(topic) {
    document.getElementById('celebEmoji').textContent = 'üéâ';
    document.getElementById('celebTitle').textContent = `"${topic.title}" Complete!`;
    document.getElementById('celebXP').textContent = `+${topic.xp} XP earned!`;
    document.getElementById('celebration').classList.add('show');
    document.getElementById('overlay').classList.add('show');
    createConfetti();
}

function closeCelebration() {
    document.getElementById('celebration').classList.remove('show');
    document.getElementById('overlay').classList.remove('show');
    // Remove confetti
    document.querySelectorAll('.confetti-piece').forEach(c => c.remove());
}

function createConfetti() {
    const colors = ['#6c63ff', '#00d4aa', '#ff6b9d', '#ffa726', '#4caf50', '#f44336'];
    for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti-piece';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-10px';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = (5 + Math.random() * 10) + 'px';
        confetti.style.height = (5 + Math.random() * 10) + 'px';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        document.body.appendChild(confetti);
        
        const duration = 1000 + Math.random() * 2000;
        const endX = (Math.random() - 0.5) * 200;
        
        confetti.animate([
            { transform: `translate(0, 0) rotate(0deg)`, opacity: 1 },
            { transform: `translate(${endX}px, ${window.innerHeight + 20}px) rotate(${360 + Math.random() * 360}deg)`, opacity: 0 }
        ], {
            duration: duration,
            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
        }).onfinish = () => confetti.remove();
    }
}

function goNext() {
    if (state.currentTopic < topics.length - 1) {
        navigateToTopic(state.currentTopic + 1);
    } else if (state.topicStatus[state.currentTopic] === 'completed') {
        // Course complete!
        document.getElementById('celebEmoji').textContent = 'üéì';
        document.getElementById('celebTitle').textContent = 'Course Complete!';
        document.getElementById('celebXP').textContent = `Total: ${state.xp} XP earned!`;
        document.getElementById('celebration').classList.add('show');
        document.getElementById('overlay').classList.add('show');
        createConfetti();
    }
}

// ============ INITIALIZE ============
function init() {
    createParticles();
    renderSidebar();
    renderMainContent();
    updateProgress();
}

init();
</script>

</body>
</html>