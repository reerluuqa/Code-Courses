<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JS Testing Mastery - Interactive Learning</title>
<style>
  :root {
    --bg-dark: #0f1117;
    --bg-card: #1a1d27;
    --bg-card2: #232736;
    --accent-green: #22c55e;
    --accent-red: #ef4444;
    --accent-blue: #3b82f6;
    --accent-purple: #a855f7;
    --accent-orange: #f59e0b;
    --accent-cyan: #06b6d4;
    --accent-pink: #ec4899;
    --text-primary: #e2e8f0;
    --text-secondary: #94a3b8;
    --text-dim: #64748b;
    --border: #2d3348;
    --pass: #22c55e;
    --fail: #ef4444;
    --skip: #f59e0b;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--bg-dark);
    color: var(--text-primary);
    line-height: 1.7;
    overflow-x: hidden;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg-dark); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent-blue); }

  /* Layout */
  .app-container { display: flex; min-height: 100vh; }

  /* Sidebar */
  .sidebar {
    width: 280px;
    background: var(--bg-card);
    border-right: 1px solid var(--border);
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    overflow-y: auto;
    z-index: 100;
    transition: transform 0.3s;
  }

  .sidebar-header {
    padding: 24px 20px;
    border-bottom: 1px solid var(--border);
    text-align: center;
  }

  .sidebar-header h1 {
    font-size: 1.2rem;
    background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 4px;
  }

  .sidebar-header .subtitle {
    font-size: 0.75rem;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  .progress-bar-container {
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
  }

  .progress-bar {
    height: 6px;
    background: var(--bg-dark);
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-green), var(--accent-cyan));
    border-radius: 3px;
    transition: width 0.5s ease;
    width: 0%;
  }

  .progress-text {
    font-size: 0.7rem;
    color: var(--text-dim);
    margin-top: 6px;
    text-align: center;
  }

  .nav-section {
    padding: 12px 0;
  }

  .nav-section-title {
    font-size: 0.65rem;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 2px;
    padding: 8px 20px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 20px;
    cursor: pointer;
    transition: all 0.2s;
    border-left: 3px solid transparent;
    font-size: 0.88rem;
    color: var(--text-secondary);
  }

  .nav-item:hover {
    background: rgba(59, 130, 246, 0.08);
    color: var(--text-primary);
  }

  .nav-item.active {
    background: rgba(59, 130, 246, 0.12);
    border-left-color: var(--accent-blue);
    color: var(--accent-blue);
  }

  .nav-item.completed .nav-icon {
    color: var(--accent-green);
  }

  .nav-icon {
    font-size: 1.1rem;
    width: 24px;
    text-align: center;
  }

  .nav-check {
    margin-left: auto;
    font-size: 0.8rem;
    color: var(--accent-green);
    display: none;
  }

  .nav-item.completed .nav-check { display: inline; }

  /* Main Content */
  .main-content {
    margin-left: 280px;
    flex: 1;
    padding: 0;
  }

  .section {
    display: none;
    padding: 40px 48px;
    max-width: 960px;
    margin: 0 auto;
    animation: fadeSlideIn 0.4s ease;
  }

  .section.active { display: block; }

  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .section-badge {
    display: inline-block;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    padding: 4px 12px;
    border-radius: 20px;
    margin-bottom: 12px;
    font-weight: 600;
  }

  .badge-fundamentals { background: rgba(59,130,246,0.15); color: var(--accent-blue); }
  .badge-core { background: rgba(168,85,247,0.15); color: var(--accent-purple); }
  .badge-advanced { background: rgba(236,72,153,0.15); color: var(--accent-pink); }
  .badge-practice { background: rgba(34,197,94,0.15); color: var(--accent-green); }
  .badge-warning { background: rgba(245,158,11,0.15); color: var(--accent-orange); }

  .section h2 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 8px;
    line-height: 1.3;
  }

  .section-desc {
    color: var(--text-secondary);
    font-size: 1.05rem;
    margin-bottom: 32px;
    max-width: 700px;
  }

  h3 {
    font-size: 1.35rem;
    margin: 32px 0 16px;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  h4 {
    font-size: 1.1rem;
    margin: 24px 0 12px;
    color: var(--accent-cyan);
  }

  p { margin-bottom: 16px; color: var(--text-secondary); }

  /* Cards */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin: 20px 0;
  }

  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;
    margin: 20px 0;
  }

  .mini-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    transition: all 0.3s;
  }

  .mini-card:hover {
    border-color: var(--accent-blue);
    transform: translateY(-2px);
  }

  .mini-card .card-icon {
    font-size: 2rem;
    margin-bottom: 12px;
    display: block;
  }

  .mini-card h4 {
    margin: 0 0 8px;
    font-size: 1rem;
    color: var(--text-primary);
  }

  .mini-card p {
    font-size: 0.85rem;
    margin: 0;
    color: var(--text-dim);
  }

  /* Code Blocks */
  .code-block {
    background: #0d1117;
    border: 1px solid var(--border);
    border-radius: 10px;
    margin: 16px 0;
    overflow: hidden;
  }

  .code-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px;
    background: rgba(255,255,255,0.03);
    border-bottom: 1px solid var(--border);
    font-size: 0.78rem;
    color: var(--text-dim);
  }

  .code-dots {
    display: flex;
    gap: 6px;
  }

  .code-dots span {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .code-dots .red { background: #ff5f57; }
  .code-dots .yellow { background: #febc2e; }
  .code-dots .green { background: #28c840; }

  .code-body {
    padding: 16px 20px;
    overflow-x: auto;
    font-family: 'Fira Code', 'Cascadia Code', 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    line-height: 1.8;
    white-space: pre;
    tab-size: 2;
  }

  /* Syntax Colors */
  .kw { color: #ff7b72; }
  .fn { color: #d2a8ff; }
  .str { color: #a5d6ff; }
  .num { color: #79c0ff; }
  .cm { color: #8b949e; font-style: italic; }
  .op { color: #ff7b72; }
  .pr { color: #ffa657; }
  .bl { color: #c9d1d9; }
  .gr { color: #7ee787; }
  .match { color: #ffa657; }

  /* Interactive Test Runner */
  .test-runner {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin: 20px 0;
  }

  .test-runner-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 20px;
    background: var(--bg-card2);
    border-bottom: 1px solid var(--border);
  }

  .test-runner-title {
    font-size: 0.85rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .run-tests-btn {
    padding: 6px 18px;
    background: var(--accent-green);
    color: #000;
    border: none;
    border-radius: 6px;
    font-size: 0.82rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .run-tests-btn:hover { background: #16a34a; transform: scale(1.03); }

  .test-editor {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
  }

  .test-editor textarea {
    width: 100%;
    min-height: 160px;
    background: #0d1117;
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px;
    font-family: 'Fira Code', monospace;
    font-size: 0.85rem;
    line-height: 1.7;
    resize: vertical;
    outline: none;
  }

  .test-editor textarea:focus { border-color: var(--accent-blue); }

  .test-output {
    padding: 16px 20px;
    font-family: 'Fira Code', monospace;
    font-size: 0.82rem;
    min-height: 80px;
    background: #0d1117;
  }

  .test-result {
    padding: 6px 0;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: resultSlide 0.3s ease;
  }

  @keyframes resultSlide {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .test-result.pass { color: var(--pass); }
  .test-result.fail { color: var(--fail); }
  .test-result.info { color: var(--accent-cyan); }

  .test-summary {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 20px;
    font-size: 0.82rem;
  }

  .summary-pass { color: var(--pass); }
  .summary-fail { color: var(--fail); }
  .summary-time { color: var(--text-dim); }

  /* Testing Pyramid */
  .pyramid-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px 0;
    margin: 20px 0;
  }

  .pyramid {
    position: relative;
    width: 400px;
  }

  .pyramid-level {
    text-align: center;
    padding: 20px;
    margin: 4px auto;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .pyramid-level:hover {
    transform: scale(1.03);
    z-index: 2;
  }

  .pyramid-e2e {
    width: 50%;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
  }

  .pyramid-integration {
    width: 75%;
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
  }

  .pyramid-unit {
    width: 100%;
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
  }

  .pyramid-label {
    display: block;
    font-size: 0.7rem;
    opacity: 0.85;
    font-weight: 400;
    margin-top: 2px;
  }

  .pyramid-tooltip {
    display: none;
    position: absolute;
    left: calc(100% + 16px);
    top: 50%;
    transform: translateY(-50%);
    background: var(--bg-card2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 18px;
    width: 260px;
    font-size: 0.82rem;
    color: var(--text-secondary);
    font-weight: 400;
    text-align: left;
    z-index: 10;
    box-shadow: 0 8px 30px rgba(0,0,0,0.4);
  }

  .pyramid-level:hover .pyramid-tooltip { display: block; }

  /* TDD Cycle */
  .tdd-cycle {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px 0;
    margin: 20px 0;
  }

  .tdd-wheel {
    position: relative;
    width: 320px;
    height: 320px;
  }

  .tdd-step {
    position: absolute;
    width: 110px;
    height: 110px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s;
    font-weight: 700;
    font-size: 0.95rem;
    border: 3px solid transparent;
  }

  .tdd-step:hover {
    transform: scale(1.12);
    z-index: 2;
  }

  .tdd-step.active-step {
    transform: scale(1.15);
    z-index: 2;
  }

  .tdd-red {
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #ef4444, #b91c1c);
    color: white;
  }

  .tdd-green {
    bottom: 10px;
    right: 10px;
    background: linear-gradient(135deg, #22c55e, #15803d);
    color: white;
  }

  .tdd-refactor {
    bottom: 10px;
    left: 10px;
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: white;
  }

  .tdd-step .step-icon { font-size: 1.6rem; margin-bottom: 4px; }
  .tdd-step .step-label { font-size: 0.7rem; font-weight: 400; opacity: 0.9; }

  .tdd-arrows {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--bg-card2);
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    animation: spin 8s linear infinite;
  }

  @keyframes spin { from { transform: translate(-50%, -50%) rotate(0deg); } to { transform: translate(-50%, -50%) rotate(360deg); } }

  .tdd-detail {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    margin: 16px 0;
    min-height: 100px;
    transition: all 0.3s;
  }

  /* Quiz */
  .quiz-container {
    margin: 24px 0;
  }

  .quiz-question {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin: 16px 0;
  }

  .quiz-q-text {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 16px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .quiz-q-num {
    background: var(--accent-blue);
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    flex-shrink: 0;
  }

  .quiz-options { display: flex; flex-direction: column; gap: 8px; }

  .quiz-option {
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--bg-card2);
  }

  .quiz-option:hover:not(.selected) {
    border-color: var(--accent-blue);
    background: rgba(59,130,246,0.08);
  }

  .quiz-option.correct {
    border-color: var(--pass);
    background: rgba(34,197,94,0.12);
    color: var(--pass);
  }

  .quiz-option.wrong {
    border-color: var(--fail);
    background: rgba(239,68,68,0.12);
    color: var(--fail);
  }

  .quiz-option .opt-letter {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .quiz-option.correct .opt-letter { background: var(--pass); color: white; border-color: var(--pass); }
  .quiz-option.wrong .opt-letter { background: var(--fail); color: white; border-color: var(--fail); }

  .quiz-explanation {
    margin-top: 12px;
    padding: 14px;
    border-radius: 8px;
    font-size: 0.85rem;
    display: none;
    animation: fadeSlideIn 0.3s;
  }

  .quiz-explanation.show { display: block; }
  .quiz-explanation.correct-exp { background: rgba(34,197,94,0.08); border: 1px solid rgba(34,197,94,0.2); color: var(--pass); }
  .quiz-explanation.wrong-exp { background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.2); color: var(--fail); }

  /* Pitfall/Warning boxes */
  .pitfall-box {
    background: rgba(239,68,68,0.06);
    border: 1px solid rgba(239,68,68,0.2);
    border-left: 4px solid var(--accent-red);
    border-radius: 8px;
    padding: 18px 20px;
    margin: 20px 0;
  }

  .pitfall-box h4 {
    color: var(--accent-red);
    margin: 0 0 8px;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .pitfall-box p { font-size: 0.88rem; margin: 0; }

  .tip-box {
    background: rgba(34,197,94,0.06);
    border: 1px solid rgba(34,197,94,0.2);
    border-left: 4px solid var(--accent-green);
    border-radius: 8px;
    padding: 18px 20px;
    margin: 20px 0;
  }

  .tip-box h4 {
    color: var(--accent-green);
    margin: 0 0 8px;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .tip-box p { font-size: 0.88rem; margin: 0; }

  .info-box {
    background: rgba(59,130,246,0.06);
    border: 1px solid rgba(59,130,246,0.2);
    border-left: 4px solid var(--accent-blue);
    border-radius: 8px;
    padding: 18px 20px;
    margin: 20px 0;
  }

  .info-box h4 {
    color: var(--accent-blue);
    margin: 0 0 8px;
    font-size: 0.95rem;
  }

  .info-box p { font-size: 0.88rem; margin: 0; }

  /* Coverage Visualization */
  .coverage-visual {
    margin: 20px 0;
  }

  .coverage-bar-group {
    margin: 12px 0;
  }

  .coverage-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 0.85rem;
  }

  .coverage-bar {
    height: 24px;
    background: var(--bg-card2);
    border-radius: 12px;
    overflow: hidden;
    position: relative;
  }

  .coverage-fill {
    height: 100%;
    border-radius: 12px;
    transition: width 1.5s ease;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    font-size: 0.72rem;
    font-weight: 700;
    color: white;
  }

  .coverage-high { background: linear-gradient(90deg, #22c55e, #16a34a); }
  .coverage-med { background: linear-gradient(90deg, #f59e0b, #d97706); }
  .coverage-low { background: linear-gradient(90deg, #ef4444, #dc2626); }

  /* Exercise */
  .exercise-container {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin: 24px 0;
  }

  .exercise-header {
    padding: 16px 20px;
    background: var(--bg-card2);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .exercise-title {
    font-weight: 600;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .exercise-difficulty {
    font-size: 0.7rem;
    padding: 3px 10px;
    border-radius: 10px;
    font-weight: 600;
  }

  .diff-easy { background: rgba(34,197,94,0.15); color: var(--accent-green); }
  .diff-medium { background: rgba(245,158,11,0.15); color: var(--accent-orange); }
  .diff-hard { background: rgba(239,68,68,0.15); color: var(--accent-red); }

  .exercise-body { padding: 20px; }

  .exercise-prompt {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 16px;
  }

  .exercise-textarea {
    width: 100%;
    min-height: 200px;
    background: #0d1117;
    color: var(--text-primary);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px;
    font-family: 'Fira Code', monospace;
    font-size: 0.85rem;
    line-height: 1.7;
    resize: vertical;
    outline: none;
    margin-bottom: 12px;
  }

  .exercise-textarea:focus { border-color: var(--accent-blue); }

  .exercise-actions {
    display: flex;
    gap: 10px;
  }

  .btn {
    padding: 8px 20px;
    border: none;
    border-radius: 6px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .btn:hover { transform: translateY(-1px); }
  .btn-primary { background: var(--accent-blue); color: white; }
  .btn-success { background: var(--accent-green); color: #000; }
  .btn-secondary { background: var(--bg-card2); color: var(--text-secondary); border: 1px solid var(--border); }

  .exercise-result {
    margin-top: 12px;
    padding: 14px;
    border-radius: 8px;
    font-size: 0.85rem;
    font-family: 'Fira Code', monospace;
    display: none;
  }

  .exercise-result.show { display: block; }

  /* Tabs */
  .tab-container { margin: 20px 0; }

  .tab-nav {
    display: flex;
    border-bottom: 1px solid var(--border);
    gap: 0;
  }

  .tab-btn {
    padding: 10px 20px;
    background: transparent;
    border: none;
    color: var(--text-dim);
    font-size: 0.88rem;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 2px solid transparent;
    font-weight: 500;
  }

  .tab-btn:hover { color: var(--text-primary); }
  .tab-btn.active { color: var(--accent-blue); border-bottom-color: var(--accent-blue); }

  .tab-panel { display: none; padding: 20px 0; }
  .tab-panel.active { display: block; }

  /* Comparison Table */
  .comparison-table {
    width: 100%;
    border-collapse: collapse;
    margin: 16px 0;
    font-size: 0.88rem;
  }

  .comparison-table th {
    background: var(--bg-card2);
    padding: 12px 16px;
    text-align: left;
    border-bottom: 2px solid var(--border);
    font-weight: 600;
    color: var(--accent-cyan);
  }

  .comparison-table td {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
    color: var(--text-secondary);
  }

  .comparison-table tr:hover td {
    background: rgba(59,130,246,0.04);
  }

  /* Floating next button */
  .section-nav {
    display: flex;
    justify-content: space-between;
    margin-top: 48px;
    padding-top: 24px;
    border-top: 1px solid var(--border);
  }

  .nav-btn {
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid var(--border);
    background: var(--bg-card);
    color: var(--text-primary);
  }

  .nav-btn:hover {
    border-color: var(--accent-blue);
    background: rgba(59,130,246,0.08);
  }

  /* Hamburger (mobile) */
  .hamburger {
    display: none;
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 200;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 1.3rem;
    color: var(--text-primary);
  }

  .overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 90;
  }

  /* Animated checkmark */
  .check-anim {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent-green);
    color: white;
    font-size: 1.3rem;
    animation: popIn 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  }

  @keyframes popIn {
    from { transform: scale(0); }
    to { transform: scale(1); }
  }

  /* Score display */
  .score-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    font-size: 2rem;
    font-weight: 800;
    border: 4px solid;
  }

  /* Matcher Reference */
  .matcher-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
    margin: 16px 0;
  }

  .matcher-item {
    background: var(--bg-card2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px;
    font-family: 'Fira Code', monospace;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .matcher-item:hover {
    border-color: var(--accent-purple);
    background: rgba(168,85,247,0.08);
  }

  .matcher-item .matcher-name {
    color: var(--accent-purple);
    font-weight: 600;
    margin-bottom: 4px;
  }

  .matcher-item .matcher-desc {
    font-family: 'Segoe UI', sans-serif;
    color: var(--text-dim);
    font-size: 0.75rem;
  }

  /* Highlight */
  .hl { color: var(--accent-cyan); font-weight: 600; }
  .hl-green { color: var(--accent-green); font-weight: 600; }
  .hl-red { color: var(--accent-red); font-weight: 600; }
  .hl-purple { color: var(--accent-purple); font-weight: 600; }
  .hl-orange { color: var(--accent-orange); font-weight: 600; }

  /* Collapsible */
  .collapsible {
    margin: 12px 0;
  }

  .collapsible-toggle {
    width: 100%;
    padding: 14px 20px;
    background: var(--bg-card2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.9rem;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s;
  }

  .collapsible-toggle:hover { border-color: var(--accent-blue); }
  .collapsible-toggle .arrow { transition: transform 0.3s; }
  .collapsible-toggle.open .arrow { transform: rotate(180deg); }

  .collapsible-content {
    display: none;
    padding: 16px 20px;
    border: 1px solid var(--border);
    border-top: none;
    border-radius: 0 0 8px 8px;
    background: var(--bg-card);
  }

  .collapsible-content.open { display: block; }

  /* Scoreboard */
  .scoreboard {
    text-align: center;
    padding: 20px;
  }

  .final-score {
    font-size: 3rem;
    font-weight: 800;
    background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .hamburger { display: block; }
    .main-content { margin-left: 0; }
    .section { padding: 24px 16px; padding-top: 60px; }
    .pyramid-tooltip { display: none !important; }
    .card-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="hamburger" onclick="toggleSidebar()">‚ò∞</div>
<div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

<div class="app-container">
  <!-- SIDEBAR -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h1>üß™ JS Testing Mastery</h1>
      <div class="subtitle">Interactive Course</div>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-text" id="progressText">0% Complete</div>
    </div>
    <div class="nav-section">
      <div class="nav-section-title">Fundamentals</div>
      <div class="nav-item active" onclick="goToSection(0)">
        <span class="nav-icon">üéØ</span> Why Test?
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="goToSection(1)">
        <span class="nav-icon">üß±</span> Unit Testing
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="goToSection(2)">
        <span class="nav-icon">üîÑ</span> TDD Approach
        <span class="nav-check">‚úì</span>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-section-title">Jest Deep Dive</div>
      <div class="nav-item" onclick="goToSection(3)">
        <span class="nav-icon">‚ö°</span> Jest Basics
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="goToSection(4)">
        <span class="nav-icon">üîç</span> Matchers
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="goToSection(5)">
        <span class="nav-icon">üé≠</span> Mocks & Spies
        <span class="nav-check">‚úì</span>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-section-title">Mastery</div>
      <div class="nav-item" onclick="goToSection(6)">
        <span class="nav-icon">üìä</span> Test Coverage
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="goToSection(7)">
        <span class="nav-icon">‚ú®</span> Best Practices
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="goToSection(8)">
        <span class="nav-icon">‚ö†Ô∏è</span> Pitfalls
        <span class="nav-check">‚úì</span>
      </div>
    </div>
    <div class="nav-section">
      <div class="nav-section-title">Practice</div>
      <div class="nav-item" onclick="goToSection(9)">
        <span class="nav-icon">üí™</span> Exercises
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="goToSection(10)">
        <span class="nav-icon">üèÜ</span> Final Quiz
        <span class="nav-check">‚úì</span>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="main-content">

    <!-- ============ SECTION 0: WHY TEST? ============ -->
    <div class="section active" id="section-0">
      <span class="section-badge badge-fundamentals">Chapter 1</span>
      <h2>Why Testing Matters üéØ</h2>
      <p class="section-desc">Before writing a single test, let's understand <em>why</em> testing is the superpower that separates junior devs from senior engineers.</p>

      <div class="card-grid">
        <div class="mini-card">
          <span class="card-icon">üêõ</span>
          <h4>Catch Bugs Early</h4>
          <p>Bugs found in development cost 10x less to fix than those found in production.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üõ°Ô∏è</span>
          <h4>Confidence to Refactor</h4>
          <p>Change code fearlessly knowing tests will catch regressions instantly.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üìñ</span>
          <h4>Living Documentation</h4>
          <p>Tests describe what your code should do ‚Äî better than any comment.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üöÄ</span>
          <h4>Faster Development</h4>
          <p>Sounds counterintuitive, but tests speed up development over time.</p>
        </div>
      </div>

      <h3>üèóÔ∏è The Testing Pyramid</h3>
      <p>Not all tests are equal. The testing pyramid shows the ideal distribution:</p>

      <div class="pyramid-container">
        <div class="pyramid">
          <div class="pyramid-level pyramid-e2e" onclick="showPyramidInfo('e2e')">
            üñ•Ô∏è E2E Tests
            <span class="pyramid-label">Few, Slow, Expensive</span>
            <div class="pyramid-tooltip">
              <strong>End-to-End Tests</strong><br>
              Simulate real user behavior across the full stack. Tools: Cypress, Playwright.
              Slowest but test the complete flow.
            </div>
          </div>
          <div class="pyramid-level pyramid-integration" onclick="showPyramidInfo('integration')">
            üîó Integration Tests
            <span class="pyramid-label">Some, Medium Speed</span>
            <div class="pyramid-tooltip">
              <strong>Integration Tests</strong><br>
              Test how modules work together. API endpoints, database queries, component interactions.
            </div>
          </div>
          <div class="pyramid-level pyramid-unit" onclick="showPyramidInfo('unit')">
            üß± Unit Tests
            <span class="pyramid-label">Many, Fast, Cheap</span>
            <div class="pyramid-tooltip">
              <strong>Unit Tests</strong><br>
              Test individual functions/methods in isolation. The foundation of your test suite. Super fast.
            </div>
          </div>
        </div>
      </div>

      <div class="info-box">
        <h4>üí° Key Insight</h4>
        <p>Aim for ~70% unit tests, ~20% integration tests, and ~10% E2E tests. Unit tests give you the most bang for your buck.</p>
      </div>

      <h3>üõ†Ô∏è Testing Libraries Landscape</h3>
      <table class="comparison-table">
        <thead>
          <tr><th>Library</th><th>Type</th><th>Best For</th><th>Used By</th></tr>
        </thead>
        <tbody>
          <tr><td><span class="hl">Jest</span></td><td>Full framework</td><td>React, Node, general JS</td><td>Meta, Airbnb</td></tr>
          <tr><td><span class="hl">Vitest</span></td><td>Full framework</td><td>Vite projects, fast</td><td>Vue ecosystem</td></tr>
          <tr><td><span class="hl">Mocha</span></td><td>Test runner</td><td>Flexible, Node.js</td><td>Many legacy projects</td></tr>
          <tr><td><span class="hl">Cypress</span></td><td>E2E</td><td>Browser testing</td><td>Major companies</td></tr>
          <tr><td><span class="hl">Testing Library</span></td><td>DOM utilities</td><td>Component testing</td><td>React ecosystem</td></tr>
        </tbody>
      </table>

      <div class="tip-box">
        <h4>üéØ Course Focus</h4>
        <p>We'll focus on <strong>Jest</strong> ‚Äî the most popular testing framework for JavaScript. Master Jest, and you can pick up any other framework easily.</p>
      </div>

      <div class="section-nav">
        <div></div>
        <button class="nav-btn" onclick="goToSection(1)">Next: Unit Testing ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 1: UNIT TESTING ============ -->
    <div class="section" id="section-1">
      <span class="section-badge badge-fundamentals">Chapter 2</span>
      <h2>Unit Testing Fundamentals üß±</h2>
      <p class="section-desc">A unit test verifies that a single "unit" of code ‚Äî typically a function ‚Äî works correctly in isolation.</p>

      <h3>üìê Anatomy of a Unit Test</h3>
      <p>Every unit test follows the <span class="hl">AAA pattern</span>: Arrange, Act, Assert.</p>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
          <span>calculator.test.js ‚Äî AAA Pattern</span>
        </div>
        <div class="code-body"><span class="cm">// The function we're testing</span>
<span class="kw">function</span> <span class="fn">add</span>(a, b) {
  <span class="kw">return</span> a + b;
}

<span class="cm">// The test</span>
<span class="fn">test</span>(<span class="str">'adds two numbers correctly'</span>, () => {
  <span class="cm">// 1. ARRANGE ‚Äî set up test data</span>
  <span class="kw">const</span> a = <span class="num">3</span>;
  <span class="kw">const</span> b = <span class="num">7</span>;

  <span class="cm">// 2. ACT ‚Äî execute the function</span>
  <span class="kw">const</span> result = <span class="fn">add</span>(a, b);

  <span class="cm">// 3. ASSERT ‚Äî check the result</span>
  <span class="fn">expect</span>(result).<span class="fn">toBe</span>(<span class="num">10</span>);
});
</div>
      </div>

      <h3>üéØ What Makes a Good Unit?</h3>
      <div class="card-grid">
        <div class="mini-card">
          <span class="card-icon">‚ö°</span>
          <h4>Fast</h4>
          <p>Should run in milliseconds. No network calls, no DB queries.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üèùÔ∏è</span>
          <h4>Isolated</h4>
          <p>Tests don't depend on each other. Order doesn't matter.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üîÅ</span>
          <h4>Repeatable</h4>
          <p>Same result every time. No random data, no timestamps.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">‚úÖ</span>
          <h4>Self-Validating</h4>
          <p>Pass or fail ‚Äî no manual checking needed.</p>
        </div>
      </div>

      <h3>üìù Real-World Example</h3>
      <p>Let's test a more realistic function ‚Äî a password validator:</p>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
          <span>passwordValidator.js</span>
        </div>
        <div class="code-body"><span class="kw">function</span> <span class="fn">validatePassword</span>(password) {
  <span class="kw">if</span> (<span class="kw">typeof</span> password !== <span class="str">'string'</span>) {
    <span class="kw">return</span> { valid: <span class="kw">false</span>, error: <span class="str">'Password must be a string'</span> };
  }
  <span class="kw">if</span> (password.length < <span class="num">8</span>) {
    <span class="kw">return</span> { valid: <span class="kw">false</span>, error: <span class="str">'Must be at least 8 characters'</span> };
  }
  <span class="kw">if</span> (!/[A-Z]/.test(password)) {
    <span class="kw">return</span> { valid: <span class="kw">false</span>, error: <span class="str">'Must contain uppercase letter'</span> };
  }
  <span class="kw">if</span> (!/[0-9]/.test(password)) {
    <span class="kw">return</span> { valid: <span class="kw">false</span>, error: <span class="str">'Must contain a number'</span> };
  }
  <span class="kw">return</span> { valid: <span class="kw">true</span> };
}
</div>
      </div>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
          <span>passwordValidator.test.js</span>
        </div>
        <div class="code-body"><span class="fn">describe</span>(<span class="str">'validatePassword'</span>, () => {

  <span class="fn">test</span>(<span class="str">'returns valid for strong password'</span>, () => {
    <span class="kw">const</span> result = <span class="fn">validatePassword</span>(<span class="str">'MyPass123'</span>);
    <span class="fn">expect</span>(result.valid).<span class="fn">toBe</span>(<span class="kw">true</span>);
  });

  <span class="fn">test</span>(<span class="str">'rejects short passwords'</span>, () => {
    <span class="kw">const</span> result = <span class="fn">validatePassword</span>(<span class="str">'Ab1'</span>);
    <span class="fn">expect</span>(result.valid).<span class="fn">toBe</span>(<span class="kw">false</span>);
    <span class="fn">expect</span>(result.error).<span class="fn">toContain</span>(<span class="str">'8 characters'</span>);
  });

  <span class="fn">test</span>(<span class="str">'rejects without uppercase'</span>, () => {
    <span class="kw">const</span> result = <span class="fn">validatePassword</span>(<span class="str">'lowercase123'</span>);
    <span class="fn">expect</span>(result.valid).<span class="fn">toBe</span>(<span class="kw">false</span>);
    <span class="fn">expect</span>(result.error).<span class="fn">toContain</span>(<span class="str">'uppercase'</span>);
  });

  <span class="fn">test</span>(<span class="str">'rejects without number'</span>, () => {
    <span class="kw">const</span> result = <span class="fn">validatePassword</span>(<span class="str">'NoNumbers'</span>);
    <span class="fn">expect</span>(result.valid).<span class="fn">toBe</span>(<span class="kw">false</span>);
    <span class="fn">expect</span>(result.error).<span class="fn">toContain</span>(<span class="str">'number'</span>);
  });

  <span class="fn">test</span>(<span class="str">'rejects non-string input'</span>, () => {
    <span class="fn">expect</span>(<span class="fn">validatePassword</span>(<span class="num">12345678</span>).valid).<span class="fn">toBe</span>(<span class="kw">false</span>);
    <span class="fn">expect</span>(<span class="fn">validatePassword</span>(<span class="kw">null</span>).valid).<span class="fn">toBe</span>(<span class="kw">false</span>);
  });
});
</div>
      </div>

      <h3>üéÆ Try It: Interactive Test Runner</h3>
      <p>Edit the function below and run the tests to see results:</p>

      <div class="test-runner">
        <div class="test-runner-header">
          <span class="test-runner-title">üß™ Live Test Runner</span>
          <button class="run-tests-btn" onclick="runUnitTests()">‚ñ∂ Run Tests</button>
        </div>
        <div class="test-editor">
          <textarea id="unitTestCode">// Try modifying this function and run the tests!
function multiply(a, b) {
  return a * b;
}

// Tests run automatically below:
// ‚úÖ multiply(2, 3) should equal 6
// ‚úÖ multiply(0, 5) should equal 0
// ‚úÖ multiply(-2, 3) should equal -6
// ‚úÖ multiply(0.1, 0.2) should be close to 0.02</textarea>
        </div>
        <div class="test-output" id="unitTestOutput">
          <span style="color: var(--text-dim)">Click "Run Tests" to see results...</span>
        </div>
      </div>

      <div class="pitfall-box">
        <h4>‚ö†Ô∏è Common Mistake: Testing Implementation, Not Behavior</h4>
        <p>Don't test <em>how</em> a function works internally. Test <em>what</em> it returns. If you refactor the internals, your tests should still pass.</p>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(0)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(2)">Next: TDD Approach ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 2: TDD ============ -->
    <div class="section" id="section-2">
      <span class="section-badge badge-fundamentals">Chapter 3</span>
      <h2>Test-Driven Development üîÑ</h2>
      <p class="section-desc">TDD flips the script: write the test FIRST, then write code to make it pass.</p>

      <h3>‚ôªÔ∏è The Red-Green-Refactor Cycle</h3>
      <p>Click each step to learn more:</p>

      <div class="tdd-cycle">
        <div class="tdd-wheel">
          <div class="tdd-step tdd-red" onclick="showTDDStep('red')">
            <span class="step-icon">‚ùå</span>
            RED
            <span class="step-label">Write failing test</span>
          </div>
          <div class="tdd-step tdd-green" onclick="showTDDStep('green')">
            <span class="step-icon">‚úÖ</span>
            GREEN
            <span class="step-label">Make it pass</span>
          </div>
          <div class="tdd-step tdd-refactor" onclick="showTDDStep('refactor')">
            <span class="step-icon">üîß</span>
            REFACTOR
            <span class="step-label">Clean up</span>
          </div>
          <div class="tdd-arrows">üîÑ</div>
        </div>
      </div>

      <div class="tdd-detail" id="tddDetail">
        <h4 style="color: var(--accent-cyan); margin-top:0;">üëÜ Click a step above to see details</h4>
        <p>The TDD cycle is the heartbeat of test-driven development. Each phase serves a critical purpose.</p>
      </div>

      <h3>üìù TDD Walkthrough: Building a FizzBuzz</h3>
      <p>Let's build FizzBuzz using TDD step by step:</p>

      <div class="tab-container">
        <div class="tab-nav">
          <button class="tab-btn active" onclick="switchTab(event, 'tdd-step1')">Step 1: Red</button>
          <button class="tab-btn" onclick="switchTab(event, 'tdd-step2')">Step 2: Green</button>
          <button class="tab-btn" onclick="switchTab(event, 'tdd-step3')">Step 3: More Red</button>
          <button class="tab-btn" onclick="switchTab(event, 'tdd-step4')">Step 4: Green Again</button>
          <button class="tab-btn" onclick="switchTab(event, 'tdd-step5')">Step 5: Refactor</button>
        </div>

        <div class="tab-panel active" id="tdd-step1">
          <p><span class="hl-red">‚ùå RED</span> ‚Äî Write a test for the simplest case first:</p>
          <div class="code-block">
            <div class="code-header">
              <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
              <span>fizzbuzz.test.js ‚Äî First test</span>
            </div>
            <div class="code-body"><span class="fn">describe</span>(<span class="str">'fizzBuzz'</span>, () => {
  <span class="fn">test</span>(<span class="str">'returns "1" for input 1'</span>, () => {
    <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">1</span>)).<span class="fn">toBe</span>(<span class="str">'1'</span>);
  });
});

<span class="cm">// ‚ùå FAILS! fizzBuzz is not defined</span>
</div>
          </div>
        </div>

        <div class="tab-panel" id="tdd-step2">
          <p><span class="hl-green">‚úÖ GREEN</span> ‚Äî Write the MINIMUM code to pass:</p>
          <div class="code-block">
            <div class="code-header">
              <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
              <span>fizzbuzz.js ‚Äî Minimal implementation</span>
            </div>
            <div class="code-body"><span class="kw">function</span> <span class="fn">fizzBuzz</span>(n) {
  <span class="kw">return</span> String(n); <span class="cm">// simplest thing that works!</span>
}

<span class="cm">// ‚úÖ Test passes!</span>
</div>
          </div>
        </div>

        <div class="tab-panel" id="tdd-step3">
          <p><span class="hl-red">‚ùå RED</span> ‚Äî Add the next test case:</p>
          <div class="code-block">
            <div class="code-header">
              <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
              <span>fizzbuzz.test.js ‚Äî Add Fizz test</span>
            </div>
            <div class="code-body"><span class="fn">test</span>(<span class="str">'returns "Fizz" for multiples of 3'</span>, () => {
  <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">3</span>)).<span class="fn">toBe</span>(<span class="str">'Fizz'</span>);
  <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">6</span>)).<span class="fn">toBe</span>(<span class="str">'Fizz'</span>);
  <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">9</span>)).<span class="fn">toBe</span>(<span class="str">'Fizz'</span>);
});

<span class="fn">test</span>(<span class="str">'returns "Buzz" for multiples of 5'</span>, () => {
  <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">5</span>)).<span class="fn">toBe</span>(<span class="str">'Buzz'</span>);
  <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">10</span>)).<span class="fn">toBe</span>(<span class="str">'Buzz'</span>);
});

<span class="fn">test</span>(<span class="str">'returns "FizzBuzz" for multiples of 15'</span>, () => {
  <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">15</span>)).<span class="fn">toBe</span>(<span class="str">'FizzBuzz'</span>);
  <span class="fn">expect</span>(<span class="fn">fizzBuzz</span>(<span class="num">30</span>)).<span class="fn">toBe</span>(<span class="str">'FizzBuzz'</span>);
});

<span class="cm">// ‚ùå FAILS! Still returns "3", "5", "15"</span>
</div>
          </div>
        </div>

        <div class="tab-panel" id="tdd-step4">
          <p><span class="hl-green">‚úÖ GREEN</span> ‚Äî Make all tests pass:</p>
          <div class="code-block">
            <div class="code-header">
              <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
              <span>fizzbuzz.js ‚Äî Full implementation</span>
            </div>
            <div class="code-body"><span class="kw">function</span> <span class="fn">fizzBuzz</span>(n) {
  <span class="kw">if</span> (n % <span class="num">15</span> === <span class="num">0</span>) <span class="kw">return</span> <span class="str">'FizzBuzz'</span>;
  <span class="kw">if</span> (n % <span class="num">3</span> === <span class="num">0</span>) <span class="kw">return</span> <span class="str">'Fizz'</span>;
  <span class="kw">if</span> (n % <span class="num">5</span> === <span class="num">0</span>) <span class="kw">return</span> <span class="str">'Buzz'</span>;
  <span class="kw">return</span> String(n);
}

<span class="cm">// ‚úÖ All 4 tests pass!</span>
</div>
          </div>
        </div>

        <div class="tab-panel" id="tdd-step5">
          <p><span class="hl">üîß REFACTOR</span> ‚Äî The code is already clean, but we could refactor:</p>
          <div class="code-block">
            <div class="code-header">
              <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
              <span>fizzbuzz.js ‚Äî Refactored (optional)</span>
            </div>
            <div class="code-body"><span class="kw">function</span> <span class="fn">fizzBuzz</span>(n) {
  <span class="kw">let</span> result = <span class="str">''</span>;
  <span class="kw">if</span> (n % <span class="num">3</span> === <span class="num">0</span>) result += <span class="str">'Fizz'</span>;
  <span class="kw">if</span> (n % <span class="num">5</span> === <span class="num">0</span>) result += <span class="str">'Buzz'</span>;
  <span class="kw">return</span> result || String(n);
}

<span class="cm">// ‚úÖ All tests still pass ‚Äî safe refactor!</span>
<span class="cm">// This version is more extensible</span>
</div>
          </div>
        </div>
      </div>

      <div class="tip-box">
        <h4>üí° TDD Golden Rule</h4>
        <p>Never write production code without a failing test first. The test drives the design of your code.</p>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(1)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(3)">Next: Jest Basics ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 3: JEST BASICS ============ -->
    <div class="section" id="section-3">
      <span class="section-badge badge-core">Chapter 4</span>
      <h2>Jest Basics ‚ö°</h2>
      <p class="section-desc">Jest is the most popular JavaScript testing framework. Let's master its core features.</p>

      <h3>üöÄ Setting Up Jest</h3>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
          <span>Terminal</span>
        </div>
        <div class="code-body"><span class="cm"># Install Jest</span>
<span class="gr">npm install --save-dev jest</span>

<span class="cm"># Add to package.json scripts</span>
<span class="str">"scripts": {
  "test": "jest",
  "test:watch": "jest --watch",
  "test:coverage": "jest --coverage"
}</span>

<span class="cm"># Run tests</span>
<span class="gr">npm test</span>
</div>
      </div>

      <h3>üìÅ File Naming Conventions</h3>
      <p>Jest automatically finds test files matching these patterns:</p>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
          <span>Project Structure</span>
        </div>
        <div class="code-body"><span class="cm">// Jest finds these automatically:</span>
src/
  utils.js
  utils.<span class="gr">test</span>.js       <span class="cm">// ‚úÖ .test.js</span>
  utils.<span class="gr">spec</span>.js       <span class="cm">// ‚úÖ .spec.js</span>
  __tests__/
    utils.js            <span class="cm">// ‚úÖ inside __tests__ folder</span>
</div>
      </div>

      <h3>üß© Core Building Blocks</h3>

      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
          <span>Jest Core API</span>
        </div>
        <div class="code-body"><span class="cm">// describe() ‚Äî Groups related tests</span>
<span class="fn">describe</span>(<span class="str">'Math utilities'</span>, () => {

  <span class="cm">// test() or it() ‚Äî Defines a single test</span>
  <span class="fn">test</span>(<span class="str">'adds numbers'</span>, () => {
    <span class="fn">expect</span>(<span class="num">1</span> + <span class="num">2</span>).<span class="fn">toBe</span>(<span class="num">3</span>);
  });

  <span class="fn">it</span>(<span class="str">'subtracts numbers'</span>, () => { <span class="cm">// it() is an alias for test()</span>
    <span class="fn">expect</span>(<span class="num">5</span> - <span class="num">3</span>).<span class="fn">toBe</span>(<span class="num">2</span>);
  });

  <span class="cm">// Nested describe for sub-groups</span>
  <span class="fn">describe</span>(<span class="str">'division'</span>, () => {
    <span class="fn">test</span>(<span class="str">'divides evenly'</span>, () => {
      <span class="fn">expect</span>(<span class="num">10</span> / <span class="num">2</span>).<span class="fn">toBe</span>(<span class="num">5</span>);
    });

    <span class="fn">test</span>(<span class="str">'handles decimals'</span>, () => {
      <span class="fn">expect</span>(<span class="num">10</span> / <span class="num">3</span>).<span class="fn">toBeCloseTo</span>(<span class="num">3.333</span>, <span class="num">2</span>);
    });
  });
});
</div>
      </div>

      <h3>üîß Setup & Teardown</h3>
      <div class="code-block">
        <div class="code-header">
          <div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
          <span>Lifecycle Hooks</span>
        </div>
        <div class="code-body"><span class="fn">describe</span>(<span class="str">'Database tests'</span>, () => {
  <span class="kw">let</span> db;

  <span class="fn">beforeAll</span>(() => {
    <span class="cm">// Runs ONCE before all tests in this describe</span>
    db = <span class="fn">createConnection</span>();
  });

  <span class="fn">afterAll</span>(() => {
    <span class="cm">// Runs ONCE after all tests</span>
    db.<span class="fn">close</span>();
  });

  <span class="fn">beforeEach</span>(() => {
    <span class="cm">// Runs before EACH test</span>
    db.<span class="fn">clear</span>();
    db.<span class="fn">seed</span>(testData);
  });

  <span class="fn">afterEach</span>(() => {
    <span class="cm">// Runs after EACH test</span>
    <span class="fn">jest</span>.<span class="fn">restoreAllMocks</span>();
  });

  <span class="fn">test</span>(<span class="str">'fetches users'</span>, () => { <span class="cm">/* ... */</span> });
  <span class="fn">test</span>(<span class="str">'creates user'</span>, () => { <span class="cm">/* ... */</span> });
});
</div>
      </div>

      <h3>‚ö° Testing Async Code</h3>
      <div class="tab-container">
        <div class="tab-nav">
          <button class="tab-btn active" onclick="switchTab(event, 'async-callback')">Callbacks</button>
          <button class="tab-btn" onclick="switchTab(event, 'async-promise')">Promises</button>
          <button class="tab-btn" onclick="switchTab(event, 'async-await')">Async/Await</button>
        </div>

        <div class="tab-panel active" id="async-callback">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Callback style</span></div>
            <div class="code-body"><span class="fn">test</span>(<span class="str">'callback async'</span>, (<span class="pr">done</span>) => {
  <span class="fn">fetchData</span>((data) => {
    <span class="fn">expect</span>(data).<span class="fn">toBe</span>(<span class="str">'hello'</span>);
    <span class="fn">done</span>(); <span class="cm">// MUST call done()!</span>
  });
});
</div>
          </div>
        </div>

        <div class="tab-panel" id="async-promise">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Promise style</span></div>
            <div class="code-body"><span class="fn">test</span>(<span class="str">'promise resolves'</span>, () => {
  <span class="cm">// MUST return the promise!</span>
  <span class="kw">return</span> <span class="fn">fetchData</span>().<span class="fn">then</span>(data => {
    <span class="fn">expect</span>(data).<span class="fn">toBe</span>(<span class="str">'hello'</span>);
  });
});

<span class="fn">test</span>(<span class="str">'promise rejects'</span>, () => {
  <span class="kw">return</span> <span class="fn">expect</span>(<span class="fn">fetchBadData</span>())
    .<span class="fn">rejects</span>.<span class="fn">toThrow</span>(<span class="str">'error'</span>);
});
</div>
          </div>
        </div>

        <div class="tab-panel" id="async-await">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Async/Await ‚ú® Recommended</span></div>
            <div class="code-body"><span class="fn">test</span>(<span class="str">'async/await style'</span>, <span class="kw">async</span> () => {
  <span class="kw">const</span> data = <span class="kw">await</span> <span class="fn">fetchData</span>();
  <span class="fn">expect</span>(data).<span class="fn">toBe</span>(<span class="str">'hello'</span>);
});

<span class="fn">test</span>(<span class="str">'async errors'</span>, <span class="kw">async</span> () => {
  <span class="kw">await</span> <span class="fn">expect</span>(<span class="fn">fetchBadData</span>())
    .<span class="fn">rejects</span>.<span class="fn">toThrow</span>(<span class="str">'network error'</span>);
});
</div>
          </div>
        </div>
      </div>

      <div class="pitfall-box">
        <h4>‚ö†Ô∏è Pitfall: Forgetting to Return Promises</h4>
        <p>If you don't return the promise (or use async/await), Jest won't wait for the async operation. The test will pass even if the assertion would fail!</p>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(2)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(4)">Next: Matchers ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 4: MATCHERS ============ -->
    <div class="section" id="section-4">
      <span class="section-badge badge-core">Chapter 5</span>
      <h2>Jest Matchers üîç</h2>
      <p class="section-desc">Matchers are the assertion methods that let you validate values in different ways.</p>

      <h3>üìã Matcher Reference (click to expand)</h3>

      <div class="collapsible">
        <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
          <span>üéØ Common Matchers</span>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="collapsible-content">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Equality & Identity</span></div>
            <div class="code-body"><span class="cm">// Exact equality (===)</span>
<span class="fn">expect</span>(<span class="num">2</span> + <span class="num">2</span>).<span class="fn">toBe</span>(<span class="num">4</span>);

<span class="cm">// Deep equality (objects/arrays)</span>
<span class="fn">expect</span>({name: <span class="str">'John'</span>}).<span class="fn">toEqual</span>({name: <span class="str">'John'</span>});

<span class="cm">// Strict equality (no type coercion)</span>
<span class="fn">expect</span>(<span class="num">2</span>).<span class="fn">toStrictEqual</span>(<span class="num">2</span>);

<span class="cm">// Negation</span>
<span class="fn">expect</span>(<span class="num">2</span> + <span class="num">2</span>).<span class="fn">not</span>.<span class="fn">toBe</span>(<span class="num">5</span>);
</div>
          </div>
        </div>
      </div>

      <div class="collapsible">
        <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
          <span>üî¢ Number Matchers</span>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="collapsible-content">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Numbers</span></div>
            <div class="code-body"><span class="fn">expect</span>(<span class="num">10</span>).<span class="fn">toBeGreaterThan</span>(<span class="num">5</span>);
<span class="fn">expect</span>(<span class="num">10</span>).<span class="fn">toBeGreaterThanOrEqual</span>(<span class="num">10</span>);
<span class="fn">expect</span>(<span class="num">5</span>).<span class="fn">toBeLessThan</span>(<span class="num">10</span>);
<span class="fn">expect</span>(<span class="num">5</span>).<span class="fn">toBeLessThanOrEqual</span>(<span class="num">5</span>);

<span class="cm">// Floating point ‚Äî use toBeCloseTo!</span>
<span class="fn">expect</span>(<span class="num">0.1</span> + <span class="num">0.2</span>).<span class="fn">toBeCloseTo</span>(<span class="num">0.3</span>);  <span class="cm">// ‚úÖ</span>
<span class="fn">expect</span>(<span class="num">0.1</span> + <span class="num">0.2</span>).<span class="fn">toBe</span>(<span class="num">0.3</span>);        <span class="cm">// ‚ùå FAILS!</span>
</div>
          </div>
        </div>
      </div>

      <div class="collapsible">
        <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
          <span>üìù String Matchers</span>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="collapsible-content">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Strings</span></div>
            <div class="code-body"><span class="fn">expect</span>(<span class="str">'Hello World'</span>).<span class="fn">toMatch</span>(<span class="str">/world/i</span>);
<span class="fn">expect</span>(<span class="str">'Hello World'</span>).<span class="fn">toContain</span>(<span class="str">'World'</span>);
<span class="fn">expect</span>(<span class="str">'Hello'</span>).<span class="fn">toHaveLength</span>(<span class="num">5</span>);
</div>
          </div>
        </div>
      </div>

      <div class="collapsible">
        <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
          <span>üì¶ Array & Object Matchers</span>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="collapsible-content">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Arrays & Objects</span></div>
            <div class="code-body"><span class="kw">const</span> arr = [<span class="str">'a'</span>, <span class="str">'b'</span>, <span class="str">'c'</span>];
<span class="fn">expect</span>(arr).<span class="fn">toContain</span>(<span class="str">'b'</span>);
<span class="fn">expect</span>(arr).<span class="fn">toHaveLength</span>(<span class="num">3</span>);

<span class="kw">const</span> arr2 = [{id: <span class="num">1</span>}, {id: <span class="num">2</span>}];
<span class="fn">expect</span>(arr2).<span class="fn">toContainEqual</span>({id: <span class="num">1</span>});

<span class="kw">const</span> obj = {name: <span class="str">'John'</span>, age: <span class="num">30</span>, city: <span class="str">'NYC'</span>};
<span class="fn">expect</span>(obj).<span class="fn">toHaveProperty</span>(<span class="str">'name'</span>);
<span class="fn">expect</span>(obj).<span class="fn">toHaveProperty</span>(<span class="str">'name'</span>, <span class="str">'John'</span>);
<span class="fn">expect</span>(obj).<span class="fn">toMatchObject</span>({name: <span class="str">'John'</span>});
</div>
          </div>
        </div>
      </div>

      <div class="collapsible">
        <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
          <span>üé≠ Truthiness Matchers</span>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="collapsible-content">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Truthiness</span></div>
            <div class="code-body"><span class="fn">expect</span>(<span class="kw">null</span>).<span class="fn">toBeNull</span>();
<span class="fn">expect</span>(<span class="kw">undefined</span>).<span class="fn">toBeUndefined</span>();
<span class="fn">expect</span>(<span class="str">'hello'</span>).<span class="fn">toBeDefined</span>();
<span class="fn">expect</span>(<span class="kw">true</span>).<span class="fn">toBeTruthy</span>();
<span class="fn">expect</span>(<span class="num">0</span>).<span class="fn">toBeFalsy</span>();
<span class="fn">expect</span>(<span class="str">''</span>).<span class="fn">toBeFalsy</span>();
<span class="fn">expect</span>(<span class="kw">null</span>).<span class="fn">toBeFalsy</span>();
</div>
          </div>
        </div>
      </div>

      <div class="collapsible">
        <button class="collapsible-toggle" onclick="toggleCollapsible(this)">
          <span>üí• Error Matchers</span>
          <span class="arrow">‚ñº</span>
        </button>
        <div class="collapsible-content">
          <div class="code-block">
            <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Errors</span></div>
            <div class="code-body"><span class="cm">// MUST wrap in a function!</span>
<span class="fn">expect</span>(() => {
  <span class="fn">throwingFunction</span>();
}).<span class="fn">toThrow</span>();

<span class="fn">expect</span>(() => {
  <span class="fn">throwingFunction</span>();
}).<span class="fn">toThrow</span>(<span class="str">'specific error message'</span>);

<span class="fn">expect</span>(() => {
  <span class="fn">throwingFunction</span>();
}).<span class="fn">toThrow</span>(TypeError);
</div>
          </div>
        </div>
      </div>

      <h3>üéÆ Matcher Challenge</h3>
      <p>Match the assertion to the correct matcher:</p>

      <div class="test-runner">
        <div class="test-runner-header">
          <span class="test-runner-title">üß© Matcher Puzzle</span>
          <button class="run-tests-btn" onclick="checkMatcherQuiz()">‚úì Check Answers</button>
        </div>
        <div class="test-editor" style="padding: 20px;">
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; color: var(--text-secondary); font-size: 0.88rem;">1. Check if <code style="color: var(--accent-cyan);">0.1 + 0.2</code> equals <code style="color: var(--accent-cyan);">0.3</code>:</label>
            <select id="matcherQ1" style="background: var(--bg-card2); color: var(--text-primary); border: 1px solid var(--border); padding: 8px 12px; border-radius: 6px; font-size: 0.85rem; width: 100%;">
              <option value="">Select matcher...</option>
              <option value="toBe">.toBe(0.3)</option>
              <option value="toEqual">.toEqual(0.3)</option>
              <option value="toBeCloseTo">.toBeCloseTo(0.3)</option>
              <option value="toMatch">.toMatch(0.3)</option>
            </select>
          </div>
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; color: var(--text-secondary); font-size: 0.88rem;">2. Check if <code style="color: var(--accent-cyan);">{a: 1}</code> deeply equals <code style="color: var(--accent-cyan);">{a: 1}</code>:</label>
            <select id="matcherQ2" style="background: var(--bg-card2); color: var(--text-primary); border: 1px solid var(--border); padding: 8px 12px; border-radius: 6px; font-size: 0.85rem; width: 100%;">
              <option value="">Select matcher...</option>
              <option value="toBe">.toBe({a: 1})</option>
              <option value="toEqual">.toEqual({a: 1})</option>
              <option value="toContain">.toContain({a: 1})</option>
              <option value="toMatch">.toMatch({a: 1})</option>
            </select>
          </div>
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; color: var(--text-secondary); font-size: 0.88rem;">3. Check if a function throws an error:</label>
            <select id="matcherQ3" style="background: var(--bg-card2); color: var(--text-primary); border: 1px solid var(--border); padding: 8px 12px; border-radius: 6px; font-size: 0.85rem; width: 100%;">
              <option value="">Select matcher...</option>
              <option value="toBe">.toBe(Error)</option>
              <option value="toThrow">.toThrow()</option>
              <option value="toEqual">.toEqual(Error)</option>
              <option value="toContain">.toContain(Error)</option>
            </select>
          </div>
        </div>
        <div class="test-output" id="matcherQuizOutput">
          <span style="color: var(--text-dim)">Select your answers and click "Check Answers"...</span>
        </div>
      </div>

      <div class="pitfall-box">
        <h4>‚ö†Ô∏è Pitfall: toBe vs toEqual</h4>
        <p><code>toBe</code> uses <code>Object.is()</code> (reference equality). For objects/arrays, always use <code>toEqual</code> (deep equality). <code>toBe({a:1})</code> with object literals will ALWAYS fail!</p>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(3)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(5)">Next: Mocks & Spies ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 5: MOCKS & SPIES ============ -->
    <div class="section" id="section-5">
      <span class="section-badge badge-advanced">Chapter 6</span>
      <h2>Mocking & Spies üé≠</h2>
      <p class="section-desc">Mocking lets you isolate the code you're testing by replacing dependencies with controlled substitutes.</p>

      <h3>ü§î Why Mock?</h3>
      <div class="card-grid">
        <div class="mini-card">
          <span class="card-icon">üåê</span>
          <h4>No Network Calls</h4>
          <p>Don't hit real APIs in tests. They're slow and unreliable.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üèùÔ∏è</span>
          <h4>Isolation</h4>
          <p>Test YOUR code, not the database or third-party libraries.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üéÆ</span>
          <h4>Control</h4>
          <p>Simulate errors, edge cases, and specific return values.</p>
        </div>
      </div>

      <h3>üß∞ Jest Mock Functions</h3>

      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>jest.fn() ‚Äî Basic Mock</span></div>
        <div class="code-body"><span class="cm">// Create a mock function</span>
<span class="kw">const</span> mockFn = <span class="fn">jest</span>.<span class="fn">fn</span>();

<span class="cm">// Call it</span>
<span class="fn">mockFn</span>(<span class="str">'hello'</span>);
<span class="fn">mockFn</span>(<span class="str">'world'</span>);

<span class="cm">// Inspect calls</span>
<span class="fn">expect</span>(mockFn).<span class="fn">toHaveBeenCalled</span>();
<span class="fn">expect</span>(mockFn).<span class="fn">toHaveBeenCalledTimes</span>(<span class="num">2</span>);
<span class="fn">expect</span>(mockFn).<span class="fn">toHaveBeenCalledWith</span>(<span class="str">'hello'</span>);
<span class="fn">expect</span>(mockFn).<span class="fn">toHaveBeenLastCalledWith</span>(<span class="str">'world'</span>);
</div>
      </div>

      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Mock Return Values</span></div>
        <div class="code-body"><span class="kw">const</span> mockFn = <span class="fn">jest</span>.<span class="fn">fn</span>();

<span class="cm">// Always return the same value</span>
mockFn.<span class="fn">mockReturnValue</span>(<span class="num">42</span>);
<span class="fn">expect</span>(<span class="fn">mockFn</span>()).<span class="fn">toBe</span>(<span class="num">42</span>);

<span class="cm">// Return value once, then default</span>
mockFn
  .<span class="fn">mockReturnValueOnce</span>(<span class="str">'first'</span>)
  .<span class="fn">mockReturnValueOnce</span>(<span class="str">'second'</span>)
  .<span class="fn">mockReturnValue</span>(<span class="str">'default'</span>);

<span class="fn">mockFn</span>(); <span class="cm">// 'first'</span>
<span class="fn">mockFn</span>(); <span class="cm">// 'second'</span>
<span class="fn">mockFn</span>(); <span class="cm">// 'default'</span>

<span class="cm">// Mock async functions</span>
mockFn.<span class="fn">mockResolvedValue</span>({data: <span class="str">'users'</span>});
<span class="kw">const</span> result = <span class="kw">await</span> <span class="fn">mockFn</span>();
<span class="cm">// result = {data: 'users'}</span>
</div>
      </div>

      <h3>üïµÔ∏è Spies</h3>
      <p>Spies watch existing functions without replacing their behavior (by default):</p>

      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>jest.spyOn()</span></div>
        <div class="code-body"><span class="kw">const</span> calculator = {
  <span class="fn">add</span>(a, b) { <span class="kw">return</span> a + b; }
};

<span class="cm">// Spy on the method</span>
<span class="kw">const</span> spy = <span class="fn">jest</span>.<span class="fn">spyOn</span>(calculator, <span class="str">'add'</span>);

calculator.<span class="fn">add</span>(<span class="num">2</span>, <span class="num">3</span>); <span class="cm">// Still calls the real function!</span>

<span class="fn">expect</span>(spy).<span class="fn">toHaveBeenCalledWith</span>(<span class="num">2</span>, <span class="num">3</span>);
<span class="fn">expect</span>(spy).<span class="fn">toHaveReturnedWith</span>(<span class="num">5</span>);

<span class="cm">// Override the implementation</span>
spy.<span class="fn">mockImplementation</span>(() => <span class="num">999</span>);
calculator.<span class="fn">add</span>(<span class="num">2</span>, <span class="num">3</span>); <span class="cm">// Returns 999!</span>

<span class="cm">// Clean up</span>
spy.<span class="fn">mockRestore</span>(); <span class="cm">// Restore original function</span>
</div>
      </div>

      <h3>üì¶ Mocking Modules</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Mocking a module (e.g., axios)</span></div>
        <div class="code-body"><span class="cm">// userService.js</span>
<span class="kw">import</span> axios <span class="kw">from</span> <span class="str">'axios'</span>;

<span class="kw">export async function</span> <span class="fn">getUser</span>(id) {
  <span class="kw">const</span> response = <span class="kw">await</span> axios.<span class="fn">get</span>(<span class="str">`/api/users/${id}`</span>);
  <span class="kw">return</span> response.data;
}

<span class="cm">// userService.test.js</span>
<span class="kw">import</span> axios <span class="kw">from</span> <span class="str">'axios'</span>;
<span class="kw">import</span> { getUser } <span class="kw">from</span> <span class="str">'./userService'</span>;

<span class="cm">// Mock the entire module</span>
<span class="fn">jest</span>.<span class="fn">mock</span>(<span class="str">'axios'</span>);

<span class="fn">test</span>(<span class="str">'fetches user by id'</span>, <span class="kw">async</span> () => {
  <span class="cm">// Setup mock response</span>
  axios.get.<span class="fn">mockResolvedValue</span>({
    data: { id: <span class="num">1</span>, name: <span class="str">'Alice'</span> }
  });

  <span class="kw">const</span> user = <span class="kw">await</span> <span class="fn">getUser</span>(<span class="num">1</span>);

  <span class="fn">expect</span>(user.name).<span class="fn">toBe</span>(<span class="str">'Alice'</span>);
  <span class="fn">expect</span>(axios.get).<span class="fn">toHaveBeenCalledWith</span>(<span class="str">'/api/users/1'</span>);
});
</div>
      </div>

      <h3>‚è±Ô∏è Timer Mocks</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Fake Timers</span></div>
        <div class="code-body"><span class="fn">jest</span>.<span class="fn">useFakeTimers</span>();

<span class="fn">test</span>(<span class="str">'debounce waits before executing'</span>, () => {
  <span class="kw">const</span> callback = <span class="fn">jest</span>.<span class="fn">fn</span>();
  <span class="kw">const</span> debounced = <span class="fn">debounce</span>(callback, <span class="num">1000</span>);

  <span class="fn">debounced</span>();
  <span class="fn">expect</span>(callback).<span class="fn">not</span>.<span class="fn">toHaveBeenCalled</span>();

  <span class="cm">// Fast-forward time</span>
  <span class="fn">jest</span>.<span class="fn">advanceTimersByTime</span>(<span class="num">1000</span>);

  <span class="fn">expect</span>(callback).<span class="fn">toHaveBeenCalledTimes</span>(<span class="num">1</span>);
});
</div>
      </div>

      <h3>üéÆ Interactive: Mock Detective</h3>
      <div class="test-runner">
        <div class="test-runner-header">
          <span class="test-runner-title">üîç Mock Inspector</span>
          <button class="run-tests-btn" onclick="runMockDemo()">‚ñ∂ Run Mock Demo</button>
        </div>
        <div class="test-editor">
          <textarea id="mockDemoCode">// Simulated mock demo - Run to see how mocks track calls!
const mockGreet = jest.fn();

// Configure return values
mockGreet
  .mockReturnValueOnce('Hello, Alice!')
  .mockReturnValueOnce('Hello, Bob!')
  .mockReturnValue('Hello, stranger!');

// Make some calls
console.log(mockGreet('Alice'));
console.log(mockGreet('Bob'));
console.log(mockGreet('Charlie'));

// Inspect the mock
console.log('Times called:', mockGreet.mock.calls.length);
console.log('All args:', mockGreet.mock.calls);
console.log('All results:', mockGreet.mock.results);</textarea>
        </div>
        <div class="test-output" id="mockDemoOutput">
          <span style="color: var(--text-dim)">Click "Run Mock Demo" to see mock behavior...</span>
        </div>
      </div>

      <div class="pitfall-box">
        <h4>‚ö†Ô∏è Pitfall: Not Cleaning Up Mocks</h4>
        <p>Mocks persist between tests! Always use <code>jest.restoreAllMocks()</code> in <code>afterEach()</code> or set <code>restoreMocks: true</code> in your Jest config.</p>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(4)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(6)">Next: Test Coverage ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 6: TEST COVERAGE ============ -->
    <div class="section" id="section-6">
      <span class="section-badge badge-advanced">Chapter 7</span>
      <h2>Test Coverage üìä</h2>
      <p class="section-desc">Test coverage measures how much of your code is executed during tests. It's a guide, not a goal.</p>

      <h3>üìà Coverage Metrics</h3>
      <div class="card-grid">
        <div class="mini-card">
          <span class="card-icon">üìã</span>
          <h4>Statement Coverage</h4>
          <p>% of code statements executed during tests.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üåø</span>
          <h4>Branch Coverage</h4>
          <p>% of if/else branches tested (both true AND false paths).</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üîß</span>
          <h4>Function Coverage</h4>
          <p>% of functions that have been called during tests.</p>
        </div>
        <div class="mini-card">
          <span class="card-icon">üìè</span>
          <h4>Line Coverage</h4>
          <p>% of executable lines that ran. Similar to statement.</p>
        </div>
      </div>

      <h3>üéÆ Interactive Coverage Visualization</h3>
      <p>Click "Analyze" to see how test coverage works for this code:</p>

      <div class="test-runner">
        <div class="test-runner-header">
          <span class="test-runner-title">üìä Coverage Analyzer</span>
          <button class="run-tests-btn" onclick="runCoverageDemo()">üìä Analyze Coverage</button>
        </div>
        <div class="test-editor">
          <textarea id="coverageCode">function calculateGrade(score) {
  if (score >= 90) {
    return 'A';    // Line 3
  } else if (score >= 80) {
    return 'B';    // Line 5
  } else if (score >= 70) {
    return 'C';    // Line 7
  } else if (score >= 60) {
    return 'D';    // Line 9
  } else {
    return 'F';    // Line 11
  }
}

// Tests (toggle these to see coverage change):
// Test 1: calculateGrade(95)  ‚Üí covers 'A' branch
// Test 2: calculateGrade(85)  ‚Üí covers 'B' branch
// Test 3: calculateGrade(45)  ‚Üí covers 'F' branch</textarea>
        </div>
        <div class="test-output" id="coverageOutput">
          <span style="color: var(--text-dim)">Click "Analyze Coverage" to see the report...</span>
        </div>
      </div>

      <h3>üìä Sample Coverage Report</h3>
      <div class="coverage-visual" id="coverageVisual">
        <div class="coverage-bar-group">
          <div class="coverage-label">
            <span>Statements</span>
            <span id="covStmt" style="font-weight: 600;">0%</span>
          </div>
          <div class="coverage-bar">
            <div class="coverage-fill coverage-high" id="covStmtBar" style="width: 0%"></div>
          </div>
        </div>
        <div class="coverage-bar-group">
          <div class="coverage-label">
            <span>Branches</span>
            <span id="covBranch" style="font-weight: 600;">0%</span>
          </div>
          <div class="coverage-bar">
            <div class="coverage-fill coverage-med" id="covBranchBar" style="width: 0%"></div>
          </div>
        </div>
        <div class="coverage-bar-group">
          <div class="coverage-label">
            <span>Functions</span>
            <span id="covFunc" style="font-weight: 600;">0%</span>
          </div>
          <div class="coverage-bar">
            <div class="coverage-fill coverage-high" id="covFuncBar" style="width: 0%"></div>
          </div>
        </div>
        <div class="coverage-bar-group">
          <div class="coverage-label">
            <span>Lines</span>
            <span id="covLines" style="font-weight: 600;">0%</span>
          </div>
          <div class="coverage-bar">
            <div class="coverage-fill coverage-low" id="covLinesBar" style="width: 0%"></div>
          </div>
        </div>
      </div>

      <h3>‚öôÔ∏è Jest Coverage Config</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>jest.config.js</span></div>
        <div class="code-body"><span class="kw">module.exports</span> = {
  <span class="cm">// Collect coverage</span>
  collectCoverage: <span class="kw">true</span>,

  <span class="cm">// Which files to collect from</span>
  collectCoverageFrom: [
    <span class="str">'src/**/*.{js,jsx}'</span>,
    <span class="str">'!src/index.js'</span>,      <span class="cm">// exclude entry point</span>
    <span class="str">'!src/**/*.test.js'</span>,   <span class="cm">// exclude test files</span>
  ],

  <span class="cm">// Minimum thresholds (CI will fail if below)</span>
  coverageThreshold: {
    global: {
      branches: <span class="num">80</span>,
      functions: <span class="num">80</span>,
      lines: <span class="num">80</span>,
      statements: <span class="num">80</span>,
    },
  },

  <span class="cm">// Report formats</span>
  coverageReporters: [<span class="str">'text'</span>, <span class="str">'lcov'</span>, <span class="str">'html'</span>],
};
</div>
      </div>

      <div class="pitfall-box">
        <h4>‚ö†Ô∏è Pitfall: 100% Coverage ‚â† Bug-Free Code</h4>
        <p>Coverage tells you what code <em>ran</em>, not if it <em>works correctly</em>. A test with no assertions has coverage but catches zero bugs. Aim for 80%+ with meaningful assertions.</p>
      </div>

      <div class="tip-box">
        <h4>üí° Coverage Sweet Spot</h4>
        <p><strong>80% coverage</strong> is the sweet spot for most projects. Below 80%, you likely have blind spots. Above 95%, you're probably testing trivial code and wasting time.</p>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(5)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(7)">Next: Best Practices ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 7: BEST PRACTICES ============ -->
    <div class="section" id="section-7">
      <span class="section-badge badge-core">Chapter 8</span>
      <h2>Testing Best Practices ‚ú®</h2>
      <p class="section-desc">Write tests that are maintainable, readable, and actually useful. Quality over quantity.</p>

      <h3>üìè Rule 1: One Assertion Concept Per Test</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>‚ùå BAD ‚Äî Testing too many things</span></div>
        <div class="code-body"><span class="fn">test</span>(<span class="str">'user operations'</span>, () => {
  <span class="kw">const</span> user = <span class="fn">createUser</span>(<span class="str">'John'</span>, <span class="num">25</span>);
  <span class="fn">expect</span>(user.name).<span class="fn">toBe</span>(<span class="str">'John'</span>);
  <span class="fn">expect</span>(user.age).<span class="fn">toBe</span>(<span class="num">25</span>);
  <span class="fn">expect</span>(user.id).<span class="fn">toBeDefined</span>();

  <span class="kw">const</span> updated = <span class="fn">updateUser</span>(user, {age: <span class="num">26</span>});
  <span class="fn">expect</span>(updated.age).<span class="fn">toBe</span>(<span class="num">26</span>);

  <span class="fn">expect</span>(() => <span class="fn">deleteUser</span>(<span class="kw">null</span>)).<span class="fn">toThrow</span>();
  <span class="cm">// If createUser fails, you don't know about update/delete!</span>
});
</div>
      </div>

      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>‚úÖ GOOD ‚Äî Focused tests</span></div>
        <div class="code-body"><span class="fn">describe</span>(<span class="str">'User operations'</span>, () => {
  <span class="fn">test</span>(<span class="str">'creates user with name and age'</span>, () => {
    <span class="kw">const</span> user = <span class="fn">createUser</span>(<span class="str">'John'</span>, <span class="num">25</span>);
    <span class="fn">expect</span>(user).<span class="fn">toEqual</span>(<span class="fn">expect</span>.<span class="fn">objectContaining</span>({
      name: <span class="str">'John'</span>, age: <span class="num">25</span>
    }));
  });

  <span class="fn">test</span>(<span class="str">'assigns unique id on creation'</span>, () => {
    <span class="kw">const</span> user = <span class="fn">createUser</span>(<span class="str">'John'</span>, <span class="num">25</span>);
    <span class="fn">expect</span>(user.id).<span class="fn">toBeDefined</span>();
  });

  <span class="fn">test</span>(<span class="str">'updates user properties'</span>, () => {
    <span class="kw">const</span> user = <span class="fn">createUser</span>(<span class="str">'John'</span>, <span class="num">25</span>);
    <span class="kw">const</span> updated = <span class="fn">updateUser</span>(user, {age: <span class="num">26</span>});
    <span class="fn">expect</span>(updated.age).<span class="fn">toBe</span>(<span class="num">26</span>);
  });

  <span class="fn">test</span>(<span class="str">'throws on deleting null user'</span>, () => {
    <span class="fn">expect</span>(() => <span class="fn">deleteUser</span>(<span class="kw">null</span>)).<span class="fn">toThrow</span>();
  });
});
</div>
      </div>

      <h3>üìõ Rule 2: Descriptive Test Names</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Naming Conventions</span></div>
        <div class="code-body"><span class="cm">// ‚ùå BAD names</span>
<span class="fn">test</span>(<span class="str">'test 1'</span>, ...);
<span class="fn">test</span>(<span class="str">'it works'</span>, ...);
<span class="fn">test</span>(<span class="str">'should do the thing'</span>, ...);

<span class="cm">// ‚úÖ GOOD names ‚Äî describe WHAT and WHEN</span>
<span class="fn">test</span>(<span class="str">'returns empty array when no users match filter'</span>, ...);
<span class="fn">test</span>(<span class="str">'throws InvalidEmail error for malformed email'</span>, ...);
<span class="fn">test</span>(<span class="str">'calculates 15% tax for orders over $100'</span>, ...);

<span class="cm">// PATTERN: "action + expected result + condition"</span>
</div>
      </div>

      <h3>üèóÔ∏è Rule 3: Use Test Data Builders</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Factory Functions</span></div>
        <div class="code-body"><span class="cm">// Create a factory for test data</span>
<span class="kw">function</span> <span class="fn">buildUser</span>(overrides = {}) {
  <span class="kw">return</span> {
    id: <span class="num">1</span>,
    name: <span class="str">'Default User'</span>,
    email: <span class="str">'test@example.com'</span>,
    role: <span class="str">'user'</span>,
    ...overrides, <span class="cm">// Override any property!</span>
  };
}

<span class="cm">// Usage in tests</span>
<span class="fn">test</span>(<span class="str">'admin users can delete posts'</span>, () => {
  <span class="kw">const</span> admin = <span class="fn">buildUser</span>({ role: <span class="str">'admin'</span> });
  <span class="fn">expect</span>(<span class="fn">canDeletePost</span>(admin)).<span class="fn">toBe</span>(<span class="kw">true</span>);
});

<span class="fn">test</span>(<span class="str">'regular users cannot delete posts'</span>, () => {
  <span class="kw">const</span> user = <span class="fn">buildUser</span>(); <span class="cm">// uses defaults</span>
  <span class="fn">expect</span>(<span class="fn">canDeletePost</span>(user)).<span class="fn">toBe</span>(<span class="kw">false</span>);
});
</div>
      </div>

      <h3>üìã Quick Reference: Do's and Don'ts</h3>
      <table class="comparison-table">
        <thead><tr><th>‚úÖ DO</th><th>‚ùå DON'T</th></tr></thead>
        <tbody>
          <tr><td>Test behavior, not implementation</td><td>Test private methods directly</td></tr>
          <tr><td>Use descriptive test names</td><td>Use test1, test2, etc.</td></tr>
          <tr><td>Keep tests independent</td><td>Make tests depend on each other</td></tr>
          <tr><td>Test edge cases & errors</td><td>Only test the "happy path"</td></tr>
          <tr><td>Use beforeEach for shared setup</td><td>Copy-paste setup in every test</td></tr>
          <tr><td>Mock external dependencies</td><td>Hit real APIs/databases</td></tr>
          <tr><td>Clean up mocks after each test</td><td>Let mocks leak between tests</td></tr>
          <tr><td>Test one concept per test</td><td>Cram everything in one test</td></tr>
        </tbody>
      </table>

      <h3>üéØ Rule 4: Test Edge Cases</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Edge cases to always consider</span></div>
        <div class="code-body"><span class="fn">describe</span>(<span class="str">'divide'</span>, () => {
  <span class="fn">test</span>(<span class="str">'divides two positive numbers'</span>, () => {
    <span class="fn">expect</span>(<span class="fn">divide</span>(<span class="num">10</span>, <span class="num">2</span>)).<span class="fn">toBe</span>(<span class="num">5</span>);
  });

  <span class="cm">// ‚ö° Edge cases!</span>
  <span class="fn">test</span>(<span class="str">'throws on division by zero'</span>, () => {
    <span class="fn">expect</span>(() => <span class="fn">divide</span>(<span class="num">10</span>, <span class="num">0</span>)).<span class="fn">toThrow</span>();
  });

  <span class="fn">test</span>(<span class="str">'handles negative numbers'</span>, () => {
    <span class="fn">expect</span>(<span class="fn">divide</span>(-<span class="num">10</span>, <span class="num">2</span>)).<span class="fn">toBe</span>(-<span class="num">5</span>);
  });

  <span class="fn">test</span>(<span class="str">'handles zero numerator'</span>, () => {
    <span class="fn">expect</span>(<span class="fn">divide</span>(<span class="num">0</span>, <span class="num">5</span>)).<span class="fn">toBe</span>(<span class="num">0</span>);
  });

  <span class="fn">test</span>(<span class="str">'handles non-number inputs'</span>, () => {
    <span class="fn">expect</span>(() => <span class="fn">divide</span>(<span class="str">'a'</span>, <span class="num">2</span>)).<span class="fn">toThrow</span>(TypeError);
  });
});
</div>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(6)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(8)">Next: Common Pitfalls ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 8: PITFALLS ============ -->
    <div class="section" id="section-8">
      <span class="section-badge badge-warning">Chapter 9</span>
      <h2>Common Mistakes & Pitfalls ‚ö†Ô∏è</h2>
      <p class="section-desc">Even experienced developers make these mistakes. Learn to spot and avoid them.</p>

      <h3>üí£ Pitfall 1: False Positives from Missing Assertions</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>‚ùå This test ALWAYS passes!</span></div>
        <div class="code-body"><span class="fn">test</span>(<span class="str">'fetches data'</span>, () => {
  <span class="fn">fetchData</span>().<span class="fn">then</span>(data => {
    <span class="fn">expect</span>(data).<span class="fn">toBe</span>(<span class="str">'hello'</span>); <span class="cm">// NEVER RUNS!</span>
  });
  <span class="cm">// ‚ùå Promise not returned, test ends before .then()</span>
});

<span class="cm">// ‚úÖ FIX 1: Return the promise</span>
<span class="fn">test</span>(<span class="str">'fetches data'</span>, () => {
  <span class="kw">return</span> <span class="fn">fetchData</span>().<span class="fn">then</span>(data => {
    <span class="fn">expect</span>(data).<span class="fn">toBe</span>(<span class="str">'hello'</span>);
  });
});

<span class="cm">// ‚úÖ FIX 2: Use async/await (recommended)</span>
<span class="fn">test</span>(<span class="str">'fetches data'</span>, <span class="kw">async</span> () => {
  <span class="kw">const</span> data = <span class="kw">await</span> <span class="fn">fetchData</span>();
  <span class="fn">expect</span>(data).<span class="fn">toBe</span>(<span class="str">'hello'</span>);
});
</div>
      </div>

      <h3>üí£ Pitfall 2: Testing Implementation Details</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>‚ùå Brittle: Tests internal state</span></div>
        <div class="code-body"><span class="cm">// ‚ùå BAD ‚Äî breaks if you refactor internal structure</span>
<span class="fn">test</span>(<span class="str">'cart stores items internally'</span>, () => {
  <span class="kw">const</span> cart = <span class="kw">new</span> <span class="fn">Cart</span>();
  cart.<span class="fn">add</span>({ id: <span class="num">1</span>, price: <span class="num">10</span> });

  <span class="cm">// Testing private internals!</span>
  <span class="fn">expect</span>(cart._items.length).<span class="fn">toBe</span>(<span class="num">1</span>);
  <span class="fn">expect</span>(cart._items[<span class="num">0</span>]._internalId).<span class="fn">toBeDefined</span>();
});

<span class="cm">// ‚úÖ GOOD ‚Äî tests the PUBLIC API</span>
<span class="fn">test</span>(<span class="str">'cart tracks added items'</span>, () => {
  <span class="kw">const</span> cart = <span class="kw">new</span> <span class="fn">Cart</span>();
  cart.<span class="fn">add</span>({ id: <span class="num">1</span>, price: <span class="num">10</span> });

  <span class="fn">expect</span>(cart.<span class="fn">getItemCount</span>()).<span class="fn">toBe</span>(<span class="num">1</span>);
  <span class="fn">expect</span>(cart.<span class="fn">getTotal</span>()).<span class="fn">toBe</span>(<span class="num">10</span>);
});
</div>
      </div>

      <h3>üí£ Pitfall 3: Snapshot Test Abuse</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Snapshot anti-pattern</span></div>
        <div class="code-body"><span class="cm">// ‚ùå BAD ‚Äî massive snapshot, everyone just updates it</span>
<span class="fn">test</span>(<span class="str">'renders page'</span>, () => {
  <span class="kw">const</span> tree = <span class="fn">render</span>(<span class="str">&lt;EntireApp /&gt;</span>);
  <span class="fn">expect</span>(tree).<span class="fn">toMatchSnapshot</span>(); <span class="cm">// 500-line snapshot!</span>
});

<span class="cm">// ‚úÖ GOOD ‚Äî small, focused snapshots</span>
<span class="fn">test</span>(<span class="str">'renders user avatar correctly'</span>, () => {
  <span class="kw">const</span> tree = <span class="fn">render</span>(<span class="str">&lt;Avatar user={mockUser} /&gt;</span>);
  <span class="fn">expect</span>(tree).<span class="fn">toMatchInlineSnapshot</span>(<span class="str">`
    &lt;img src="avatar.jpg" alt="John" /&gt;
  `</span>);
});
</div>
      </div>

      <h3>üí£ Pitfall 4: Shared Mutable State</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Test pollution</span></div>
        <div class="code-body"><span class="cm">// ‚ùå BAD ‚Äî tests modify shared data</span>
<span class="kw">const</span> users = [{ name: <span class="str">'Alice'</span> }]; <span class="cm">// shared!</span>

<span class="fn">test</span>(<span class="str">'adds a user'</span>, () => {
  users.push({ name: <span class="str">'Bob'</span> });
  <span class="fn">expect</span>(users).toHaveLength(<span class="num">2</span>); <span class="cm">// ‚úÖ passes</span>
});

<span class="fn">test</span>(<span class="str">'starts with one user'</span>, () => {
  <span class="fn">expect</span>(users).toHaveLength(<span class="num">1</span>); <span class="cm">// ‚ùå FAILS! Still has 2</span>
});

<span class="cm">// ‚úÖ FIX ‚Äî fresh data for each test</span>
<span class="kw">let</span> users;
<span class="fn">beforeEach</span>(() => {
  users = [{ name: <span class="str">'Alice'</span> }]; <span class="cm">// fresh copy!</span>
});
</div>
      </div>

      <h3>üí£ Pitfall 5: Forgetting to Wrap Thrown Errors</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>Common toThrow() mistake</span></div>
        <div class="code-body"><span class="cm">// ‚ùå BAD ‚Äî function executes immediately, crashes the test!</span>
<span class="fn">expect</span>(<span class="fn">throwingFunction</span>()).<span class="fn">toThrow</span>();

<span class="cm">// ‚úÖ GOOD ‚Äî wrap in arrow function</span>
<span class="fn">expect</span>(<span class="bl">()</span> => <span class="fn">throwingFunction</span>()).<span class="fn">toThrow</span>();
</div>
      </div>

      <h3>üí£ Pitfall 6: Ignoring the "Arrange" Phase</h3>
      <div class="code-block">
        <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>No setup = unclear intent</span></div>
        <div class="code-body"><span class="cm">// ‚ùå BAD ‚Äî what is 42? What does this test verify?</span>
<span class="fn">test</span>(<span class="str">'works'</span>, () => {
  <span class="fn">expect</span>(<span class="fn">process</span>(<span class="num">42</span>, <span class="kw">true</span>, <span class="str">'x'</span>, [<span class="num">1</span>,<span class="num">2</span>])).<span class="fn">toBe</span>(<span class="num">84</span>);
});

<span class="cm">// ‚úÖ GOOD ‚Äî clear intent</span>
<span class="fn">test</span>(<span class="str">'doubles the price when premium is true'</span>, () => {
  <span class="kw">const</span> basePrice = <span class="num">42</span>;
  <span class="kw">const</span> isPremium = <span class="kw">true</span>;
  <span class="kw">const</span> category = <span class="str">'electronics'</span>;
  <span class="kw">const</span> discounts = [];

  <span class="kw">const</span> result = <span class="fn">calculatePrice</span>(basePrice, isPremium, category, discounts);

  <span class="fn">expect</span>(result).<span class="fn">toBe</span>(<span class="num">84</span>);
});
</div>
      </div>

      <div class="tip-box">
        <h4>üèÜ Golden Rule of Testing</h4>
        <p>If a test fails, you should know <strong>exactly what broke</strong> just by reading the test name and the assertion that failed ‚Äî without looking at the source code.</p>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(7)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(9)">Next: Exercises ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 9: EXERCISES ============ -->
    <div class="section" id="section-9">
      <span class="section-badge badge-practice">Practice</span>
      <h2>Hands-On Exercises üí™</h2>
      <p class="section-desc">Put your knowledge to the test! Write real test code and verify your solutions.</p>

      <div class="exercise-container">
        <div class="exercise-header">
          <span class="exercise-title">üìù Exercise 1: Test a String Utility</span>
          <span class="exercise-difficulty diff-easy">Easy</span>
        </div>
        <div class="exercise-body">
          <div class="exercise-prompt">
            <p>Given the function below, write tests for it. Cover: normal case, empty string, string with spaces, already capitalized string.</p>
            <div class="code-block">
              <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>capitalize.js</span></div>
              <div class="code-body"><span class="kw">function</span> <span class="fn">capitalize</span>(str) {
  <span class="kw">if</span> (!str) <span class="kw">return</span> <span class="str">''</span>;
  <span class="kw">return</span> str.charAt(<span class="num">0</span>).toUpperCase() + str.slice(<span class="num">1</span>);
}
</div>
            </div>
          </div>
          <textarea class="exercise-textarea" id="exercise1">// Write your tests here!
describe('capitalize', () => {
  test('capitalizes the first letter', () => {
    // Your code here...
  });

  // Add more tests...
});</textarea>
          <div class="exercise-actions">
            <button class="btn btn-success" onclick="checkExercise(1)">‚úì Check Solution</button>
            <button class="btn btn-secondary" onclick="showHint(1)">üí° Hint</button>
            <button class="btn btn-secondary" onclick="showSolution(1)">üëÅÔ∏è Solution</button>
          </div>
          <div class="exercise-result" id="exercise1Result"></div>
        </div>
      </div>

      <div class="exercise-container">
        <div class="exercise-header">
          <span class="exercise-title">üìù Exercise 2: Test an Array Function</span>
          <span class="exercise-difficulty diff-medium">Medium</span>
        </div>
        <div class="exercise-body">
          <div class="exercise-prompt">
            <p>Write comprehensive tests for this array filtering function:</p>
            <div class="code-block">
              <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>filterByAge.js</span></div>
              <div class="code-body"><span class="kw">function</span> <span class="fn">filterAdults</span>(people) {
  <span class="kw">if</span> (!Array.isArray(people)) {
    <span class="kw">throw new</span> TypeError(<span class="str">'Input must be an array'</span>);
  }
  <span class="kw">return</span> people.filter(p => p.age >= <span class="num">18</span>);
}
</div>
            </div>
          </div>
          <textarea class="exercise-textarea" id="exercise2">describe('filterAdults', () => {
  // Test normal filtering
  // Test empty array
  // Test array with no adults
  // Test error for non-array input
  // Test edge case: exactly 18
});</textarea>
          <div class="exercise-actions">
            <button class="btn btn-success" onclick="checkExercise(2)">‚úì Check Solution</button>
            <button class="btn btn-secondary" onclick="showHint(2)">üí° Hint</button>
            <button class="btn btn-secondary" onclick="showSolution(2)">üëÅÔ∏è Solution</button>
          </div>
          <div class="exercise-result" id="exercise2Result"></div>
        </div>
      </div>

      <div class="exercise-container">
        <div class="exercise-header">
          <span class="exercise-title">üìù Exercise 3: Write a Mock Test</span>
          <span class="exercise-difficulty diff-hard">Hard</span>
        </div>
        <div class="exercise-body">
          <div class="exercise-prompt">
            <p>Write a test that mocks the API call and verifies the function's behavior:</p>
            <div class="code-block">
              <div class="code-header"><div class="code-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div><span>notificationService.js</span></div>
              <div class="code-body"><span class="kw">async function</span> <span class="fn">sendNotification</span>(userId, message, apiClient) {
  <span class="kw">if</span> (!userId || !message) {
    <span class="kw">throw new</span> Error(<span class="str">'userId and message required'</span>);
  }

  <span class="kw">const</span> response = <span class="kw">await</span> apiClient.<span class="fn">post</span>(<span class="str">'/notifications'</span>, {
    userId, message, timestamp: Date.<span class="fn">now</span>()
  });

  <span class="kw">return</span> { success: <span class="kw">true</span>, id: response.id };
}
</div>
            </div>
          </div>
          <textarea class="exercise-textarea" id="exercise3">describe('sendNotification', () => {
  // Create a mock apiClient
  // Test successful notification
  // Test validation errors
  // Verify the mock was called correctly
});</textarea>
          <div class="exercise-actions">
            <button class="btn btn-success" onclick="checkExercise(3)">‚úì Check Solution</button>
            <button class="btn btn-secondary" onclick="showHint(3)">üí° Hint</button>
            <button class="btn btn-secondary" onclick="showSolution(3)">üëÅÔ∏è Solution</button>
          </div>
          <div class="exercise-result" id="exercise3Result"></div>
        </div>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(8)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(10)">Next: Final Quiz üèÜ ‚Üí</button>
      </div>
    </div>

    <!-- ============ SECTION 10: FINAL QUIZ ============ -->
    <div class="section" id="section-10">
      <span class="section-badge badge-practice">Final Challenge</span>
      <h2>Final Quiz üèÜ</h2>
      <p class="section-desc">Test your knowledge! 15 questions covering everything we've learned.</p>

      <div class="quiz-container" id="quizContainer">
        <!-- Questions injected by JS -->
      </div>

      <div style="text-align: center; margin: 32px 0;">
        <button class="btn btn-success" style="font-size: 1.1rem; padding: 14px 40px;" onclick="submitQuiz()">
          üèÜ Submit Quiz
        </button>
      </div>

      <div id="quizResult" style="display: none;">
        <div class="scoreboard">
          <div class="score-circle" id="scoreCircle">
            <span id="scoreNum">0</span>
            <span style="font-size: 0.8rem; font-weight: 400;">/15</span>
          </div>
          <div id="scoreMessage" style="font-size: 1.2rem; margin-bottom: 16px;"></div>
          <div id="scoreDetails" style="color: var(--text-dim); font-size: 0.9rem;"></div>
        </div>
      </div>

      <div class="section-nav">
        <button class="nav-btn" onclick="goToSection(9)">‚Üê Previous</button>
        <button class="nav-btn" onclick="goToSection(0)">üîÑ Start Over</button>
      </div>
    </div>

  </main>
</div>

<script>
// ============== STATE ==============
let currentSection = 0;
const totalSections = 11;
const completedSections = new Set();
let quizAnswers = {};

// ============== NAVIGATION ==============
function goToSection(index) {
  // Mark current section as completed
  completedSections.add(currentSection);

  // Update nav
  const navItems = document.querySelectorAll('.nav-item');
  navItems.forEach((item, i) => {
    item.classList.remove('active');
    if (completedSections.has(i)) item.classList.add('completed');
  });
  navItems[index].classList.add('active');

  // Update sections
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(`section-${index}`).classList.add('active');

  currentSection = index;
  updateProgress();
  window.scrollTo({ top: 0, behavior: 'smooth' });

  // Close mobile sidebar
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('overlay').style.display = 'none';
}

function updateProgress() {
  const pct = Math.round((completedSections.size / totalSections) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = pct + '% Complete';
}

function toggleSidebar() {
  const sb = document.getElementById('sidebar');
  const ov = document.getElementById('overlay');
  sb.classList.toggle('open');
  ov.style.display = sb.classList.contains('open') ? 'block' : 'none';
}

// ============== TABS ==============
function switchTab(event, tabId) {
  const container = event.target.closest('.tab-container');
  container.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  container.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(tabId).classList.add('active');
}

// ============== COLLAPSIBLE ==============
function toggleCollapsible(btn) {
  btn.classList.toggle('open');
  const content = btn.nextElementSibling;
  content.classList.toggle('open');
}

// ============== TDD CYCLE ==============
function showTDDStep(step) {
  const detail = document.getElementById('tddDetail');
  const steps = {
    red: {
      title: '‚ùå RED ‚Äî Write a Failing Test',
      content: `<p>Write a test for functionality that <strong>doesn't exist yet</strong>. Run it ‚Äî it must FAIL (red).</p>
        <ul style="color: var(--text-secondary); margin-top: 8px;">
          <li>Think about WHAT the code should do</li>
          <li>Write the smallest possible test</li>
          <li>Verify it fails for the RIGHT reason</li>
          <li>Don't write any production code yet!</li>
        </ul>`,
      color: 'var(--accent-red)'
    },
    green: {
      title: '‚úÖ GREEN ‚Äî Make It Pass',
      content: `<p>Write the <strong>minimum code</strong> needed to make the test pass. Nothing more.</p>
        <ul style="color: var(--text-secondary); margin-top: 8px;">
          <li>Write the simplest solution possible</li>
          <li>It's OK if the code is ugly</li>
          <li>Don't optimize or generalize yet</li>
          <li>Just make the test go green!</li>
        </ul>`,
      color: 'var(--accent-green)'
    },
    refactor: {
      title: 'üîß REFACTOR ‚Äî Clean Up',
      content: `<p>Now improve the code without changing behavior. Tests are your safety net!</p>
        <ul style="color: var(--text-secondary); margin-top: 8px;">
          <li>Remove duplication</li>
          <li>Improve naming</li>
          <li>Simplify logic</li>
          <li>Run tests after each change ‚Äî they must stay green</li>
        </ul>`,
      color: 'var(--accent-blue)'
    }
  };

  const s = steps[step];
  detail.innerHTML = `<h4 style="color: ${s.color}; margin-top: 0;">${s.title}</h4>${s.content}`;
  detail.style.borderColor = s.color;

  document.querySelectorAll('.tdd-step').forEach(el => el.classList.remove('active-step'));
  document.querySelector(`.tdd-${step}`).classList.add('active-step');
}

// ============== UNIT TEST RUNNER ==============
function runUnitTests() {
  const code = document.getElementById('unitTestCode').value;
  const output = document.getElementById('unitTestOutput');
  output.innerHTML = '';

  try {
    // Extract the function
    const fnMatch = code.match(/function\s+(\w+)\s*\(([^)]*)\)\s*\{([^}]*)\}/);
    if (!fnMatch) {
      output.innerHTML = '<div class="test-result fail">‚ùå Could not find a function definition</div>';
      return;
    }

    const fnName = fnMatch[1];
    const fn = new Function(fnMatch[2], fnMatch[3].includes('return') ? fnMatch[3] : `return ${fnMatch[3]}`);

    // Run predefined tests for multiply
    const tests = [
      { name: `${fnName}(2, 3) === 6`, fn: () => fn(2, 3), expected: 6 },
      { name: `${fnName}(0, 5) === 0`, fn: () => fn(0, 5), expected: 0 },
      { name: `${fnName}(-2, 3) === -6`, fn: () => fn(-2, 3), expected: -6 },
      { name: `${fnName}(0.1, 0.2) ‚âà 0.02`, fn: () => Math.abs(fn(0.1, 0.2) - 0.02) < 0.001, expected: true },
    ];

    let passed = 0;
    let failed = 0;
    const startTime = performance.now();

    tests.forEach((test, i) => {
      setTimeout(() => {
        try {
          const result = test.fn();
          const success = test.expected === true ? result === true : result === test.expected;
          if (success) {
            passed++;
            output.innerHTML += `<div class="test-result pass" style="animation-delay: ${i * 0.1}s">‚úÖ PASS: ${test.name}</div>`;
          } else {
            failed++;
            output.innerHTML += `<div class="test-result fail" style="animation-delay: ${i * 0.1}s">‚ùå FAIL: ${test.name} ‚Äî Got: ${result}</div>`;
          }
        } catch (e) {
          failed++;
          output.innerHTML += `<div class="test-result fail">‚ùå ERROR: ${test.name} ‚Äî ${e.message}</div>`;
        }

        if (i === tests.length - 1) {
          const elapsed = (performance.now() - startTime).toFixed(0);
          output.innerHTML += `<div class="test-summary">
            <span class="summary-pass">‚úÖ ${passed} passed</span>
            <span class="summary-fail">${failed > 0 ? `‚ùå ${failed} failed` : ''}</span>
            <span class="summary-time">‚è± ${elapsed}ms</span>
          </div>`;
        }
      }, i * 200);
    });
  } catch (e) {
    output.innerHTML = `<div class="test-result fail">‚ùå Error: ${e.message}</div>`;
  }
}

// ============== MATCHER QUIZ ==============
function checkMatcherQuiz() {
  const answers = {
    matcherQ1: 'toBeCloseTo',
    matcherQ2: 'toEqual',
    matcherQ3: 'toThrow',
  };

  const output = document.getElementById('matcherQuizOutput');
  output.innerHTML = '';

  let correct = 0;

  const explanations = {
    matcherQ1: 'Floating point math is imprecise (0.1 + 0.2 = 0.30000000000000004). Use toBeCloseTo() for decimal comparisons!',
    matcherQ2: 'toBe() checks reference equality (===). Two separate objects are never ===. Use toEqual() for deep comparison.',
    matcherQ3: 'toThrow() tests if a function throws. Remember to wrap the call in () => fn(), not fn() directly!',
  };

  Object.keys(answers).forEach((q, i) => {
    const selected = document.getElementById(q).value;
    const isCorrect = selected === answers[q];
    if (isCorrect) correct++;

    setTimeout(() => {
      output.innerHTML += `<div class="test-result ${isCorrect ? 'pass' : 'fail'}">
        ${isCorrect ? '‚úÖ' : '‚ùå'} Q${i + 1}: ${isCorrect ? 'Correct!' : `Wrong ‚Äî Answer: .${answers[q]}()`}
        <br><span style="color: var(--text-dim); font-size: 0.78rem; margin-left: 28px;">${explanations[q]}</span>
      </div>`;
    }, i * 300);
  });

  setTimeout(() => {
    output.innerHTML += `<div class="test-summary">
      <span class="summary-pass">‚úÖ ${correct}/3 correct</span>
    </div>`;
  }, 1000);
}

// ============== MOCK DEMO ==============
function runMockDemo() {
  const output = document.getElementById('mockDemoOutput');
  output.innerHTML = '';

  const lines = [
    { text: 'üì¶ Creating mock function: jest.fn()', class: 'info', delay: 0 },
    { text: '‚öôÔ∏è Configuring return values...', class: 'info', delay: 300 },
    { text: '', class: '', delay: 500 },
    { text: 'üìû Call 1: mockGreet("Alice")', class: 'info', delay: 600 },
    { text: '   ‚Üí Returns: "Hello, Alice!"', class: 'pass', delay: 800 },
    { text: 'üìû Call 2: mockGreet("Bob")', class: 'info', delay: 1000 },
    { text: '   ‚Üí Returns: "Hello, Bob!"', class: 'pass', delay: 1200 },
    { text: 'üìû Call 3: mockGreet("Charlie")', class: 'info', delay: 1400 },
    { text: '   ‚Üí Returns: "Hello, stranger!" (default)', class: 'pass', delay: 1600 },
    { text: '', class: '', delay: 1800 },
    { text: 'üîç Mock Inspection:', class: 'info', delay: 2000 },
    { text: '   mock.calls.length = 3', class: 'pass', delay: 2200 },
    { text: '   mock.calls[0] = ["Alice"]', class: 'pass', delay: 2400 },
    { text: '   mock.calls[1] = ["Bob"]', class: 'pass', delay: 2600 },
    { text: '   mock.calls[2] = ["Charlie"]', class: 'pass', delay: 2800 },
    { text: '', class: '', delay: 3000 },
    { text: '‚úÖ Mock tracks: call count, arguments, return values, and call order!', class: 'pass', delay: 3200 },
  ];

  lines.forEach(line => {
    setTimeout(() => {
      if (line.text === '') {
        output.innerHTML += '<br>';
      } else {
        output.innerHTML += `<div class="test-result ${line.class}">${line.text}</div>`;
      }
      output.scrollTop = output.scrollHeight;
    }, line.delay);
  });
}

// ============== COVERAGE DEMO ==============
function runCoverageDemo() {
  const output = document.getElementById('coverageOutput');
  output.innerHTML = '';

  const lines = [
    { text: 'üìä Analyzing test coverage...', class: 'info' },
    { text: '', class: '' },
    { text: 'Test 1: calculateGrade(95) ‚Üí "A"', class: 'pass' },
    { text: '  ‚úÖ Covers: line 1-3 (score >= 90 branch)', class: 'pass' },
    { text: 'Test 2: calculateGrade(85) ‚Üí "B"', class: 'pass' },
    { text: '  ‚úÖ Covers: line 4-5 (score >= 80 branch)', class: 'pass' },
    { text: 'Test 3: calculateGrade(45) ‚Üí "F"', class: 'pass' },
    { text: '  ‚úÖ Covers: line 10-11 (else branch)', class: 'pass' },
    { text: '', class: '' },
    { text: '‚ö†Ô∏è UNCOVERED branches:', class: 'fail' },
    { text: '  ‚ùå Line 7: score >= 70 (C grade) ‚Äî NOT TESTED', class: 'fail' },
    { text: '  ‚ùå Line 9: score >= 60 (D grade) ‚Äî NOT TESTED', class: 'fail' },
  ];

  lines.forEach((line, i) => {
    setTimeout(() => {
      if (line.text === '') {
        output.innerHTML += '<br>';
      } else {
        output.innerHTML += `<div class="test-result ${line.class}">${line.text}</div>`;
      }
    }, i * 200);
  });

  // Animate coverage bars
  setTimeout(() => {
    animateCoverage('covStmt', 'covStmtBar', 75, 'coverage-med');
    animateCoverage('covBranch', 'covBranchBar', 60, 'coverage-low');
    animateCoverage('covFunc', 'covFuncBar', 100, 'coverage-high');
    animateCoverage('covLines', 'covLinesBar', 73, 'coverage-med');
  }, 2500);
}

function animateCoverage(labelId, barId, value, colorClass) {
  const label = document.getElementById(labelId);
  const bar = document.getElementById(barId);
  bar.className = `coverage-fill ${colorClass}`;
  bar.style.width = value + '%';
  label.textContent = value + '%';
}

// ============== EXERCISES ==============
function checkExercise(num) {
  const code = document.getElementById(`exercise${num}`).value;
  const resultEl = document.getElementById(`exercise${num}Result`);
  resultEl.classList.add('show');

  const checks = {
    1: [
      { text: 'Has describe block', check: /describe\s*\(/.test(code) },
      { text: 'Has test/it for normal case', check: /test|it/.test(code) },
      { text: 'Tests empty string', check: /['"]\s*['"]|empty/i.test(code) },
      { text: 'Uses expect()', check: /expect\s*\(/.test(code) },
      { text: 'Uses toBe or toEqual', check: /toBe|toEqual/.test(code) },
      { text: 'At least 3 test cases', check: (code.match(/test\s*\(|it\s*\(/g) || []).length >= 3 },
    ],
    2: [
      { text: 'Has describe block', check: /describe\s*\(/.test(code) },
      { text: 'Tests normal filtering', check: /filter|adult|people/i.test(code) },
      { text: 'Tests empty array', check: /\[\s*\]|empty/i.test(code) },
      { text: 'Tests error for non-array', check: /toThrow|TypeError|error/i.test(code) },
      { text: 'Tests edge case (age 18)', check: /18|edge|exactly/i.test(code) },
      { text: 'At least 4 test cases', check: (code.match(/test\s*\(|it\s*\(/g) || []).length >= 4 },
    ],
    3: [
      { text: 'Creates mock apiClient', check: /mock|jest\.fn|Mock/i.test(code) },
      { text: 'Uses async/await', check: /async|await/.test(code) },
      { text: 'Tests success case', check: /success|resolve/i.test(code) },
      { text: 'Tests validation error', check: /throw|reject|error/i.test(code) },
      { text: 'Verifies mock was called', check: /toHaveBeenCalled|mock\.calls/i.test(code) },
      { text: 'At least 3 test cases', check: (code.match(/test\s*\(|it\s*\(/g) || []).length >= 3 },
    ]
  };

  const results = checks[num];
  let passed = 0;
  let html = '';

  results.forEach(r => {
    if (r.check) passed++;
    html += `<div style="padding: 4px 0; color: ${r.check ? 'var(--pass)' : 'var(--fail)'}">
      ${r.check ? '‚úÖ' : '‚ùå'} ${r.text}
    </div>`;
  });

  const pct = Math.round((passed / results.length) * 100);
  const color = pct >= 80 ? 'var(--pass)' : pct >= 50 ? 'var(--accent-orange)' : 'var(--fail)';

  resultEl.style.background = pct >= 80 ? 'rgba(34,197,94,0.08)' : 'rgba(239,68,68,0.08)';
  resultEl.style.border = `1px solid ${color}`;
  resultEl.innerHTML = `<div style="font-weight: 700; color: ${color}; margin-bottom: 8px;">Score: ${passed}/${results.length} (${pct}%)</div>${html}`;
}

function showHint(num) {
  const hints = {
    1: "Think about: what happens with 'hello'? What about ''? What about 'Hello' (already capitalized)? What about null/undefined?",
    2: "Remember to test: empty array returns [], mixed ages filter correctly, toThrow() needs arrow function wrapper, age === 18 should be included.",
    3: "Create apiClient with: { post: jest.fn() }. Use mockResolvedValue for the success case. Test that validation throws BEFORE the API call."
  };

  const resultEl = document.getElementById(`exercise${num}Result`);
  resultEl.classList.add('show');
  resultEl.style.background = 'rgba(59,130,246,0.08)';
  resultEl.style.border = '1px solid rgba(59,130,246,0.3)';
  resultEl.innerHTML = `<div style="color: var(--accent-blue);">üí° <strong>Hint:</strong> ${hints[num]}</div>`;
}

function showSolution(num) {
  const solutions = {
    1: `describe('capitalize', () => {
  test('capitalizes first letter of lowercase word', () => {
    expect(capitalize('hello')).toBe('Hello');
  });

  test('returns empty string for empty input', () => {
    expect(capitalize('')).toBe('');
  });

  test('returns empty string for falsy input', () => {
    expect(capitalize(null)).toBe('');
    expect(capitalize(undefined)).toBe('');
  });

  test('keeps already capitalized strings', () => {
    expect(capitalize('Hello')).toBe('Hello');
  });

  test('handles single character', () => {
    expect(capitalize('a')).toBe('A');
  });
});`,
    2: `describe('filterAdults', () => {
  test('returns adults (age >= 18)', () => {
    const people = [
      { name: 'Alice', age: 25 },
      { name: 'Bob', age: 15 },
      { name: 'Charlie', age: 30 }
    ];
    const result = filterAdults(people);
    expect(result).toEqual([
      { name: 'Alice', age: 25 },
      { name: 'Charlie', age: 30 }
    ]);
  });

  test('returns empty array when no adults', () => {
    const kids = [{ name: 'Kid', age: 10 }];
    expect(filterAdults(kids)).toEqual([]);
  });

  test('returns empty array for empty input', () => {
    expect(filterAdults([])).toEqual([]);
  });

  test('throws TypeError for non-array input', () => {
    expect(() => filterAdults('not array')).toThrow(TypeError);
    expect(() => filterAdults(null)).toThrow(TypeError);
  });

  test('includes people who are exactly 18', () => {
    const people = [{ name: 'Teen', age: 18 }];
    expect(filterAdults(people)).toHaveLength(1);
  });
});`,
    3: `describe('sendNotification', () => {
  let mockApiClient;

  beforeEach(() => {
    mockApiClient = {
      post: jest.fn().mockResolvedValue({ id: 'notif-123' })
    };
  });

  test('sends notification successfully', async () => {
    const result = await sendNotification('user1', 'Hello!', mockApiClient);

    expect(result).toEqual({ success: true, id: 'notif-123' });
    expect(mockApiClient.post).toHaveBeenCalledWith(
      '/notifications',
      expect.objectContaining({
        userId: 'user1',
        message: 'Hello!'
      })
    );
  });

  test('throws when userId is missing', async () => {
    await expect(
      sendNotification(null, 'Hello!', mockApiClient)
    ).rejects.toThrow('userId and message required');
  });

  test('throws when message is missing', async () => {
    await expect(
      sendNotification('user1', '', mockApiClient)
    ).rejects.toThrow('userId and message required');
  });

  test('does not call API when validation fails', async () => {
    try {
      await sendNotification(null, 'Hi', mockApiClient);
    } catch (e) {}
    expect(mockApiClient.post).not.toHaveBeenCalled();
  });
});`
  };

  const resultEl = document.getElementById(`exercise${num}Result`);
  resultEl.classList.add('show');
  resultEl.style.background = 'rgba(34,197,94,0.05)';
  resultEl.style.border = '1px solid rgba(34,197,94,0.2)';
  resultEl.innerHTML = `<div style="color: var(--accent-green); margin-bottom: 8px; font-weight: 700;">üëÅÔ∏è Solution:</div><pre style="color: var(--text-secondary); font-size: 0.82rem; white-space: pre-wrap; font-family: 'Fira Code', monospace; line-height: 1.7;">${solutions[num]}</pre>`;
}

// ============== QUIZ ==============
const quizQuestions = [
  {
    q: "What does the 'AAA' pattern stand for in unit testing?",
    opts: ["Arrange, Act, Assert", "Assign, Apply, Analyze", "Add, Adjust, Approve", "Arrange, Apply, Assert"],
    correct: 0,
    explanation: "Arrange (setup data), Act (execute code), Assert (verify result) ‚Äî the universal structure for unit tests."
  },
  {
    q: "What matcher should you use for floating-point comparisons?",
    opts: [".toBe()", ".toEqual()", ".toBeCloseTo()", ".toMatch()"],
    correct: 2,
    explanation: "Due to floating-point precision (0.1 + 0.2 ‚â† 0.3), use toBeCloseTo() which allows a small delta."
  },
  {
    q: "What is the correct way to test if a function throws?",
    opts: [
      "expect(fn()).toThrow()",
      "expect(() => fn()).toThrow()",
      "expect(fn).toThrow()",
      "Both B and C are correct"
    ],
    correct: 3,
    explanation: "You can pass the function reference (fn) OR wrap in arrow function (() => fn()). Never call the function directly ‚Äî it throws before expect() can catch it!"
  },
  {
    q: "In TDD, what's the first step?",
    opts: ["Write production code", "Write a failing test", "Set up the project", "Write documentation"],
    correct: 1,
    explanation: "TDD starts with RED ‚Äî writing a failing test before any production code exists."
  },
  {
    q: "What does jest.fn() create?",
    opts: ["A test suite", "A mock function", "A snapshot", "A spy on an existing function"],
    correct: 1,
    explanation: "jest.fn() creates a new mock function that tracks calls, arguments, and return values."
  },
  {
    q: "What's wrong with this test?\n\ntest('fetches data', () => {\n  fetchData().then(d => {\n    expect(d).toBe('hi');\n  });\n});",
    opts: [
      "Missing describe block",
      "Promise not returned ‚Äî assertion may never run",
      "Wrong matcher used",
      "fetchData should be mocked"
    ],
    correct: 1,
    explanation: "Without returning the promise or using async/await, Jest won't wait for the .then() to execute. The test passes vacuously!"
  },
  {
    q: "Which lifecycle hook runs before EACH test in a describe block?",
    opts: ["beforeAll", "beforeEach", "afterAll", "setUp"],
    correct: 1,
    explanation: "beforeEach runs before every single test in its scope. beforeAll runs only once for the entire describe."
  },
  {
    q: "What's the ideal coverage percentage for most projects?",
    opts: ["100%", "50%", "~80%", "95%"],
    correct: 2,
    explanation: "80% is the sweet spot. Below that, you likely have gaps. Above 95%, you're probably testing trivial code."
  },
  {
    q: "What does jest.spyOn() do differently from jest.fn()?",
    opts: [
      "It runs tests faster",
      "It watches an existing method on an object",
      "It creates a new function",
      "It mocks entire modules"
    ],
    correct: 1,
    explanation: "spyOn watches a method that already exists on an object, tracking calls while optionally keeping the original implementation."
  },
  {
    q: "What is 'branch coverage'?",
    opts: [
      "% of Git branches tested",
      "% of if/else paths executed",
      "% of functions called",
      "% of files imported"
    ],
    correct: 1,
    explanation: "Branch coverage measures if both sides of conditionals (if/else, ternary, switch) have been tested."
  },
  {
    q: "What's the difference between .toBe() and .toEqual()?",
    opts: [
      "No difference",
      "toBe uses ===, toEqual does deep comparison",
      "toEqual is faster",
      "toBe works with objects, toEqual with primitives"
    ],
    correct: 1,
    explanation: "toBe uses Object.is() (similar to ===) ‚Äî checks reference equality. toEqual recursively checks every property ‚Äî use for objects/arrays."
  },
  {
    q: "Why should you mock external API calls in unit tests?",
    opts: [
      "To make tests slower",
      "They're fast, isolated, and deterministic when mocked",
      "Jest requires it",
      "It's optional and not recommended"
    ],
    correct: 1,
    explanation: "Real API calls are slow, flaky, and non-deterministic. Mocking gives you speed, reliability, and control over responses."
  },
  {
    q: "What does mockResolvedValue() do?",
    opts: [
      "Makes the mock throw an error",
      "Makes the mock return a resolved Promise",
      "Makes the mock synchronous",
      "Clears the mock's history"
    ],
    correct: 1,
    explanation: "mockResolvedValue(x) is shorthand for mockImplementation(() => Promise.resolve(x)) ‚Äî perfect for mocking async functions."
  },
  {
    q: "Which is NOT a testing best practice?",
    opts: [
      "One concept per test",
      "Descriptive test names",
      "Testing private implementation details",
      "Using beforeEach for shared setup"
    ],
    correct: 2,
    explanation: "Testing private internals makes tests brittle. Test public behavior ‚Äî if internals change but output stays the same, tests should still pass."
  },
  {
    q: "What command generates a Jest coverage report?",
    opts: [
      "jest --report",
      "jest --coverage",
      "jest --analyze",
      "jest --stats"
    ],
    correct: 1,
    explanation: "jest --coverage generates a detailed coverage report showing statements, branches, functions, and lines covered."
  }
];

// Build quiz on load
function buildQuiz() {
  const container = document.getElementById('quizContainer');
  container.innerHTML = '';

  quizQuestions.forEach((q, i) => {
    const optionsHtml = q.opts.map((opt, j) => `
      <div class="quiz-option" data-q="${i}" data-opt="${j}" onclick="selectQuizOption(${i}, ${j})">
        <span class="opt-letter">${String.fromCharCode(65 + j)}</span>
        <span>${opt}</span>
      </div>
    `).join('');

    container.innerHTML += `
      <div class="quiz-question" id="quiz-q-${i}">
        <div class="quiz-q-text">
          <span class="quiz-q-num">${i + 1}</span>
          <span>${q.q}</span>
        </div>
        <div class="quiz-options">${optionsHtml}</div>
        <div class="quiz-explanation" id="quiz-exp-${i}"></div>
      </div>
    `;
  });
}

function selectQuizOption(qIndex, optIndex) {
  // Remove previous selection
  const qEl = document.getElementById(`quiz-q-${qIndex}`);
  qEl.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
  qEl.querySelectorAll('.quiz-option')[optIndex].classList.add('selected');
  quizAnswers[qIndex] = optIndex;
}

function submitQuiz() {
  let score = 0;

  quizQuestions.forEach((q, i) => {
    const qEl = document.getElementById(`quiz-q-${i}`);
    const expEl = document.getElementById(`quiz-exp-${i}`);
    const options = qEl.querySelectorAll('.quiz-option');

    options.forEach(o => {
      o.classList.remove('correct', 'wrong', 'selected');
      o.style.pointerEvents = 'none';
    });

    // Highlight correct
    options[q.correct].classList.add('correct');

    // Highlight user's wrong answer
    const userAnswer = quizAnswers[i];
    if (userAnswer !== undefined && userAnswer !== q.correct) {
      options[userAnswer].classList.add('wrong');
      expEl.className = 'quiz-explanation show wrong-exp';
      expEl.innerHTML = `‚ùå ${q.explanation}`;
    } else if (userAnswer === q.correct) {
      score++;
      expEl.className = 'quiz-explanation show correct-exp';
      expEl.innerHTML = `‚úÖ Correct! ${q.explanation}`;
    } else {
      expEl.className = 'quiz-explanation show wrong-exp';
      expEl.innerHTML = `‚è≠ Skipped ‚Äî ${q.explanation}`;
    }
  });

  // Show result
  const resultEl = document.getElementById('quizResult');
  resultEl.style.display = 'block';

  const scoreCircle = document.getElementById('scoreCircle');
  const pct = Math.round((score / quizQuestions.length) * 100);

  let color, message;
  if (pct >= 90) { color = 'var(--accent-green)'; message = 'üèÜ Outstanding! You\'re interview-ready!'; }
  else if (pct >= 70) { color = 'var(--accent-cyan)'; message = 'üí™ Great job! Review the ones you missed.'; }
  else if (pct >= 50) { color = 'var(--accent-orange)'; message = 'üìö Good start! Re-read the chapters you struggled with.'; }
  else { color = 'var(--accent-red)'; message = 'üîÑ Keep studying! Go through each chapter again.'; }

  scoreCircle.style.borderColor = color;
  scoreCircle.style.color = color;
  document.getElementById('scoreNum').textContent = score;
  document.getElementById('scoreMessage').textContent = message;
  document.getElementById('scoreMessage').style.color = color;
  document.getElementById('scoreDetails').textContent = `${score}/${quizQuestions.length} correct (${pct}%)`;

  resultEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// ============== INIT ==============
document.addEventListener('DOMContentLoaded', () => {
  buildQuiz();
});
</script>
</body>
</html>