<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JestMaster: Interactive Testing Bootcamp</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --jest-red: #C21325;
            --jest-orange: #99425B;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-code: #0d1117;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --success: #22c55e;
            --warning: #eab308;
            --error: #ef4444;
            --accent: #3b82f6;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Layout */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 2rem 1rem;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            width: 280px;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--jest-red);
            margin-bottom: 2rem;
            cursor: pointer;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--jest-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Fira Code', monospace;
            font-weight: 600;
        }

        .progress-container {
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(194, 19, 37, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(194, 19, 37, 0.2);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--jest-red);
            border-radius: 4px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(194, 19, 37, 0.5);
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
            font-size: 0.9375rem;
            border: 1px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--border);
        }

        .nav-item.active {
            background: rgba(194, 19, 37, 0.15);
            border-color: var(--jest-red);
            color: var(--jest-red);
        }

        .nav-item.completed {
            color: var(--success);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            max-width: 900px;
        }

        .header {
            margin-bottom: 2rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(194, 19, 37, 0.2);
            color: var(--jest-red);
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
            border: 1px solid rgba(194, 19, 37, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h2 {
            font-size: 1.75rem;
            margin: 2rem 0 1rem;
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--accent);
        }

        p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-size: 1.0625rem;
            line-height: 1.7;
        }

        /* Interactive Components */
        .interactive-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            position: relative;
            overflow: hidden;
        }

        .interactive-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--jest-red), var(--accent));
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.125rem;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        /* Code Blocks */
        .code-container {
            background: var(--bg-code);
            border-radius: 8px;
            border: 1px solid var(--border);
            margin: 1rem 0;
            overflow: hidden;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid var(--border);
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .code-block {
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
            font-size: 0.9375rem;
            line-height: 1.6;
        }

        .code-block code {
            font-family: 'Fira Code', monospace;
        }

        /* TDD Visualizer */
        .tdd-cycle {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 2rem 0;
            padding: 2rem;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            position: relative;
        }

        .tdd-step {
            text-align: center;
            padding: 1.5rem;
            border-radius: 12px;
            width: 120px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .tdd-step:hover {
            transform: translateY(-5px);
        }

        .tdd-step.red {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid var(--error);
            color: var(--error);
        }

        .tdd-step.green {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid var(--success);
            color: var(--success);
        }

        .tdd-step.refactor {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .tdd-arrow {
            font-size: 2rem;
            color: var(--text-secondary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Quiz Styles */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .quiz-option:hover {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.2);
        }

        .quiz-option.wrong {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.2);
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Exercise Editor */
        .exercise-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .editor-pane {
            background: var(--bg-code);
            border-radius: 8px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .editor-header {
            background: rgba(255,255,255,0.05);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-textarea {
            width: 100%;
            min-height: 300px;
            background: transparent;
            border: none;
            padding: 1rem;
            color: var(--text-primary);
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            resize: vertical;
            line-height: 1.6;
            tab-size: 2;
        }

        .editor-textarea:focus {
            outline: none;
        }

        .output-pane {
            background: #000;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.875rem;
            overflow-y: auto;
            max-height: 300px;
            border: 1px solid var(--border);
        }

        .output-line {
            margin: 0.25rem 0;
            padding: 0.25rem 0;
        }

        .output-pass {
            color: var(--success);
        }

        .output-fail {
            color: var(--error);
        }

        .output-info {
            color: var(--accent);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9375rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--jest-red);
            color: white;
        }

        .btn-primary:hover {
            background: #a31120;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(194, 19, 37, 0.4);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* Visual Diagrams */
        .diagram-container {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .pyramid {
            width: 300px;
            margin: 0 auto;
            position: relative;
        }

        .pyramid-level {
            margin: 0 auto 4px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
            clip-path: polygon(10% 0, 90% 0, 100% 100%, 0% 100%);
        }

        .pyramid-level:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .level-e2e {
            width: 60%;
            height: 60px;
            background: #8b5cf6;
        }

        .level-integration {
            width: 80%;
            height: 60px;
            background: var(--accent);
        }

        .level-unit {
            width: 100%;
            height: 60px;
            background: var(--success);
        }

        /* Mocking Visualizer */
        .mock-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
            flex-wrap: wrap;
        }

        .mock-box {
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            min-width: 150px;
            position: relative;
        }

        .mock-real {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid var(--success);
        }

        .mock-fake {
            background: rgba(234, 179, 8, 0.2);
            border: 2px dashed var(--warning);
            animation: mockPulse 2s infinite;
        }

        @keyframes mockPulse {
            0%, 100% { border-style: dashed; }
            50% { border-style: solid; }
        }

        .mock-arrow {
            font-size: 2rem;
            color: var(--text-secondary);
        }

        /* Pitfall Cards */
        .pitfall-card {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            display: flex;
            gap: 1rem;
            align-items: start;
        }

        .pitfall-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .pitfall-content h4 {
            color: var(--error);
            margin-bottom: 0.5rem;
        }

        .pitfall-content p {
            margin: 0;
            font-size: 0.9375rem;
        }

        .pitfall-fix {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid var(--success);
            border-radius: 0 4px 4px 0;
            font-size: 0.875rem;
        }

        /* Coverage Bar */
        .coverage-container {
            margin: 2rem 0;
        }

        .coverage-item {
            margin-bottom: 1.5rem;
        }

        .coverage-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9375rem;
        }

        .coverage-bar {
            height: 24px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .coverage-fill {
            height: 100%;
            border-radius: 12px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            font-family: 'Fira Code', monospace;
        }

        .coverage-low { background: var(--error); }
        .coverage-med { background: var(--warning); }
        .coverage-high { background: var(--success); }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-card);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            display: none;
            z-index: 1000;
            animation: slideIn 0.5s ease;
            max-width: 350px;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .achievement-title {
            color: var(--success);
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .achievement-desc {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            .main-content {
                margin-left: 0;
            }
            .exercise-container {
                grid-template-columns: 1fr;
            }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dotted var(--accent);
        }

        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.875rem;
            white-space: nowrap;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9375rem;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .comparison-table th {
            background: rgba(255,255,255,0.05);
            font-weight: 600;
            color: var(--text-primary);
        }

        .comparison-table tr:hover {
            background: rgba(255,255,255,0.02);
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .tag-good {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .tag-bad {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .tag-info {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="logo" onclick="app.navigate('welcome')">
                <div class="logo-icon">Jest</div>
                <span>JestMaster</span>
            </div>

            <div class="progress-container">
                <div class="progress-header">
                    <span>Your Progress</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Fundamentals</div>
                <div class="nav-item active" data-module="why-test" onclick="app.navigate('why-test')">
                    <span class="nav-icon">üéØ</span>
                    <span>Why Test?</span>
                </div>
                <div class="nav-item" data-module="unit-basics" onclick="app.navigate('unit-basics')">
                    <span class="nav-icon">üß©</span>
                    <span>Unit Testing</span>
                </div>
                <div class="nav-item" data-module="jest-intro" onclick="app.navigate('jest-intro')">
                    <span class="nav-icon">üÉè</span>
                    <span>Jest Basics</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Advanced</div>
                <div class="nav-item" data-module="tdd" onclick="app.navigate('tdd')">
                    <span class="nav-icon">üî¥</span>
                    <span>TDD Cycle</span>
                </div>
                <div class="nav-item" data-module="mocking" onclick="app.navigate('mocking')">
                    <span class="nav-icon">üé≠</span>
                    <span>Mocking & Spies</span>
                </div>
                <div class="nav-item" data-module="coverage" onclick="app.navigate('coverage')">
                    <span class="nav-icon">üìä</span>
                    <span>Test Coverage</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Mastery</div>
                <div class="nav-item" data-module="best-practices" onclick="app.navigate('best-practices')">
                    <span class="nav-icon">‚≠ê</span>
                    <span>Best Practices</span>
                </div>
                <div class="nav-item" data-module="interview" onclick="app.navigate('interview')">
                    <span class="nav-icon">üíº</span>
                    <span>Interview Prep</span>
                </div>
                <div class="nav-item" data-module="final-challenge" onclick="app.navigate('final-challenge')">
                    <span class="nav-icon">üèÜ</span>
                    <span>Final Challenge</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="content">
            <!-- Content injected via JavaScript -->
        </main>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievement">
        <div class="achievement-title" id="achievement-title">Achievement Unlocked!</div>
        <div class="achievement-desc" id="achievement-desc">You've mastered the basics</div>
    </div>

    <script>
        // Application State
        const state = {
            currentModule: 'why-test',
            completedModules: new Set(),
            progress: 0,
            achievements: new Set()
        };

        // Content Database
        const content = {
            'welcome': {
                title: 'Welcome to JestMaster',
                subtitle: 'Master JavaScript Testing',
                render: () => `
                    <div class="header">
                        <div class="badge">Interactive Learning Path</div>
                        <h1>Become a Testing Ninja ü•∑</h1>
                        <p>Welcome to your journey to testing mastery. This interactive bootcamp will take you from zero to hero in JavaScript testing using Jest. You'll write real tests, fix broken ones, and learn the pitfalls that trip up even senior developers.</p>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üöÄ</span>
                            <span>What You'll Master</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                            <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4 style="color: var(--jest-red); margin-bottom: 0.5rem;">Unit Testing</h4>
                                <p style="font-size: 0.9375rem;">Write isolated, deterministic tests using Arrange-Act-Assert</p>
                            </div>
                            <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4 style="color: var(--success); margin-bottom: 0.5rem;">TDD</h4>
                                <p style="font-size: 0.9375rem;">Red-Green-Refactor cycle and test-first development</p>
                            </div>
                            <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4 style="color: var(--accent); margin-bottom: 0.5rem;">Mocking</h4>
                                <p style="font-size: 0.9375rem;">Master jest.fn(), spies, and dependency injection</p>
                            </div>
                            <div style="padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4 style="color: var(--warning); margin-bottom: 0.5rem;">Best Practices</h4>
                                <p style="font-size: 0.9375rem;">Avoid brittle tests and learn what to test (and what not to)</p>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.navigate('why-test')" style="margin-top: 1rem;">
                        Start Learning ‚Üí
                    </button>
                `
            },

            'why-test': {
                title: 'Why Test?',
                subtitle: 'The Business Case & Developer Sanity',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 1</div>
                        <h1>Why Bother Testing? üéØ</h1>
                    </div>

                    <p>Imagine deploying on Friday at 5 PM with confidence. That's the power of testing. But beyond avoiding disasters, tests serve as documentation, design tools, and safety nets.</p>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üí∞</span>
                            <span>The Cost of Bugs</span>
                        </div>
                        <p style="margin-bottom: 1rem;">The cost to fix a bug increases exponentially the later it's found:</p>
                        
                        <div style="display: flex; align-items: flex-end; gap: 1rem; height: 200px; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px; margin: 1rem 0;">
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="width: 100%; background: var(--success); height: 30px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.875rem; font-weight: 600;">1x</div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Development</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="width: 100%; background: var(--accent); height: 60px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.875rem; font-weight: 600;">5x</div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">QA</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="width: 100%; background: var(--warning); height: 100px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.875rem; font-weight: 600;">10x</div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Staging</span>
                            </div>
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem;">
                                <div style="width: 100%; background: var(--error); height: 180px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.875rem; font-weight: 600;">100x</div>
                                <span style="font-size: 0.875rem; color: var(--text-secondary);">Production</span>
                            </div>
                        </div>
                    </div>

                    <h2>The Testing Pyramid</h2>
                    <p>Not all tests are created equal. The pyramid shows the ideal distribution:</p>

                    <div class="diagram-container">
                        <div class="pyramid">
                            <div class="pyramid-level level-e2e" onclick="app.showPyramidInfo('e2e')">
                                E2E Tests<br>
                                <small>Slow, Expensive</small>
                            </div>
                            <div class="pyramid-level level-integration" onclick="app.showPyramidInfo('integration')">
                                Integration<br>
                                <small>Services + DB</small>
                            </div>
                            <div class="pyramid-level level-unit" onclick="app.showPyramidInfo('unit')">
                                Unit Tests<br>
                                <small>Fast, Isolated</small>
                            </div>
                        </div>
                        <p style="margin-top: 1rem; font-size: 0.9375rem; color: var(--text-secondary);" id="pyramid-info">
                            Click on each level to learn more. Unit tests form the foundation!
                        </p>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üéÆ</span>
                            <span>Quick Quiz</span>
                        </div>
                        <p>Which of these is NOT a benefit of unit testing?</p>
                        <div class="quiz-container" id="quiz-why-test">
                            <button class="quiz-option" onclick="app.checkAnswer(this, false)">
                                Catching bugs before they reach production
                            </button>
                            <button class="quiz-option" onclick="app.checkAnswer(this, false)">
                                Serving as documentation for how code should work
                            </button>
                            <button class="quiz-option" onclick="app.checkAnswer(this, true)">
                                Guaranteeing the application is 100% bug-free
                            </button>
                            <button class="quiz-option" onclick="app.checkAnswer(this, false)">
                                Enabling confident refactoring
                            </button>
                        </div>
                        <div id="quiz-feedback" style="margin-top: 1rem; font-weight: 600;"></div>
                    </div>

                    <div class="pitfall-card">
                        <div class="pitfall-icon">‚ö†Ô∏è</div>
                        <div class="pitfall-content">
                            <h4>The "Test Everything" Trap</h4>
                            <p>Don't test library code (React, Lodash), trivial getters, or implementation details. Focus on behavior and business logic.</p>
                            <div class="pitfall-fix">
                                <strong>Fix:</strong> Test "what" the code does, not "how" it does it. If you refactor internals without changing behavior, tests shouldn't break.
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('why-test', 'unit-basics')">
                        Complete Module ‚Üí
                    </button>
                `
            },

            'unit-basics': {
                title: 'Unit Testing Fundamentals',
                subtitle: 'The Three A\'s: Arrange, Act, Assert',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 2</div>
                        <h1>Unit Testing Anatomy üß©</h1>
                    </div>

                    <p>A unit test verifies the smallest testable part of an application (usually a function or class method) in isolation. The golden rule: <strong>Given X, when Y happens, then expect Z.</strong></p>

                    <h3>The AAA Pattern</h3>
                    <p>Every great test follows this structure:</p>

                    <div class="code-container">
                        <div class="code-header">calculator.test.js</div>
                        <div class="code-block">
<pre><code class="language-javascript">// 1. ARRANGE: Set up the test data and conditions
const calculator = new Calculator();
const inputA = 5;
const inputB = 3;

// 2. ACT: Execute the function being tested
const result = calculator.add(inputA, inputB);

// 3. ASSERT: Verify the result matches expectations
expect(result).toBe(8);</code></pre>
                        </div>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">‚úèÔ∏è</span>
                            <span>Interactive Exercise: Fix the Test</span>
                        </div>
                        <p>This test is broken. It violates the AAA pattern and has a logic error. Find and fix it!</p>
                        
                        <div class="exercise-container">
                            <div class="editor-pane">
                                <div class="editor-header">
                                    <span>broken-test.js</span>
                                    <button class="btn btn-primary" onclick="app.runExercise('aaa-fix')" style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">Run Test</button>
                                </div>
                                <textarea class="editor-textarea" id="aaa-fix-code">function multiply(a, b) {
  return a * b;
}

test('multiplies correctly', () => {
  // Fix this test!
  const result = multiply(2, 3);
  expect(result).toBe(5);
  const a = 2;
  const b = 3;
});</textarea>
                            </div>
                            <div class="output-pane" id="aaa-fix-output">
                                <span class="output-info">Click "Run Test" to see results...</span>
                            </div>
                        </div>
                    </div>

                    <h3>Characteristics of Great Unit Tests</h3>
                    <table class="comparison-table">
                        <tr>
                            <th>Property</th>
                            <th>Good Test</th>
                            <th>Bad Test</th>
                        </tr>
                        <tr>
                            <td>Speed</td>
                            <td><span class="tag tag-good">Fast (&lt;10ms)</span></td>
                            <td><span class="tag tag-bad">Slow (hits API/DB)</span></td>
                        </tr>
                        <tr>
                            <td>Isolation</td>
                            <td><span class="tag tag-good">Independent</span></td>
                            <td><span class="tag tag-bad">Depends on other tests</span></td>
                        </tr>
                        <tr>
                            <td>Deterministic</td>
                            <td><span class="tag tag-good">Same result always</span></td>
                            <td><span class="tag tag-bad">Flaky (timing issues)</span></td>
                        </tr>
                        <tr>
                            <td>Readable</td>
                            <td><span class="tag tag-good">Clear intent</span></td>
                            <td><span class="tag tag-bad">Complex setup</span></td>
                        </tr>
                    </table>

                    <div class="pitfall-card">
                        <div class="pitfall-icon">üö´</div>
                        <div class="pitfall-content">
                            <h4>Testing Multiple Things</h4>
                            <p>One test should verify one concept. If the first assertion fails, you won't know if the subsequent ones pass.</p>
                            <div class="pitfall-fix">
                                <strong>Fix:</strong> Split into separate tests or use multiple expect statements only when testing different aspects of the same state.
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('unit-basics', 'jest-intro')">
                        Next: Jest Basics ‚Üí
                    </button>
                `
            },

            'jest-intro': {
                title: 'Jest Fundamentals',
                subtitle: 'Matchers, Setup, and Teardown',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 3</div>
                        <h1>Jest Essentials üÉè</h1>
                    </div>

                    <p>Jest is the de facto standard testing framework for JavaScript. Developed by Facebook, it's zero-config, fast, and comes with everything you need: test runner, assertions, and mocking.</p>

                    <h3>Basic Structure</h3>
                    <div class="code-container">
                        <div class="code-header">sum.test.js</div>
                        <div class="code-block">
<pre><code class="language-javascript">// Group related tests with describe
describe('sum function', () => {
  
  // Individual test with 'it' or 'test'
  it('should add two positive numbers', () => {
    expect(sum(1, 2)).toBe(3);
  });
  
  test('handles negative numbers', () => {
    expect(sum(-1, -2)).toBe(-3);
  });
  
});</code></pre>
                        </div>
                    </div>

                    <h3>Common Matchers</h3>
                    <p>Jest provides matchers to validate different conditions:</p>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üéØ</span>
                            <span>Matcher Playground</span>
                        </div>
                        <p>Select the correct matcher for each scenario:</p>
                        
                        <div style="margin-top: 1rem;">
                            <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <p style="margin-bottom: 0.5rem;">Checking if an array contains an item:</p>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, false)">toBe()</button>
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, true)">toContain()</button>
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, false)">toEqual()</button>
                                </div>
                            </div>

                            <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <p style="margin-bottom: 0.5rem;">Checking if a function throws an error:</p>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, true)">toThrow()</button>
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, false)">toBeError()</button>
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, false)">toReject()</button>
                                </div>
                            </div>

                            <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <p style="margin-bottom: 0.5rem;">Checking object equality (deep comparison):</p>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, false)">toBe()</button>
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, true)">toEqual()</button>
                                    <button class="btn btn-secondary" onclick="app.selectMatcher(this, false)">toMatch()</button>
                                </div>
                            </div>
                        </div>
                        <div id="matcher-feedback"></div>
                    </div>

                    <h3>Setup and Teardown</h3>
                    <p>Avoid repetition with lifecycle hooks:</p>

                    <div class="code-container">
                        <div class="code-block">
<pre><code class="language-javascript">describe('Database', () => {
  let connection;
  
  // Run before each test
  beforeEach(() => {
    connection = new DatabaseConnection();
  });
  
  // Run after each test (cleanup!)
  afterEach(() => {
    connection.close();
  });
  
  // Run once before all tests (setup expensive resources)
  beforeAll(async () => {
    await setupTestDB();
  });
  
  test('queries data', () => {
    const data = connection.query('SELECT * FROM users');
    expect(data).toBeDefined();
  });
});</code></pre>
                        </div>
                    </div>

                    <div class="pitfall-card">
                        <div class="pitfall-icon">üí•</div>
                        <div class="pitfall-content">
                            <h4>The toBe vs toEqual Trap</h4>
                            <p><code>toBe</code> uses strict equality (===). For objects, this checks reference, not content!</p>
                            <div class="code-container" style="margin-top: 0.5rem;">
                                <div class="code-block">
<pre><code>expect({a: 1}).toBe({a: 1});    // FAILS (different objects)
expect({a: 1}).toEqual({a: 1});  // PASSES (deep equality)</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('jest-intro', 'tdd')">
                        Next: TDD Cycle ‚Üí
                    </button>
                `
            },

            'tdd': {
                title: 'Test-Driven Development',
                subtitle: 'Red, Green, Refactor',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 4</div>
                        <h1>The TDD Cycle üî¥üü¢üîµ</h1>
                    </div>

                    <p>TDD isn't just about testing‚Äîit's about design. By writing tests first, you:</p>
                    <ul style="color: var(--text-secondary); margin-left: 1.5rem; margin-bottom: 1.5rem;">
                        <li>Clarify requirements before coding</li>
                        <li>Ensure testable code (good architecture)</li>
                        <li>Get immediate feedback</li>
                        <li>Build confidence in your solution</li>
                    </ul>

                    <div class="tdd-cycle">
                        <div class="tdd-step red" onclick="app.highlightTDD('red')">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üî¥</div>
                            <div style="font-weight: 700;">RED</div>
                            <div style="font-size: 0.875rem; margin-top: 0.5rem;">Write a failing test</div>
                        </div>
                        <div class="tdd-arrow">‚Üí</div>
                        <div class="tdd-step green" onclick="app.highlightTDD('green')">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üü¢</div>
                            <div style="font-weight: 700;">GREEN</div>
                            <div style="font-size: 0.875rem; margin-top: 0.5rem;">Write minimal code to pass</div>
                        </div>
                        <div class="tdd-arrow">‚Üí</div>
                        <div class="tdd-step refactor" onclick="app.highlightTDD('refactor')">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üîµ</div>
                            <div style="font-weight: 700;">REFACTOR</div>
                            <div style="font-size: 0.875rem; margin-top: 0.5rem;">Clean up with confidence</div>
                        </div>
                    </div>

                    <div id="tdd-explanation" style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; margin: 1rem 0; border-left: 4px solid var(--jest-red);">
                        <strong style="color: var(--error);">RED Phase:</strong> Write a test that fails. This proves the test is actually testing something (not accidentally passing). The error message should guide your implementation.
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üèãÔ∏è</span>
                            <span>TDD Workshop: FizzBuzz</span>
                        </div>
                        <p>Let's build FizzBuzz using strict TDD. Follow the steps below:</p>

                        <div style="margin-top: 1.5rem;">
                            <div style="display: flex; gap: 1rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">
                                <button class="btn btn-secondary" id="step-1-btn" onclick="app.showTDDStep(1)" style="flex: 1;">Step 1: Red</button>
                                <button class="btn btn-secondary" id="step-2-btn" onclick="app.showTDDStep(2)" style="flex: 1; opacity: 0.5;" disabled>Step 2: Green</button>
                                <button class="btn btn-secondary" id="step-3-btn" onclick="app.showTDDStep(3)" style="flex: 1; opacity: 0.5;" disabled>Step 3: Refactor</button>
                            </div>

                            <div id="tdd-step-content">
                                <h4>Step 1: Write the Failing Test</h4>
                                <p>We want a function that returns "Fizz" for multiples of 3. First, write the test:</p>
                                <div class="code-container">
                                    <div class="code-block">
<pre><code>// fizzbuzz.test.js
const fizzBuzz = require('./fizzbuzz');

test('returns Fizz for 3', () => {
  expect(fizzBuzz(3)).toBe('Fizz');
});</code></pre>
                                    </div>
                                </div>
                                <p style="color: var(--error); margin-top: 1rem;">‚úì This should fail with "fizzBuzz is not defined"</p>
                                <button class="btn btn-primary" onclick="app.advanceTDDStep(2)">I wrote the failing test ‚Üí</button>
                            </div>
                        </div>
                    </div>

                    <div class="pitfall-card">
                        <div class="pitfall-icon">üê¢</div>
                        <div class="pitfall-content">
                            <h4>Writing Too Much Code in Green Phase</h4>
                            <p>The goal is just to make the test pass. Don't add extra logic for future tests. If the test expects return "Fizz", just return "Fizz" (hardcode it), then refactor when you have more tests.</p>
                            <div class="pitfall-fix">
                                <strong>Remember:</strong> Fake it till you make it. Hardcode, then generalize.
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('tdd', 'mocking')">
                        Next: Mocking ‚Üí
                    </button>
                `
            },

            'mocking': {
                title: 'Mocking & Spies',
                subtitle: 'Isolating Your Units',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 5</div>
                        <h1>Mastering Mocks üé≠</h1>
                    </div>

                    <p>True unit tests isolate the unit under test. If your function calls a database or API, you don't want the test to actually hit those‚Äîyou want to <strong>mock</strong> them.</p>

                    <div class="mock-diagram">
                        <div class="mock-box mock-real">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üì¶</div>
                            <div><strong>Your Code</strong></div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">Unit under test</div>
                        </div>
                        <div class="mock-arrow">‚Üí</div>
                        <div class="mock-box mock-fake">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üé≠</div>
                            <div><strong>Mock</strong></div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">Simulated dependency</div>
                        </div>
                        <div class="mock-arrow">‚Üí</div>
                        <div class="mock-box mock-real" style="opacity: 0.3;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üóÑÔ∏è</div>
                            <div><strong>Real DB</strong></div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">Not called!</div>
                        </div>
                    </div>

                    <h3>jest.fn() - The Spy</h3>
                    <p>Create mock functions to capture calls and return values:</p>

                    <div class="code-container">
                        <div class="code-block">
<pre><code class="language-javascript">// Create a mock function
const mockFn = jest.fn();

// Configure return value
mockFn.mockReturnValue('fake data');

// Use it
const result = mockFn(); // 'fake data'

// Assert it was called
expect(mockFn).toHaveBeenCalled();
expect(mockFn).toHaveBeenCalledTimes(1);
expect(mockFn).toHaveBeenCalledWith(); // specific args</code></pre>
                        </div>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üïµÔ∏è</span>
                            <span>Spy Mission: Verify Behavior</span>
                        </div>
                        <p>Test that <code>sendEmail</code> is called when user registers, without actually sending emails:</p>

                        <div class="exercise-container">
                            <div class="editor-pane">
                                <div class="editor-header">exercise.test.js</div>
                                <textarea class="editor-textarea" id="mock-exercise">// Mission: Test that emailService.send is called
// when userService.register succeeds

const emailService = {
  send: jest.fn()
};

const userService = {
  register: (email) => {
    // ... logic ...
    emailService.send(email, 'Welcome!');
    return { id: 1, email };
  }
};

test('sends welcome email on registration', () => {
  // Write your assertions here!
  
  userService.register('test@example.com');
  
  // Hint: Check if emailService.send was called with correct args
  expect(__________).toHaveBeenCalledWith('test@example.com', 'Welcome!');
});</textarea>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div class="editor-pane" style="flex: 1;">
                                    <div class="editor-header">Instructions</div>
                                    <div style="padding: 1rem; color: var(--text-secondary); font-size: 0.9375rem;">
                                        <p style="margin-bottom: 0.5rem;">Fill in the blank:</p>
                                        <code style="color: var(--accent);">expect(__________)</code>
                                        <p style="margin-top: 0.5rem;">What goes in the blank to check the mock was called correctly?</p>
                                        <br>
                                        <button class="btn btn-primary" onclick="app.checkMockAnswer()">Verify Answer</button>
                                    </div>
                                </div>
                                <div id="mock-feedback" style="padding: 1rem; border-radius: 8px; display: none;"></div>
                            </div>
                        </div>
                    </div>

                    <h3>Mocking Modules</h3>
                    <p>Mock entire modules with <code>jest.mock</code>:</p>

                    <div class="code-container">
                        <div class="code-header">api.test.js</div>
                        <div class="code-block">
<pre><code class="language-javascript">import axios from 'axios';
import { fetchUser } from './api';

// Mock the entire axios module
jest.mock('axios');

test('fetches user data', async () => {
  // Setup mock response
  axios.get.mockResolvedValue({ 
    data: { name: 'John', id: 1 } 
  });
  
  const user = await fetchUser(1);
  
  expect(user.name).toBe('John');
  expect(axios.get).toHaveBeenCalledWith('/users/1');
});</code></pre>
                        </div>
                    </div>

                    <div class="pitfall-card">
                        <div class="pitfall-icon">üö®</div>
                        <div class="pitfall-content">
                            <h4>Mocking What You Don't Own</h4>
                            <p>Don't mock low-level browser APIs or language features. Mock at the boundary of your application (HTTP requests, file system).</p>
                            <div class="pitfall-fix">
                                <strong>Rule:</strong> Don't mock fetch/axios in every test. Create an abstraction layer (apiClient) and mock that instead.
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('mocking', 'coverage')">
                        Next: Coverage ‚Üí
                    </button>
                `
            },

            'coverage': {
                title: 'Test Coverage',
                subtitle: 'Metrics That Matter (And Don\'t)',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 6</div>
                        <h1>Understanding Coverage üìä</h1>
                    </div>

                    <p>Coverage measures how much of your code is executed by tests. It's a useful metric, but <strong>100% coverage doesn't mean 100% correct</strong>.</p>

                    <h3>Coverage Metrics Explained</h3>
                    
                    <div class="coverage-container">
                        <div class="coverage-item">
                            <div class="coverage-header">
                                <span>Statement Coverage</span>
                                <span>Which lines executed?</span>
                            </div>
                            <div class="coverage-bar">
                                <div class="coverage-fill coverage-high" style="width: 85%">85%</div>
                            </div>
                        </div>

                        <div class="coverage-item">
                            <div class="coverage-header">
                                <span>Branch Coverage</span>
                                <span>Did we test if/else paths?</span>
                            </div>
                            <div class="coverage-bar">
                                <div class="coverage-fill coverage-med" style="width: 60%">60% ‚ö†Ô∏è</div>
                            </div>
                        </div>

                        <div class="coverage-item">
                            <div class="coverage-header">
                                <span>Function Coverage</span>
                                <span>Which functions called?</span>
                            </div>
                            <div class="coverage-bar">
                                <div class="coverage-fill coverage-high" style="width: 92%">92%</div>
                            </div>
                        </div>

                        <div class="coverage-item">
                            <div class="coverage-header">
                                <span>Line Coverage</span>
                                <span>Overall line execution</span>
                            </div>
                            <div class="coverage-bar">
                                <div class="coverage-fill coverage-low" style="width: 45%">45% üö®</div>
                            </div>
                        </div>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üé™</span>
                            <span>The Coverage Illusion</span>
                        </div>
                        <p>Look at this code with 100% line coverage but a hidden bug:</p>

                        <div class="code-container">
                            <div class="code-header">calculator.js (100% covered but buggy)</div>
                            <div class="code-block">
<pre><code class="language-javascript">function calculate(a, b, operation) {
  if (operation === 'add') {
    return a + b;
  }
  if (operation === 'subtract') {
    return a - b;
  }
  // Missing: what if operation is 'multiply'?
  // No error thrown, just returns undefined!
}</code></pre>
                            </div>
                        </div>

                        <div style="margin-top: 1rem; padding: 1rem; background: rgba(234, 179, 8, 0.1); border-left: 4px solid var(--warning); border-radius: 0 8px 8px 0;">
                            <strong>Test:</strong> We tested 'add' and 'subtract'. All lines executed. But we didn't test the implicit <code>else</code> case (invalid operation).
                        </div>
                    </div>

                    <h3>Setting Coverage Thresholds</h3>
                    <p>In jest.config.js:</p>
                    <div class="code-container">
                        <div class="code-block">
<pre><code class="language-javascript">module.exports = {
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};</code></pre>
                        </div>
                    </div>

                    <div class="pitfall-card">
                        <div class="pitfall-icon">üìâ</div>
                        <div class="pitfall-content">
                            <h4>Gaming the Metric</h4>
                            <p>Developers writing tests just to hit coverage numbers, not to catch bugs. This creates brittle, useless tests.</p>
                            <div class="pitfall-fix">
                                <strong>Fix:</strong> Coverage is a guardrail, not a goal. Focus on behavior coverage (use cases), not line coverage.
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('coverage', 'best-practices')">
                        Next: Best Practices ‚Üí
                    </button>
                `
            },

            'best-practices': {
                title: 'Testing Best Practices',
                subtitle: 'Write Tests That Last',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 7</div>
                        <h1>The Testing Commandments ‚≠ê</h1>
                    </div>

                    <div class="interactive-card" style="border-color: var(--success);">
                        <div class="card-header">
                            <span class="card-icon">üìú</span>
                            <span>The DAMP Principle</span>
                        </div>
                        <p><strong>D</strong>escriptive <strong>A</strong>nd <strong>M</strong>eaningful <strong>P</strong>hrases. Tests should be readable above all else. Prefer duplication over clever abstractions in tests.</p>
                        
                        <div style="margin-top: 1rem; display: grid; gap: 1rem; grid-template-columns: 1fr 1fr;">
                            <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                                <div style="font-size: 0.875rem; color: var(--error); margin-bottom: 0.5rem;">‚ùå DRY (Bad for tests)</div>
                                <code style="font-size: 0.8rem; color: var(--text-secondary);">
                                    const setup = () => { /* complex generic setup */ }<br>
                                    test('A', () => setup('A'))<br>
                                    test('B', () => setup('B'))
                                </code>
                            </div>
                            <div style="padding: 1rem; background: rgba(34, 197, 94, 0.1); border-radius: 8px;">
                                <div style="font-size: 0.875rem; color: var(--success); margin-bottom: 0.5rem;">‚úÖ DAMP (Good)</div>
                                <code style="font-size: 0.8rem; color: var(--text-secondary);">
                                    test('A', () => {<br>
                                    &nbsp;&nbsp;const user = createAdminUser();<br>
                                    &nbsp;&nbsp;// test A...<br>
                                    })
                                </code>
                            </div>
                        </div>
                    </div>

                    <h3>The Test Name Formula</h3>
                    <p>A good test name describes:</p>
                    <div style="background: var(--bg-card); padding: 1.5rem; border-radius: 8px; margin: 1rem 0; font-family: 'Fira Code', monospace; text-align: center;">
                        <span style="color: var(--accent);">it('should [expected behavior] when [condition]', ...)</span>
                    </div>

                    <div class="code-container">
                        <div class="code-header">good-names.test.js</div>
                        <div class="code-block">
<pre><code class="language-javascript">// ‚ùå Bad: Vague
it('works', () => {...});
it('handles edge cases', () => {...});

// ‚úÖ Good: Specific and descriptive
it('should return discounted price when user is VIP', () => {...});
it('should throw ValidationError when email is missing', () => {...});</code></pre>
                        </div>
                    </div>

                    <h3>Don't Test Implementation Details</h3>
                    <p>Test behavior, not internals. If you rename a private method, tests shouldn't break.</p>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üéØ</span>
                            <span>Spot the Bad Test</span>
                        </div>
                        <p>Which test is better?</p>
                        
                        <div class="quiz-container" style="margin-top: 1rem;">
                            <button class="quiz-option" onclick="app.checkBestPractice(this, 'a')">
                                Test A: <code>expect(component.instance().handleClick).toBeDefined()</code>
                            </button>
                            <button class="quiz-option" onclick="app.checkBestPractice(this, 'b')">
                                Test B: <code>expect(screen.getByText('Submitted')).toBeInTheDocument()</code>
                            </button>
                        </div>
                        <div id="best-practice-feedback" style="margin-top: 1rem;"></div>
                    </div>

                    <div class="pitfall-card">
                        <div class="pitfall-icon">‚è≥</div>
                        <div class="pitfall-content">
                            <h4>Flaky Tests</h4>
                            <p>Tests that pass sometimes and fail others. Usually caused by:</p>
                            <ul style="margin-left: 1rem; margin-top: 0.5rem; color: var(--text-secondary);">
                                <li>Depending on current time/date</li>
                                <li>Random data generation</li>
                                <li>Async timing issues (not awaiting)</li>
                                <li>Shared state between tests</li>
                            </ul>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('best-practices', 'interview')">
                        Next: Interview Prep ‚Üí
                    </button>
                `
            },

            'interview': {
                title: 'Interview Preparation',
                subtitle: 'Common Questions & Answers',
                render: () => `
                    <div class="header">
                        <div class="badge">Module 8</div>
                        <h1>Crack the Interview üíº</h1>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">‚ùì</span>
                            <span>Q1: What's the difference between Unit and Integration tests?</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="app.showInterviewAnswer(1)" style="width: 100%; justify-content: center;">Reveal Answer</button>
                            <div id="interview-1" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid var(--accent);">
                                <strong>Key Points:</strong>
                                <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--text-secondary);">
                                    <li><strong>Unit:</strong> Test single function/module in isolation (fast, mocks dependencies)</li>
                                    <li><strong>Integration:</strong> Test how modules work together (slower, real DB/API)</li>
                                    <li><strong>Trade-off:</strong> Unit tests give precise error location; Integration tests catch wiring issues</li>
                                    <li><strong>Ratio:</strong> Follow the testing pyramid (70% unit, 20% integration, 10% e2e)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">‚ùì</span>
                            <span>Q2: When would you NOT use TDD?</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="app.showInterviewAnswer(2)" style="width: 100%; justify-content: center;">Reveal Answer</button>
                            <div id="interview-2" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid var(--accent);">
                                <strong>Nuanced Answer:</strong>
                                <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--text-secondary);">
                                    <li>Spikes/prototypes where requirements are unclear</li>
                                    <li>UI design exploration (tweak until it looks right)</li>
                                    <li>Legacy code without tests (write tests before refactoring, but not necessarily TDD for new features)</li>
                                    <li>Always mention: "For production code with clear requirements, I prefer TDD"</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">‚ùì</span>
                            <span>Q3: How do you test private functions?</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="app.showInterviewAnswer(3)" style="width: 100%; justify-content: center;">Reveal Answer</button>
                            <div id="interview-3" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid var(--accent);">
                                <strong>Philosophy:</strong>
                                <p style="margin-top: 0.5rem; color: var(--text-secondary);">
                                    You don't! Private functions are implementation details. Test the public API. If a private function is complex enough to need testing, consider if it should be its own module (then it's public to that module).
                                </p>
                                <p style="margin-top: 0.5rem; color: var(--success);">
                                    <strong>Bonus:</strong> In JavaScript, you can test private methods via the module pattern or by exporting for tests only (conditional exports).
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="interactive-card" style="background: linear-gradient(135deg, rgba(194, 19, 37, 0.1), rgba(59, 130, 246, 0.1));">
                        <div class="card-header">
                            <span class="card-icon">üí°</span>
                            <span>Pro Tips for Coding Interviews</span>
                        </div>
                        <ul style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 2;">
                            <li>Always ask: "Should I write tests for this?" (Shows professionalism)</li>
                            <li>Handle edge cases (empty arrays, null, undefined, async errors)</li>
                            <li>Name tests descriptively even in interviews</li>
                            <li>If asked to "just implement it," mention you'd normally write tests first</li>
                            <li>Know your matchers: toBe vs toEqual vs toStrictEqual</li>
                        </ul>
                    </div>

                    <button class="btn btn-primary" onclick="app.completeModule('interview', 'final-challenge')">
                        Final Challenge ‚Üí
                    </button>
                `
            },

            'final-challenge': {
                title: 'Final Challenge',
                subtitle: 'The Bank Account Kata',
                render: () => `
                    <div class="header">
                        <div class="badge">Final Boss</div>
                        <h1>Bank Account Kata üèÜ</h1>
                    </div>

                    <p>This is a classic TDD exercise. Build a bank account system with the following requirements:</p>
                    <ul style="color: var(--text-secondary); margin-left: 1.5rem; margin-bottom: 1.5rem;">
                        <li>Deposit amounts</li>
                        <li>Withdraw amounts (if sufficient funds)</li>
                        <li>Print statement with transaction history</li>
                        <li>Date, amount, and balance for each transaction</li>
                    </ul>

                    <div class="interactive-card">
                        <div class="card-header">
                            <span class="card-icon">üè¶</span>
                            <span>Your Mission</span>
                        </div>
                        <p>Complete the test file below to fully specify the behavior, then implement the Account class.</p>

                        <div class="exercise-container">
                            <div class="editor-pane">
                                <div class="editor-header">account.test.js</div>
                                <textarea class="editor-textarea" id="final-challenge">const Account = require('./account');

describe('Account', () => {
  let account;
  let dateSpy;
  
  beforeEach(() => {
    // Mock Date to have consistent test output
    const mockDate = new Date('2024-01-15');
    dateSpy = jest.spyOn(global, 'Date')
      .mockImplementation(() => mockDate);
    account = new Account();
  });

  afterEach(() => {
    dateSpy.mockRestore();
  });

  test('deposit increases balance', () => {
    // TODO: Write this test
  });
  
  test('withdraw decreases balance', () => {
    // TODO: Write this test
  });
  
  test('cannot withdraw more than balance', () => {
    // TODO: Write this test (should throw)
  });
  
  test('printStatement shows transactions', () => {
    // TODO: Integration-style test
    account.deposit(1000);
    account.withdraw(100);
    const output = account.printStatement();
    expect(output).toContain('1000');
    expect(output).toContain('100');
    expect(output).toContain('900');
  });
});</textarea>
                            </div>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div class="editor-pane">
                                    <div class="editor-header">account.js (Implement after tests)</div>
                                    <textarea class="editor-textarea" id="final-impl">class Account {
  constructor() {
    this.balance = 0;
    this.transactions = [];
  }
  
  deposit(amount) {
    // Implement
  }
  
  withdraw(amount) {
    // Implement
  }
  
  printStatement() {
    // Implement CSV-like format
  }
}

module.exports = Account;</textarea>
                                </div>
                                <button class="btn btn-success" onclick="app.checkFinalChallenge()" style="width: 100%; justify-content: center; padding: 1rem;">
                                    Submit Solution
                                </button>
                            </div>
                        </div>
                        <div id="final-feedback" style="margin-top: 1rem; padding: 1rem; border-radius: 8px; display: none;"></div>
                    </div>

                    <div style="text-align: center; margin-top: 3rem; padding: 2rem; opacity: 0.7;">
                        <p>Made with ‚ù§Ô∏è for JavaScript developers</p>
                        <p style="font-size: 0.875rem;">Remember: Red, Green, Refactor!</p>
                    </div>
                `
            }
        };

        // Application Controller
        const app = {
            init() {
                this.navigate('why-test');
                this.updateProgress();
            },

            navigate(moduleId) {
                state.currentModule = moduleId;
                
                // Update sidebar
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.module === moduleId) {
                        item.classList.add('active');
                    }
                });

                // Render content
                const module = content[moduleId];
                const container = document.getElementById('content');
                
                container.style.opacity = '0';
                setTimeout(() => {
                    container.innerHTML = module.render();
                    container.style.opacity = '1';
                    container.style.transition = 'opacity 0.3s';
                    
                    // Re-highlight code
                    if (window.Prism) {
                        Prism.highlightAll();
                    }
                }, 100);

                window.scrollTo(0, 0);
            },

            completeModule(current, next) {
                state.completedModules.add(current);
                this.updateProgress();
                this.showAchievement(`Module Completed!`, `You've mastered ${content[current].subtitle}`);
                this.navigate(next);
            },

            updateProgress() {
                const total = Object.keys(content).length - 1; // Exclude welcome
                const completed = state.completedModules.size;
                const progress = Math.round((completed / total) * 100);
                
                document.getElementById('progress-bar').style.width = `${progress}%`;
                document.getElementById('progress-text').textContent = `${progress}%`;

                // Update sidebar icons
                state.completedModules.forEach(moduleId => {
                    const item = document.querySelector(`[data-module="${moduleId}"]`);
                    if (item) {
                        item.classList.add('completed');
                        item.querySelector('.nav-icon').textContent = '‚úì';
                    }
                });
            },

            showAchievement(title, desc) {
                const popup = document.getElementById('achievement');
                document.getElementById('achievement-title').textContent = title;
                document.getElementById('achievement-desc').textContent = desc;
                
                popup.style.display = 'block';
                
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.8 },
                    colors: ['#C21325', '#22c55e', '#3b82f6']
                });

                setTimeout(() => {
                    popup.style.display = 'none';
                }, 4000);
            },

            // Interactive Features
            showPyramidInfo(level) {
                const info = {
                    'unit': 'Unit Tests: Fast, isolated, test one function. 70% of your tests.',
                    'integration': 'Integration Tests: Test service boundaries (DB, API). 20% of your tests.',
                    'e2e': 'E2E Tests: Simulate real user flows. Slow but comprehensive. 10% of your tests.'
                };
                document.getElementById('pyramid-info').textContent = info[level];
            },

            checkAnswer(btn, isCorrect) {
                const container = btn.parentElement;
                const buttons = container.querySelectorAll('.quiz-option');
                const feedback = document.getElementById('quiz-feedback');

                buttons.forEach(b => b.classList.add('disabled'));
                
                if (isCorrect) {
                    btn.classList.add('correct');
                    feedback.textContent = '‚úÖ Correct! Tests reduce bugs but cannot guarantee their absence (halting problem).';
                    feedback.style.color = 'var(--success)';
                } else {
                    btn.classList.add('wrong');
                    feedback.textContent = '‚ùå Not quite. All those are benefits! Think about absolute guarantees...';
                    feedback.style.color = 'var(--error)';
                }
            },

            runExercise(exerciseId) {
                const code = document.getElementById(`${exerciseId}-code`).value;
                const output = document.getElementById(`${exerciseId}-output`);
                
                if (exerciseId === 'aaa-fix') {
                    if (code.includes('const a = 2') && code.includes('const b = 3') && 
                        code.includes('expect(result).toBe(6)')) {
                        output.innerHTML = '<span class="output-pass">‚úì Test passed!</span><br><span class="output-info">Fixed the order (Arrange before Act) and corrected expectation (2*3=6)</span>';
                        confetti({ particleCount: 50, origin: { y: 0.8 } });
                    } else if (code.includes('toBe(6)')) {
                        output.innerHTML = '<span class="output-fail">‚úó Logic error: Expected 6, got 5</span>';
                    } else {
                        output.innerHTML = '<span class="output-fail">‚úó Still broken. Hint: Fix the expectation and put declarations before usage.</span>';
                    }
                }
            },

            selectMatcher(btn, isCorrect) {
                const feedback = document.getElementById('matcher-feedback');
                if (isCorrect) {
                    btn.style.background = 'var(--success)';
                    btn.style.color = 'white';
                    feedback.innerHTML = '<span style="color: var(--success);">‚úì Correct!</span>';
                } else {
                    btn.style.background = 'var(--error)';
                    btn.style.color = 'white';
                    feedback.innerHTML = '<span style="color: var(--error);">‚úó Try again. Think about what each matcher does.</span>';
                }
            },

            highlightTDD(phase) {
                const explanations = {
                    'red': '<strong style="color: var(--error);">RED Phase:</strong> Write a test that fails. This proves the test is actually testing something (not accidentally passing). The error message should guide your implementation.',
                    'green': '<strong style="color: var(--success);">GREEN Phase:</strong> Write the minimum code to make the test pass. Hardcode if necessary! The goal is speed, not elegance.',
                    'refactor': '<strong style="color: var(--accent);">REFACTOR Phase:</strong> Now clean up the code. Rename variables, extract functions, optimize. The tests give you confidence you didn\'t break anything.'
                };
                document.getElementById('tdd-explanation').innerHTML = explanations[phase];
            },

            showTDDStep(step) {
                const content = document.getElementById('tdd-step-content');
                if (step === 2) {
                    content.innerHTML = `
                        <h4>Step 2: Make It Green</h4>
                        <p>Implement the simplest thing that works:</p>
                        <div class="code-container">
                            <div class="code-block">
<pre><code>// fizzbuzz.js
function fizzBuzz(n) {
  return 'Fizz'; // Hardcoded! It's okay for now.
}
module.exports = fizzBuzz;</code></pre>
                            </div>
                        </div>
                        <p style="color: var(--success); margin-top: 1rem;">‚úì Test passes! Now we refactor with more test cases.</p>
                        <button class="btn btn-primary" onclick="app.advanceTDDStep(3)">Proceed to Refactor ‚Üí</button>
                    `;
                } else if (step === 3) {
                    content.innerHTML = `
                        <h4>Step 3: Refactor & Repeat</h4>
                        <p>Add more tests to force generalization:</p>
                        <ul style="color: var(--text-secondary); margin: 1rem 0;">
                            <li>Test fizzBuzz(6) ‚Üí 'Fizz'</li>
                            <li>Test fizzBuzz(5) ‚Üí 'Buzz'</li>
                            <li>Test fizzBuzz(15) ‚Üí 'FizzBuzz'</li>
                        </ul>
                        <p>Now generalize the implementation to handle all cases.</p>
                        <div class="code-container">
                            <div class="code-block">
<pre><code>// Final implementation
function fizzBuzz(n) {
  if (n % 15 === 0) return 'FizzBuzz';
  if (n % 3 === 0) return 'Fizz';
  if (n % 5 === 0) return 'Buzz';
  return String(n);
}</code></pre>
                            </div>
                        </div>
                    `;
                }
            },

            advanceTDDStep(step) {
                document.getElementById(`step-${step}-btn`).disabled = false;
                document.getElementById(`step-${step}-btn`).style.opacity = '1';
                document.getElementById(`step-${step}-btn`).click();
            },

            checkMockAnswer() {
                const code = document.getElementById('mock-exercise').value;
                const feedback = document.getElementById('mock-feedback');
                
                if (code.includes('emailService.send')) {
                    feedback.style.display = 'block';
                    feedback.style.background = 'rgba(34, 197, 94, 0.1)';
                    feedback.style.borderLeft = '4px solid var(--success)';
                    feedback.innerHTML = '<strong style="color: var(--success);">Correct!</strong> We verify the mock was called with the expected arguments.';
                    confetti({ particleCount: 30, origin: { y: 0.8 } });
                } else {
                    feedback.style.display = 'block';
                    feedback.style.background = 'rgba(239, 68, 68, 0.1)';
                    feedback.style.borderLeft = '4px solid var(--error)';
                    feedback.innerHTML = '<strong style="color: var(--error);">Not quite.</strong> Hint: We want to check if the send method on emailService was called.';
                }
            },

            checkBestPractice(btn, choice) {
                const feedback = document.getElementById('best-practice-feedback');
                const buttons = btn.parentElement.querySelectorAll('.quiz-option');
                buttons.forEach(b => b.classList.add('disabled'));

                if (choice === 'b') {
                    btn.classList.add('correct');
                    feedback.innerHTML = '<strong style="color: var(--success);">‚úì Correct!</strong> Test B checks behavior (user sees "Submitted"). Test A checks implementation (method exists). If you rename the method, Test A breaks even if the button still works.';
                } else {
                    btn.classList.add('wrong');
                    feedback.innerHTML = '<strong style="color: var(--error);">‚úó Incorrect.</strong> Testing for method existence is brittle. What matters is the user outcome, not the internal method name.';
                }
            },

            showInterviewAnswer(num) {
                document.getElementById(`interview-${num}`).style.display = 'block';
            },

            checkFinalChallenge() {
                const testCode = document.getElementById('final-challenge').value;
                const implCode = document.getElementById('final-impl').value;
                const feedback = document.getElementById('final-feedback');
                
                const hasDepositTest = testCode.includes('deposit') && testCode.includes('expect');
                const hasWithdrawTest = testCode.includes('withdraw');
                const hasErrorTest = testCode.includes('throw') || testCode.includes('Error');
                const hasImpl = implCode.includes('this.transactions.push') || implCode.includes('this.balance');
                
                if (hasDepositTest && hasWithdrawTest && hasErrorTest && hasImpl) {
                    feedback.style.display = 'block';
                    feedback.style.background = 'rgba(34, 197, 94, 0.1)';
                    feedback.style.borderLeft = '4px solid var(--success)';
                    feedback.innerHTML = `
                        <h3 style="color: var(--success); margin-bottom: 0.5rem;">üéâ Congratulations! You're a Testing Master!</h3>
                        <p>You've completed the Bank Account Kata with proper TDD approach.</p>
                        <p style="margin-top: 0.5rem;"><strong>Key skills demonstrated:</strong></p>
                        <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                            <li>Arrange-Act-Assert pattern</li>
                            <li>Mocking Date for determinism</li>
                            <li>Error handling tests</li>
                            <li>State management in tests</li>
                        </ul>
                    `;
                    confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
                    state.completedModules.add('final-challenge');
                    this.updateProgress();
                } else {
                    feedback.style.display = 'block';
                    feedback.style.background = 'rgba(234, 179, 8, 0.1)';
                    feedback.style.borderLeft = '4px solid var(--warning)';
                    feedback.innerHTML = '<strong style="color: var(--warning);">Almost there!</strong> Make sure you have tests for deposit, withdraw, and error cases, plus a basic implementation.';
                }
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>