<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ JavaScript Scope Mastery - Modern Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a2e;
            color: #e0e0e0;
            line-height: 1.7;
        }

        .nav-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: #0d0d35;
            border-right: 2px solid #1a1a5e;
            overflow-y: auto;
            z-index: 100;
            padding: 20px 0;
        }

        .nav-title {
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            color: #a29bfe;
            padding: 10px 15px 15px;
            border-bottom: 1px solid #1a1a5e;
        }

        .progress-container {
            padding: 12px 15px;
            border-bottom: 1px solid #1a1a5e;
        }

        .progress-bar {
            height: 6px;
            background: #1a1a5e;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6c5ce7, #a29bfe);
            border-radius: 3px;
            transition: width 0.5s;
            width: 0%;
        }

        .progress-text {
            font-size: 0.75em;
            color: #888;
            margin-top: 4px;
        }

        .nav-section-title {
            font-size: 0.7em;
            text-transform: uppercase;
            color: #6c5ce7;
            padding: 12px 15px 4px;
            letter-spacing: 1px;
        }

        .nav-item {
            padding: 7px 15px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85em;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-item:hover {
            background: #1a1a5e;
            color: #a29bfe;
        }

        .nav-item.active {
            background: #6c5ce7;
            color: white;
        }

        .nav-item.completed::after {
            content: '‚úì';
            margin-left: auto;
            color: #00b894;
            font-weight: bold;
        }

        .main-content {
            margin-left: 260px;
            padding: 30px 40px;
            max-width: 950px;
        }

        .section {
            display: none;
            animation: fadeIn 0.4s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            font-size: 2.2em;
            color: #a29bfe;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #888;
            font-size: 1.05em;
            margin-bottom: 25px;
        }

        .card {
            background: #12123e;
            border-radius: 12px;
            padding: 22px;
            margin-bottom: 22px;
            border: 1px solid #1a1a5e;
        }

        .card h3 {
            color: #a29bfe;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        .analogy {
            background: linear-gradient(135deg, #1a1a5e, #2d1b69);
            border-radius: 12px;
            padding: 22px;
            margin: 18px 0;
            border-left: 4px solid #6c5ce7;
        }

        .analogy .icon {
            font-size: 1.8em;
            margin-bottom: 8px;
        }

        .analogy h4 {
            color: #dfe6e9;
            margin-bottom: 8px;
        }

        .code-block {
            background: #0a0a20;
            border-radius: 8px;
            padding: 18px;
            font-family: 'Courier New', monospace;
            font-size: 0.92em;
            overflow-x: auto;
            border: 1px solid #1a1a5e;
            line-height: 1.8;
            margin: 12px 0;
            white-space: pre;
        }

        .cm { color: #636e72; }
        .kw { color: #e056a0; }
        .st { color: #a8e6cf; }
        .vr { color: #74b9ff; }
        .fn { color: #ffeaa7; }
        .nm { color: #fd79a8; }
        .err { background: rgba(255,0,0,0.12); display: inline-block; width: 100%; padding: 0 4px; border-radius: 3px; }
        .ok { background: rgba(0,184,148,0.12); display: inline-block; width: 100%; padding: 0 4px; border-radius: 3px; }

        .run-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            border: none;
            color: white;
            padding: 9px 22px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            margin: 8px 0;
            transition: all 0.2s;
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,184,148,0.3);
        }

        .output {
            background: #050515;
            border: 1px solid #1a1a5e;
            border-radius: 8px;
            padding: 14px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            min-height: 40px;
            white-space: pre-wrap;
            font-size: 0.9em;
        }

        .out-ok { color: #00b894; }
        .out-err { color: #e74c3c; }
        .out-warn { color: #fdcb6e; }
        .out-info { color: #74b9ff; }

        .scope-visual {
            margin: 15px 0;
            padding: 15px;
        }

        .scope-box {
            border: 2px dashed;
            border-radius: 10px;
            padding: 18px;
            margin: 8px 0;
            position: relative;
        }

        .scope-box.global { border-color: #e74c3c; background: rgba(231,76,60,0.04); }
        .scope-box.func { border-color: #6c5ce7; background: rgba(108,92,231,0.04); margin: 12px; }
        .scope-box.block { border-color: #00b894; background: rgba(0,184,148,0.04); margin: 12px; }

        .scope-lbl {
            position: absolute;
            top: -11px;
            left: 12px;
            padding: 1px 10px;
            border-radius: 4px;
            font-size: 0.78em;
            font-weight: bold;
            color: white;
        }

        .scope-lbl.global { background: #e74c3c; }
        .scope-lbl.func { background: #6c5ce7; }
        .scope-lbl.block { background: #00b894; }

        .scope-tag {
            display: inline-block;
            padding: 4px 12px;
            margin: 3px;
            border-radius: 16px;
            font-family: monospace;
            font-size: 0.85em;
        }

        .scope-tag.let-tag { background: #6c5ce733; color: #a29bfe; border: 1px solid #6c5ce7; }
        .scope-tag.const-tag { background: #00b89433; color: #00b894; border: 1px solid #00b894; }
        .scope-tag.var-tag { background: #e74c3c33; color: #e74c3c; border: 1px solid #e74c3c; text-decoration: line-through; }

        .pitfall {
            background: rgba(231,76,60,0.08);
            border: 1px solid #e74c3c;
            border-radius: 12px;
            padding: 20px;
            margin: 18px 0;
        }

        .pitfall h4 { color: #e74c3c; margin-bottom: 8px; }

        .tip {
            background: rgba(0,184,148,0.08);
            border: 1px solid #00b894;
            border-radius: 12px;
            padding: 20px;
            margin: 18px 0;
        }

        .tip h4 { color: #00b894; margin-bottom: 8px; }

        .warning {
            background: rgba(253,203,110,0.08);
            border: 1px solid #fdcb6e;
            border-radius: 12px;
            padding: 20px;
            margin: 18px 0;
        }

        .warning h4 { color: #fdcb6e; margin-bottom: 8px; }

        .legacy-box {
            background: rgba(231,76,60,0.05);
            border: 2px solid #e74c3c;
            border-radius: 12px;
            padding: 20px;
            margin: 18px 0;
            position: relative;
        }

        .legacy-box::before {
            content: '‚ö†Ô∏è LEGACY ‚Äî var (avoid in new code)';
            position: absolute;
            top: -12px;
            left: 15px;
            background: #e74c3c;
            color: white;
            padding: 2px 12px;
            border-radius: 4px;
            font-size: 0.78em;
            font-weight: bold;
        }

        .legacy-box h4 { color: #e74c3c; margin-bottom: 8px; margin-top: 8px; }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 0.92em;
        }

        .comparison-table th {
            background: #1a1a5e;
            padding: 10px 12px;
            text-align: left;
            color: #a29bfe;
            border: 1px solid #2d2d6e;
        }

        .comparison-table td {
            padding: 10px 12px;
            border: 1px solid #1a1a5e;
            background: #0a0a2e;
        }

        .yes { color: #00b894; font-weight: bold; }
        .no { color: #e74c3c; font-weight: bold; }

        .quiz-box {
            background: #12123e;
            border-radius: 12px;
            padding: 22px;
            margin: 18px 0;
            border: 1px solid #1a1a5e;
        }

        .quiz-q {
            font-size: 1.05em;
            margin-bottom: 15px;
            color: #dfe6e9;
        }

        .quiz-q .qn { color: #6c5ce7; font-weight: bold; }

        .quiz-opts {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .quiz-opt {
            padding: 10px 16px;
            background: #0a0a2e;
            border: 2px solid #1a1a5e;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: monospace;
            font-size: 0.92em;
        }

        .quiz-opt:hover { border-color: #6c5ce7; background: #1a1a5e; }
        .quiz-opt.correct { border-color: #00b894; background: rgba(0,184,148,0.15); }
        .quiz-opt.wrong { border-color: #e74c3c; background: rgba(231,76,60,0.15); }
        .quiz-opt.locked { pointer-events: none; }

        .quiz-exp {
            margin-top: 12px;
            padding: 12px;
            border-radius: 8px;
            display: none;
            font-size: 0.95em;
        }

        .quiz-exp.show { display: block; }
        .quiz-exp.ok-exp { background: rgba(0,184,148,0.1); border: 1px solid #00b894; color: #00b894; }
        .quiz-exp.bad-exp { background: rgba(231,76,60,0.1); border: 1px solid #e74c3c; color: #e74c3c; }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 35px;
            padding-top: 18px;
            border-top: 1px solid #1a1a5e;
        }

        .nav-btn {
            padding: 10px 25px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.2s;
        }

        .nav-btn.prev { background: #1a1a5e; color: #a29bfe; }
        .nav-btn.next { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; }
        .nav-btn:hover { transform: translateY(-2px); }
        .nav-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

        .inline-code {
            background: #1a1a5e;
            padding: 1px 7px;
            border-radius: 4px;
            font-family: monospace;
            color: #a29bfe;
            font-size: 0.92em;
        }

        .score-circle {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 18px auto;
            font-size: 2.2em;
            font-weight: bold;
        }

        .score-circle.excellent { border: 5px solid #00b894; color: #00b894; }
        .score-circle.good { border: 5px solid #fdcb6e; color: #fdcb6e; }
        .score-circle.retry { border: 5px solid #e74c3c; color: #e74c3c; }

        .hidden { display: none; }

        .playground textarea {
            width: 100%;
            min-height: 120px;
            background: #0a0a20;
            color: #e0e0e0;
            border: 1px solid #1a1a5e;
            border-radius: 8px;
            padding: 14px;
            font-family: 'Courier New', monospace;
            font-size: 0.92em;
            resize: vertical;
            line-height: 1.6;
        }

        .playground textarea:focus { outline: none; border-color: #6c5ce7; }

        .real-world {
            background: linear-gradient(135deg, #12123e, #1a1250);
            border-radius: 12px;
            padding: 22px;
            margin: 18px 0;
            border: 1px solid #2d2d6e;
        }

        .real-world h4 { color: #74b9ff; margin-bottom: 8px; }

        ul, ol { margin: 8px 0 8px 22px; }
        li { margin: 4px 0; }

        ::-webkit-scrollbar { width: 7px; }
        ::-webkit-scrollbar-track { background: #0a0a2e; }
        ::-webkit-scrollbar-thumb { background: #1a1a5e; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6c5ce7; }

        .rule-banner {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: #0a0a2e;
            padding: 15px 22px;
            border-radius: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.15em;
            margin: 18px 0;
        }

        .memory-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
        }

        .memory-slot {
            background: #0a0a2e;
            border: 2px solid #1a1a5e;
            border-radius: 8px;
            padding: 14px;
            text-align: center;
            min-width: 110px;
        }

        .memory-slot .sl-name { font-family: monospace; color: #a29bfe; font-weight: bold; }
        .memory-slot .sl-val { margin-top: 6px; padding: 4px 8px; background: #12123e; border-radius: 4px; font-family: monospace; }
        .memory-slot .sl-type { font-size: 0.68em; color: #888; margin-top: 4px; }

        .strike { text-decoration: line-through; opacity: 0.5; }

        @media (max-width: 768px) {
            .nav-sidebar { display: none; }
            .main-content { margin-left: 0; padding: 15px; }
        }
    </style>
</head>
<body>

<nav class="nav-sidebar">
    <div class="nav-title">üéØ JS Scope Mastery</div>
    <div class="progress-container">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-text" id="progressText">0 / 10 completed</div>
    </div>
    <div class="nav-section-title">üìö Foundations</div>
    <div class="nav-item active" data-s="intro" onclick="go('intro')">üè† What is Scope?</div>
    <div class="nav-item" data-s="why" onclick="go('why')">ü§î Why Scope Matters</div>
    <div class="nav-item" data-s="global" onclick="go('global')">üåç Global Scope</div>
    <div class="nav-item" data-s="function" onclick="go('function')">üì¶ Function Scope</div>
    <div class="nav-item" data-s="block" onclick="go('block')">üß± Block Scope</div>
    <div class="nav-section-title">‚ö° Advanced</div>
    <div class="nav-item" data-s="legacy" onclick="go('legacy')">üíÄ Why var is Dangerous</div>
    <div class="nav-item" data-s="chain" onclick="go('chain')">üîó Scope Chain</div>
    <div class="nav-item" data-s="hoisting" onclick="go('hoisting')">üèóÔ∏è Hoisting & TDZ</div>
    <div class="nav-item" data-s="closures" onclick="go('closures')">üîí Closures</div>
    <div class="nav-section-title">üèÜ Mastery</div>
    <div class="nav-item" data-s="realworld" onclick="go('realworld')">üåê Real-World Patterns</div>
    <div class="nav-item" data-s="pitfalls" onclick="go('pitfalls')">üí£ Pitfalls & Fixes</div>
    <div class="nav-item" data-s="quiz" onclick="go('quiz')">üèÜ Final Quiz</div>
</nav>

<main class="main-content" id="mainContent">

<!-- ========== INTRO ========== -->
<div class="section active" id="s-intro">
    <h1>üéØ What is Scope?</h1>
    <p class="subtitle">The #1 concept to truly understand JavaScript</p>

    <div class="rule-banner">
        üö® This guide uses <strong>const</strong> and <strong>let</strong> only.<br>
        <code>var</code> is shown ONLY in the "Legacy" section so you know why to avoid it.
    </div>

    <div class="analogy">
        <div class="icon">üè†üö™</div>
        <h4>The House Analogy</h4>
        <p><strong>Scope = where a variable can be seen and used.</strong></p>
        <p>Think of your code like a house:</p>
        <ul>
            <li>üåç <strong>Global scope</strong> = the front yard ‚Äî everyone walking by can see it</li>
            <li>üì¶ <strong>Function scope</strong> = a room with a locked door ‚Äî only people inside can see what's in there</li>
            <li>üß± <strong>Block scope</strong> = a drawer inside that room ‚Äî even more private</li>
        </ul>
        <p><br>üîë <strong>You can always look OUT from where you are, but nobody can look IN.</strong></p>
    </div>

    <div class="card">
        <h3>üìñ Three Types of Scope</h3>
        <div class="memory-row">
            <div class="memory-slot" style="border-color:#e74c3c;">
                <div class="sl-name">üåç Global</div>
                <div class="sl-val">Everywhere</div>
                <div class="sl-type">Outside any function/block</div>
            </div>
            <div class="memory-slot" style="border-color:#6c5ce7;">
                <div class="sl-name">üì¶ Function</div>
                <div class="sl-val">Inside function</div>
                <div class="sl-type">Created by function() { }</div>
            </div>
            <div class="memory-slot" style="border-color:#00b894;">
                <div class="sl-name">üß± Block</div>
                <div class="sl-val">Inside { }</div>
                <div class="sl-type">if, for, while, plain { }</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>üëÅÔ∏è Visual: The Scope Layers</h3>
        <div class="scope-visual">
            <div class="scope-box global">
                <span class="scope-lbl global">üåç GLOBAL SCOPE</span>
                <span class="scope-tag const-tag">const appName = "MyApp"</span>

                <div class="scope-box func">
                    <span class="scope-lbl func">üì¶ FUNCTION SCOPE (greetUser)</span>
                    <span class="scope-tag let-tag">let userName = "Alice"</span>
                    <span class="scope-tag const-tag">const greeting = "Hello"</span>
                    <p style="font-size:0.82em;color:#888;margin-top:6px">‚úÖ Can see: appName, userName, greeting</p>

                    <div class="scope-box block">
                        <span class="scope-lbl block">üß± BLOCK SCOPE (if)</span>
                        <span class="scope-tag const-tag">const message = "Welcome!"</span>
                        <p style="font-size:0.82em;color:#888;margin-top:6px">‚úÖ Can see: EVERYTHING above + message</p>
                    </div>
                    <p style="font-size:0.82em;color:#e74c3c;margin-top:6px">‚ùå Cannot see: message (block scoped)</p>
                </div>
                <p style="font-size:0.82em;color:#e74c3c;margin-top:6px">‚ùå Cannot see: userName, greeting, message</p>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>üéÆ Try It ‚Äî Your First Scope Experiment</h3>
        <div class="code-block"><span class="cm">// üåç Global Scope</span>
<span class="kw">const</span> <span class="vr">globalVar</span> = <span class="st">"I'm global! üåç"</span>;

<span class="kw">function</span> <span class="fn">myFunction</span>() {
    <span class="cm">// üì¶ Function Scope</span>
    <span class="kw">const</span> <span class="vr">functionVar</span> = <span class="st">"I'm function-scoped üì¶"</span>;

    console.log(globalVar);    <span class="cm">// ‚úÖ Can see global</span>
    console.log(functionVar);  <span class="cm">// ‚úÖ Can see own variable</span>

    <span class="kw">if</span> (<span class="kw">true</span>) {
        <span class="cm">// üß± Block Scope</span>
        <span class="kw">const</span> <span class="vr">blockVar</span> = <span class="st">"I'm block-scoped üß±"</span>;
        console.log(blockVar);     <span class="cm">// ‚úÖ</span>
        console.log(functionVar);  <span class="cm">// ‚úÖ Can see parent</span>
        console.log(globalVar);    <span class="cm">// ‚úÖ Can see grandparent</span>
    }

    <span class="cm">// console.log(blockVar); // ‚ùå ReferenceError!</span>
}

<span class="fn">myFunction</span>();
<span class="cm">// console.log(functionVar); // ‚ùå ReferenceError!</span></div>
        <button class="run-btn" onclick="runDemo('intro1')">‚ñ∂ Run This Code</button>
        <div class="output" id="out-intro1"></div>
    </div>

    <div class="tip">
        <h4>üí° The Golden Rule</h4>
        <p><strong>Inner scopes can access outer scopes. Outer scopes CANNOT access inner scopes.</strong></p>
        <p>Like one-way glass: you can see OUT but nobody can see IN.</p>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" disabled>‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('why')">Next: Why Scope Matters ‚Üí</button>
    </div>
</div>

<!-- ========== WHY SCOPE ========== -->
<div class="section" id="s-why">
    <h1>ü§î Why Does Scope Exist?</h1>
    <p class="subtitle">4 concrete reasons scope will save your life as a developer</p>

    <div class="analogy">
        <div class="icon">üè•</div>
        <h4>Hospital Without Walls</h4>
        <p>Imagine a hospital with <em>no rooms, no walls</em>. Patient records get mixed up, surgeries interfere with each other, private info is visible to everyone. <strong>Scope = walls in your code.</strong></p>
    </div>

    <div class="card">
        <h3>1Ô∏è‚É£ Avoiding Name Collisions</h3>
        <div class="code-block"><span class="cm">// ‚úÖ Different functions, same variable names, ZERO conflict</span>
<span class="kw">function</span> <span class="fn">calculateShipping</span>(<span class="vr">weight</span>) {
    <span class="kw">const</span> <span class="vr">rate</span> = <span class="nm">2.5</span>;         <span class="cm">// This 'rate'...</span>
    <span class="kw">return</span> <span class="vr">weight</span> * <span class="vr">rate</span>;
}

<span class="kw">function</span> <span class="fn">calculateTax</span>(<span class="vr">price</span>) {
    <span class="kw">const</span> <span class="vr">rate</span> = <span class="nm">0.08</span>;        <span class="cm">// ...and this 'rate' are DIFFERENT!</span>
    <span class="kw">return</span> <span class="vr">price</span> * <span class="vr">rate</span>;
}

console.log(<span class="fn">calculateShipping</span>(<span class="nm">10</span>)); <span class="cm">// 25</span>
console.log(<span class="fn">calculateTax</span>(<span class="nm">100</span>));      <span class="cm">// 8</span></div>
        <button class="run-btn" onclick="runDemo('why1')">‚ñ∂ Run</button>
        <div class="output" id="out-why1"></div>
    </div>

    <div class="card">
        <h3>2Ô∏è‚É£ Data Privacy & Security</h3>
        <div class="code-block"><span class="kw">function</span> <span class="fn">createBankAccount</span>(<span class="vr">initialBalance</span>) {
    <span class="kw">let</span> <span class="vr">balance</span> = <span class="vr">initialBalance</span>;  <span class="cm">// üîí PRIVATE</span>
    <span class="kw">const</span> <span class="vr">pin</span> = <span class="st">"1234"</span>;            <span class="cm">// üîí PRIVATE</span>

    <span class="kw">return</span> {
        <span class="fn">getBalance</span>() { <span class="kw">return</span> <span class="vr">balance</span>; },
        <span class="fn">deposit</span>(<span class="vr">amount</span>) {
            <span class="kw">if</span> (<span class="vr">amount</span> > <span class="nm">0</span>) <span class="vr">balance</span> += <span class="vr">amount</span>;
        },
        <span class="fn">withdraw</span>(<span class="vr">amount</span>, <span class="vr">userPin</span>) {
            <span class="kw">if</span> (<span class="vr">userPin</span> === <span class="vr">pin</span> && <span class="vr">amount</span> <= <span class="vr">balance</span>) {
                <span class="vr">balance</span> -= <span class="vr">amount</span>;
                <span class="kw">return</span> <span class="vr">amount</span>;
            }
            <span class="kw">return</span> <span class="st">"Denied!"</span>;
        }
    };
}

<span class="kw">const</span> <span class="vr">acct</span> = <span class="fn">createBankAccount</span>(<span class="nm">1000</span>);
console.log(<span class="vr">acct</span>.<span class="fn">getBalance</span>());          <span class="cm">// 1000 ‚úÖ</span>
<span class="vr">acct</span>.<span class="fn">deposit</span>(<span class="nm">500</span>);
console.log(<span class="vr">acct</span>.<span class="fn">getBalance</span>());          <span class="cm">// 1500 ‚úÖ</span>
console.log(<span class="vr">acct</span>.<span class="fn">withdraw</span>(<span class="nm">200</span>, <span class="st">"wrong"</span>)); <span class="cm">// "Denied!" ‚úÖ</span>
console.log(<span class="vr">acct</span>.<span class="fn">withdraw</span>(<span class="nm">200</span>, <span class="st">"1234"</span>));  <span class="cm">// 200 ‚úÖ</span>
<span class="cm">// console.log(balance); // ‚ùå Can't touch private data!</span>
<span class="cm">// console.log(pin);     // ‚ùå PIN is safe!</span></div>
        <button class="run-btn" onclick="runDemo('why2')">‚ñ∂ Run Bank Demo</button>
        <div class="output" id="out-why2"></div>
    </div>

    <div class="card">
        <h3>3Ô∏è‚É£ Memory Management</h3>
        <p>Local variables get <strong>garbage collected</strong> when their scope ends. Global variables live <em>forever</em>, eating memory.</p>
        <div class="code-block"><span class="cm">// ‚ùå BAD: stays in memory forever</span>
<span class="kw">const</span> <span class="vr">hugeGlobalArray</span> = <span class="kw">new</span> Array(<span class="nm">1000000</span>).fill(<span class="st">"data"</span>);

<span class="cm">// ‚úÖ GOOD: cleaned up after function ends</span>
<span class="kw">function</span> <span class="fn">processData</span>() {
    <span class="kw">const</span> <span class="vr">tempData</span> = <span class="kw">new</span> Array(<span class="nm">1000000</span>).fill(<span class="st">"data"</span>);
    <span class="cm">// ... process ...</span>
    <span class="kw">return</span> <span class="st">"done"</span>;
    <span class="cm">// tempData is garbage collected here üóëÔ∏è</span>
}</div>
    </div>

    <div class="card">
        <h3>4Ô∏è‚É£ Team Collaboration</h3>
        <p>Multiple developers can use the same variable names in different functions without any risk of conflicts.</p>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('intro')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('global')">Next: Global Scope ‚Üí</button>
    </div>
</div>

<!-- ========== GLOBAL SCOPE ========== -->
<div class="section" id="s-global">
    <h1>üåç Global Scope</h1>
    <p class="subtitle">Visible everywhere ‚Äî powerful but dangerous if overused</p>

    <div class="card">
        <h3>üìñ When is a Variable Global?</h3>
        <p>When declared <strong>outside</strong> any function or block:</p>
        <div class="code-block"><span class="cm">// All of these are global</span>
<span class="kw">const</span> <span class="vr">API_URL</span> = <span class="st">"https://api.myapp.com"</span>;  <span class="cm">// ‚úÖ Good use of global</span>
<span class="kw">const</span> <span class="vr">MAX_RETRIES</span> = <span class="nm">3</span>;                    <span class="cm">// ‚úÖ Good use of global</span>
<span class="kw">let</span> <span class="vr">currentTheme</span> = <span class="st">"dark"</span>;                 <span class="cm">// ‚ö†Ô∏è OK if truly app-wide</span>

<span class="kw">function</span> <span class="fn">fetchData</span>() {
    console.log(<span class="vr">API_URL</span>);    <span class="cm">// ‚úÖ Accessible everywhere</span>
    console.log(<span class="vr">MAX_RETRIES</span>); <span class="cm">// ‚úÖ Accessible everywhere</span>
}

<span class="kw">if</span> (<span class="kw">true</span>) {
    console.log(<span class="vr">currentTheme</span>); <span class="cm">// ‚úÖ Also accessible here</span>
}</div>
        <button class="run-btn" onclick="runDemo('global1')">‚ñ∂ Run</button>
        <div class="output" id="out-global1"></div>
    </div>

    <div class="tip">
        <h4>‚úÖ When IS Global Scope OK?</h4>
        <ul>
            <li>App-wide constants: <span class="inline-code">const API_URL = "..."</span></li>
            <li>Configuration objects: <span class="inline-code">const CONFIG = { ... }</span></li>
            <li>Truly app-wide state (but consider state management)</li>
        </ul>
    </div>

    <div class="pitfall">
        <h4>üíÄ Rule: Minimize Global Variables</h4>
        <p>Every global variable is a potential collision with:</p>
        <ul>
            <li>Other scripts on the page</li>
            <li>Browser built-in names (like <span class="inline-code">name</span>, <span class="inline-code">status</span>, <span class="inline-code">event</span>)</li>
            <li>Third-party libraries</li>
        </ul>
    </div>

    <div class="quiz-box" id="q-global1">
        <div class="quiz-q"><span class="qn">Quiz:</span> What does this output?
            <div class="code-block"><span class="kw">const</span> <span class="vr">color</span> = <span class="st">"red"</span>;
<span class="kw">function</span> <span class="fn">paint</span>() { console.log(<span class="vr">color</span>); }
<span class="cm">// color = "blue";  ‚Üê Would crash! const can't be reassigned</span>
<span class="fn">paint</span>();</div>
        </div>
        <div class="quiz-opts">
            <div class="quiz-opt" onclick="quiz('q-global1',this,true)">"red"</div>
            <div class="quiz-opt" onclick="quiz('q-global1',this,false)">"blue"</div>
            <div class="quiz-opt" onclick="quiz('q-global1',this,false)">undefined</div>
            <div class="quiz-opt" onclick="quiz('q-global1',this,false)">TypeError</div>
        </div>
        <div class="quiz-exp ok-exp" id="q-global1-ok">‚úÖ Correct! <code>const color = "red"</code> is global and accessible inside <code>paint()</code>. Since it's <code>const</code>, it can never be reassigned ‚Äî which is the whole point of using <code>const</code>!</div>
        <div class="quiz-exp bad-exp" id="q-global1-bad">‚ùå The answer is <strong>"red"</strong>. The function reads the global <code>const color</code>, which is "red". Since it's <code>const</code>, it can't be changed, so there's no risk of surprises.</div>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('why')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('function')">Next: Function Scope ‚Üí</button>
    </div>
</div>

<!-- ========== FUNCTION SCOPE ========== -->
<div class="section" id="s-function">
    <h1>üì¶ Function Scope</h1>
    <p class="subtitle">Your private room ‚Äî what's declared here stays here</p>

    <div class="analogy">
        <div class="icon">üéí</div>
        <h4>The Backpack</h4>
        <p>Each function call opens a fresh backpack. Variables go in it. When the function ends, the backpack is tossed away. Nobody else can see inside.</p>
    </div>

    <div class="card">
        <h3>üìñ How It Works</h3>
        <div class="code-block"><span class="kw">function</span> <span class="fn">makeBreakfast</span>() {
    <span class="kw">const</span> <span class="vr">eggs</span> = <span class="nm">3</span>;
    <span class="kw">const</span> <span class="vr">toast</span> = <span class="nm">2</span>;
    <span class="kw">const</span> <span class="vr">coffee</span> = <span class="st">"black"</span>;

    console.log(<span class="st">`Making ${eggs} eggs, ${toast} toast, ${coffee} coffee`</span>);
}

<span class="fn">makeBreakfast</span>(); <span class="cm">// Works!</span>
<span class="cm">// console.log(eggs);  ‚ùå ReferenceError ‚Äî not accessible outside!</span></div>
        <button class="run-btn" onclick="runDemo('func1')">‚ñ∂ Run</button>
        <div class="output" id="out-func1"></div>
    </div>

    <div class="card">
        <h3>üîÑ Each Call = NEW Scope</h3>
        <div class="code-block"><span class="kw">function</span> <span class="fn">counter</span>() {
    <span class="kw">let</span> <span class="vr">count</span> = <span class="nm">0</span>;  <span class="cm">// Fresh count every time!</span>
    <span class="vr">count</span>++;
    console.log(<span class="st">`Count: ${count}`</span>);
}

<span class="fn">counter</span>(); <span class="cm">// Count: 1</span>
<span class="fn">counter</span>(); <span class="cm">// Count: 1  ‚Üê RESET! New scope each call</span>
<span class="fn">counter</span>(); <span class="cm">// Count: 1  ‚Üê RESET again!</span></div>
        <button class="run-btn" onclick="runDemo('func2')">‚ñ∂ Run</button>
        <div class="output" id="out-func2"></div>
        <p style="margin-top:8px;color:#888;font-size:0.9em">üí° Want a counter that <em>remembers</em>? You need closures ‚Äî we'll learn that soon!</p>
    </div>

    <div class="card">
        <h3>ü™Ü Nested Functions ‚Äî Inner Sees Outer</h3>
        <div class="scope-visual">
            <div class="scope-box global">
                <span class="scope-lbl global">üåç GLOBAL</span>
                <span class="scope-tag const-tag">const app = "MyApp"</span>
                <div class="scope-box func">
                    <span class="scope-lbl func">üì¶ outer()</span>
                    <span class="scope-tag let-tag">let x = 10</span>
                    <div class="scope-box func" style="border-color:#fd79a8">
                        <span class="scope-lbl func" style="background:#fd79a8">üì¶ inner()</span>
                        <span class="scope-tag let-tag">let y = 20</span>
                        <p style="font-size:0.82em;color:#888;margin-top:5px">‚úÖ Can see: app, x, y</p>
                    </div>
                    <p style="font-size:0.82em;color:#e74c3c;margin-top:5px">‚ùå Cannot see: y</p>
                </div>
            </div>
        </div>
        <div class="code-block"><span class="kw">function</span> <span class="fn">outer</span>() {
    <span class="kw">const</span> <span class="vr">x</span> = <span class="nm">10</span>;

    <span class="kw">function</span> <span class="fn">inner</span>() {
        <span class="kw">const</span> <span class="vr">y</span> = <span class="nm">20</span>;
        console.log(<span class="vr">x</span> + <span class="vr">y</span>);  <span class="cm">// ‚úÖ 30 ‚Äî inner sees outer's x</span>
    }

    <span class="fn">inner</span>();
    <span class="cm">// console.log(y);  ‚ùå outer CANNOT see inner's y</span>
}

<span class="fn">outer</span>();</div>
        <button class="run-btn" onclick="runDemo('func3')">‚ñ∂ Run</button>
        <div class="output" id="out-func3"></div>
    </div>

    <div class="quiz-box" id="q-func1">
        <div class="quiz-q"><span class="qn">Quiz:</span> What's the output?
            <div class="code-block"><span class="kw">const</span> <span class="vr">x</span> = <span class="nm">1</span>;
<span class="kw">function</span> <span class="fn">foo</span>() {
    <span class="kw">const</span> <span class="vr">x</span> = <span class="nm">2</span>;
    console.log(<span class="vr">x</span>);
}
<span class="fn">foo</span>();
console.log(<span class="vr">x</span>);</div>
        </div>
        <div class="quiz-opts">
            <div class="quiz-opt" onclick="quiz('q-func1',this,false)">2, 2</div>
            <div class="quiz-opt" onclick="quiz('q-func1',this,true)">2, 1</div>
            <div class="quiz-opt" onclick="quiz('q-func1',this,false)">1, 1</div>
            <div class="quiz-opt" onclick="quiz('q-func1',this,false)">Error</div>
        </div>
        <div class="quiz-exp ok-exp" id="q-func1-ok">‚úÖ Inside <code>foo()</code>, the local <code>const x = 2</code> shadows the global <code>x = 1</code>. But the global <code>x</code> is untouched, so the second log prints 1. Two DIFFERENT variables with the same name!</div>
        <div class="quiz-exp bad-exp" id="q-func1-bad">‚ùå Answer: <strong>2, 1</strong>. The <code>const x = 2</code> inside is a NEW variable. The global <code>x = 1</code> remains unchanged.</div>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('global')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('block')">Next: Block Scope ‚Üí</button>
    </div>
</div>

<!-- ========== BLOCK SCOPE ========== -->
<div class="section" id="s-block">
    <h1>üß± Block Scope</h1>
    <p class="subtitle">The finest level of control ‚Äî thanks to let and const</p>

    <div class="card">
        <h3>üìñ What's a "Block"?</h3>
        <p>Anything between <span class="inline-code">{ }</span>:</p>
        <ul>
            <li><span class="inline-code">if / else { }</span></li>
            <li><span class="inline-code">for ( ) { }</span></li>
            <li><span class="inline-code">while ( ) { }</span></li>
            <li><span class="inline-code">switch { }</span></li>
            <li>Even standalone <span class="inline-code">{ }</span></li>
        </ul>
        <p>Variables declared with <span class="inline-code">let</span> or <span class="inline-code">const</span> inside a block <strong>stay inside that block</strong>.</p>
    </div>

    <div class="card">
        <h3>üîí Block Scope in Action</h3>
        <div class="code-block"><span class="kw">if</span> (<span class="kw">true</span>) {
    <span class="kw">const</span> <span class="vr">secret</span> = <span class="st">"only here"</span>;
    <span class="kw">let</span> <span class="vr">temp</span> = <span class="nm">42</span>;
    console.log(<span class="vr">secret</span>); <span class="cm">// ‚úÖ "only here"</span>
    console.log(<span class="vr">temp</span>);   <span class="cm">// ‚úÖ 42</span>
}

<span class="cm">// console.log(secret); ‚ùå ReferenceError!</span>
<span class="cm">// console.log(temp);   ‚ùå ReferenceError!</span></div>
        <button class="run-btn" onclick="runDemo('block1')">‚ñ∂ Run</button>
        <div class="output" id="out-block1"></div>
    </div>

    <div class="card">
        <h3>üîÑ Block Scope in Loops ‚Äî This is HUGE</h3>
        <p>Each iteration of a <span class="inline-code">for</span> loop with <span class="inline-code">let</span> creates a <strong>fresh variable</strong>:</p>
        <div class="code-block"><span class="kw">for</span> (<span class="kw">let</span> <span class="vr">i</span> = <span class="nm">0</span>; <span class="vr">i</span> &lt; <span class="nm">3</span>; <span class="vr">i</span>++) {
    setTimeout(() => {
        console.log(<span class="st">"i ="</span>, <span class="vr">i</span>);
    }, <span class="nm">100</span>);
}
<span class="cm">// Output: 0, 1, 2 ‚úÖ</span>
<span class="cm">// Each iteration gets its OWN copy of 'i'</span></div>
        <button class="run-btn" onclick="runDemo('block2')">‚ñ∂ Run</button>
        <div class="output" id="out-block2"></div>
    </div>

    <div class="real-world">
        <h4>üåê Real-World: Temporary Variables</h4>
        <p>Block scope is perfect for variables you only need briefly:</p>
        <div class="code-block"><span class="kw">function</span> <span class="fn">processUsers</span>(<span class="vr">users</span>) {
    <span class="kw">const</span> <span class="vr">results</span> = [];

    <span class="kw">for</span> (<span class="kw">const</span> <span class="vr">user</span> <span class="kw">of</span> <span class="vr">users</span>) {
        <span class="cm">// 'formatted' only exists inside this loop body</span>
        <span class="kw">const</span> <span class="vr">formatted</span> = <span class="vr">user</span>.name.toUpperCase();
        <span class="vr">results</span>.push(<span class="vr">formatted</span>);
    }

    <span class="cm">// 'formatted' and 'user' don't leak out here ‚úÖ</span>
    <span class="kw">return</span> <span class="vr">results</span>;
}</div>
    </div>

    <div class="quiz-box" id="q-block1">
        <div class="quiz-q"><span class="qn">Quiz:</span> What does this output?
            <div class="code-block"><span class="kw">let</span> <span class="vr">x</span> = <span class="nm">10</span>;
<span class="kw">if</span> (<span class="kw">true</span>) {
    <span class="kw">let</span> <span class="vr">x</span> = <span class="nm">20</span>;
}
console.log(<span class="vr">x</span>);</div>
        </div>
        <div class="quiz-opts">
            <div class="quiz-opt" onclick="quiz('q-block1',this,true)">10</div>
            <div class="quiz-opt" onclick="quiz('q-block1',this,false)">20</div>
            <div class="quiz-opt" onclick="quiz('q-block1',this,false)">undefined</div>
            <div class="quiz-opt" onclick="quiz('q-block1',this,false)">ReferenceError</div>
        </div>
        <div class="quiz-exp ok-exp" id="q-block1-ok">‚úÖ The <code>let x = 20</code> inside the block is a BRAND NEW variable. It shadows the outer <code>x</code> inside the block but never touches it. Once the block ends, the inner <code>x</code> is gone and the outer <code>x = 10</code> is what prints.</div>
        <div class="quiz-exp bad-exp" id="q-block1-bad">‚ùå Answer: <strong>10</strong>. The <code>let x = 20</code> inside the block creates a brand new, separate variable. The outer <code>x = 10</code> is untouched.</div>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('function')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('legacy')">Next: Why var is Dangerous ‚Üí</button>
    </div>
</div>

<!-- ========== LEGACY VAR ========== -->
<div class="section" id="s-legacy">
    <h1>üíÄ Why <code>var</code> is Dangerous</h1>
    <p class="subtitle">Understanding legacy code ‚Äî and why you must never write new code with var</p>

    <div class="rule-banner" style="background:linear-gradient(135deg,#e74c3c,#c0392b);">
        üö® NEVER use <code>var</code> in new code. This section exists ONLY so you<br>
        understand old code and interview questions.
    </div>

    <div class="card">
        <h3>üìä The Problem: var vs let/const</h3>
        <table class="comparison-table">
            <tr>
                <th>Behavior</th>
                <th style="color:#e74c3c"><s>var</s> üíÄ</th>
                <th style="color:#6c5ce7">let ‚úÖ</th>
                <th style="color:#00b894">const ‚≠ê</th>
            </tr>
            <tr>
                <td>Scope</td>
                <td><span class="no">Function only</span> (ignores blocks!)</td>
                <td><span class="yes">Block</span></td>
                <td><span class="yes">Block</span></td>
            </tr>
            <tr>
                <td>Respects if/for { } ?</td>
                <td><span class="no">‚ùå NO ‚Äî leaks out!</span></td>
                <td><span class="yes">‚úÖ YES</span></td>
                <td><span class="yes">‚úÖ YES</span></td>
            </tr>
            <tr>
                <td>Can redeclare?</td>
                <td><span class="no">Yes (silent bugs!)</span></td>
                <td><span class="yes">No (error = safe)</span></td>
                <td><span class="yes">No (error = safe)</span></td>
            </tr>
            <tr>
                <td>Hoisting behavior</td>
                <td><span class="no">Hoisted as undefined</span></td>
                <td><span class="yes">TDZ ‚Äî error if used early</span></td>
                <td><span class="yes">TDZ ‚Äî error if used early</span></td>
            </tr>
            <tr>
                <td>Can reassign?</td>
                <td>Yes</td>
                <td>Yes</td>
                <td><span class="yes">No (safer!)</span></td>
            </tr>
            <tr>
                <td>Pollutes window?</td>
                <td><span class="no">Yes (if global)</span></td>
                <td><span class="yes">No</span></td>
                <td><span class="yes">No</span></td>
            </tr>
        </table>
    </div>

    <div class="legacy-box">
        <h4>Bug 1: var Leaks Out of Blocks</h4>
        <div class="code-block"><span class="cm">// ‚ùå var IGNORES block scope ‚Äî leaks everywhere</span>
<span class="kw">if</span> (<span class="kw">true</span>) {
    <span class="err"><span class="kw">var</span> <span class="vr">leaked</span> = <span class="st">"I escaped! üíß"</span>;</span>
    <span class="kw">let</span> <span class="vr">contained</span> = <span class="st">"I stayed inside üîí"</span>;
}

console.log(<span class="vr">leaked</span>);    <span class="cm">// "I escaped! üíß"  ‚Üê BAD!</span>
<span class="cm">// console.log(contained); ‚ùå ReferenceError  ‚Üê GOOD!</span></div>
        <button class="run-btn" onclick="runDemo('legacy1')">‚ñ∂ See the Bug</button>
        <div class="output" id="out-legacy1"></div>
    </div>

    <div class="legacy-box">
        <h4>Bug 2: The Famous Loop Bug (Interview Classic!)</h4>
        <div class="code-block"><span class="cm">// ‚ùå With var ‚Äî all callbacks see the SAME 'i'</span>
<span class="kw">for</span> (<span class="err"><span class="kw">var</span> <span class="vr">i</span> = <span class="nm">0</span></span>; <span class="vr">i</span> &lt; <span class="nm">3</span>; <span class="vr">i</span>++) {
    setTimeout(() => console.log(<span class="st">"var:"</span>, <span class="vr">i</span>), <span class="nm">100</span>);
}
<span class="cm">// Prints: 3, 3, 3  üò±</span>

<span class="cm">// ‚úÖ With let ‚Äî each iteration gets its OWN 'i'</span>
<span class="kw">for</span> (<span class="ok"><span class="kw">let</span> <span class="vr">j</span> = <span class="nm">0</span></span>; <span class="vr">j</span> &lt; <span class="nm">3</span>; <span class="vr">j</span>++) {
    setTimeout(() => console.log(<span class="st">"let:"</span>, <span class="vr">j</span>), <span class="nm">200</span>);
}
<span class="cm">// Prints: 0, 1, 2  ‚úÖ</span></div>
        <button class="run-btn" onclick="runDemo('legacy2')">‚ñ∂ See the Difference</button>
        <div class="output" id="out-legacy2"></div>
    </div>

    <div class="legacy-box">
        <h4>Bug 3: Silent Redeclaration</h4>
        <div class="code-block"><span class="cm">// ‚ùå var lets you redeclare ‚Äî hides bugs!</span>
<span class="err"><span class="kw">var</span> <span class="vr">user</span> = <span class="st">"Alice"</span>;</span>
<span class="cm">// ... 200 lines of code later ...</span>
<span class="err"><span class="kw">var</span> <span class="vr">user</span> = <span class="st">"Bob"</span>;</span>   <span class="cm">// No error! Alice is silently overwritten üò±</span>

<span class="cm">// ‚úÖ let/const catch this mistake</span>
<span class="kw">let</span> <span class="vr">name1</span> = <span class="st">"Alice"</span>;
<span class="cm">// let name1 = "Bob"; ‚ùå SyntaxError! Already declared ‚úÖ (good error!)</span></div>
    </div>

    <div class="tip">
        <h4>üí° The Modern Rule</h4>
        <p style="font-size:1.1em"><strong>const</strong> by default ‚Üí <strong>let</strong> when you need to reassign ‚Üí <strong class="strike">var</strong> never</p>
        <br>
        <p>Add <span class="inline-code">"use strict";</span> at the top of your files. It catches accidental globals and other <code>var</code>-era bugs.</p>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('block')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('chain')">Next: Scope Chain ‚Üí</button>
    </div>
</div>

<!-- ========== SCOPE CHAIN ========== -->
<div class="section" id="s-chain">
    <h1>üîó Scope Chain & Variable Lookup</h1>
    <p class="subtitle">How JavaScript finds your variables ‚Äî the search process</p>

    <div class="analogy">
        <div class="icon">üîç</div>
        <h4>The Lost Keys Search</h4>
        <p>Lost your keys? Check your <strong>pockets</strong> (current scope) ‚Üí <strong>desk</strong> (parent scope) ‚Üí <strong>kitchen table</strong> (grandparent scope) ‚Üí <strong>front door hook</strong> (global). Not found anywhere? Panic! (ReferenceError)</p>
    </div>

    <div class="card">
        <h3>üéÆ Watch the Chain in Action</h3>
        <div class="code-block"><span class="kw">const</span> <span class="vr">planet</span> = <span class="st">"Earth"</span>;             <span class="cm">// üåç Global</span>

<span class="kw">function</span> <span class="fn">country</span>() {
    <span class="kw">const</span> <span class="vr">countryName</span> = <span class="st">"Japan"</span>;      <span class="cm">// üì¶ Level 1</span>

    <span class="kw">function</span> <span class="fn">city</span>() {
        <span class="kw">const</span> <span class="vr">cityName</span> = <span class="st">"Tokyo"</span>;     <span class="cm">// üì¶ Level 2</span>

        <span class="kw">function</span> <span class="fn">street</span>() {
            <span class="kw">const</span> <span class="vr">streetName</span> = <span class="st">"Shibuya"</span>; <span class="cm">// üì¶ Level 3</span>

            <span class="cm">// JS searches: street ‚Üí city ‚Üí country ‚Üí global</span>
            console.log(<span class="st">`üìç ${streetName}, ${cityName}, ${countryName}, ${planet}`</span>);
        }
        <span class="fn">street</span>();
    }
    <span class="fn">city</span>();
}
<span class="fn">country</span>();</div>
        <button class="run-btn" onclick="runDemo('chain1')">‚ñ∂ Run</button>
        <div class="output" id="out-chain1"></div>
    </div>

    <div class="card">
        <h3>üé≠ Variable Shadowing</h3>
        <p>When an inner scope declares the same name, it <strong>shadows</strong> (hides) the outer one:</p>
        <div class="code-block"><span class="kw">const</span> <span class="vr">color</span> = <span class="st">"red"</span>;

<span class="kw">function</span> <span class="fn">paint</span>() {
    <span class="kw">const</span> <span class="vr">color</span> = <span class="st">"blue"</span>;  <span class="cm">// Shadows outer 'color'</span>
    console.log(color);     <span class="cm">// "blue" ‚Üê finds it in current scope, stops</span>
}

<span class="fn">paint</span>();
console.log(<span class="vr">color</span>);  <span class="cm">// "red" ‚Üê outer was never touched</span></div>
        <button class="run-btn" onclick="runDemo('chain2')">‚ñ∂ Run</button>
        <div class="output" id="out-chain2"></div>
    </div>

    <div class="warning">
        <h4>‚ö†Ô∏è Shadowing Can Confuse</h4>
        <p>Shadowing is valid but makes code harder to read. Prefer unique names when possible!</p>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('legacy')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('hoisting')">Next: Hoisting & TDZ ‚Üí</button>
    </div>
</div>

<!-- ========== HOISTING ========== -->
<div class="section" id="s-hoisting">
    <h1>üèóÔ∏è Hoisting & the Temporal Dead Zone</h1>
    <p class="subtitle">What happens before your code runs</p>

    <div class="analogy">
        <div class="icon">üèóÔ∏è</div>
        <h4>Construction Site</h4>
        <p>Before a building opens, the architect reserves space. With <strong>let/const</strong>, the space has "DO NOT ENTER" tape (TDZ) until construction reaches that floor. This <strong>protects you</strong> from using variables before they're ready.</p>
    </div>

    <div class="card">
        <h3>üìñ How let/const Hoisting Works (TDZ)</h3>
        <p><span class="inline-code">let</span> and <span class="inline-code">const</span> are hoisted BUT placed in a <strong>Temporal Dead Zone</strong> until their declaration line. Accessing them early throws an error ‚Äî <em>which is exactly what you want!</em></p>
        <div class="code-block"><span class="cm">// ‚ùå This CORRECTLY throws an error ‚Äî protecting you!</span>
<span class="err">console.log(<span class="vr">myName</span>);  <span class="cm">// üí• ReferenceError: Cannot access before init</span></span>
<span class="kw">const</span> <span class="vr">myName</span> = <span class="st">"Alice"</span>;

<span class="cm">// ‚úÖ Declare first, then use:</span>
<span class="kw">const</span> <span class="vr">myAge</span> = <span class="nm">25</span>;
console.log(<span class="vr">myAge</span>);  <span class="cm">// 25 ‚úÖ</span></div>
        <button class="run-btn" onclick="runDemo('hoist1')">‚ñ∂ Run</button>
        <div class="output" id="out-hoist1"></div>
    </div>

    <div class="card">
        <h3>üìã TDZ Visualized</h3>
        <div class="scope-visual">
            <div class="scope-box block">
                <span class="scope-lbl block">Block Scope</span>
                <div style="background:rgba(231,76,60,0.12);padding:10px;border-radius:6px;margin:5px 0;border-left:3px solid #e74c3c;">
                    <span style="color:#e74c3c;font-weight:bold;">‚ò†Ô∏è TEMPORAL DEAD ZONE</span><br>
                    <code style="color:#888;">// x exists but CANNOT be used yet</code><br>
                    <code style="color:#888;">console.log(x); // üí• ReferenceError!</code>
                </div>
                <div style="background:rgba(0,184,148,0.12);padding:10px;border-radius:6px;margin:5px 0;border-left:3px solid #00b894;">
                    <span style="color:#00b894;font-weight:bold;">‚úÖ SAFE ZONE</span><br>
                    <code>const x = 42; // ‚Üê TDZ ends here</code><br>
                    <code>console.log(x); // ‚úÖ 42</code>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>üèóÔ∏è Function Declaration Hoisting</h3>
        <p>Function <em>declarations</em> are fully hoisted ‚Äî you can call them before their line. Arrow functions and function expressions are NOT.</p>
        <div class="code-block"><span class="cm">// ‚úÖ Function declaration ‚Äî fully hoisted</span>
<span class="fn">sayHello</span>();  <span class="cm">// ‚úÖ Works!</span>

<span class="kw">function</span> <span class="fn">sayHello</span>() {
    console.log(<span class="st">"Hello!"</span>);
}

<span class="cm">// ‚ùå Arrow function ‚Äî NOT hoisted (const is in TDZ)</span>
<span class="cm">// greet();  üí• ReferenceError!</span>
<span class="kw">const</span> <span class="vr">greet</span> = () => console.log(<span class="st">"Hi!"</span>);</div>
        <button class="run-btn" onclick="runDemo('hoist2')">‚ñ∂ Run</button>
        <div class="output" id="out-hoist2"></div>
    </div>

    <div class="tip">
        <h4>üí° Simple Rule</h4>
        <p><strong>Always declare variables at the TOP of their scope.</strong> Then hoisting becomes irrelevant.</p>
    </div>

    <div class="quiz-box" id="q-hoist1">
        <div class="quiz-q"><span class="qn">Quiz:</span> What happens?
            <div class="code-block">console.log(<span class="vr">a</span>);
<span class="kw">let</span> <span class="vr">a</span> = <span class="nm">5</span>;</div>
        </div>
        <div class="quiz-opts">
            <div class="quiz-opt" onclick="quiz('q-hoist1',this,false)">undefined</div>
            <div class="quiz-opt" onclick="quiz('q-hoist1',this,false)">5</div>
            <div class="quiz-opt" onclick="quiz('q-hoist1',this,true)">ReferenceError</div>
            <div class="quiz-opt" onclick="quiz('q-hoist1',this,false)">null</div>
        </div>
        <div class="quiz-exp ok-exp" id="q-hoist1-ok">‚úÖ Correct! <code>let</code> is in the Temporal Dead Zone until its declaration. Accessing it early correctly throws a ReferenceError. This is a FEATURE ‚Äî it catches bugs that <code>var</code> would silently hide.</div>
        <div class="quiz-exp bad-exp" id="q-hoist1-bad">‚ùå Answer: <strong>ReferenceError</strong>. <code>let</code> exists in the TDZ until its declaration line. Accessing it early throws an error (unlike <code>var</code> which would give a misleading <code>undefined</code>).</div>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('chain')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('closures')">Next: Closures ‚Üí</button>
    </div>
</div>

<!-- ========== CLOSURES ========== -->
<div class="section" id="s-closures">
    <h1>üîí Closures</h1>
    <p class="subtitle">The most powerful pattern that emerges from scope</p>

    <div class="analogy">
        <div class="icon">üì∏üéí</div>
        <h4>The Snapshot Backpack</h4>
        <p>You take a photo inside a room and put it in your backpack. Even after leaving the room, you still <em>remember</em> what was there. A <strong>closure</strong> is a function that remembers variables from where it was created, even after that scope is gone.</p>
    </div>

    <div class="card">
        <h3>üìñ Closure = Function + Its Outer Variables</h3>
        <div class="code-block"><span class="kw">function</span> <span class="fn">createGreeter</span>(<span class="vr">greeting</span>) {
    <span class="cm">// 'greeting' lives in createGreeter's scope</span>

    <span class="kw">return</span> <span class="kw">function</span>(<span class="vr">name</span>) {
        <span class="cm">// This inner function "closes over" greeting</span>
        console.log(<span class="st">`${greeting}, ${name}!`</span>);
    };
}

<span class="kw">const</span> <span class="vr">hi</span> = <span class="fn">createGreeter</span>(<span class="st">"Hello"</span>);
<span class="kw">const</span> <span class="vr">hola</span> = <span class="fn">createGreeter</span>(<span class="st">"Hola"</span>);

<span class="vr">hi</span>(<span class="st">"Alice"</span>);    <span class="cm">// "Hello, Alice!"  ‚Äî remembers "Hello"</span>
<span class="vr">hola</span>(<span class="st">"Bob"</span>);    <span class="cm">// "Hola, Bob!"     ‚Äî remembers "Hola"</span></div>
        <button class="run-btn" onclick="runDemo('closure1')">‚ñ∂ Run</button>
        <div class="output" id="out-closure1"></div>
    </div>

    <div class="card">
        <h3>üßÆ Real Use: Counter That Remembers!</h3>
        <p>Remember how a function's <code>count</code> kept resetting? Closures fix that:</p>
        <div class="code-block"><span class="kw">function</span> <span class="fn">createCounter</span>() {
    <span class="kw">let</span> <span class="vr">count</span> = <span class="nm">0</span>;  <span class="cm">// üîí Private, persists via closure</span>

    <span class="kw">return</span> {
        <span class="fn">increment</span>() { <span class="kw">return</span> ++<span class="vr">count</span>; },
        <span class="fn">decrement</span>() { <span class="kw">return</span> --<span class="vr">count</span>; },
        <span class="fn">value</span>()     { <span class="kw">return</span> <span class="vr">count</span>; }
    };
}

<span class="kw">const</span> <span class="vr">counter</span> = <span class="fn">createCounter</span>();
console.log(<span class="vr">counter</span>.<span class="fn">increment</span>()); <span class="cm">// 1</span>
console.log(<span class="vr">counter</span>.<span class="fn">increment</span>()); <span class="cm">// 2</span>
console.log(<span class="vr">counter</span>.<span class="fn">increment</span>()); <span class="cm">// 3</span>
console.log(<span class="vr">counter</span>.<span class="fn">decrement</span>()); <span class="cm">// 2</span>
<span class="cm">// console.log(count);  ‚ùå Private!</span></div>
        <button class="run-btn" onclick="runDemo('closure2')">‚ñ∂ Run</button>
        <div class="output" id="out-closure2"></div>
    </div>

    <div class="card">
        <h3>üõí Real Use: Shopping Cart</h3>
        <div class="code-block"><span class="kw">function</span> <span class="fn">createCart</span>() {
    <span class="kw">const</span> <span class="vr">items</span> = [];  <span class="cm">// üîí Private via closure</span>

    <span class="kw">return</span> {
        <span class="fn">add</span>(<span class="vr">name</span>, <span class="vr">price</span>) {
            <span class="vr">items</span>.push({ <span class="vr">name</span>, <span class="vr">price</span> });
            console.log(<span class="st">`‚ûï ${name} ($${price})`</span>);
        },
        <span class="fn">total</span>() {
            <span class="kw">return</span> <span class="vr">items</span>.reduce((<span class="vr">sum</span>, <span class="vr">i</span>) => <span class="vr">sum</span> + <span class="vr">i</span>.price, <span class="nm">0</span>);
        },
        <span class="fn">show</span>() {
            console.log(<span class="st">"üõí"</span>, <span class="vr">items</span>.map(<span class="vr">i</span> => <span class="vr">i</span>.name).join(<span class="st">", "</span>));
            console.log(<span class="st">`üí∞ Total: $${<span class="kw">this</span>.total()}`</span>);
        }
    };
}

<span class="kw">const</span> <span class="vr">cart</span> = <span class="fn">createCart</span>();
<span class="vr">cart</span>.<span class="fn">add</span>(<span class="st">"Laptop"</span>, <span class="nm">999</span>);
<span class="vr">cart</span>.<span class="fn">add</span>(<span class="st">"Mouse"</span>, <span class="nm">29</span>);
<span class="vr">cart</span>.<span class="fn">show</span>();</div>
        <button class="run-btn" onclick="runDemo('closure3')">‚ñ∂ Run</button>
        <div class="output" id="out-closure3"></div>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('hoisting')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('realworld')">Next: Real-World Patterns ‚Üí</button>
    </div>
</div>

<!-- ========== REAL WORLD ========== -->
<div class="section" id="s-realworld">
    <h1>üåê Real-World Patterns</h1>
    <p class="subtitle">Scope patterns you'll use in actual projects</p>

    <div class="real-world">
        <h4>üåê Pattern 1: Module Pattern (Private State)</h4>
        <div class="code-block"><span class="kw">const</span> <span class="vr">AuthModule</span> = (() => {
    <span class="kw">let</span> <span class="vr">currentUser</span> = <span class="kw">null</span>;     <span class="cm">// üîí Private</span>
    <span class="kw">let</span> <span class="vr">token</span> = <span class="kw">null</span>;            <span class="cm">// üîí Private</span>
    <span class="kw">let</span> <span class="vr">attempts</span> = <span class="nm">0</span>;            <span class="cm">// üîí Private</span>
    <span class="kw">const</span> <span class="vr">MAX</span> = <span class="nm">3</span>;               <span class="cm">// üîí Private</span>

    <span class="kw">return</span> {
        <span class="fn">login</span>(<span class="vr">user</span>, <span class="vr">pass</span>) {
            <span class="kw">if</span> (<span class="vr">attempts</span> >= <span class="vr">MAX</span>) <span class="kw">return</span> <span class="st">"Locked!"</span>;
            <span class="kw">if</span> (<span class="vr">pass</span>.length >= <span class="nm">8</span>) {
                <span class="vr">currentUser</span> = <span class="vr">user</span>;
                <span class="vr">token</span> = <span class="st">"jwt_"</span> + Math.random().toString(<span class="nm">36</span>).slice(<span class="nm">2</span>);
                <span class="vr">attempts</span> = <span class="nm">0</span>;
                <span class="kw">return</span> <span class="st">`Welcome, ${user}!`</span>;
            }
            <span class="vr">attempts</span>++;
            <span class="kw">return</span> <span class="st">`Failed. ${MAX - attempts} left.`</span>;
        },
        <span class="fn">isLoggedIn</span>() { <span class="kw">return</span> <span class="vr">currentUser</span> !== <span class="kw">null</span>; },
        <span class="fn">logout</span>() { <span class="vr">currentUser</span> = <span class="vr">token</span> = <span class="kw">null</span>; <span class="kw">return</span> <span class="st">"Bye!"</span>; }
    };
})();

console.log(<span class="vr">AuthModule</span>.<span class="fn">login</span>(<span class="st">"alice"</span>, <span class="st">"short"</span>));
console.log(<span class="vr">AuthModule</span>.<span class="fn">login</span>(<span class="st">"alice"</span>, <span class="st">"longpassword"</span>));
console.log(<span class="vr">AuthModule</span>.<span class="fn">isLoggedIn</span>());
<span class="cm">// AuthModule.token ‚Üí undefined (private!) ‚úÖ</span></div>
        <button class="run-btn" onclick="runDemo('rw1')">‚ñ∂ Run</button>
        <div class="output" id="out-rw1"></div>
    </div>

    <div class="real-world">
        <h4>üåê Pattern 2: Memoization (Caching)</h4>
        <div class="code-block"><span class="kw">function</span> <span class="fn">memoize</span>(<span class="vr">fn</span>) {
    <span class="kw">const</span> <span class="vr">cache</span> = <span class="kw">new</span> Map();  <span class="cm">// üîí Private cache</span>

    <span class="kw">return</span> <span class="kw">function</span>(...<span class="vr">args</span>) {
        <span class="kw">const</span> <span class="vr">key</span> = JSON.stringify(<span class="vr">args</span>);
        <span class="kw">if</span> (<span class="vr">cache</span>.has(<span class="vr">key</span>)) {
            console.log(<span class="st">`‚ö° Cache hit: ${key}`</span>);
            <span class="kw">return</span> <span class="vr">cache</span>.get(<span class="vr">key</span>);
        }
        console.log(<span class="st">`üîÑ Computing: ${key}`</span>);
        <span class="kw">const</span> <span class="vr">result</span> = <span class="vr">fn</span>(...<span class="vr">args</span>);
        <span class="vr">cache</span>.set(<span class="vr">key</span>, <span class="vr">result</span>);
        <span class="kw">return</span> <span class="vr">result</span>;
    };
}

<span class="kw">const</span> <span class="vr">square</span> = <span class="fn">memoize</span>(<span class="vr">n</span> => <span class="vr">n</span> * <span class="vr">n</span>);
console.log(<span class="vr">square</span>(<span class="nm">5</span>));  <span class="cm">// Computing... 25</span>
console.log(<span class="vr">square</span>(<span class="nm">5</span>));  <span class="cm">// Cache hit! 25</span>
console.log(<span class="vr">square</span>(<span class="nm">9</span>));  <span class="cm">// Computing... 81</span></div>
        <button class="run-btn" onclick="runDemo('rw2')">‚ñ∂ Run</button>
        <div class="output" id="out-rw2"></div>
    </div>

    <div class="real-world">
        <h4>üåê Pattern 3: Rate Limiter</h4>
        <div class="code-block"><span class="kw">function</span> <span class="fn">createRateLimiter</span>(<span class="vr">maxCalls</span>, <span class="vr">windowMs</span>) {
    <span class="kw">let</span> <span class="vr">calls</span> = [];  <span class="cm">// üîí Private</span>

    <span class="kw">return</span> <span class="kw">function</span>(<span class="vr">action</span>) {
        <span class="kw">const</span> <span class="vr">now</span> = Date.now();
        <span class="vr">calls</span> = <span class="vr">calls</span>.filter(<span class="vr">t</span> => <span class="vr">now</span> - <span class="vr">t</span> < <span class="vr">windowMs</span>);

        <span class="kw">if</span> (<span class="vr">calls</span>.length < <span class="vr">maxCalls</span>) {
            <span class="vr">calls</span>.push(<span class="vr">now</span>);
            console.log(<span class="st">`‚úÖ Allowed (${calls.length}/${maxCalls})`</span>);
            <span class="kw">return</span> <span class="vr">action</span>();
        }
        console.log(<span class="st">`‚ùå Rate limited!`</span>);
    };
}

<span class="kw">const</span> <span class="vr">limited</span> = <span class="fn">createRateLimiter</span>(<span class="nm">3</span>, <span class="nm">5000</span>);
<span class="vr">limited</span>(() => <span class="st">"req1"</span>);
<span class="vr">limited</span>(() => <span class="st">"req2"</span>);
<span class="vr">limited</span>(() => <span class="st">"req3"</span>);
<span class="vr">limited</span>(() => <span class="st">"req4"</span>); <span class="cm">// blocked!</span></div>
        <button class="run-btn" onclick="runDemo('rw3')">‚ñ∂ Run</button>
        <div class="output" id="out-rw3"></div>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('closures')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('pitfalls')">Next: Pitfalls & Fixes ‚Üí</button>
    </div>
</div>

<!-- ========== PITFALLS ========== -->
<div class="section" id="s-pitfalls">
    <h1>üí£ Common Pitfalls & Fixes</h1>
    <p class="subtitle">Mistakes that catch every developer ‚Äî and how to avoid them</p>

    <div class="pitfall">
        <h4>üíÄ Pitfall 1: Forgetting let/const = Accidental Global</h4>
        <div class="code-block"><span class="cm">// ‚ùå BAD</span>
<span class="kw">function</span> <span class="fn">calculate</span>() {
    <span class="err"><span class="vr">total</span> = <span class="nm">100</span>;</span>  <span class="cm">// üò± No keyword = GLOBAL leak!</span>
}
<span class="fn">calculate</span>();
console.log(<span class="vr">total</span>);  <span class="cm">// 100 ‚Äî leaked! üíß</span>

<span class="cm">// ‚úÖ FIX: Always use const or let</span>
<span class="kw">function</span> <span class="fn">calculateFixed</span>() {
    <span class="ok"><span class="kw">const</span> <span class="vr">total</span> = <span class="nm">100</span>;</span>  <span class="cm">// ‚úÖ Safely scoped</span>
}

<span class="cm">// ‚úÖ FIX 2: Add "use strict" to catch this</span>
<span class="cm">// "use strict";  ‚Üê will throw ReferenceError on line 3</span></div>
    </div>

    <div class="pitfall">
        <h4>üíÄ Pitfall 2: Shadowing When You Meant to Modify</h4>
        <div class="code-block"><span class="kw">let</span> <span class="vr">user</span> = <span class="st">"Alice"</span>;

<span class="kw">function</span> <span class="fn">updateUser</span>() {
    <span class="err"><span class="kw">let</span> <span class="vr">user</span> = <span class="st">"Bob"</span>;</span>  <span class="cm">// üò± Created NEW variable! Didn't modify outer!</span>
}

<span class="fn">updateUser</span>();
console.log(<span class="vr">user</span>);  <span class="cm">// Still "Alice" üò±</span>

<span class="cm">// ‚úÖ FIX: Remove 'let' to modify the outer variable</span>
<span class="kw">function</span> <span class="fn">updateUserFixed</span>() {
    <span class="ok"><span class="vr">user</span> = <span class="st">"Bob"</span>;</span>  <span class="cm">// ‚úÖ No 'let' = modifies outer</span>
}</div>
        <button class="run-btn" onclick="runDemo('pit2')">‚ñ∂ See the Bug</button>
        <div class="output" id="out-pit2"></div>
    </div>

    <div class="pitfall">
        <h4>üíÄ Pitfall 3: const Doesn't Mean Immutable Object</h4>
        <div class="code-block"><span class="kw">const</span> <span class="vr">person</span> = { name: <span class="st">"Alice"</span> };

<span class="vr">person</span>.name = <span class="st">"Bob"</span>;        <span class="cm">// ‚úÖ Works! Changed property, not reference</span>
<span class="vr">person</span>.age = <span class="nm">30</span>;            <span class="cm">// ‚úÖ Works! Added property</span>
<span class="cm">// person = { name: "X" };  ‚ùå TypeError! Can't reassign const variable</span>

<span class="cm">// For true immutability: Object.freeze()</span>
<span class="kw">const</span> <span class="vr">frozen</span> = Object.freeze({ x: <span class="nm">1</span> });
<span class="vr">frozen</span>.x = <span class="nm">99</span>;  <span class="cm">// Silently fails (or error in strict mode)</span>
console.log(<span class="vr">frozen</span>.x); <span class="cm">// Still 1</span></div>
        <button class="run-btn" onclick="runDemo('pit3')">‚ñ∂ Run</button>
        <div class="output" id="out-pit3"></div>
    </div>

    <div class="tip">
        <h4>üõ°Ô∏è The Safety Checklist</h4>
        <ol>
            <li>‚úÖ Add <span class="inline-code">"use strict";</span> at the top of every file</li>
            <li>‚úÖ Default to <span class="inline-code">const</span></li>
            <li>‚úÖ Use <span class="inline-code">let</span> only when you need to reassign</li>
            <li>‚úÖ <strong>Never</strong> use <span class="inline-code strike">var</span></li>
            <li>‚úÖ Declare variables at the top of their scope</li>
            <li>‚úÖ Keep globals to an absolute minimum</li>
            <li>‚úÖ Use ESLint's <code>no-var</code> and <code>prefer-const</code> rules</li>
        </ol>
    </div>

    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('realworld')">‚Üê Previous</button>
        <button class="nav-btn next" onclick="go('quiz')">Next: Final Quiz üèÜ ‚Üí</button>
    </div>
</div>

<!-- ========== FINAL QUIZ ========== -->
<div class="section" id="s-quiz">
    <h1>üèÜ Final Quiz</h1>
    <p class="subtitle">10 questions ‚Äî test everything you've learned!</p>
    <div id="quiz-area"></div>
    <div id="quiz-results" class="hidden"></div>
    <div class="nav-buttons">
        <button class="nav-btn prev" onclick="go('pitfalls')">‚Üê Previous</button>
        <button class="nav-btn next" disabled>üéâ Guide Complete!</button>
    </div>
</div>

</main>

<script>
// ========== NAV ==========
let cur = 'intro';
const done = new Set();
const secs = ['intro','why','global','function','block','legacy','chain','hoisting','closures','realworld','pitfalls','quiz'];

function go(id) {
    done.add(cur);
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    const el = document.getElementById('s-' + id);
    if (el) { el.classList.add('active'); cur = id; }
    document.querySelectorAll('.nav-item').forEach(n => {
        n.classList.remove('active');
        if (n.dataset.s === id) n.classList.add('active');
        if (done.has(n.dataset.s)) n.classList.add('completed');
    });
    document.getElementById('progressFill').style.width = (done.size / secs.length * 100) + '%';
    document.getElementById('progressText').textContent = `${done.size} / ${secs.length} completed`;
    window.scrollTo(0, 0);
    if (id === 'quiz' && !quizBuilt) buildQuiz();
}

// ========== OUTPUT ==========
function out(id, txt, cls = 'ok') {
    document.getElementById('out-' + id).innerHTML += `<span class="out-${cls}">${txt}</span>\n`;
}
function clr(id) { document.getElementById('out-' + id).innerHTML = ''; }

// ========== DEMOS ==========
function runDemo(id) {
    clr(id);
    demos[id]();
}

const demos = {
    intro1() {
        const globalVar = "I'm global! üåç";
        function myFunction() {
            const functionVar = "I'm function-scoped üì¶";
            out('intro1', '‚úÖ globalVar: ' + globalVar);
            out('intro1', '‚úÖ functionVar: ' + functionVar);
            if (true) {
                const blockVar = "I'm block-scoped üß±";
                out('intro1', '‚úÖ blockVar (inside block): ' + blockVar);
                out('intro1', '‚úÖ functionVar (from block): ' + functionVar);
            }
            try { eval('blockVar'); } catch(e) {
                out('intro1', '‚ùå blockVar (outside block): ReferenceError!', 'err');
            }
        }
        myFunction();
        out('intro1', '‚ùå functionVar (outside function): ReferenceError!', 'err');
    },

    why1() {
        function calculateShipping(weight) { const rate = 2.5; return weight * rate; }
        function calculateTax(price) { const rate = 0.08; return price * rate; }
        out('why1', 'Shipping(10): $' + calculateShipping(10));
        out('why1', 'Tax(100): $' + calculateTax(100));
        out('why1', 'üí° Same name "rate", zero conflict!', 'info');
    },

    why2() {
        function createBankAccount(init) {
            let balance = init;
            const pin = "1234";
            return {
                getBalance() { return balance; },
                deposit(a) { if (a > 0) balance += a; },
                withdraw(a, p) { if (p === pin && a <= balance) { balance -= a; return a; } return "Denied!"; }
            };
        }
        const acct = createBankAccount(1000);
        out('why2', 'üí∞ Balance: $' + acct.getBalance());
        acct.deposit(500);
        out('why2', 'üí≥ +$500 ‚Üí $' + acct.getBalance());
        out('why2', 'üîí Wrong PIN: ' + acct.withdraw(200, "wrong"), 'err');
        out('why2', '‚úÖ Right PIN: withdrew $' + acct.withdraw(200, "1234"));
        out('why2', 'üí∞ Balance: $' + acct.getBalance());
        out('why2', 'üîê acct.pin ‚Üí ' + acct.pin + ' (private!)', 'warn');
    },

    global1() {
        const API_URL = "https://api.myapp.com";
        const MAX_RETRIES = 3;
        let currentTheme = "dark";
        function fetchData() {
            out('global1', 'üì° API_URL: ' + API_URL);
            out('global1', 'üîÑ MAX_RETRIES: ' + MAX_RETRIES);
        }
        fetchData();
        if (true) { out('global1', 'üé® Theme: ' + currentTheme); }
        out('global1', '‚úÖ All accessible everywhere', 'info');
    },

    func1() {
        function makeBreakfast() {
            const eggs = 3, toast = 2, coffee = "black";
            out('func1', `‚úÖ Making ${eggs} eggs, ${toast} toast, ${coffee} coffee`);
        }
        makeBreakfast();
        out('func1', '‚ùå eggs outside ‚Üí ReferenceError', 'err');
        out('func1', '‚ùå toast outside ‚Üí ReferenceError', 'err');
    },

    func2() {
        function counter() { let count = 0; count++; return count; }
        out('func2', 'Call 1: ' + counter());
        out('func2', 'Call 2: ' + counter());
        out('func2', 'Call 3: ' + counter());
        out('func2', 'üí° Always 1 ‚Äî each call creates a NEW scope!', 'warn');
    },

    func3() {
        function outer() {
            const x = 10;
            out('func3', 'üì¶ outer: x = ' + x);
            function inner() {
                const y = 20;
                out('func3', '  üì¶ inner: x + y = ' + (x + y) + ' ‚úÖ');
            }
            inner();
            out('func3', 'üì¶ outer: y ‚Üí not accessible ‚ùå', 'err');
        }
        outer();
    },

    block1() {
        if (true) {
            const secret = "only here";
            let temp = 42;
            out('block1', '‚úÖ Inside block: secret = "' + secret + '"');
            out('block1', '‚úÖ Inside block: temp = ' + temp);
        }
        out('block1', '‚ùå Outside block: secret ‚Üí ReferenceError', 'err');
        out('block1', '‚ùå Outside block: temp ‚Üí ReferenceError', 'err');
    },

    block2() {
        out('block2', '‚è≥ Running setTimeout...', 'info');
        for (let i = 0; i < 3; i++) {
            setTimeout(() => { out('block2', '‚úÖ let i = ' + i); }, 100);
        }
    },

    legacy1() {
        if (true) {
            var leaked = "I escaped! üíß";
        }
        out('legacy1', 'üò± var leaked: "' + leaked + '"', 'err');
        out('legacy1', '‚úÖ let/const would give ReferenceError here');
        out('legacy1', '', 'info');
        out('legacy1', 'üí° This is why var is dangerous ‚Äî it ignores blocks!', 'warn');
    },

    legacy2() {
        out('legacy2', '‚è≥ Running... watch carefully', 'info');
        for (var i = 0; i < 3; i++) {
            setTimeout(() => { out('legacy2', '‚ùå var i = ' + i + ' (all same!)', 'err'); }, 100);
        }
        for (let j = 0; j < 3; j++) {
            setTimeout(() => { out('legacy2', '‚úÖ let j = ' + j); }, 250);
        }
    },

    chain1() {
        const planet = "Earth";
        function country() {
            const countryName = "Japan";
            function city() {
                const cityName = "Tokyo";
                function street() {
                    const streetName = "Shibuya";
                    out('chain1', 'üîç streetName ‚Üí current scope ‚úÖ');
                    out('chain1', 'üîç cityName ‚Üí parent scope ‚úÖ');
                    out('chain1', 'üîç countryName ‚Üí grandparent scope ‚úÖ');
                    out('chain1', 'üîç planet ‚Üí global scope ‚úÖ');
                    out('chain1', `üìç ${streetName}, ${cityName}, ${countryName}, ${planet}`, 'info');
                }
                street();
            }
            city();
        }
        country();
    },

    chain2() {
        const color = "red";
        out('chain2', 'üåç Global: color = "' + color + '"');
        function paint() {
            const color = "blue";
            out('chain2', '  üì¶ paint(): color = "' + color + '" (shadows outer)', 'warn');
        }
        paint();
        out('chain2', 'üåç After paint(): color = "' + color + '" (unchanged!)');
    },

    hoist1() {
        out('hoist1', 'üìù console.log(myName) before declaration:', 'info');
        out('hoist1', '  üí• ReferenceError: Cannot access before initialization', 'err');
        out('hoist1', '  (let/const are in the Temporal Dead Zone ‚Äî this is GOOD!)', 'warn');
        out('hoist1', '');
        const myAge = 25;
        out('hoist1', 'üìù After declaration:');
        out('hoist1', '  const myAge = ' + myAge + ' ‚úÖ');
    },

    hoist2() {
        sayHello();
        function sayHello() { out('hoist2', '‚úÖ Function declaration: "Hello!" (fully hoisted)'); }
        out('hoist2', '');
        out('hoist2', '‚ùå Arrow function before declaration ‚Üí ReferenceError', 'err');
        out('hoist2', '  (const is in TDZ, so the arrow function is too)', 'warn');
        const greet = () => "Hi!";
        out('hoist2', '‚úÖ Arrow function after declaration: "' + greet() + '"');
    },

    closure1() {
        function createGreeter(greeting) {
            return function(name) { out('closure1', `${greeting}, ${name}!`); };
        }
        const hi = createGreeter("Hello");
        const hola = createGreeter("Hola");
        const bonjour = createGreeter("Bonjour");
        hi("Alice");
        hola("Bob");
        bonjour("Charlie");
        out('closure1', 'üí° Each function remembers its own greeting!', 'info');
    },

    closure2() {
        function createCounter() {
            let count = 0;
            return {
                increment() { return ++count; },
                decrement() { return --count; },
                value() { return count; }
            };
        }
        const c = createCounter();
        out('closure2', 'increment: ' + c.increment());
        out('closure2', 'increment: ' + c.increment());
        out('closure2', 'increment: ' + c.increment());
        out('closure2', 'decrement: ' + c.decrement());
        out('closure2', 'value: ' + c.value(), 'info');
    },

    closure3() {
        function createCart() {
            const items = [];
            return {
                add(name, price) { items.push({name, price}); out('closure3', `‚ûï ${name} ($${price})`); },
                total() { return items.reduce((s,i) => s+i.price, 0); },
                show() {
                    out('closure3', 'üõí ' + items.map(i=>i.name).join(', '), 'info');
                    out('closure3', 'üí∞ Total: $' + this.total(), 'info');
                }
            };
        }
        const cart = createCart();
        cart.add("Laptop", 999);
        cart.add("Mouse", 29);
        cart.add("Keyboard", 79);
        cart.show();
    },

    rw1() {
        const AuthModule = (() => {
            let currentUser = null, token = null, attempts = 0;
            const MAX = 3;
            return {
                login(user, pass) {
                    if (attempts >= MAX) return "Locked!";
                    if (pass.length >= 8) {
                        currentUser = user;
                        token = "jwt_" + Math.random().toString(36).slice(2);
                        attempts = 0;
                        return `Welcome, ${user}!`;
                    }
                    attempts++;
                    return `Failed. ${MAX - attempts} left.`;
                },
                isLoggedIn() { return currentUser !== null; },
                logout() { currentUser = token = null; return "Bye!"; }
            };
        })();
        out('rw1', AuthModule.login("alice", "short"), 'err');
        out('rw1', AuthModule.login("alice", "longpassword123"));
        out('rw1', 'Logged in: ' + AuthModule.isLoggedIn(), 'info');
        out('rw1', 'üîê AuthModule.token ‚Üí ' + AuthModule.token + ' (private!)', 'warn');
    },

    rw2() {
        function memoize(fn) {
            const cache = new Map();
            return function(...args) {
                const key = JSON.stringify(args);
                if (cache.has(key)) { out('rw2', `‚ö° Cache hit: ${key} ‚Üí ${cache.get(key)}`); return cache.get(key); }
                out('rw2', `üîÑ Computing: ${key}...`, 'warn');
                const r = fn(...args);
                cache.set(key, r);
                out('rw2', `   Result: ${r}`);
                return r;
            };
        }
        const square = memoize(n => n * n);
        square(5); square(5); square(9); square(9);
    },

    rw3() {
        function createRateLimiter(max, ms) {
            let calls = [];
            return function(action) {
                const now = Date.now();
                calls = calls.filter(t => now - t < ms);
                if (calls.length < max) {
                    calls.push(now);
                    out('rw3', `‚úÖ Allowed (${calls.length}/${max})`);
                    return action();
                }
                out('rw3', `‚ùå Rate limited!`, 'err');
            };
        }
        const limited = createRateLimiter(3, 5000);
        limited(() => "req1");
        limited(() => "req2");
        limited(() => "req3");
        limited(() => "req4");
        limited(() => "req5");
    },

    pit2() {
        let user = "Alice";
        out('pit2', 'Before: user = "' + user + '"', 'info');
        function updateUser() {
            let user = "Bob"; // BUG: creates NEW variable
        }
        updateUser();
        out('pit2', 'After updateUser(): user = "' + user + '"', 'err');
        out('pit2', 'üò± Still "Alice"! The let inside created a NEW variable.', 'warn');
        out('pit2', '');
        // Fixed version
        function updateUserFixed() {
            user = "Bob"; // No 'let' = modifies outer
        }
        updateUserFixed();
        out('pit2', 'After FIXED updateUser(): user = "' + user + '"');
    },

    pit3() {
        const person = { name: "Alice" };
        out('pit3', 'const person = { name: "Alice" }', 'info');
        person.name = "Bob";
        out('pit3', 'person.name = "Bob" ‚Üí ‚úÖ Works!');
        person.age = 30;
        out('pit3', 'person.age = 30 ‚Üí ‚úÖ Works!');
        out('pit3', 'person = {} ‚Üí ‚ùå TypeError! Can\'t reassign const', 'err');
        out('pit3', '');
        const frozen = Object.freeze({ x: 1 });
        frozen.x = 99;
        out('pit3', 'Object.freeze({ x: 1 }); frozen.x = 99;', 'warn');
        out('pit3', 'frozen.x = ' + frozen.x + ' (unchanged ‚Äî truly frozen!)');
    }
};

// ========== INLINE QUIZZES ==========
function quiz(id, el, correct) {
    const box = document.getElementById(id);
    box.querySelectorAll('.quiz-opt').forEach(o => o.classList.add('locked'));
    if (correct) {
        el.classList.add('correct');
        document.getElementById(id + '-ok').classList.add('show');
    } else {
        el.classList.add('wrong');
        // highlight correct
        const opts = box.querySelectorAll('.quiz-opt');
        opts.forEach(o => {
            if (o.onclick && o.onclick.toString().includes('true')) o.classList.add('correct');
        });
        document.getElementById(id + '-bad').classList.add('show');
    }
}

// ========== FINAL QUIZ ==========
const questions = [
    { q: 'What is scope in JavaScript?', o: ['A type of loop', 'Where variables are accessible in code', 'A way to style HTML', 'A debugging tool'], c: 1, e: 'Scope defines the region of code where a variable can be accessed. It creates boundaries for variable visibility.' },
    { q: 'What should you use by DEFAULT for variable declarations?', o: ['var', 'let', 'const', 'No keyword needed'], c: 2, e: 'const is the safest default ‚Äî it prevents reassignment. Use let only when you need to change the value. Never use var.' },
    { q: 'What is the output?\n\nconst x = 10;\nif (true) {\n  const x = 20;\n}\nconsole.log(x);', o: ['10', '20', 'undefined', 'ReferenceError'], c: 0, e: 'The const x = 20 inside the block is a separate variable that shadows the outer x. The outer x = 10 is untouched and is what gets logged.' },
    { q: 'Why is var dangerous?', o: ['It\'s too slow', 'It leaks out of blocks, allows redeclaration, and hoists as undefined', 'It can\'t hold strings', 'It uses too much memory'], c: 1, e: 'var ignores block scope (leaks out of if/for), allows silent redeclaration (hides bugs), and hoists as undefined (misleading behavior).' },
    { q: 'What is a closure?', o: ['A way to close the browser', 'A function that remembers variables from its outer scope', 'A CSS property', 'A type of error'], c: 1, e: 'A closure is a function that retains access to variables from its creation scope, even after that scope has finished executing.' },
    { q: 'What is the Temporal Dead Zone (TDZ)?', o: ['A JavaScript framework', 'The period before let/const declaration where the variable exists but can\'t be accessed', 'A memory leak', 'The time between page loads'], c: 1, e: 'The TDZ is the region from the start of a scope to the let/const declaration. Accessing during TDZ throws ReferenceError ‚Äî this is a safety feature.' },
    { q: 'for (let i = 0; i < 3; i++) {\n  setTimeout(() => console.log(i), 100);\n}\n\nWhat prints?', o: ['3, 3, 3', '0, 1, 2', 'undefined √ó3', 'Error'], c: 1, e: 'With let, each loop iteration creates its own block-scoped i. Each setTimeout captures its own copy, so it prints 0, 1, 2.' },
    { q: 'const obj = { a: 1 };\nobj.a = 2;\nWhat happens?', o: ['TypeError ‚Äî const can\'t change', 'obj.a becomes 2 ‚Äî const prevents reassignment, not mutation', 'obj.a stays 1', 'ReferenceError'], c: 1, e: 'const prevents reassigning the variable (obj = ...), but does NOT make the object immutable. Modifying properties is allowed.' },
    { q: 'How does the scope chain search work?', o: ['Global ‚Üí inner (top down)', 'Current scope ‚Üí parent ‚Üí grandparent ‚Üí ... ‚Üí global (bottom up)', 'Random order', 'Only checks current scope'], c: 1, e: 'JS searches from the innermost (current) scope outward through all ancestors until it reaches global. If not found ‚Üí ReferenceError.' },
    { q: 'What is the BEST practice in modern JS?', o: ['Use var everywhere', 'Use let everywhere', 'Use const by default, let when needed, never var', 'Declare all variables globally for easy access'], c: 2, e: 'const by default (prevents accidental reassignment), let when you need to change the value (counters, flags), never var (legacy bugs).' }
];

let quizBuilt = false;
let quizAnswers = {};

function buildQuiz() {
    quizBuilt = true;
    const area = document.getElementById('quiz-area');
    area.innerHTML = questions.map((q, i) => `
        <div class="quiz-box" id="fq-${i}">
            <div class="quiz-q">
                <span class="qn">Q${i+1}.</span>
                <pre style="white-space:pre-wrap;font-family:inherit;margin-top:8px;color:#dfe6e9;">${q.q}</pre>
            </div>
            <div class="quiz-opts">
                ${q.o.map((opt, j) => `<div class="quiz-opt" onclick="fqAnswer(${i},${j},this)">${String.fromCharCode(65+j)}) ${opt}</div>`).join('')}
            </div>
            <div class="quiz-exp" id="fq-${i}-exp"></div>
        </div>
    `).join('') + `<div style="text-align:center;margin-top:25px;"><button class="run-btn" id="fq-submit" onclick="fqSubmit()" style="font-size:1.1em;padding:14px 36px;">üìä Submit & See Results</button></div>`;
}

function fqAnswer(qi, oi, el) {
    const box = document.getElementById('fq-' + qi);
    box.querySelectorAll('.quiz-opt').forEach((o, j) => {
        o.style.border = j === oi ? '2px solid #6c5ce7' : '2px solid #1a1a5e';
        o.style.background = j === oi ? 'rgba(108,92,231,0.2)' : '#0a0a2e';
    });
    quizAnswers[qi] = oi;
}

function fqSubmit() {
    let score = 0;
    questions.forEach((q, i) => {
        const box = document.getElementById('fq-' + i);
        const opts = box.querySelectorAll('.quiz-opt');
        opts.forEach(o => o.classList.add('locked'));
        const exp = document.getElementById('fq-' + i + '-exp');
        if (quizAnswers[i] === q.c) {
            score++;
            opts[q.c].classList.add('correct');
            exp.className = 'quiz-exp show ok-exp';
            exp.innerHTML = '‚úÖ ' + q.e;
        } else {
            if (quizAnswers[i] !== undefined) opts[quizAnswers[i]].classList.add('wrong');
            opts[q.c].classList.add('correct');
            exp.className = 'quiz-exp show bad-exp';
            exp.innerHTML = '‚ùå ' + q.e;
        }
    });

    const pct = score / questions.length * 100;
    const cls = pct >= 80 ? 'excellent' : pct >= 50 ? 'good' : 'retry';
    const msg = pct >= 80 ? 'üéâ You\'ve mastered scope!' : pct >= 50 ? 'üëç Solid! Review what you missed.' : 'üìö Keep practicing! Re-read the guide.';

    document.getElementById('quiz-results').classList.remove('hidden');
    document.getElementById('quiz-results').innerHTML = `
        <div style="text-align:center;padding:25px;">
            <h2>Your Score</h2>
            <div class="score-circle ${cls}"><span>${score}/${questions.length}</span></div>
            <p style="font-size:1.1em;">${msg}</p>
            <button class="run-btn" onclick="resetQuiz()" style="margin-top:15px;">üîÑ Retake</button>
        </div>`;

    document.getElementById('fq-submit').style.display = 'none';
    document.getElementById('quiz-results').scrollIntoView({behavior:'smooth'});
}

function resetQuiz() {
    quizBuilt = false;
    quizAnswers = {};
    document.getElementById('quiz-results').classList.add('hidden');
    buildQuiz();
}
</script>

</body>
</html>