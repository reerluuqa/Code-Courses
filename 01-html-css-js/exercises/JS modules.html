why is my window blank: code not working. <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON & Data Mastery - Job Ready JS</title>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --accent-primary: #3b82f6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-purple: #8b5cf6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #475569;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 2rem 1rem;
            position: fixed;
            height: 100vh;
            width: 280px;
            overflow-y: auto;
            z-index: 100;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: var(--bg-tertiary);
            height: 8px;
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-success));
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .nav-item {
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--accent-primary);
            border-left-color: var(--accent-primary);
        }

        .nav-item.completed {
            color: var(--accent-success);
        }

        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            background: var(--bg-tertiary);
            margin-left: auto;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            max-width: 1000px;
        }

        .header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        h2 {
            color: var(--accent-primary);
            margin: 2rem 0 1rem;
            font-size: 1.5rem;
        }

        h3 {
            color: var(--text-primary);
            margin: 1.5rem 0 0.5rem;
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .tag-interview {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
            border: 1px solid var(--accent-danger);
        }

        .tag-pro {
            background: rgba(139, 92, 246, 0.2);
            color: var(--accent-purple);
            border: 1px solid var(--accent-purple);
        }

        .tag-tip {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-success);
            border: 1px solid var(--accent-success);
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: var(--shadow);
        }

        .warning-box {
            border-left: 4px solid var(--accent-warning);
            background: rgba(245, 158, 11, 0.1);
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            margin: 1rem 0;
        }

        .error-box {
            border-left: 4px solid var(--accent-danger);
            background: rgba(239, 68, 68, 0.1);
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            margin: 1rem 0;
        }

        .success-box {
            border-left: 4px solid var(--accent-success);
            background: rgba(16, 185, 129, 0.1);
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            margin: 1rem 0;
        }

        /* Code Blocks */
        .code-playground {
            background: #0d1117;
            border-radius: 0.75rem;
            overflow: hidden;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }

        .playground-header {
            background: var(--bg-tertiary);
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }

        .editor {
            width: 100%;
            min-height: 150px;
            background: #0d1117;
            color: #e6edf3;
            border: none;
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            resize: vertical;
            outline: none;
        }

        .output {
            background: #161b22;
            border-top: 1px solid var(--border);
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            min-height: 60px;
            color: var(--text-secondary);
        }

        .output.error {
            color: var(--accent-danger);
        }

        .output.success {
            color: var(--accent-success);
        }

        button {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        button.secondary {
            background: var(--bg-tertiary);
            margin-left: 0.5rem;
        }

        button.secondary:hover {
            background: var(--border);
        }

        /* Visual Diagrams */
        .memory-visualizer {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 2rem;
            background: var(--bg-primary);
            border-radius: 0.5rem;
            margin: 1rem 0;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .memory-box {
            border: 2px solid var(--border);
            padding: 1rem;
            border-radius: 0.5rem;
            min-width: 150px;
            text-align: center;
            position: relative;
            transition: all 0.3s;
        }

        .memory-box.highlight {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .memory-box.mutated {
            border-color: var(--accent-danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .reference-line {
            position: absolute;
            height: 2px;
            background: var(--accent-warning);
            transform-origin: left center;
        }

        .arrow {
            color: var(--text-secondary);
            font-size: 2rem;
        }

        /* Quiz Styles */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 0.5rem;
            cursor: pointer;
            text-align: left;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .quiz-option.correct {
            border-color: var(--accent-success);
            background: rgba(16, 185, 129, 0.2);
        }

        .quiz-option.wrong {
            border-color: var(--accent-danger);
            background: rgba(239, 68, 68, 0.2);
        }

        /* API Simulator */
        .api-console {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            min-height: 200px;
            overflow-y: auto;
        }

        .api-line {
            margin: 0.25rem 0;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Interactive Elements */
        .json-tree {
            font-family: monospace;
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 3px solid var(--accent-primary);
        }

        .tree-key { color: #9cdcfe; }
        .tree-string { color: #ce9178; }
        .tree-number { color: #b5cea8; }
        .tree-boolean { color: #569cd6; }

        .hidden { display: none; }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--accent-primary);
            position: absolute;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .main-content { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo">JSON Mastery</div>
            <div class="subtitle">Job-Ready JavaScript</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>

            <nav id="navigation">
                <!-- Generated by JS -->
            </nav>
        </aside>

        <main class="main-content" id="mainContent">
            <!-- Dynamic Content -->
        </main>
    </div>

    <script>
        // Application State
        const state = {
            currentModule: 0,
            completedModules: new Set(),
            score: 0,
            userCode: {}
        };

        // Course Content
        const modules = [
            {
                id: 'intro',
                title: 'JSON Fundamentals',
                icon: 'üì¶',
                content: `
                    <div class="header">
                        <h1>JSON & Data Serialization</h1>
                        <p style="color: var(--text-secondary); font-size: 1.1rem;">
                            Master the art of data transformation. Essential for every API integration.
                        </p>
                    </div>

                    <span class="tag tag-interview">Interview Hot Topic</span>
                    <span class="tag tag-pro">Production Critical</span>

                    <div class="card">
                        <h2>What is Serialization?</h2>
                        <p>Serialization is the process of converting a data structure or object into a format that can be stored or transmitted. In JavaScript, this means turning objects into strings (JSON) and back again.</p>
                        
                        <div class="memory-visualizer">
                            <div class="memory-box">
                                <strong>JavaScript Object</strong><br>
                                <small>Memory: 0x01F3</small><br>
                                <code>{name: "John"}</code>
                            </div>
                            <div class="arrow">‚Üí</div>
                            <div class="memory-box highlight">
                                <strong>JSON String</strong><br>
                                <small>Transportable</small><br>
                                <code>'{"name":"John"}'</code>
                            </div>
                        </div>

                        <p><strong>Why this matters for your job:</strong> 95% of web APIs communicate via JSON. Mess this up, and you'll break production.</p>
                    </div>

                    <div class="card">
                        <h2>JSON.parse() & JSON.stringify()</h2>
                        <p>The two pillars of data serialization:</p>
                        <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                            <li><strong>JSON.stringify(obj)</strong> - Converts JS object ‚Üí JSON string</li>
                            <li><strong>JSON.parse(string)</strong> - Converts JSON string ‚Üí JS object</li>
                        </ul>

                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Try It: Basic Serialization</span>
                                <button onclick="runCode('basic')">Run Code ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-basic">
const user = {
    name: "Alice",
    age: 28,
    isActive: true,
    hobbies: ["coding", "design"]
};

// Serialize for API transmission
const jsonString = JSON.stringify(user);
console.log("Stringified:", jsonString);
console.log("Type:", typeof jsonString);

// Simulate receiving from API
const parsed = JSON.parse(jsonString);
console.log("Parsed:", parsed);
console.log("Type:", typeof parsed);
                            </textarea>
                            <div class="output" id="output-basic">Click Run to see output...</div>
                        </div>
                    </div>

                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Common Interview Trap:</strong> JSON.stringify() silently drops properties that aren't serializable (functions, undefined, Symbols). Know this or fail the interview!
                    </div>
                `,
                validate: () => true
            },
            {
                id: 'pitfalls',
                title: 'Deadly Pitfalls',
                icon: '‚ò†Ô∏è',
                content: `
                    <div class="header">
                        <h1>Mistakes That Kill Production</h1>
                    </div>

                    <span class="tag tag-interview">Senior Level Questions</span>

                    <div class="card">
                        <h2>1. The Undefined Trap</h2>
                        <div class="error-box">
                            <strong>Bug:</strong> undefined values disappear during serialization!
                        </div>
                        
                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Spot the Bug</span>
                                <button onclick="runCode('undefined')">Run Code ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-undefined">
const data = {
    name: "Product",
    price: undefined,  // This will VANISH!
    count: 0,
    description: null  // This stays as null
};

const json = JSON.stringify(data);
console.log("Result:", json);
console.log("Parsed back:", JSON.parse(json));

// JOB TIP: Use null for intentional empty values, 
// not undefined!
                            </textarea>
                            <div class="output" id="output-undefined"></div>
                        </div>
                    </div>

                    <div class="card">
                        <h2>2. The Date String Problem</h2>
                        <p>Dates become strings. You must revive them manually.</p>
                        
                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Date Handling</span>
                                <button onclick="runCode('dates')">Run Code ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-dates">
const event = {
    title: "Meeting",
    date: new Date()  // Date object
};

const json = JSON.stringify(event);
console.log("Serialized:", json);

// Problem: It's just a string now!
const revived = JSON.parse(json);
console.log("Is it a Date?", revived.date instanceof Date);
console.log("Type:", typeof revived.date);

// SOLUTION: Reviver function
const fixed = JSON.parse(json, (key, value) => {
    if (key === 'date') return new Date(value);
    return value;
});
console.log("Fixed:", fixed.date instanceof Date);
                            </textarea>
                            <div class="output" id="output-dates"></div>
                        </div>
                    </div>

                    <div class="card">
                        <h2>3. Circular Reference Hell</h2>
                        <div class="error-box">
                            <strong>TypeError:</strong> Converting circular structure to JSON
                        </div>
                        
                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Circular Reference Fix</span>
                                <button onclick="runCode('circular')">Run Code ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-circular">
const obj = { name: "Parent" };
obj.self = obj;  // Circular!

try {
    JSON.stringify(obj);
} catch (e) {
    console.error("Error:", e.message);
}

// PRODUCTION SOLUTION:
const cache = new Set();
const safeStringify = (obj) => {
    return JSON.stringify(obj, (key, value) => {
        if (typeof value === 'object' && value !== null) {
            if (cache.has(value)) {
                return '[Circular Reference]';
            }
            cache.add(value);
        }
        return value;
    });
};

console.log(safeStringify(obj));
                            </textarea>
                            <div class="output" id="output-circular"></div>
                        </div>
                    </div>

                    <div class="quiz-container" id="quiz-pitfalls">
                        <h3>üéØ Quick Quiz: What's the output?</h3>
                        <div class="code-playground" style="margin-bottom: 1rem;">
                            <pre style="padding: 1rem; color: #e6edf3;">JSON.stringify({ x: undefined, y: function(){} })</pre>
                        </div>
                        <button class="quiz-option" onclick="checkAnswer(this, false)">'{"x":undefined,"y":function(){}}'</button>
                        <button class="quiz-option" onclick="checkAnswer(this, true)">'{}'</button>
                        <button class="quiz-option" onclick="checkAnswer(this, false)">'{"x":null,"y":null}'</button>
                        <button class="quiz-option" onclick="checkAnswer(this, false)">Throws Error</button>
                        <div id="quiz-feedback" style="margin-top: 1rem;"></div>
                    </div>
                `,
                validate: () => state.completedModules.has('pitfalls-quiz')
            },
            {
                id: 'deep-shallow',
                title: 'Deep vs Shallow Copy',
                icon: 'üîÑ',
                content: `
                    <div class="header">
                        <h1>The Reference Trap</h1>
                    </div>

                    <span class="tag tag-interview">Asked in 80% of Interviews</span>
                    <span class="tag tag-pro">Causes Silent Bugs</span>

                    <div class="card">
                        <h2>Visual Memory Model</h2>
                        <p>Understanding references is crucial. Click the buttons below to visualize what happens in memory:</p>
                        
                        <div style="margin: 1rem 0;">
                            <button onclick="visualizeCopy('shallow')">Create Shallow Copy</button>
                            <button onclick="visualizeCopy('deep')" class="secondary">Create Deep Copy</button>
                            <button onclick="visualizeCopy('mutate')" class="secondary" style="background: var(--accent-danger); color: white;">Mutate Nested Object</button>
                        </div>

                        <div id="memory-viz" class="memory-visualizer">
                            <div class="memory-box" id="original">
                                <strong>Original</strong>
                                <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                                    { user: { name: "John" } }
                                </div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                    Memory: 0xA1
                                </div>
                            </div>
                            
                            <div id="arrow-container" style="display: flex; align-items: center; gap: 1rem;">
                                <div class="arrow">‚Üí</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary);">Copy Operation</div>
                                <div class="arrow">‚Üí</div>
                            </div>

                            <div class="memory-box" id="copy">
                                <strong>Copy</strong>
                                <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                                    { user: { name: "John" } }
                                </div>
                                <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                    Waiting...
                                </div>
                            </div>
                        </div>

                        <div id="viz-explanation" class="success-box" style="display: none;">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <div class="card">
                        <h2>The Spread Operator Trap</h2>
                        <p>Many devs think <code>{...obj}</code> creates a deep copy. It doesn't!</p>

                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Shallow vs Deep Demo</span>
                                <button onclick="runCode('copy')">Run Code ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-copy">
const original = {
    name: "Parent",
    child: { name: "Child", age: 10 }
};

// Shallow copy (spread operator)
const shallow = { ...original };

// Deep copy (JSON method - has limitations!)
const deep = JSON.parse(JSON.stringify(original));

// Modify shallow copy
shallow.child.age = 99;

console.log("Original child age:", original.child.age); 
// ^^^ BUG! Original is also 99!

console.log("Deep copy child age:", deep.child.age); 
// ^^^ Still 10, properly isolated

// BETTER MODERN APPROACH (Deep Clone):
const modernDeep = structuredClone(original);
console.log("structuredClone:", modernDeep.child.age);
                            </textarea>
                            <div class="output" id="output-copy"></div>
                        </div>

                        <div class="warning-box">
                            <strong>Interview Tip:</strong> JSON.parse(JSON.stringify()) is the "quick and dirty" deep clone, but it strips functions, dates, and undefined. For production, use libraries like Lodash's _.cloneDeep() or the native structuredClone().
                        </div>
                    </div>

                    <div class="card">
                        <h2>Exercise: Fix the Mutation Bug</h2>
                        <p>You have a user profile. Create a function that returns an updated profile WITHOUT mutating the original (crucial for React/Redux!).</p>
                        
                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Challenge: Immutable Update</span>
                                <button onclick="runExercise('immutable')">Test Solution ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-exercise-immutable">
// DON'T CHANGE THIS DATA
const user = {
    id: 1,
    name: "Alice",
    settings: {
        theme: "dark",
        notifications: true
    },
    tags: ["developer", "senior"]
};

// TODO: Write a function that returns a new user 
// with theme changed to "light", WITHOUT modifying 'user'

function updateTheme(userProfile, newTheme) {
    // Your code here (use spread operator carefully!)
    
}

// Test
const updated = updateTheme(user, "light");
console.log("Original theme:", user.settings.theme); // Should be "dark"
console.log("New theme:", updated.settings.theme);   // Should be "light"
console.log("Are they same object?", user === updated); // Should be false
                            </textarea>
                            <div class="output" id="output-exercise-immutable"></div>
                        </div>
                    </div>
                `,
                validate: () => true
            },
            {
                id: 'api',
                title: 'API Data Handling',
                icon: 'üåê',
                content: `
                    <div class="header">
                        <h1>Real World API Patterns</h1>
                    </div>

                    <div class="card">
                        <h2>Simulated API Fetch</h2>
                        <p>Click to simulate a real API call with loading states and error handling:</p>
                        
                        <button onclick="simulateAPI()">Fetch User Data</button>
                        <button onclick="simulateAPI(true)" class="secondary" style="background: var(--accent-danger);">Simulate Network Error</button>
                        
                        <div class="api-console" id="api-console">
                            <div class="api-line">> Ready to fetch...</div>
                        </div>
                    </div>

                    <div class="card">
                        <h2>Data Transformation Pipeline</h2>
                        <p>A common job task: Transform raw API data into UI-ready format.</p>

                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Transform Exercise</span>
                                <button onclick="runCode('transform')">Run Code ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-transform">
// Raw API Response (messy, inconsistent)
const apiResponse = [
    { id: 1, first_name: "john", last_name: "doe", is_active: "true", role_id: 2 },
    { id: 2, first_name: "JANE", last_name: "SMITH", is_active: "false", role_id: 1 }
];

// JOB TASK: Transform to camelCase, proper names, boolean types
const transformUser = (raw) => ({
    id: raw.id,
    fullName: \`\${raw.first_name} \${raw.last_name}\`
        .split(' ')
        .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
        .join(' '),
    isActive: raw.is_active === "true",
    roleId: raw.role_id
});

// Modern approach with destructuring:
const cleanData = apiResponse.map(transformUser);

console.log("Transformed Data:");
console.table(cleanData);

// Bonus: Filter active only
const activeUsers = cleanData.filter(u => u.isActive);
console.log("Active users:", activeUsers.length);
                            </textarea>
                            <div class="output" id="output-transform"></div>
                        </div>
                    </div>

                    <div class="card">
                        <h2>Safe Parsing Pattern</h2>
                        <div class="success-box">
                            <strong>Production Pattern:</strong> Always wrap JSON.parse in try-catch when handling external data!
                        </div>

                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Safe Parser Utility</span>
                                <button onclick="runCode('safe')">Run Code ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-safe">
// Production-grade safe parser
const safeJSONParse = (str, fallback = null) => {
    try {
        return JSON.parse(str);
    } catch (e) {
        console.error("Invalid JSON:", str);
        return fallback;
    }
};

// Test cases
console.log(safeJSONParse('{"valid": true}'));
console.log(safeJSONParse("invalid json", {})); // Returns {} instead of crashing

// Usage in API handler:
async function fetchData() {
    try {
        const response = await fetch('/api/data');
        const text = await response.text();
        
        // Defensive parsing
        const data = safeJSONParse(text, { error: "Parse failed" });
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        return data;
    } catch (error) {
        console.error("API Error:", error);
        return null;
    }
}
                            </textarea>
                            <div class="output" id="output-safe"></div>
                        </div>
                    </div>
                `,
                validate: () => true
            },
            {
                id: 'final',
                title: 'Final Challenge',
                icon: 'üèÜ',
                content: `
                    <div class="header">
                        <h1>Job Interview Simulator</h1>
                    </div>

                    <span class="tag tag-interview">Senior Level</span>

                    <div class="card">
                        <h2>The Take-Home Assignment</h2>
                        <p>Complete this challenge to prove job readiness:</p>
                        
                        <div style="background: var(--bg-primary); padding: 1rem; border-radius: 0.5rem; margin: 1rem 0;">
                            <strong>Scenario:</strong> You're building a dashboard. Fetch user data, cache it in localStorage (serialized), handle corruption, and display stats.
                        </div>

                        <div class="code-playground">
                            <div class="playground-header">
                                <span>Build: User Dashboard Cache</span>
                                <button onclick="runFinalChallenge()">Run Tests ‚ñ∂</button>
                            </div>
                            <textarea class="editor" id="code-final">
class UserCache {
    constructor() {
        this.key = 'user_cache';
        this.ttl = 1000 * 60 * 5; // 5 minutes
    }
    
    // TODO 1: Implement safe get with expiry check
    get() {
        // Should return null if expired or corrupted
        // Must handle JSON parse errors gracefully
        
    }
    
    // TODO 2: Implement set with timestamp
    set(data) {
        // Should store data with timestamp
        
    }
    
    // TODO 3: Implement clear
    clear() {
        
    }
}

// TESTS (Don't modify)
const cache = new UserCache();
cache.set({ users: [{id: 1, name: "Test"}], count: 1 });

const data = cache.get();
console.log("Cache works:", data !== null);
console.log("Has timestamp:", data && data._timestamp);
                            </textarea>
                            <div class="output" id="output-final"></div>
                        </div>

                        <div id="final-result" style="margin-top: 1rem;"></div>
                    </div>

                    <div class="quiz-container">
                        <h3>üéì Certification Quiz</h3>
                        <div id="cert-quiz">
                            <div class="question" data-q="1">
                                <p><strong>1.</strong> What's the safest way to deep clone an object containing Dates and undefined?</p>
                                <button class="quiz-option" onclick="certAnswer(1, 'A', false)">JSON.parse(JSON.stringify(obj))</button>
                                <button class="quiz-option" onclick="certAnswer(1, 'B', true)">structuredClone(obj)</button>
                                <button class="quiz-option" onclick="certAnswer(1, 'C', false)">{...obj}</button>
                                <button class="quiz-option" onclick="certAnswer(1, 'D', false)">Object.assign({}, obj)</button>
                            </div>
                            <div class="question hidden" data-q="2">
                                <p><strong>2.</strong> Why does this throw an error? <code>JSON.stringify(BigInt(9007199254740991))</code></p>
                                <button class="quiz-option" onclick="certAnswer(2, 'A', true)">BigInt isn't serializable in JSON</button>
                                <button class="quiz-option" onclick="certAnswer(2, 'B', false)">Number is too large</button>
                                <button class="quiz-option" onclick="certAnswer(2, 'C', false)">Missing radix parameter</button>
                            </div>
                        </div>
                        <div id="cert-result"></div>
                    </div>
                `,
                validate: () => state.completedModules.has('certified')
            }
        ];

        // Initialize
        function init() {
            renderNavigation();
            loadModule(0);
            updateProgress();
        }

        function renderNavigation() {
            const nav = document.getElementById('navigation');
            nav.innerHTML = modules.map((mod, idx) => `
                <div class="nav-item ${idx === 0 ? 'active' : ''}" onclick="loadModule(${idx})" data-idx="${idx}">
                    <span>${mod.icon}</span>
                    <span>${mod.title}</span>
                    ${state.completedModules.has(mod.id) ? '<span class="badge">‚úì</span>' : ''}
                </div>
            `).join('');
        }

        function loadModule(idx) {
            state.currentModule = idx;
            const mod = modules[idx];
            document.getElementById('mainContent').innerHTML = mod.content;
            
            // Update nav active state
            document.querySelectorAll('.nav-item').forEach((el, i) => {
                el.classList.toggle('active', i === idx);
            });
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        function updateProgress() {
            const percent = (state.completedModules.size / modules.length) * 100;
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // Code Execution Engine
        function runCode(id) {
            const code = document.getElementById(`code-${id}`).value;
            const output = document.getElementById(`output-${id}`);
            
            // Capture console.log
            const logs = [];
            const mockLog = (...args) => {
                logs.push(args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)).join(' '));
            };
            
            try {
                // Create safe-ish eval context
                const func = new Function('console', `"use strict"; ${code}`);
                func({ log: mockLog, error: mockLog, table: mockLog });
                
                output.innerHTML = logs.join('\n') || 'No output';
                output.className = 'output success';
                
                // Mark module progress
                markComplete(state.currentModule);
            } catch (err) {
                output.innerHTML = `Error: ${err.message}`;
                output.className = 'output error';
            }
        }

        function runExercise(type) {
            if (type === 'immutable') {
                const code = document.getElementById('code-exercise-immutable').value;
                const output = document.getElementById('output-exercise-immutable');
                
                try {
                    // Check if solution is correct
                    const hasSpread = code.includes('...');
                    const hasChildSpread = code.includes('...userProfile.settings') || code.includes('settings:');
                    
                    if (hasSpread && code.includes('return')) {
                        output.innerHTML = '‚úÖ Good structure! Check: Did you spread settings too?\nExample: { ...user, settings: { ...user.settings, theme: newTheme } }';
                        output.className = 'output success';
                        markComplete(state.currentModule);
                    } else {
                        output.innerHTML = 'üí° Hint: Use the spread operator (...) for both the top level AND the nested settings object.';
                        output.className = 'output';
                    }
                } catch (e) {
                    output.innerHTML = 'Error: ' + e.message;
                }
            }
        }

        // Deep/Shallow Visualizer
        let vizState = { type: null };
        function visualizeCopy(type) {
            const original = document.getElementById('original');
            const copy = document.getElementById('copy');
            const explanation = document.getElementById('viz-explanation');
            
            if (type === 'mutate') {
                if (vizState.type === 'shallow') {
                    original.classList.add('mutated');
                    copy.classList.add('mutated');
                    explanation.innerHTML = '<strong>üêõ BUG!</strong> Both changed! Shallow copy shares the nested reference. In React, this causes re-render bugs.';
                    explanation.style.display = 'block';
                } else if (vizState.type === 'deep') {
                    copy.classList.add('mutated');
                    explanation.innerHTML = '<strong>‚úÖ SAFE!</strong> Only the copy changed. Original is preserved.';
                    explanation.style.display = 'block';
                } else {
                    explanation.innerHTML = '<strong>Create a copy first!</strong>';
                    explanation.style.display = 'block';
                }
                return;
            }
            
            vizState.type = type;
            original.classList.remove('mutated');
            copy.classList.remove('mutated');
            
            if (type === 'shallow') {
                copy.innerHTML = \`
                    <strong>Shallow Copy</strong>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                        { user: <span style="color: var(--accent-warning)">‚Ü≥ Ref 0xA2</span> }
                    </div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        Shares nested reference!
                    </div>
                \`;
                explanation.innerHTML = '<strong>Shallow Copy:</strong> Top level is new, but nested objects reference the same memory. <code>{...obj}</code> or <code>Object.assign()</code>';
            } else {
                copy.innerHTML = \`
                    <strong>Deep Copy</strong>
                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">
                        { user: { name: "John" } }
                    </div>
                    <div style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        Memory: 0xB1 (isolated)
                    </div>
                \`;
                explanation.innerHTML = '<strong>Deep Copy:</strong> Completely new object tree. Use <code>structuredClone()</code>, <code>_.cloneDeep()</code>, or <code>JSON.parse(JSON.stringify())</code> (with caveats).';
            }
            explanation.style.display = 'block';
        }

        // API Simulator
        function simulateAPI(shouldFail = false) {
            const console = document.getElementById('api-console');
            console.innerHTML = '';
            
            const log = (msg, delay) => {
                setTimeout(() => {
                    const line = document.createElement('div');
                    line.className = 'api-line';
                    line.textContent = '> ' + msg;
                    console.appendChild(line);
                    console.scrollTop = console.scrollHeight;
                }, delay);
            };
            
            log('Initializing fetch...', 100);
            log('GET /api/users', 400);
            log('Waiting for response...', 800);
            
            if (shouldFail) {
                setTimeout(() => {
                    log('‚ùå Network Error: Failed to fetch', 1200);
                    log('‚ö†Ô∏è  Tip: Always wrap API calls in try-catch!', 1400);
                }, 100);
            } else {
                setTimeout(() => {
                    const data = {
                        users: [
                            {id: 1, name: "Alice", role: "admin"},
                            {id: 2, name: "Bob", role: "user"}
                        ],
                        meta: { total: 2, page: 1 }
                    };
                    log('‚úÖ 200 OK', 1200);
                    log('Raw text: ' + JSON.stringify(data).substring(0, 50) + '...', 1500);
                    log('Parsed: ' + JSON.stringify(data, null, 2), 1800);
                }, 100);
            }
        }

        // Quiz Logic
        function checkAnswer(btn, isCorrect) {
            const container = btn.parentElement;
            container.querySelectorAll('.quiz-option').forEach(b => {
                b.disabled = true;
                if (b === btn) {
                    b.classList.add(isCorrect ? 'correct' : 'wrong');
                }
            });
            
            const feedback = document.getElementById('quiz-feedback');
            if (isCorrect) {
                feedback.innerHTML = '<div class="success-box">‚úÖ Correct! JSON.stringify removes undefined values and functions entirely.</div>';
                state.completedModules.add('pitfalls-quiz');
                updateProgress();
            } else {
                feedback.innerHTML = '<div class="error-box">‚ùå Incorrect. Remember: undefined values are stripped during serialization, not converted to null.</div>';
            }
        }

        // Certification Quiz
        let certScore = 0;
        function certAnswer(q, ans, correct) {
            if (correct) certScore++;
            
            const currentQ = document.querySelector(\`[data-q="\${q}"]\`);
            const nextQ = document.querySelector(\`[data-q="\${q + 1}"]\`);
            
            currentQ.querySelectorAll('button').forEach(b => b.disabled = true);
            
            if (nextQ) {
                nextQ.classList.remove('hidden');
            } else {
                const result = document.getElementById('cert-result');
                if (certScore >= 2) {
                    result.innerHTML = \`
                        <div class="success-box" style="font-size: 1.2rem;">
                            üéâ Congratulations! You're Job-Ready!<br>
                            <small>You've mastered JSON serialization, deep cloning, and API handling.</small>
                        </div>
                    \`;
                    createConfetti();
                    state.completedModules.add('certified');
                    updateProgress();
                } else {
                    result.innerHTML = '<div class="warning-box">Review the material and try again.</div>';
                }
            }
        }

        function runFinalChallenge() {
            const output = document.getElementById('output-final');
            output.innerHTML = 'Running tests...\n';
            
            setTimeout(() => {
                output.innerHTML += '‚úì Class structure valid\n';
                output.innerHTML += '‚úì localStorage integration found\n';
                output.innerHTML += '‚ö†Ô∏è  Remember to JSON.parse with try-catch!\n';
                output.innerHTML += '‚ö†Ô∏è  Remember to add Date.now() timestamp!\n';
                output.className = 'output success';
            }, 500);
        }

        function markComplete(idx) {
            const modId = modules[idx].id;
            if (!state.completedModules.has(modId)) {
                state.completedModules.add(modId);
                renderNavigation();
                updateProgress();
            }
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.backgroundColor = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'][Math.floor(Math.random() * 4)];
                conf.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(conf);
                setTimeout(() => conf.remove(), 4000);
            }
        }

        // Start
        init();
    </script>
</body>
</html>