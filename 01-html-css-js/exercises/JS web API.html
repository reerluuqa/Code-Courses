<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üöÄ Web APIs Mastery Hub</title>
<style>
:root {
  --bg-dark: #0b0d17;
  --bg-card: #131629;
  --bg-card2: #1a1e35;
  --bg-code: #0d1025;
  --accent1: #00d4ff;
  --accent2: #00ff88;
  --accent3: #7c3aed;
  --accent4: #ff6b35;
  --accent5: #ff3e8e;
  --text: #e2e8f0;
  --text-dim: #8892b0;
  --border: #2a2f4a;
  --success: #00ff88;
  --danger: #ff4757;
  --warning: #ffa502;
  --radius: 12px;
  --shadow: 0 4px 24px rgba(0,0,0,0.4);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg-dark);
  color: var(--text);
  display: flex;
  min-height: 100vh;
  overflow-x: hidden;
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-dark); }
::-webkit-scrollbar-thumb { background: var(--accent3); border-radius: 3px; }

/* SIDEBAR */
.sidebar {
  width: 260px;
  min-height: 100vh;
  background: linear-gradient(180deg, #0f1225 0%, #161a36 100%);
  border-right: 1px solid var(--border);
  position: fixed;
  top: 0;
  left: 0;
  z-index: 100;
  display: flex;
  flex-direction: column;
  transition: transform 0.3s;
}

.sidebar-header {
  padding: 24px 20px;
  border-bottom: 1px solid var(--border);
}

.sidebar-header h1 {
  font-size: 1.2rem;
  background: linear-gradient(135deg, var(--accent1), var(--accent3));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.sidebar-header p {
  font-size: 0.75rem;
  color: var(--text-dim);
  margin-top: 4px;
}

.progress-bar-container {
  padding: 12px 20px;
  border-bottom: 1px solid var(--border);
}

.progress-label {
  font-size: 0.7rem;
  color: var(--text-dim);
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
}

.progress-track {
  height: 6px;
  background: var(--bg-dark);
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent1), var(--accent2));
  border-radius: 3px;
  transition: width 0.5s ease;
}

.nav-list {
  list-style: none;
  padding: 12px 0;
  flex: 1;
  overflow-y: auto;
}

.nav-item {
  padding: 12px 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 0.9rem;
  color: var(--text-dim);
  transition: all 0.2s;
  border-left: 3px solid transparent;
  position: relative;
}

.nav-item:hover {
  background: rgba(0,212,255,0.05);
  color: var(--text);
}

.nav-item.active {
  background: rgba(0,212,255,0.08);
  color: var(--accent1);
  border-left-color: var(--accent1);
}

.nav-icon {
  font-size: 1.3rem;
  width: 28px;
  text-align: center;
}

.nav-check {
  position: absolute;
  right: 16px;
  font-size: 0.8rem;
  color: var(--accent2);
  display: none;
}

.nav-item.completed .nav-check { display: block; }

.mobile-toggle {
  display: none;
  position: fixed;
  top: 16px;
  left: 16px;
  z-index: 200;
  background: var(--bg-card);
  border: 1px solid var(--border);
  color: var(--text);
  width: 44px;
  height: 44px;
  border-radius: 10px;
  font-size: 1.3rem;
  cursor: pointer;
}

/* MAIN */
.main {
  margin-left: 260px;
  flex: 1;
  min-height: 100vh;
}

.section {
  display: none;
  padding: 40px;
  max-width: 900px;
  margin: 0 auto;
  animation: fadeIn 0.4s ease;
}

.section.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

/* SECTION HERO */
.section-hero {
  padding: 40px;
  border-radius: var(--radius);
  margin-bottom: 32px;
  position: relative;
  overflow: hidden;
}

.section-hero::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  opacity: 0.1;
  background: radial-gradient(circle at 30% 50%, var(--accent1), transparent 60%),
              radial-gradient(circle at 70% 50%, var(--accent3), transparent 60%);
}

.section-hero .hero-icon { font-size: 3rem; margin-bottom: 12px; }
.section-hero h2 {
  font-size: 2rem;
  margin-bottom: 8px;
  background: linear-gradient(135deg, #fff, var(--accent1));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.section-hero p { color: var(--text-dim); font-size: 1.05rem; position: relative; }

/* CARDS */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 28px;
  margin-bottom: 24px;
}

.card h3 {
  font-size: 1.2rem;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card p, .card li {
  color: var(--text-dim);
  line-height: 1.7;
  font-size: 0.95rem;
}

.card ul, .card ol {
  padding-left: 20px;
  margin: 12px 0;
}

.card li { margin-bottom: 6px; }

.badge {
  display: inline-block;
  padding: 2px 10px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.badge-blue { background: rgba(0,212,255,0.15); color: var(--accent1); }
.badge-green { background: rgba(0,255,136,0.15); color: var(--accent2); }
.badge-purple { background: rgba(124,58,237,0.15); color: var(--accent3); }
.badge-orange { background: rgba(255,107,53,0.15); color: var(--accent4); }
.badge-pink { background: rgba(255,62,142,0.15); color: var(--accent5); }

/* CODE BLOCKS */
.code-block {
  background: var(--bg-code);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin: 16px 0;
  overflow: hidden;
}

.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 16px;
  background: rgba(255,255,255,0.03);
  border-bottom: 1px solid var(--border);
  font-size: 0.75rem;
  color: var(--text-dim);
}

.code-header .dots {
  display: flex;
  gap: 6px;
}

.code-header .dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.dot-red { background: #ff5f57; }
.dot-yellow { background: #ffbd2e; }
.dot-green { background: #28c840; }

.copy-btn {
  background: none;
  border: 1px solid var(--border);
  color: var(--text-dim);
  padding: 3px 10px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.7rem;
  transition: all 0.2s;
}

.copy-btn:hover {
  border-color: var(--accent1);
  color: var(--accent1);
}

.code-body {
  padding: 16px;
  overflow-x: auto;
  font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
  font-size: 0.85rem;
  line-height: 1.7;
  white-space: pre;
  tab-size: 2;
}

.code-body .kw { color: #c792ea; }
.code-body .fn { color: #82aaff; }
.code-body .str { color: #c3e88d; }
.code-body .num { color: #f78c6c; }
.code-body .cm { color: #546e7a; }
.code-body .op { color: #89ddff; }
.code-body .obj { color: #ffcb6b; }
.code-body .pr { color: #f07178; }

/* INTERACTIVE DEMO */
.demo-area {
  background: var(--bg-card2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin: 16px 0;
}

.demo-area h4 {
  font-size: 0.9rem;
  color: var(--accent1);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn:active { transform: scale(0.96); }

.btn-primary {
  background: linear-gradient(135deg, var(--accent1), #0099cc);
  color: #000;
}

.btn-primary:hover { box-shadow: 0 0 20px rgba(0,212,255,0.3); }

.btn-success {
  background: linear-gradient(135deg, var(--accent2), #00cc6a);
  color: #000;
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #cc0022);
  color: #fff;
}

.btn-purple {
  background: linear-gradient(135deg, var(--accent3), #5b21b6);
  color: #fff;
}

.btn-orange {
  background: linear-gradient(135deg, var(--accent4), #cc5522);
  color: #fff;
}

.btn-sm {
  padding: 6px 14px;
  font-size: 0.78rem;
}

.btn-group {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin: 12px 0;
}

.output-box {
  background: var(--bg-dark);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px;
  margin-top: 12px;
  font-family: monospace;
  font-size: 0.85rem;
  min-height: 60px;
  max-height: 250px;
  overflow-y: auto;
  color: var(--accent2);
  white-space: pre-wrap;
  word-break: break-word;
}

/* VISUAL DIAGRAM */
.diagram {
  background: var(--bg-card2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  margin: 20px 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}

.diagram-row {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
  justify-content: center;
}

.diagram-box {
  padding: 14px 24px;
  border-radius: 10px;
  font-size: 0.85rem;
  font-weight: 600;
  text-align: center;
  min-width: 120px;
  position: relative;
}

.diagram-arrow {
  font-size: 1.5rem;
  color: var(--text-dim);
  animation: pulse 1.5s ease infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.4; }
  50% { opacity: 1; }
}

.d-blue { background: rgba(0,212,255,0.15); border: 1px solid var(--accent1); color: var(--accent1); }
.d-green { background: rgba(0,255,136,0.15); border: 1px solid var(--accent2); color: var(--accent2); }
.d-purple { background: rgba(124,58,237,0.15); border: 1px solid var(--accent3); color: var(--accent3); }
.d-orange { background: rgba(255,107,53,0.15); border: 1px solid var(--accent4); color: var(--accent4); }
.d-pink { background: rgba(255,62,142,0.15); border: 1px solid var(--accent5); color: var(--accent5); }

/* MISTAKES */
.mistake-card {
  background: var(--bg-card);
  border-left: 4px solid var(--danger);
  border-radius: 0 var(--radius) var(--radius) 0;
  padding: 20px 24px;
  margin: 12px 0;
}

.mistake-card h4 {
  color: var(--danger);
  font-size: 0.9rem;
  margin-bottom: 8px;
}

.fix-card {
  background: var(--bg-card);
  border-left: 4px solid var(--success);
  border-radius: 0 var(--radius) var(--radius) 0;
  padding: 20px 24px;
  margin: 12px 0;
}

.fix-card h4 {
  color: var(--success);
  font-size: 0.9rem;
  margin-bottom: 8px;
}

/* QUIZ */
.quiz-container { margin: 20px 0; }

.quiz-question {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 16px;
}

.quiz-question h4 {
  font-size: 0.95rem;
  margin-bottom: 16px;
  color: var(--text);
}

.quiz-q-num {
  display: inline-block;
  background: var(--accent3);
  color: #fff;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  text-align: center;
  line-height: 28px;
  font-size: 0.8rem;
  font-weight: 700;
  margin-right: 10px;
}

.quiz-options { display: flex; flex-direction: column; gap: 8px; }

.quiz-opt {
  padding: 12px 16px;
  background: var(--bg-card2);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.88rem;
  transition: all 0.2s;
  color: var(--text-dim);
}

.quiz-opt:hover:not(.disabled) {
  border-color: var(--accent1);
  color: var(--text);
}

.quiz-opt.correct {
  border-color: var(--success);
  background: rgba(0,255,136,0.08);
  color: var(--success);
}

.quiz-opt.wrong {
  border-color: var(--danger);
  background: rgba(255,71,87,0.08);
  color: var(--danger);
}

.quiz-explanation {
  margin-top: 12px;
  padding: 12px 16px;
  background: rgba(0,212,255,0.05);
  border-radius: 8px;
  font-size: 0.85rem;
  color: var(--text-dim);
  display: none;
  border-left: 3px solid var(--accent1);
}

.quiz-score {
  text-align: center;
  padding: 24px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-top: 20px;
}

.quiz-score .score-num {
  font-size: 2.5rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* EXERCISE */
.exercise-box {
  background: var(--bg-card);
  border: 2px dashed var(--accent3);
  border-radius: var(--radius);
  padding: 28px;
  margin: 20px 0;
}

.exercise-box h4 {
  color: var(--accent3);
  margin-bottom: 12px;
}

.exercise-editor {
  width: 100%;
  min-height: 150px;
  background: var(--bg-code);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--accent2);
  font-family: 'Consolas', monospace;
  font-size: 0.85rem;
  padding: 16px;
  resize: vertical;
  outline: none;
  margin: 12px 0;
}

.exercise-editor:focus { border-color: var(--accent3); }

.solution-toggle {
  background: none;
  border: 1px dashed var(--accent3);
  color: var(--accent3);
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.82rem;
  margin-top: 8px;
}

.solution-box {
  display: none;
  margin-top: 12px;
}

/* THREAD ANIMATION */
.thread-visual {
  display: flex;
  gap: 24px;
  margin: 16px 0;
  flex-wrap: wrap;
}

.thread-lane {
  flex: 1;
  min-width: 250px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  text-align: center;
}

.thread-lane h5 {
  font-size: 0.85rem;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

.thread-bar-track {
  height: 20px;
  background: var(--bg-dark);
  border-radius: 10px;
  overflow: hidden;
  margin: 8px 0;
}

.thread-bar {
  height: 100%;
  width: 0%;
  border-radius: 10px;
  transition: width 0.1s linear;
}

.bar-main { background: linear-gradient(90deg, var(--accent4), var(--danger)); }
.bar-worker { background: linear-gradient(90deg, var(--accent1), var(--accent2)); }

.anim-box {
  width: 50px;
  height: 50px;
  background: linear-gradient(135deg, var(--accent1), var(--accent3));
  border-radius: 10px;
  margin: 16px auto;
  animation: spin 2s linear infinite;
}

.anim-box.frozen { animation-play-state: paused; opacity: 0.3; }

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* LIFECYCLE */
.lifecycle {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
  justify-content: center;
  padding: 20px;
}

.lifecycle-step {
  padding: 10px 16px;
  border-radius: 8px;
  font-size: 0.8rem;
  font-weight: 600;
  text-align: center;
  transition: all 0.3s;
}

.lifecycle-step.active-step {
  transform: scale(1.1);
  box-shadow: 0 0 15px rgba(0,212,255,0.3);
}

.lifecycle-arrow {
  font-size: 1.2rem;
  color: var(--text-dim);
}

/* WS */
.chat-box {
  background: var(--bg-dark);
  border: 1px solid var(--border);
  border-radius: 8px;
  height: 200px;
  overflow-y: auto;
  padding: 12px;
  margin: 12px 0;
}

.chat-msg {
  padding: 6px 12px;
  margin: 4px 0;
  border-radius: 8px;
  font-size: 0.85rem;
  max-width: 80%;
}

.chat-sent {
  background: rgba(0,212,255,0.15);
  color: var(--accent1);
  margin-left: auto;
  text-align: right;
}

.chat-recv {
  background: rgba(0,255,136,0.15);
  color: var(--accent2);
}

.chat-sys {
  color: var(--text-dim);
  font-size: 0.75rem;
  text-align: center;
  font-style: italic;
}

.chat-input-row {
  display: flex;
  gap: 8px;
}

.chat-input {
  flex: 1;
  padding: 10px 14px;
  background: var(--bg-dark);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-size: 0.88rem;
  outline: none;
}

.chat-input:focus { border-color: var(--accent1); }

/* STATUS */
.status-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 6px;
}

.status-green { background: var(--success); box-shadow: 0 0 6px var(--success); }
.status-red { background: var(--danger); box-shadow: 0 0 6px var(--danger); }
.status-yellow { background: var(--warning); box-shadow: 0 0 6px var(--warning); }

/* TABS */
.tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  margin-bottom: 20px;
  gap: 0;
  overflow-x: auto;
}

.tab-btn {
  padding: 10px 20px;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--text-dim);
  cursor: pointer;
  font-size: 0.85rem;
  white-space: nowrap;
  transition: all 0.2s;
}

.tab-btn:hover { color: var(--text); }
.tab-btn.active { color: var(--accent1); border-bottom-color: var(--accent1); }

.tab-pane { display: none; }
.tab-pane.active { display: block; }

/* TOOLTIP */
.tip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(0,212,255,0.08);
  border: 1px solid rgba(0,212,255,0.2);
  border-radius: 8px;
  padding: 10px 16px;
  margin: 8px 0;
  font-size: 0.85rem;
  color: var(--accent1);
}

/* TABLE */
.api-table {
  width: 100%;
  border-collapse: collapse;
  margin: 16px 0;
  font-size: 0.85rem;
}

.api-table th {
  text-align: left;
  padding: 10px 14px;
  background: var(--bg-card2);
  border: 1px solid var(--border);
  color: var(--accent1);
  font-size: 0.8rem;
}

.api-table td {
  padding: 10px 14px;
  border: 1px solid var(--border);
  color: var(--text-dim);
}

.api-table code {
  background: var(--bg-code);
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.8rem;
  color: var(--accent2);
}

.highlight { color: var(--accent1); font-weight: 600; }
.highlight-green { color: var(--accent2); font-weight: 600; }

/* SECTION COMPLETE BTN */
.complete-section-btn {
  display: block;
  width: 100%;
  padding: 16px;
  margin-top: 32px;
  background: linear-gradient(135deg, var(--accent2), #00cc6a);
  color: #000;
  border: none;
  border-radius: var(--radius);
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
}

.complete-section-btn:hover {
  box-shadow: 0 0 30px rgba(0,255,136,0.3);
  transform: translateY(-2px);
}

.complete-section-btn.completed-btn {
  background: var(--bg-card2);
  color: var(--accent2);
  border: 1px solid var(--accent2);
}

/* CONFETTI */
.confetti-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 999;
}

.confetti-piece {
  position: absolute;
  width: 10px;
  height: 10px;
  top: -10px;
  animation: confettiFall 3s ease-out forwards;
}

@keyframes confettiFall {
  0% { transform: translateY(0) rotateZ(0) scale(1); opacity: 1; }
  100% { transform: translateY(100vh) rotateZ(720deg) scale(0); opacity: 0; }
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .mobile-toggle { display: flex; align-items: center; justify-content: center; }
  .main { margin-left: 0; }
  .section { padding: 20px; padding-top: 70px; }
  .thread-visual { flex-direction: column; }
  .diagram-row { flex-direction: column; }
  .diagram-arrow { transform: rotate(90deg); }
}
</style>
</head>
<body>

<button class="mobile-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞</button>

<nav class="sidebar">
  <div class="sidebar-header">
    <h1>üöÄ Web APIs Mastery</h1>
    <p>Master modern browser APIs</p>
  </div>
  <div class="progress-bar-container">
    <div class="progress-label">
      <span>Overall Progress</span>
      <span id="progress-pct">0%</span>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="progress-fill"></div>
    </div>
  </div>
  <ul class="nav-list">
    <li class="nav-item active" data-section="home">
      <span class="nav-icon">üè†</span> Home
      <span class="nav-check">‚úì</span>
    </li>
    <li class="nav-item" data-section="geolocation">
      <span class="nav-icon">üìç</span> Geolocation API
      <span class="nav-check">‚úì</span>
    </li>
    <li class="nav-item" data-section="webworkers">
      <span class="nav-icon">‚öôÔ∏è</span> Web Workers
      <span class="nav-check">‚úì</span>
    </li>
    <li class="nav-item" data-section="serviceworkers">
      <span class="nav-icon">üîß</span> Service Workers
      <span class="nav-check">‚úì</span>
    </li>
    <li class="nav-item" data-section="websockets">
      <span class="nav-icon">üîå</span> WebSocket API
      <span class="nav-check">‚úì</span>
    </li>
    <li class="nav-item" data-section="notifications">
      <span class="nav-icon">üîî</span> Notification API
      <span class="nav-check">‚úì</span>
    </li>
    <li class="nav-item" data-section="finalquiz">
      <span class="nav-icon">üèÜ</span> Final Challenge
      <span class="nav-check">‚úì</span>
    </li>
  </ul>
</nav>

<main class="main">

<!-- ==================== HOME ==================== -->
<section class="section active" id="home">
  <div class="section-hero">
    <div class="hero-icon">üöÄ</div>
    <h2>Web APIs Mastery Hub</h2>
    <p>Master the browser APIs that top companies expect you to know. Interactive examples, visual diagrams, quizzes, and real-world exercises await!</p>
  </div>

  <div class="card">
    <h3>üìã What You'll Master</h3>
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:16px; margin-top:12px;">
      <div style="padding:16px; background:var(--bg-card2); border-radius:10px; border:1px solid var(--border);">
        <div style="font-size:2rem; margin-bottom:8px;">üìç</div>
        <strong>Geolocation API</strong>
        <p style="font-size:0.8rem; color:var(--text-dim); margin-top:4px;">Track user location, watch position changes, handle errors</p>
      </div>
      <div style="padding:16px; background:var(--bg-card2); border-radius:10px; border:1px solid var(--border);">
        <div style="font-size:2rem; margin-bottom:8px;">‚öôÔ∏è</div>
        <strong>Web Workers</strong>
        <p style="font-size:0.8rem; color:var(--text-dim); margin-top:4px;">Multi-threading in JS, off-main-thread computation</p>
      </div>
      <div style="padding:16px; background:var(--bg-card2); border-radius:10px; border:1px solid var(--border);">
        <div style="font-size:2rem; margin-bottom:8px;">üîß</div>
        <strong>Service Workers</strong>
        <p style="font-size:0.8rem; color:var(--text-dim); margin-top:4px;">Offline support, caching, push notifications, PWA</p>
      </div>
      <div style="padding:16px; background:var(--bg-card2); border-radius:10px; border:1px solid var(--border);">
        <div style="font-size:2rem; margin-bottom:8px;">üîå</div>
        <strong>WebSocket API</strong>
        <p style="font-size:0.8rem; color:var(--text-dim); margin-top:4px;">Real-time bidirectional communication</p>
      </div>
      <div style="padding:16px; background:var(--bg-card2); border-radius:10px; border:1px solid var(--border);">
        <div style="font-size:2rem; margin-bottom:8px;">üîî</div>
        <strong>Notification API</strong>
        <p style="font-size:0.8rem; color:var(--text-dim); margin-top:4px;">Browser notifications, permission model, options</p>
      </div>
    </div>
  </div>

  <div class="tip">üí° Complete each section and mark it done to track your progress!</div>

  <button class="complete-section-btn" onclick="completeSection('home')">‚úÖ I'm Ready ‚Äî Let's Begin!</button>
</section>

<!-- ==================== GEOLOCATION ==================== -->
<section class="section" id="geolocation">
  <div class="section-hero">
    <div class="hero-icon">üìç</div>
    <h2>Geolocation API</h2>
    <p>Access the user's geographical location with their permission. Used in maps, weather apps, delivery tracking & more.</p>
  </div>

  <div class="card">
    <h3>üß† How It Works</h3>
    <p>The Geolocation API lets you request the user's position. The browser asks for permission first ‚Äî <span class="highlight">privacy is built in</span>.</p>
    <div class="diagram">
      <div class="diagram-row">
        <div class="diagram-box d-blue">Your Code<br><small>getCurrentPosition()</small></div>
        <span class="diagram-arrow">‚Üí</span>
        <div class="diagram-box d-purple">Browser<br><small>Permission Prompt</small></div>
        <span class="diagram-arrow">‚Üí</span>
        <div class="diagram-box d-orange">Device<br><small>GPS / WiFi / IP</small></div>
        <span class="diagram-arrow">‚Üí</span>
        <div class="diagram-box d-green">Callback<br><small>lat, lng, accuracy</small></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üìñ API Reference</h3>
    <table class="api-table">
      <tr><th>Method</th><th>Description</th></tr>
      <tr><td><code>getCurrentPosition(success, error, options)</code></td><td>Get position once</td></tr>
      <tr><td><code>watchPosition(success, error, options)</code></td><td>Continuously track position</td></tr>
      <tr><td><code>clearWatch(id)</code></td><td>Stop watching position</td></tr>
    </table>
    <table class="api-table" style="margin-top:12px">
      <tr><th>Option</th><th>Type</th><th>Description</th></tr>
      <tr><td><code>enableHighAccuracy</code></td><td>Boolean</td><td>Use GPS (slower, more battery)</td></tr>
      <tr><td><code>timeout</code></td><td>ms</td><td>Max wait time for response</td></tr>
      <tr><td><code>maximumAge</code></td><td>ms</td><td>Accept cached position up to this age</td></tr>
    </table>
  </div>

  <div class="card">
    <h3>üî• Example 1: Get Current Position</h3>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>geolocation-basic.js</span>
      </div>
      <div class="code-body"><span class="cm">// Check if API is available</span>
<span class="kw">if</span> (<span class="obj">navigator</span>.<span class="pr">geolocation</span>) {
  <span class="obj">navigator</span>.<span class="pr">geolocation</span>.<span class="fn">getCurrentPosition</span>(
    <span class="cm">// Success callback</span>
    (position) <span class="op">=></span> {
      <span class="kw">const</span> { latitude, longitude, accuracy } <span class="op">=</span> position.<span class="pr">coords</span>;
      <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">`Lat: ${latitude}, Lng: ${longitude}`</span>);
      <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">`Accuracy: ${accuracy} meters`</span>);
    },
    <span class="cm">// Error callback</span>
    (error) <span class="op">=></span> {
      <span class="kw">switch</span> (error.<span class="pr">code</span>) {
        <span class="kw">case</span> error.<span class="pr">PERMISSION_DENIED</span>:
          <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">"User denied permission"</span>); <span class="kw">break</span>;
        <span class="kw">case</span> error.<span class="pr">POSITION_UNAVAILABLE</span>:
          <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">"Position unavailable"</span>); <span class="kw">break</span>;
        <span class="kw">case</span> error.<span class="pr">TIMEOUT</span>:
          <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">"Request timed out"</span>); <span class="kw">break</span>;
      }
    },
    { enableHighAccuracy: <span class="kw">true</span>, timeout: <span class="num">10000</span>, maximumAge: <span class="num">0</span> }
  );
} <span class="kw">else</span> {
  <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">"Geolocation not supported"</span>);
}</div>
    </div>

    <div class="demo-area">
      <h4>üéÆ Try It Live</h4>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="demoGeolocate()">üìç Get My Location</button>
      </div>
      <div class="output-box" id="geo-output">Click the button to get your location...</div>
    </div>
  </div>

  <div class="card">
    <h3>üî• Example 2: Watch Position (Real-time Tracking)</h3>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>watch-position.js</span>
      </div>
      <div class="code-body"><span class="kw">let</span> watchId <span class="op">=</span> <span class="obj">navigator</span>.<span class="pr">geolocation</span>.<span class="fn">watchPosition</span>(
  (position) <span class="op">=></span> {
    <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">`Moved to: ${position.coords.latitude}, ${position.coords.longitude}`</span>);
    <span class="fn">updateMapMarker</span>(position.<span class="pr">coords</span>);
  },
  (error) <span class="op">=></span> <span class="obj">console</span>.<span class="fn">error</span>(error),
  { enableHighAccuracy: <span class="kw">true</span> }
);

<span class="cm">// Stop watching when done</span>
<span class="obj">navigator</span>.<span class="pr">geolocation</span>.<span class="fn">clearWatch</span>(watchId);</div>
    </div>
    <div class="demo-area">
      <h4>üéÆ Watch Position Demo</h4>
      <div class="btn-group">
        <button class="btn btn-success" id="geo-watch-btn" onclick="demoWatchPosition()">‚ñ∂ Start Watching</button>
        <button class="btn btn-danger" onclick="demoStopWatch()">‚èπ Stop</button>
      </div>
      <div class="output-box" id="geo-watch-output">Start watching to see position updates...</div>
    </div>
  </div>

  <!-- MISTAKES -->
  <div class="card">
    <h3>‚ö†Ô∏è Common Mistakes & Pitfalls</h3>

    <div class="mistake-card">
      <h4>‚ùå Mistake 1: Not checking API availability</h4>
      <div class="code-block"><div class="code-body"><span class="cm">// This will crash if geolocation is not supported!</span>
<span class="obj">navigator</span>.<span class="pr">geolocation</span>.<span class="fn">getCurrentPosition</span>(callback);</div></div>
    </div>
    <div class="fix-card">
      <h4>‚úÖ Fix: Always check first</h4>
      <div class="code-block"><div class="code-body"><span class="kw">if</span> (<span class="str">'geolocation'</span> <span class="kw">in</span> navigator) {
  navigator.geolocation.getCurrentPosition(callback);
} <span class="kw">else</span> {
  showFallbackUI();
}</div></div>
    </div>

    <div class="mistake-card">
      <h4>‚ùå Mistake 2: Forgetting error callback</h4>
      <p>Without error handling, you'll never know why it failed. The user may have denied permission!</p>
    </div>

    <div class="mistake-card">
      <h4>‚ùå Mistake 3: Not setting a timeout</h4>
      <p>Without a timeout, <code>getCurrentPosition()</code> may hang indefinitely on some devices.</p>
    </div>

    <div class="mistake-card">
      <h4>‚ùå Mistake 4: Forgetting clearWatch()</h4>
      <p><code>watchPosition()</code> runs continuously and drains battery. Always call <code>clearWatch()</code> when done!</p>
    </div>

    <div class="mistake-card">
      <h4>‚ùå Mistake 5: Using HTTP instead of HTTPS</h4>
      <p>Geolocation API only works on <strong>HTTPS</strong> origins (and localhost). It's blocked on HTTP!</p>
    </div>
  </div>

  <!-- QUIZ -->
  <div class="card">
    <h3>üß™ Quiz: Geolocation API</h3>
    <div class="quiz-container" id="quiz-geo"></div>
  </div>

  <!-- EXERCISE -->
  <div class="exercise-box">
    <h4>üí™ Exercise: Distance Calculator</h4>
    <p>Write a function that takes two position objects and calculates the distance between them using the Haversine formula. Then use <code>getCurrentPosition()</code> to get the user's location and calculate their distance from the Eiffel Tower (48.8584, 2.2945).</p>
    <textarea class="exercise-editor" placeholder="// Write your solution here...
function haversineDistance(lat1, lon1, lat2, lon2) {
  // Your code here
}

navigator.geolocation.getCurrentPosition((pos) => {
  // Calculate distance to Eiffel Tower
});"></textarea>
    <button class="solution-toggle" onclick="toggleSolution('sol-geo')">üëÅ Show Solution</button>
    <div class="solution-box" id="sol-geo">
      <div class="code-block"><div class="code-body"><span class="kw">function</span> <span class="fn">haversineDistance</span>(lat1, lon1, lat2, lon2) {
  <span class="kw">const</span> R = <span class="num">6371</span>; <span class="cm">// Earth radius in km</span>
  <span class="kw">const</span> dLat = (lat2 - lat1) * Math.PI / <span class="num">180</span>;
  <span class="kw">const</span> dLon = (lon2 - lon1) * Math.PI / <span class="num">180</span>;
  <span class="kw">const</span> a = Math.sin(dLat/<span class="num">2</span>) ** <span class="num">2</span> +
    Math.cos(lat1 * Math.PI/<span class="num">180</span>) *
    Math.cos(lat2 * Math.PI/<span class="num">180</span>) *
    Math.sin(dLon/<span class="num">2</span>) ** <span class="num">2</span>;
  <span class="kw">return</span> R * <span class="num">2</span> * Math.atan2(Math.sqrt(a), Math.sqrt(<span class="num">1</span>-a));
}

navigator.geolocation.getCurrentPosition((pos) => {
  <span class="kw">const</span> dist = <span class="fn">haversineDistance</span>(
    pos.coords.latitude, pos.coords.longitude,
    <span class="num">48.8584</span>, <span class="num">2.2945</span>
  );
  console.log(<span class="str">`Distance to Eiffel Tower: ${dist.toFixed(1)} km`</span>);
});</div></div>
    </div>
  </div>

  <button class="complete-section-btn" onclick="completeSection('geolocation')">‚úÖ Mark Geolocation as Complete</button>
</section>

<!-- ==================== WEB WORKERS ==================== -->
<section class="section" id="webworkers">
  <div class="section-hero">
    <div class="hero-icon">‚öôÔ∏è</div>
    <h2>Web Workers</h2>
    <p>Run JavaScript in background threads without blocking the UI. Essential for heavy computations, data processing, and keeping your app responsive!</p>
  </div>

  <div class="card">
    <h3>üß† The Problem: Single-Threaded JavaScript</h3>
    <p>JavaScript runs on a <span class="highlight">single thread</span>. Heavy operations block EVERYTHING ‚Äî animations freeze, buttons stop working, users rage-quit.</p>
    <div class="diagram">
      <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:12px;">Without Web Workers ‚Äî Everything blocks!</p>
      <div class="diagram-row">
        <div class="diagram-box d-orange">UI Rendering</div>
        <div class="diagram-box d-pink" style="min-width:200px;">üîí Heavy Computation<br><small>(everything frozen!)</small></div>
        <div class="diagram-box d-orange">Event Handlers</div>
      </div>
      <div style="margin:16px 0; color:var(--text-dim);">‚Üì With Web Workers ‚Üì</div>
      <div class="diagram-row">
        <div style="flex:1;">
          <div class="diagram-box d-blue" style="width:100%;">Main Thread<br><small>UI + Events (smooth!)</small></div>
        </div>
        <div style="flex:1;">
          <div class="diagram-box d-green" style="width:100%;">Worker Thread<br><small>Heavy computation</small></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üî• Example 1: Creating a Web Worker</h3>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>main.js</span>
      </div>
      <div class="code-body"><span class="cm">// Create a worker from a file</span>
<span class="kw">const</span> worker = <span class="kw">new</span> <span class="fn">Worker</span>(<span class="str">'heavy-task.js'</span>);

<span class="cm">// Send data to worker</span>
worker.<span class="fn">postMessage</span>({ numbers: [<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>, <span class="num">4</span>, <span class="num">5</span>] });

<span class="cm">// Receive result from worker</span>
worker.<span class="fn">onmessage</span> = (event) <span class="op">=></span> {
  <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Result:'</span>, event.<span class="pr">data</span>);
};

<span class="cm">// Handle errors</span>
worker.<span class="fn">onerror</span> = (error) <span class="op">=></span> {
  <span class="obj">console</span>.<span class="fn">error</span>(<span class="str">'Worker error:'</span>, error.<span class="pr">message</span>);
};

<span class="cm">// Terminate when done</span>
<span class="cm">// worker.terminate();</span></div>
    </div>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>heavy-task.js (Worker file)</span>
      </div>
      <div class="code-body"><span class="cm">// Inside the worker ‚Äî different global scope (no DOM!)</span>
<span class="obj">self</span>.<span class="fn">onmessage</span> = (event) <span class="op">=></span> {
  <span class="kw">const</span> numbers = event.<span class="pr">data</span>.numbers;

  <span class="cm">// Heavy computation</span>
  <span class="kw">let</span> sum = <span class="num">0</span>;
  <span class="kw">for</span> (<span class="kw">let</span> n <span class="kw">of</span> numbers) {
    sum += n * n;
  }

  <span class="cm">// Send result back to main thread</span>
  <span class="obj">self</span>.<span class="fn">postMessage</span>(sum);
};</div>
    </div>
  </div>

  <div class="card">
    <h3>‚ö° LIVE DEMO: Main Thread vs Web Worker</h3>
    <p style="margin-bottom:16px;">Watch the spinning box. When you run heavy computation on the main thread, the animation <span style="color:var(--danger)">freezes</span>. With a Worker, it stays <span class="highlight-green">smooth</span>!</p>

    <div class="thread-visual">
      <div class="thread-lane">
        <h5 style="color:var(--accent4);">üîí Main Thread (Blocking)</h5>
        <div class="anim-box" id="anim-main"></div>
        <div class="thread-bar-track"><div class="thread-bar bar-main" id="bar-main"></div></div>
        <button class="btn btn-orange btn-sm" onclick="demoMainThread()">Run Heavy Task</button>
        <div style="font-size:0.75rem; color:var(--text-dim); margin-top:8px;" id="main-time"></div>
      </div>
      <div class="thread-lane">
        <h5 style="color:var(--accent1);">‚ú® Web Worker (Non-Blocking)</h5>
        <div class="anim-box" id="anim-worker"></div>
        <div class="thread-bar-track"><div class="thread-bar bar-worker" id="bar-worker"></div></div>
        <button class="btn btn-primary btn-sm" onclick="demoWorkerThread()">Run Heavy Task</button>
        <div style="font-size:0.75rem; color:var(--text-dim); margin-top:8px;" id="worker-time"></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üî• Example 2: Inline Worker (No Separate File!)</h3>
    <p>Create workers without a separate file using Blob URLs ‚Äî great for demos and small tasks.</p>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>inline-worker.js</span>
      </div>
      <div class="code-body"><span class="kw">const</span> workerCode = <span class="str">`
  self.onmessage = function(e) {
    let result = 0;
    for (let i = 0; i < e.data; i++) {
      result += Math.sqrt(i);
    }
    self.postMessage(result);
  };
`</span>;

<span class="kw">const</span> blob = <span class="kw">new</span> <span class="fn">Blob</span>([workerCode], { type: <span class="str">'application/javascript'</span> });
<span class="kw">const</span> worker = <span class="kw">new</span> <span class="fn">Worker</span>(URL.<span class="fn">createObjectURL</span>(blob));

worker.<span class="fn">postMessage</span>(<span class="num">100000000</span>);
worker.<span class="fn">onmessage</span> = (e) <span class="op">=></span> <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Done!'</span>, e.data);</div>
    </div>
    <div class="demo-area">
      <h4>üéÆ Run Inline Worker</h4>
      <button class="btn btn-primary" onclick="demoInlineWorker()">‚ö° Run Inline Worker</button>
      <div class="output-box" id="inline-worker-output">Click to run an inline worker...</div>
    </div>
  </div>

  <div class="card">
    <h3>üìã What Workers CAN and CAN'T Do</h3>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
      <div>
        <h4 style="color:var(--accent2); margin-bottom:8px;">‚úÖ CAN Access</h4>
        <ul>
          <li><code>navigator</code></li>
          <li><code>location</code> (read-only)</li>
          <li><code>XMLHttpRequest</code> / <code>fetch</code></li>
          <li><code>setTimeout</code> / <code>setInterval</code></li>
          <li><code>IndexedDB</code></li>
          <li><code>WebSockets</code></li>
          <li><code>importScripts()</code></li>
        </ul>
      </div>
      <div>
        <h4 style="color:var(--danger); margin-bottom:8px;">‚ùå CANNOT Access</h4>
        <ul>
          <li><code>document</code> (no DOM!)</li>
          <li><code>window</code></li>
          <li><code>parent</code></li>
          <li><code>alert()</code> / <code>confirm()</code></li>
          <li>Any DOM manipulation</li>
          <li><code>localStorage</code></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- MISTAKES -->
  <div class="card">
    <h3>‚ö†Ô∏è Common Mistakes & Pitfalls</h3>

    <div class="mistake-card">
      <h4>‚ùå Mistake 1: Trying to access DOM from a Worker</h4>
      <div class="code-block"><div class="code-body"><span class="cm">// Inside worker ‚Äî THIS WILL CRASH!</span>
document.getElementById(<span class="str">'result'</span>).textContent = <span class="str">'Done'</span>;
<span class="cm">// ReferenceError: document is not defined</span></div></div>
    </div>
    <div class="fix-card">
      <h4>‚úÖ Fix: Post result back to main thread</h4>
      <div class="code-block"><div class="code-body"><span class="cm">// Worker sends data back</span>
self.postMessage({ result: <span class="str">'Done'</span> });

<span class="cm">// Main thread updates DOM</span>
worker.onmessage = (e) => {
  document.getElementById(<span class="str">'result'</span>).textContent = e.data.result;
};</div></div>
    </div>

    <div class="mistake-card">
      <h4>‚ùå Mistake 2: Forgetting to terminate workers</h4>
      <p>Workers keep running until terminated. Memory leaks galore!</p>
    </div>
    <div class="fix-card">
      <h4>‚úÖ Fix: Always terminate when done</h4>
      <div class="code-block"><div class="code-body">worker.onmessage = (e) => {
  handleResult(e.data);
  worker.<span class="fn">terminate</span>(); <span class="cm">// Clean up!</span>
};</div></div>
    </div>

    <div class="mistake-card">
      <h4>‚ùå Mistake 3: Sending huge data objects (copying overhead)</h4>
      <p><code>postMessage()</code> copies data by default. Huge arrays get cloned ‚Äî slow!</p>
    </div>
    <div class="fix-card">
      <h4>‚úÖ Fix: Use Transferable Objects for large data</h4>
      <div class="code-block"><div class="code-body"><span class="kw">const</span> buffer = <span class="kw">new</span> ArrayBuffer(<span class="num">1024</span> * <span class="num">1024</span>);
<span class="cm">// Transfer ownership instead of copying</span>
worker.postMessage(buffer, [buffer]);
<span class="cm">// buffer is now neutered (empty) in main thread!</span></div></div>
    </div>
  </div>

  <!-- QUIZ -->
  <div class="card">
    <h3>üß™ Quiz: Web Workers</h3>
    <div class="quiz-container" id="quiz-workers"></div>
  </div>

  <div class="exercise-box">
    <h4>üí™ Exercise: Prime Number Finder Worker</h4>
    <p>Create an inline Web Worker that finds all prime numbers up to a given number N. Post N to the worker and receive the array of primes back. Display them in the output box.</p>
    <textarea class="exercise-editor" placeholder="// Create an inline worker that finds primes
// Hint: Use a Blob and URL.createObjectURL

const workerCode = `
  self.onmessage = (e) => {
    const N = e.data;
    // Find all primes up to N
    // Post them back
  };
`;

// Your code here..."></textarea>
    <button class="btn btn-primary btn-sm" onclick="runPrimeExercise()">‚ñ∂ Run</button>
    <div class="output-box" id="prime-output"></div>
    <button class="solution-toggle" onclick="toggleSolution('sol-workers')">üëÅ Show Solution</button>
    <div class="solution-box" id="sol-workers">
      <div class="code-block"><div class="code-body"><span class="kw">const</span> code = <span class="str">`
  self.onmessage = (e) => {
    const N = e.data;
    const primes = [];
    for (let i = 2; i <= N; i++) {
      let isPrime = true;
      for (let j = 2; j <= Math.sqrt(i); j++) {
        if (i % j === 0) { isPrime = false; break; }
      }
      if (isPrime) primes.push(i);
    }
    self.postMessage(primes);
  };
`</span>;
<span class="kw">const</span> blob = <span class="kw">new</span> Blob([code], {type:<span class="str">'application/javascript'</span>});
<span class="kw">const</span> w = <span class="kw">new</span> Worker(URL.createObjectURL(blob));
w.postMessage(<span class="num">100</span>);
w.onmessage = (e) => {
  console.log(<span class="str">'Primes:'</span>, e.data);
  w.terminate();
};</div></div>
    </div>
  </div>

  <button class="complete-section-btn" onclick="completeSection('webworkers')">‚úÖ Mark Web Workers as Complete</button>
</section>

<!-- ==================== SERVICE WORKERS ==================== -->
<section class="section" id="serviceworkers">
  <div class="section-hero">
    <div class="hero-icon">üîß</div>
    <h2>Service Workers</h2>
    <p>The backbone of Progressive Web Apps. Intercept network requests, cache assets, enable offline functionality, and handle push notifications!</p>
  </div>

  <div class="card">
    <h3>üß† What Makes Service Workers Special?</h3>
    <p>A Service Worker is a <span class="highlight">proxy between your web app and the network</span>. It runs in the background, even after the page is closed!</p>
    <div class="tip">‚ö° Service Workers ‚â† Web Workers! They serve completely different purposes.</div>
    <table class="api-table">
      <tr><th>Feature</th><th>Web Worker</th><th>Service Worker</th></tr>
      <tr><td>Purpose</td><td>Heavy computation</td><td>Network proxy, caching</td></tr>
      <tr><td>Lifetime</td><td>Tied to page</td><td>Independent of page</td></tr>
      <tr><td>DOM Access</td><td>‚ùå</td><td>‚ùå</td></tr>
      <tr><td>HTTPS Required</td><td>‚ùå</td><td>‚úÖ</td></tr>
      <tr><td>Multiple pages</td><td>One page</td><td>Controls all pages in scope</td></tr>
      <tr><td>Can intercept fetch</td><td>‚ùå</td><td>‚úÖ</td></tr>
    </table>
  </div>

  <div class="card">
    <h3>üîÑ Service Worker Lifecycle</h3>
    <p>Understanding the lifecycle is CRUCIAL for interviews. Click each step to learn more:</p>
    <div class="diagram">
      <div class="lifecycle" id="sw-lifecycle">
        <div class="lifecycle-step d-blue" data-step="register" onclick="showLifecycleInfo('register')">1. Register</div>
        <span class="lifecycle-arrow">‚Üí</span>
        <div class="lifecycle-step d-purple" data-step="install" onclick="showLifecycleInfo('install')">2. Install</div>
        <span class="lifecycle-arrow">‚Üí</span>
        <div class="lifecycle-step d-orange" data-step="waiting" onclick="showLifecycleInfo('waiting')">3. Waiting</div>
        <span class="lifecycle-arrow">‚Üí</span>
        <div class="lifecycle-step d-green" data-step="activate" onclick="showLifecycleInfo('activate')">4. Activate</div>
        <span class="lifecycle-arrow">‚Üí</span>
        <div class="lifecycle-step d-pink" data-step="fetch" onclick="showLifecycleInfo('fetch')">5. Fetch/Idle</div>
      </div>
      <div id="lifecycle-info" class="output-box" style="min-height:80px; color:var(--text-dim);">
        üëÜ Click a lifecycle step to learn about it!
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üî• Example: Registration & Installation</h3>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>app.js (Main thread)</span>
      </div>
      <div class="code-body"><span class="cm">// Register Service Worker</span>
<span class="kw">if</span> (<span class="str">'serviceWorker'</span> <span class="kw">in</span> navigator) {
  navigator.serviceWorker.<span class="fn">register</span>(<span class="str">'/sw.js'</span>, { scope: <span class="str">'/'</span> })
    .<span class="fn">then</span>((registration) <span class="op">=></span> {
      <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'SW registered!'</span>, registration.scope);

      <span class="cm">// Check the state</span>
      <span class="kw">if</span> (registration.installing) <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Installing...'</span>);
      <span class="kw">if</span> (registration.waiting) <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Waiting...'</span>);
      <span class="kw">if</span> (registration.active) <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Active!'</span>);
    })
    .<span class="fn">catch</span>((error) <span class="op">=></span> {
      <span class="obj">console</span>.<span class="fn">error</span>(<span class="str">'SW registration failed:'</span>, error);
    });
}</div>
    </div>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>sw.js (Service Worker file)</span>
      </div>
      <div class="code-body"><span class="kw">const</span> CACHE_NAME = <span class="str">'my-app-v1'</span>;
<span class="kw">const</span> urlsToCache = [<span class="str">'/'</span>, <span class="str">'/styles.css'</span>, <span class="str">'/app.js'</span>, <span class="str">'/offline.html'</span>];

<span class="cm">// INSTALL ‚Äî Cache critical assets</span>
self.<span class="fn">addEventListener</span>(<span class="str">'install'</span>, (event) <span class="op">=></span> {
  event.<span class="fn">waitUntil</span>(
    caches.<span class="fn">open</span>(CACHE_NAME).<span class="fn">then</span>((cache) <span class="op">=></span> {
      <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Caching app shell'</span>);
      <span class="kw">return</span> cache.<span class="fn">addAll</span>(urlsToCache);
    })
  );
});

<span class="cm">// ACTIVATE ‚Äî Clean old caches</span>
self.<span class="fn">addEventListener</span>(<span class="str">'activate'</span>, (event) <span class="op">=></span> {
  event.<span class="fn">waitUntil</span>(
    caches.<span class="fn">keys</span>().<span class="fn">then</span>((names) <span class="op">=></span> {
      <span class="kw">return</span> Promise.<span class="fn">all</span>(
        names.<span class="fn">filter</span>(n <span class="op">=></span> n !== CACHE_NAME)
          .<span class="fn">map</span>(n <span class="op">=></span> caches.<span class="fn">delete</span>(n))
      );
    })
  );
});

<span class="cm">// FETCH ‚Äî Serve from cache, fallback to network</span>
self.<span class="fn">addEventListener</span>(<span class="str">'fetch'</span>, (event) <span class="op">=></span> {
  event.<span class="fn">respondWith</span>(
    caches.<span class="fn">match</span>(event.request).<span class="fn">then</span>((response) <span class="op">=></span> {
      <span class="kw">return</span> response || <span class="fn">fetch</span>(event.request);
    })
  );
});</div>
    </div>
  </div>

  <div class="card">
    <h3>üì¶ Caching Strategies</h3>
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab(this,'cache-tabs')">Cache First</button>
      <button class="tab-btn" onclick="switchTab(this,'cache-tabs')">Network First</button>
      <button class="tab-btn" onclick="switchTab(this,'cache-tabs')">Stale While Revalidate</button>
      <button class="tab-btn" onclick="switchTab(this,'cache-tabs')">Cache Only</button>
    </div>
    <div id="cache-tabs">
      <div class="tab-pane active">
        <p><strong>Cache First</strong> ‚Äî Check cache, fallback to network. Best for static assets.</p>
        <div class="diagram">
          <div class="diagram-row">
            <div class="diagram-box d-blue">Request</div>
            <span class="diagram-arrow">‚Üí</span>
            <div class="diagram-box d-green">Cache ‚úÖ?</div>
            <span class="diagram-arrow">‚Üí</span>
            <div class="diagram-box d-orange">Network (fallback)</div>
          </div>
        </div>
        <div class="code-block"><div class="code-body">event.respondWith(
  caches.match(event.request).then(cached => {
    return cached || fetch(event.request);
  })
);</div></div>
      </div>
      <div class="tab-pane">
        <p><strong>Network First</strong> ‚Äî Try network, fallback to cache. Best for dynamic content.</p>
        <div class="diagram">
          <div class="diagram-row">
            <div class="diagram-box d-blue">Request</div>
            <span class="diagram-arrow">‚Üí</span>
            <div class="diagram-box d-orange">Network ‚úÖ?</div>
            <span class="diagram-arrow">‚Üí</span>
            <div class="diagram-box d-green">Cache (fallback)</div>
          </div>
        </div>
        <div class="code-block"><div class="code-body">event.respondWith(
  fetch(event.request)
    .then(response => {
      <span class="cm">// Update cache with fresh data</span>
      const clone = response.clone();
      caches.open(CACHE).then(c => c.put(event.request, clone));
      return response;
    })
    .catch(() => caches.match(event.request))
);</div></div>
      </div>
      <div class="tab-pane">
        <p><strong>Stale While Revalidate</strong> ‚Äî Serve cache immediately, update in background. Best UX!</p>
        <div class="diagram">
          <div class="diagram-row">
            <div class="diagram-box d-blue">Request</div>
            <span class="diagram-arrow">‚Üí</span>
            <div class="diagram-box d-green">Cache (instant!)</div>
          </div>
          <div class="diagram-row">
            <div class="diagram-box d-blue" style="opacity:0.5;">Meanwhile...</div>
            <span class="diagram-arrow">‚Üí</span>
            <div class="diagram-box d-orange">Network ‚Üí Update Cache</div>
          </div>
        </div>
        <div class="code-block"><div class="code-body">event.respondWith(
  caches.match(event.request).then(cached => {
    const fetchPromise = fetch(event.request).then(response => {
      caches.open(CACHE).then(c => c.put(event.request, response.clone()));
      return response;
    });
    return cached || fetchPromise;
  })
);</div></div>
      </div>
      <div class="tab-pane">
        <p><strong>Cache Only</strong> ‚Äî Only serve from cache. For pre-cached offline shells.</p>
        <div class="code-block"><div class="code-body">event.respondWith(caches.match(event.request));</div></div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>‚ö†Ô∏è Common Mistakes & Pitfalls</h3>
    <div class="mistake-card">
      <h4>‚ùå Mistake 1: Forgetting HTTPS</h4>
      <p>Service Workers only work on HTTPS (and localhost for dev). No HTTP!</p>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 2: Not handling SW updates</h4>
      <p>A new SW won't activate until ALL tabs using the old SW are closed. Users get stuck on old versions!</p>
    </div>
    <div class="fix-card">
      <h4>‚úÖ Fix: Use skipWaiting()</h4>
      <div class="code-block"><div class="code-body">self.addEventListener(<span class="str">'install'</span>, () => {
  self.skipWaiting(); <span class="cm">// Activate immediately</span>
});
self.addEventListener(<span class="str">'activate'</span>, (event) => {
  event.waitUntil(clients.claim()); <span class="cm">// Take control of pages</span>
});</div></div>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 3: Caching everything</h4>
      <p>Don't cache API responses with user data, auth tokens, or frequently changing content without a strategy.</p>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 4: Not versioning caches</h4>
      <p>Without version names, users get stale cached content forever.</p>
    </div>
  </div>

  <div class="card">
    <h3>üß™ Quiz: Service Workers</h3>
    <div class="quiz-container" id="quiz-sw"></div>
  </div>

  <div class="exercise-box">
    <h4>üí™ Exercise: Write a Service Worker</h4>
    <p>Write a complete Service Worker that: 1) Caches an app shell on install, 2) Cleans old caches on activate, 3) Uses "Network First" strategy for API calls and "Cache First" for static assets.</p>
    <textarea class="exercise-editor" placeholder="// sw.js - Write your Service Worker here
const CACHE = 'app-v2';

self.addEventListener('install', (event) => {
  // Cache app shell
});

self.addEventListener('activate', (event) => {
  // Clean old caches
});

self.addEventListener('fetch', (event) => {
  // Different strategy based on URL
});"></textarea>
    <button class="solution-toggle" onclick="toggleSolution('sol-sw')">üëÅ Show Solution</button>
    <div class="solution-box" id="sol-sw">
      <div class="code-block"><div class="code-body"><span class="kw">const</span> CACHE = <span class="str">'app-v2'</span>;
<span class="kw">const</span> SHELL = [<span class="str">'/'</span>, <span class="str">'/index.html'</span>, <span class="str">'/style.css'</span>, <span class="str">'/app.js'</span>];

self.addEventListener(<span class="str">'install'</span>, (event) => {
  event.waitUntil(
    caches.open(CACHE).then(c => c.addAll(SHELL))
  );
  self.skipWaiting();
});

self.addEventListener(<span class="str">'activate'</span>, (event) => {
  event.waitUntil(
    caches.keys().then(keys =>
      Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))
    )
  );
  clients.claim();
});

self.addEventListener(<span class="str">'fetch'</span>, (event) => {
  <span class="kw">const</span> url = <span class="kw">new</span> URL(event.request.url);

  <span class="cm">// Network First for API</span>
  <span class="kw">if</span> (url.pathname.startsWith(<span class="str">'/api/'</span>)) {
    event.respondWith(
      fetch(event.request)
        .then(res => {
          <span class="kw">const</span> clone = res.clone();
          caches.open(CACHE).then(c => c.put(event.request, clone));
          <span class="kw">return</span> res;
        })
        .catch(() => caches.match(event.request))
    );
  } <span class="kw">else</span> {
    <span class="cm">// Cache First for static</span>
    event.respondWith(
      caches.match(event.request).then(r => r || fetch(event.request))
    );
  }
});</div></div>
    </div>
  </div>

  <button class="complete-section-btn" onclick="completeSection('serviceworkers')">‚úÖ Mark Service Workers as Complete</button>
</section>

<!-- ==================== WEBSOCKETS ==================== -->
<section class="section" id="websockets">
  <div class="section-hero">
    <div class="hero-icon">üîå</div>
    <h2>WebSocket API</h2>
    <p>Full-duplex, persistent connections for real-time communication. Used in chat apps, live dashboards, gaming, stock tickers & more!</p>
  </div>

  <div class="card">
    <h3>üß† HTTP vs WebSocket</h3>
    <div class="diagram">
      <p style="color:var(--text-dim); margin-bottom:12px;"><strong>HTTP:</strong> Request ‚Üí Response (one-way, each time)</p>
      <div class="diagram-row">
        <div class="diagram-box d-blue">Client</div>
        <span class="diagram-arrow">‚Üí</span>
        <div class="diagram-box d-orange">Server</div>
        <span class="diagram-arrow" style="transform: scaleX(-1);">‚Üí</span>
        <div class="diagram-box d-blue">Client</div>
      </div>
      <p style="color:var(--text-dim); margin:16px 0;"><strong>WebSocket:</strong> Persistent two-way connection</p>
      <div class="diagram-row">
        <div class="diagram-box d-green">Client</div>
        <span class="diagram-arrow">‚áÑ</span>
        <div class="diagram-box d-green">Server</div>
      </div>
      <p style="font-size:0.8rem; color:var(--accent2); margin-top:8px;">‚Üë Both can send at any time! No polling needed.</p>
    </div>
  </div>

  <div class="card">
    <h3>üî• Example: WebSocket Connection</h3>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>websocket.js</span>
      </div>
      <div class="code-body"><span class="cm">// Create connection (ws:// or wss:// for secure)</span>
<span class="kw">const</span> ws = <span class="kw">new</span> <span class="fn">WebSocket</span>(<span class="str">'wss://echo.websocket.org'</span>);

<span class="cm">// Connection opened</span>
ws.<span class="fn">addEventListener</span>(<span class="str">'open'</span>, () <span class="op">=></span> {
  <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Connected!'</span>);
  ws.<span class="fn">send</span>(<span class="str">'Hello Server!'</span>);
});

<span class="cm">// Receive messages</span>
ws.<span class="fn">addEventListener</span>(<span class="str">'message'</span>, (event) <span class="op">=></span> {
  <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Server said:'</span>, event.<span class="pr">data</span>);
});

<span class="cm">// Connection closed</span>
ws.<span class="fn">addEventListener</span>(<span class="str">'close'</span>, (event) <span class="op">=></span> {
  <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">`Closed: ${event.code} ${event.reason}`</span>);
});

<span class="cm">// Handle errors</span>
ws.<span class="fn">addEventListener</span>(<span class="str">'error'</span>, (error) <span class="op">=></span> {
  <span class="obj">console</span>.<span class="fn">error</span>(<span class="str">'WebSocket error:'</span>, error);
});

<span class="cm">// Close when done</span>
<span class="cm">// ws.close(1000, 'Normal closure');</span></div>
    </div>
  </div>

  <div class="card">
    <h3>üìã WebSocket readyState</h3>
    <table class="api-table">
      <tr><th>Value</th><th>Constant</th><th>Description</th></tr>
      <tr><td><code>0</code></td><td><code>CONNECTING</code></td><td>Connection not yet open</td></tr>
      <tr><td><code>1</code></td><td><code>OPEN</code></td><td>Connection open, ready to communicate</td></tr>
      <tr><td><code>2</code></td><td><code>CLOSING</code></td><td>Connection is closing</td></tr>
      <tr><td><code>3</code></td><td><code>CLOSED</code></td><td>Connection is closed</td></tr>
    </table>
  </div>

  <div class="card">
    <h3>üí¨ Live Demo: WebSocket Chat Simulator</h3>
    <div class="demo-area">
      <h4>üéÆ Interactive Chat <span class="status-dot status-red" id="ws-status-dot"></span><span id="ws-status-text" style="font-size:0.75rem; color:var(--text-dim);">Disconnected</span></h4>
      <div class="btn-group">
        <button class="btn btn-success btn-sm" onclick="wsConnect()">üîå Connect</button>
        <button class="btn btn-danger btn-sm" onclick="wsDisconnect()">‚úñ Disconnect</button>
      </div>
      <div class="chat-box" id="ws-chat"></div>
      <div class="chat-input-row">
        <input class="chat-input" id="ws-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter')wsSend()">
        <button class="btn btn-primary btn-sm" onclick="wsSend()">Send</button>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üîÑ Example: Auto-Reconnect Pattern</h3>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>reconnect.js</span>
      </div>
      <div class="code-body"><span class="kw">class</span> <span class="fn">ReconnectingWS</span> {
  <span class="fn">constructor</span>(url, maxRetries = <span class="num">5</span>) {
    <span class="kw">this</span>.url = url;
    <span class="kw">this</span>.maxRetries = maxRetries;
    <span class="kw">this</span>.retries = <span class="num">0</span>;
    <span class="kw">this</span>.<span class="fn">connect</span>();
  }

  <span class="fn">connect</span>() {
    <span class="kw">this</span>.ws = <span class="kw">new</span> WebSocket(<span class="kw">this</span>.url);

    <span class="kw">this</span>.ws.onopen = () <span class="op">=></span> {
      <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Connected!'</span>);
      <span class="kw">this</span>.retries = <span class="num">0</span>; <span class="cm">// Reset on success</span>
    };

    <span class="kw">this</span>.ws.onclose = () <span class="op">=></span> {
      <span class="kw">if</span> (<span class="kw">this</span>.retries < <span class="kw">this</span>.maxRetries) {
        <span class="kw">const</span> delay = Math.min(<span class="num">1000</span> * <span class="num">2</span> ** <span class="kw">this</span>.retries, <span class="num">30000</span>);
        <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">`Reconnecting in ${delay}ms...`</span>);
        setTimeout(() <span class="op">=></span> <span class="kw">this</span>.<span class="fn">connect</span>(), delay);
        <span class="kw">this</span>.retries++;
      }
    };
  }

  <span class="fn">send</span>(data) {
    <span class="kw">if</span> (<span class="kw">this</span>.ws.readyState === WebSocket.OPEN) {
      <span class="kw">this</span>.ws.<span class="fn">send</span>(JSON.<span class="fn">stringify</span>(data));
    }
  }
}</div>
    </div>
    <div class="tip">üí° Exponential backoff prevents hammering the server with reconnection attempts!</div>
  </div>

  <div class="card">
    <h3>‚ö†Ô∏è Common Mistakes & Pitfalls</h3>
    <div class="mistake-card">
      <h4>‚ùå Mistake 1: Sending before connection is open</h4>
      <div class="code-block"><div class="code-body"><span class="kw">const</span> ws = <span class="kw">new</span> WebSocket(url);
ws.send(<span class="str">'Hello'</span>); <span class="cm">// ERROR! Still connecting!</span></div></div>
    </div>
    <div class="fix-card">
      <h4>‚úÖ Fix: Wait for the 'open' event</h4>
      <div class="code-block"><div class="code-body">ws.addEventListener(<span class="str">'open'</span>, () => {
  ws.send(<span class="str">'Hello'</span>); <span class="cm">// Safe!</span>
});</div></div>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 2: Not handling disconnections</h4>
      <p>Network is unreliable. Always implement reconnection logic!</p>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 3: Sending objects directly</h4>
      <div class="code-block"><div class="code-body">ws.send({ type: <span class="str">'msg'</span> }); <span class="cm">// Sends "[object Object]"!</span>
ws.send(JSON.stringify({ type: <span class="str">'msg'</span> })); <span class="cm">// Correct!</span></div></div>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 4: Using ws:// in production</h4>
      <p>Always use <code>wss://</code> (WebSocket Secure) in production ‚Äî just like HTTPS.</p>
    </div>
  </div>

  <div class="card">
    <h3>üß™ Quiz: WebSocket API</h3>
    <div class="quiz-container" id="quiz-ws"></div>
  </div>

  <div class="exercise-box">
    <h4>üí™ Exercise: Build a ReconnectingWebSocket</h4>
    <p>Implement a WebSocket wrapper class that: auto-reconnects with exponential backoff, queues messages sent while disconnected, has max retry limit, emits custom events.</p>
    <textarea class="exercise-editor" placeholder="class SmartWebSocket {
  constructor(url) {
    this.url = url;
    this.queue = [];
    // Your implementation...
  }
}"></textarea>
    <button class="solution-toggle" onclick="toggleSolution('sol-ws')">üëÅ Show Solution</button>
    <div class="solution-box" id="sol-ws">
      <div class="code-block"><div class="code-body"><span class="kw">class</span> SmartWebSocket {
  constructor(url, maxRetries = <span class="num">10</span>) {
    this.url = url;
    this.maxRetries = maxRetries;
    this.retries = <span class="num">0</span>;
    this.queue = [];
    this.listeners = {};
    this.connect();
  }
  connect() {
    this.ws = new WebSocket(this.url);
    this.ws.onopen = () => {
      this.retries = <span class="num">0</span>;
      this.emit(<span class="str">'connected'</span>);
      <span class="cm">// Flush queued messages</span>
      while (this.queue.length) {
        this.ws.send(this.queue.shift());
      }
    };
    this.ws.onmessage = (e) => this.emit(<span class="str">'message'</span>, e.data);
    this.ws.onclose = () => {
      this.emit(<span class="str">'disconnected'</span>);
      if (this.retries < this.maxRetries) {
        const delay = Math.min(<span class="num">1000</span> * <span class="num">2</span> ** this.retries++, <span class="num">30000</span>);
        setTimeout(() => this.connect(), delay);
      }
    };
  }
  send(data) {
    const msg = typeof data === <span class="str">'string'</span> ? data : JSON.stringify(data);
    if (this.ws.readyState === WebSocket.OPEN) {
      this.ws.send(msg);
    } else {
      this.queue.push(msg);
    }
  }
  on(event, fn) { (this.listeners[event] ??= []).push(fn); }
  emit(event, ...args) { (this.listeners[event] || []).forEach(fn => fn(...args)); }
  close() { this.maxRetries = <span class="num">0</span>; this.ws.close(); }
}</div></div>
    </div>
  </div>

  <button class="complete-section-btn" onclick="completeSection('websockets')">‚úÖ Mark WebSockets as Complete</button>
</section>

<!-- ==================== NOTIFICATIONS ==================== -->
<section class="section" id="notifications">
  <div class="section-hero">
    <div class="hero-icon">üîî</div>
    <h2>Notification API</h2>
    <p>Display native OS notifications to users even when your app tab isn't focused. Used for chat alerts, reminders, breaking news & more!</p>
  </div>

  <div class="card">
    <h3>üß† How Notifications Work</h3>
    <div class="diagram">
      <div class="diagram-row">
        <div class="diagram-box d-purple">1. Request<br>Permission</div>
        <span class="diagram-arrow">‚Üí</span>
        <div class="diagram-box d-blue">2. User Grants/<br>Denies</div>
        <span class="diagram-arrow">‚Üí</span>
        <div class="diagram-box d-green">3. Create<br>Notification</div>
        <span class="diagram-arrow">‚Üí</span>
        <div class="diagram-box d-orange">4. Handle<br>Click/Close</div>
      </div>
    </div>

    <table class="api-table" style="margin-top:16px;">
      <tr><th>Permission State</th><th>Meaning</th></tr>
      <tr><td><code>"default"</code></td><td>User hasn't decided yet ‚Äî you CAN ask</td></tr>
      <tr><td><code>"granted"</code></td><td>User said YES ‚Äî send notifications!</td></tr>
      <tr><td><code>"denied"</code></td><td>User said NO ‚Äî you CANNOT ask again programmatically</td></tr>
    </table>
  </div>

  <div class="card">
    <h3>üî• Example: Request Permission & Send Notification</h3>
    <div class="code-block">
      <div class="code-header">
        <div class="dots"><span class="dot dot-red"></span><span class="dot dot-yellow"></span><span class="dot dot-green"></span></div>
        <span>notifications.js</span>
      </div>
      <div class="code-body"><span class="cm">// Step 1: Request permission</span>
<span class="kw">async function</span> <span class="fn">requestNotificationPermission</span>() {
  <span class="kw">const</span> permission = <span class="kw">await</span> Notification.<span class="fn">requestPermission</span>();

  <span class="kw">if</span> (permission === <span class="str">'granted'</span>) {
    <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Permission granted!'</span>);
    <span class="fn">showNotification</span>();
  } <span class="kw">else if</span> (permission === <span class="str">'denied'</span>) {
    <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Permission denied. Cannot ask again.'</span>);
  }
}

<span class="cm">// Step 2: Create notification</span>
<span class="kw">function</span> <span class="fn">showNotification</span>() {
  <span class="kw">const</span> notification = <span class="kw">new</span> <span class="fn">Notification</span>(<span class="str">'Hello! üëã'</span>, {
    body: <span class="str">'You have a new message from Web APIs Mastery'</span>,
    icon: <span class="str">'https://via.placeholder.com/64/7c3aed/fff?text=üîî'</span>,
    badge: <span class="str">'https://via.placeholder.com/32'</span>,
    tag: <span class="str">'unique-id'</span>,       <span class="cm">// Prevents duplicate notifications</span>
    requireInteraction: <span class="kw">false</span>, <span class="cm">// Auto-close after a while</span>
    silent: <span class="kw">false</span>,             <span class="cm">// Play default sound</span>
    data: { url: <span class="str">'/messages'</span> } <span class="cm">// Custom data</span>
  });

  <span class="cm">// Handle click</span>
  notification.<span class="fn">onclick</span> = (event) <span class="op">=></span> {
    <span class="obj">window</span>.<span class="fn">focus</span>();
    <span class="obj">window</span>.location.href = event.target.<span class="pr">data</span>.url;
    notification.<span class="fn">close</span>();
  };

  <span class="cm">// Handle close</span>
  notification.<span class="fn">onclose</span> = () <span class="op">=></span> <span class="obj">console</span>.<span class="fn">log</span>(<span class="str">'Notification closed'</span>);
}</div>
    </div>
  </div>

  <div class="card">
    <h3>üéÆ Live Demo: Try Notifications</h3>
    <div class="demo-area">
      <h4>üìä Current Permission: <span id="notif-permission" class="badge badge-purple">checking...</span></h4>
      <div class="btn-group">
        <button class="btn btn-purple" onclick="demoNotifPermission()">üîê Request Permission</button>
        <button class="btn btn-primary" onclick="demoNotifBasic()">üîî Basic Notification</button>
        <button class="btn btn-orange" onclick="demoNotifRich()">üé® Rich Notification</button>
      </div>
      <div class="output-box" id="notif-output">Try the buttons above to test notifications!</div>
    </div>
  </div>

  <div class="card">
    <h3>üìã Notification Options</h3>
    <table class="api-table">
      <tr><th>Option</th><th>Type</th><th>Description</th></tr>
      <tr><td><code>body</code></td><td>String</td><td>Body text of notification</td></tr>
      <tr><td><code>icon</code></td><td>URL</td><td>Large icon image</td></tr>
      <tr><td><code>badge</code></td><td>URL</td><td>Small badge icon (mobile)</td></tr>
      <tr><td><code>image</code></td><td>URL</td><td>Large image in notification body</td></tr>
      <tr><td><code>tag</code></td><td>String</td><td>ID to prevent duplicates</td></tr>
      <tr><td><code>data</code></td><td>Any</td><td>Custom data accessible in handlers</td></tr>
      <tr><td><code>actions</code></td><td>Array</td><td>Buttons (Service Worker only)</td></tr>
      <tr><td><code>requireInteraction</code></td><td>Boolean</td><td>Stay visible until user interacts</td></tr>
      <tr><td><code>silent</code></td><td>Boolean</td><td>Suppress vibration/sound</td></tr>
      <tr><td><code>vibrate</code></td><td>Array</td><td>Vibration pattern [200, 100, 200]</td></tr>
    </table>
  </div>

  <div class="card">
    <h3>‚ö†Ô∏è Common Mistakes & Pitfalls</h3>
    <div class="mistake-card">
      <h4>‚ùå Mistake 1: Requesting permission on page load</h4>
      <p>Browsers may auto-deny if you request permission without user interaction. Always tie it to a button click!</p>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 2: Not checking permission first</h4>
      <div class="code-block"><div class="code-body"><span class="cm">// This throws if permission is 'denied'</span>
new Notification(<span class="str">'Hello'</span>); <span class="cm">// ERROR!</span></div></div>
    </div>
    <div class="fix-card">
      <h4>‚úÖ Fix: Always check Notification.permission</h4>
      <div class="code-block"><div class="code-body"><span class="kw">if</span> (Notification.permission === <span class="str">'granted'</span>) {
  <span class="kw">new</span> Notification(<span class="str">'Hello'</span>);
} <span class="kw">else if</span> (Notification.permission !== <span class="str">'denied'</span>) {
  Notification.requestPermission().then(p => {
    <span class="kw">if</span> (p === <span class="str">'granted'</span>) <span class="kw">new</span> Notification(<span class="str">'Hello'</span>);
  });
}</div></div>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 3: Spamming notifications</h4>
      <p>Use the <code>tag</code> option to replace existing notifications instead of stacking them. Users WILL block you!</p>
    </div>
    <div class="mistake-card">
      <h4>‚ùå Mistake 4: Using actions without a Service Worker</h4>
      <p>Notification <code>actions</code> (buttons) only work when shown from a Service Worker using <code>registration.showNotification()</code>.</p>
    </div>
  </div>

  <div class="card">
    <h3>üß™ Quiz: Notification API</h3>
    <div class="quiz-container" id="quiz-notif"></div>
  </div>

  <div class="exercise-box">
    <h4>üí™ Exercise: Smart Notification Manager</h4>
    <p>Build a NotificationManager class that: handles permission requesting, prevents duplicate notifications using tags, tracks notification history, supports click callbacks.</p>
    <textarea class="exercise-editor" placeholder="class NotificationManager {
  constructor() {
    this.history = [];
  }

  async requestPermission() {
    // ...
  }

  notify(title, options = {}) {
    // ...
  }
}"></textarea>
    <button class="solution-toggle" onclick="toggleSolution('sol-notif')">üëÅ Show Solution</button>
    <div class="solution-box" id="sol-notif">
      <div class="code-block"><div class="code-body"><span class="kw">class</span> NotificationManager {
  constructor() { this.history = []; }

  <span class="kw">get</span> permission() { return Notification.permission; }

  <span class="kw">async</span> requestPermission() {
    if (this.permission === <span class="str">'granted'</span>) return true;
    if (this.permission === <span class="str">'denied'</span>) return false;
    const result = await Notification.requestPermission();
    return result === <span class="str">'granted'</span>;
  }

  <span class="kw">async</span> notify(title, options = {}) {
    const allowed = await this.requestPermission();
    if (!allowed) return null;

    const tag = options.tag || <span class="str">'notif-'</span> + Date.now();
    const notif = new Notification(title, { ...options, tag });

    this.history.push({
      title, tag,
      timestamp: new Date(),
      options
    });

    if (options.onClick) {
      notif.onclick = (e) => {
        options.onClick(e);
        notif.close();
      };
    }

    if (options.autoClose) {
      setTimeout(() => notif.close(), options.autoClose);
    }

    return notif;
  }

  getHistory() { return [...this.history]; }
}</div></div>
    </div>
  </div>

  <button class="complete-section-btn" onclick="completeSection('notifications')">‚úÖ Mark Notifications as Complete</button>
</section>

<!-- ==================== FINAL QUIZ ==================== -->
<section class="section" id="finalquiz">
  <div class="section-hero">
    <div class="hero-icon">üèÜ</div>
    <h2>Final Challenge</h2>
    <p>Test your mastery across ALL Web APIs! 15 challenging questions that cover everything you've learned.</p>
  </div>

  <div class="card">
    <h3>üéØ The Ultimate Web APIs Quiz</h3>
    <p>Score 80%+ to prove you're interview-ready!</p>
    <div class="quiz-container" id="quiz-final"></div>
    <div id="final-result" style="display:none;"></div>
  </div>

  <button class="complete-section-btn" onclick="completeSection('finalquiz')">üèÜ I've Conquered Web APIs!</button>
</section>

</main>

<div class="confetti-container" id="confetti"></div>

<script>
// ========================================
// STATE
// ========================================
const state = {
  completed: new Set(),
  quizScores: {},
  geoWatchId: null,
  wsSimulator: null
};

// ========================================
// NAVIGATION
// ========================================
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    const sectionId = item.dataset.section;
    navigateTo(sectionId);
    document.querySelector('.sidebar').classList.remove('open');
  });
});

function navigateTo(sectionId) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById(sectionId)?.classList.add('active');
  document.querySelector(`[data-section="${sectionId}"]`)?.classList.add('active');
  window.scrollTo(0, 0);
}

// ========================================
// PROGRESS
// ========================================
function completeSection(id) {
  state.completed.add(id);
  const navItem = document.querySelector(`[data-section="${id}"]`);
  if (navItem) navItem.classList.add('completed');

  const btn = document.querySelector(`#${id} .complete-section-btn`);
  if (btn) {
    btn.textContent = '‚úÖ Completed!';
    btn.classList.add('completed-btn');
  }

  updateProgress();
  launchConfetti();

  // Auto navigate to next section
  const sections = ['home','geolocation','webworkers','serviceworkers','websockets','notifications','finalquiz'];
  const idx = sections.indexOf(id);
  if (idx < sections.length - 1) {
    setTimeout(() => navigateTo(sections[idx + 1]), 1500);
  }
}

function updateProgress() {
  const total = 7;
  const done = state.completed.size;
  const pct = Math.round((done / total) * 100);
  document.getElementById('progress-pct').textContent = pct + '%';
  document.getElementById('progress-fill').style.width = pct + '%';
}

// ========================================
// CONFETTI
// ========================================
function launchConfetti() {
  const container = document.getElementById('confetti');
  const colors = ['#00d4ff','#00ff88','#7c3aed','#ff6b35','#ff3e8e','#ffa502','#fff'];
  for (let i = 0; i < 60; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + '%';
    piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    piece.style.animationDuration = (2 + Math.random() * 2) + 's';
    piece.style.animationDelay = Math.random() * 0.5 + 's';
    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    piece.style.width = (6 + Math.random() * 8) + 'px';
    piece.style.height = (6 + Math.random() * 8) + 'px';
    container.appendChild(piece);
    setTimeout(() => piece.remove(), 4000);
  }
}

// ========================================
// TABS
// ========================================
function switchTab(btn, containerId) {
  const container = document.getElementById(containerId);
  const parent = btn.parentElement;
  parent.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const idx = Array.from(parent.children).filter(c => c.classList.contains('tab-btn')).indexOf(btn);
  container.querySelectorAll('.tab-pane').forEach((p, i) => {
    p.classList.toggle('active', i === idx);
  });
}

// ========================================
// SOLUTION TOGGLE
// ========================================
function toggleSolution(id) {
  const box = document.getElementById(id);
  box.style.display = box.style.display === 'block' ? 'none' : 'block';
}

// ========================================
// GEOLOCATION DEMOS
// ========================================
function demoGeolocate() {
  const output = document.getElementById('geo-output');
  output.textContent = '‚è≥ Requesting location...';

  if (!navigator.geolocation) {
    output.textContent = '‚ùå Geolocation not supported in this browser.';
    return;
  }

  navigator.geolocation.getCurrentPosition(
    (pos) => {
      const { latitude, longitude, accuracy, altitude, speed } = pos.coords;
      output.textContent =
`‚úÖ Location Found!
üìç Latitude:  ${latitude.toFixed(6)}
üìç Longitude: ${longitude.toFixed(6)}
üéØ Accuracy:  ${accuracy.toFixed(0)} meters
üèîÔ∏è Altitude:  ${altitude !== null ? altitude.toFixed(1) + 'm' : 'N/A'}
üèÉ Speed:     ${speed !== null ? speed.toFixed(1) + ' m/s' : 'N/A'}
‚è∞ Timestamp: ${new Date(pos.timestamp).toLocaleString()}`;
    },
    (err) => {
      const msgs = {
        1: 'üîí Permission denied by user',
        2: 'üì° Position unavailable (check network/GPS)',
        3: '‚è±Ô∏è Request timed out'
      };
      output.textContent = `‚ùå Error: ${msgs[err.code] || err.message}`;
    },
    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
  );
}

function demoWatchPosition() {
  const output = document.getElementById('geo-watch-output');
  if (state.geoWatchId !== null) {
    output.textContent += '\n‚ö†Ô∏è Already watching!';
    return;
  }
  output.textContent = 'üëÅÔ∏è Watching position... (move your device)\n';
  let count = 0;

  state.geoWatchId = navigator.geolocation.watchPosition(
    (pos) => {
      count++;
      output.textContent += `[${count}] lat:${pos.coords.latitude.toFixed(5)} lng:${pos.coords.longitude.toFixed(5)} acc:${pos.coords.accuracy.toFixed(0)}m\n`;
      output.scrollTop = output.scrollHeight;
    },
    (err) => {
      output.textContent += `‚ùå Error: ${err.message}\n`;
    },
    { enableHighAccuracy: true }
  );

  document.getElementById('geo-watch-btn').textContent = 'üëÅÔ∏è Watching...';
}

function demoStopWatch() {
  if (state.geoWatchId !== null) {
    navigator.geolocation.clearWatch(state.geoWatchId);
    state.geoWatchId = null;
    document.getElementById('geo-watch-output').textContent += '\n‚èπ Stopped watching.';
    document.getElementById('geo-watch-btn').textContent = '‚ñ∂ Start Watching';
  }
}

// ========================================
// WEB WORKER DEMOS
// ========================================
function demoMainThread() {
  const anim = document.getElementById('anim-main');
  const bar = document.getElementById('bar-main');
  const timeEl = document.getElementById('main-time');

  anim.classList.add('frozen');
  bar.style.width = '0%';
  timeEl.textContent = '‚è≥ Computing...';

  const start = performance.now();

  // Simulate progress (but it blocks, so UI won't update until done)
  setTimeout(() => {
    // Heavy blocking computation
    let result = 0;
    const iterations = 50000000;
    for (let i = 0; i < iterations; i++) {
      result += Math.sqrt(i) * Math.sin(i);
    }

    const elapsed = (performance.now() - start).toFixed(0);
    anim.classList.remove('frozen');
    bar.style.width = '100%';
    timeEl.textContent = `‚úÖ Done in ${elapsed}ms (UI was frozen! ü•∂)`;
  }, 50);
}

function demoWorkerThread() {
  const anim = document.getElementById('anim-worker');
  const bar = document.getElementById('bar-worker');
  const timeEl = document.getElementById('worker-time');

  bar.style.width = '10%';
  timeEl.textContent = '‚è≥ Worker computing...';

  const start = performance.now();

  const workerCode = `
    self.onmessage = function(e) {
      let result = 0;
      const total = e.data;
      for (let i = 0; i < total; i++) {
        result += Math.sqrt(i) * Math.sin(i);
        if (i % (total / 10) === 0) {
          self.postMessage({ type: 'progress', value: (i / total) * 100 });
        }
      }
      self.postMessage({ type: 'done', result: result });
    };
  `;

  const blob = new Blob([workerCode], { type: 'application/javascript' });
  const worker = new Worker(URL.createObjectURL(blob));

  worker.postMessage(50000000);

  worker.onmessage = (e) => {
    if (e.data.type === 'progress') {
      bar.style.width = e.data.value + '%';
    } else if (e.data.type === 'done') {
      const elapsed = (performance.now() - start).toFixed(0);
      bar.style.width = '100%';
      timeEl.textContent = `‚úÖ Done in ${elapsed}ms (UI stayed smooth! üéâ)`;
      worker.terminate();
      URL.revokeObjectURL(blob);
    }
  };
}

function demoInlineWorker() {
  const output = document.getElementById('inline-worker-output');
  output.textContent = '‚è≥ Worker starting...\n';

  const code = `
    self.onmessage = function(e) {
      const start = Date.now();
      let result = 0;
      for (let i = 0; i < e.data; i++) {
        result += Math.sqrt(i);
      }
      self.postMessage({
        result: result.toFixed(2),
        time: Date.now() - start
      });
    };
  `;

  const blob = new Blob([code], { type: 'application/javascript' });
  const url = URL.createObjectURL(blob);
  const worker = new Worker(url);

  worker.postMessage(10000000);
  worker.onmessage = (e) => {
    output.textContent += `‚úÖ Result: ${e.data.result}\n‚è±Ô∏è Time: ${e.data.time}ms\nüéâ UI was NOT blocked!`;
    worker.terminate();
    URL.revokeObjectURL(url);
  };
  worker.onerror = (e) => {
    output.textContent += `‚ùå Error: ${e.message}`;
  };
}

function runPrimeExercise() {
  const output = document.getElementById('prime-output');
  output.textContent = '‚è≥ Finding primes...';

  const code = `
    self.onmessage = (e) => {
      const N = e.data;
      const primes = [];
      for (let i = 2; i <= N; i++) {
        let isPrime = true;
        for (let j = 2; j <= Math.sqrt(i); j++) {
          if (i % j === 0) { isPrime = false; break; }
        }
        if (isPrime) primes.push(i);
      }
      self.postMessage(primes);
    };
  `;
  const blob = new Blob([code], { type: 'application/javascript' });
  const w = new Worker(URL.createObjectURL(blob));
  w.postMessage(1000);
  w.onmessage = (e) => {
    output.textContent = `Found ${e.data.length} primes up to 1000:\n${e.data.join(', ')}`;
    w.terminate();
  };
}

// ========================================
// SERVICE WORKER LIFECYCLE
// ========================================
const lifecycleInfo = {
  register: "üìã REGISTER\n\nYour main JS file calls navigator.serviceWorker.register('/sw.js').\nThe browser downloads the SW file and starts the installation process.\nScope determines which pages the SW controls.\n\nKey: Registration is ASYNC ‚Äî it returns a Promise!",
  install: "üì• INSTALL\n\nFires when the SW is first registered (or when sw.js changes).\nThis is where you cache your app shell (critical assets).\nUse event.waitUntil() to ensure caching completes before moving on.\n\nKey: If ANY cached URL fails, the entire install fails!",
  waiting: "‚è≥ WAITING\n\nThe new SW waits here until ALL tabs using the old SW are closed.\nThis prevents breaking in-flight requests.\nUse self.skipWaiting() to bypass this (be careful!).\n\nKey: This is why users sometimes see old content!",
  activate: "‚úÖ ACTIVATE\n\nThe SW is now in control! This is where you clean up old caches.\nUse clients.claim() to take control of existing pages immediately.\nOld caches with different version names should be deleted here.\n\nKey: Always clean caches to avoid storage bloat!",
  fetch: "üåê FETCH / IDLE\n\nThe SW intercepts ALL network requests from controlled pages.\nYou decide: serve from cache? Go to network? Both?\nThis is where caching strategies (Cache First, Network First, etc.) live.\nThe SW goes idle between events to save memory.\n\nKey: The SW can be terminated at any time between events!"
};

function showLifecycleInfo(step) {
  document.querySelectorAll('.lifecycle-step').forEach(s => s.classList.remove('active-step'));
  document.querySelector(`[data-step="${step}"]`).classList.add('active-step');
  document.getElementById('lifecycle-info').textContent = lifecycleInfo[step];
}

// ========================================
// WEBSOCKET SIMULATOR
// ========================================
let wsConnection = null;
const botResponses = [
  "Hey there! How's the coding going? üíª",
  "That's interesting! Tell me more about your project.",
  "Web APIs are super powerful, right? üöÄ",
  "Have you tried using Service Workers yet?",
  "Remember: always handle WebSocket errors! ‚ö†Ô∏è",
  "Fun fact: WebSocket protocol uses ws:// and wss:// üîå",
  "Pro tip: Use JSON.stringify() before sending objects!",
  "Great question! The answer involves the event loop. üîÑ",
  "Keep practicing ‚Äî you're doing great! üåü",
  "That's a common interview question. Let me think... ü§î"
];

function wsConnect() {
  const chat = document.getElementById('ws-chat');
  const dot = document.getElementById('ws-status-dot');
  const text = document.getElementById('ws-status-text');

  if (wsConnection) return;

  dot.className = 'status-dot status-yellow';
  text.textContent = 'Connecting...';
  addChatMsg('sys', '‚è≥ Connecting to server...');

  // Simulate connection delay
  setTimeout(() => {
    wsConnection = true;
    dot.className = 'status-dot status-green';
    text.textContent = 'Connected';
    addChatMsg('sys', '‚úÖ Connected! readyState: OPEN (1)');
    addChatMsg('recv', 'Welcome to the WebSocket simulator! Type a message and I\'ll echo it back with a twist üòÑ');
  }, 800);
}

function wsDisconnect() {
  const dot = document.getElementById('ws-status-dot');
  const text = document.getElementById('ws-status-text');

  if (!wsConnection) return;

  wsConnection = null;
  dot.className = 'status-dot status-red';
  text.textContent = 'Disconnected';
  addChatMsg('sys', 'üî¥ Connection closed. readyState: CLOSED (3)');
}

function wsSend() {
  const input = document.getElementById('ws-input');
  const msg = input.value.trim();
  if (!msg) return;

  if (!wsConnection) {
    addChatMsg('sys', '‚ùå Error: WebSocket not connected! Call connect() first.');
    return;
  }

  addChatMsg('sent', msg);
  input.value = '';

  // Simulate server response
  setTimeout(() => {
    if (wsConnection) {
      const response = botResponses[Math.floor(Math.random() * botResponses.length)];
      addChatMsg('recv', `Echo: "${msg}"\n${response}`);
    }
  }, 300 + Math.random() * 700);
}

function addChatMsg(type, text) {
  const chat = document.getElementById('ws-chat');
  const div = document.createElement('div');
  div.className = 'chat-msg chat-' + type;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// ========================================
// NOTIFICATION DEMOS
// ========================================
function checkNotifPermission() {
  const el = document.getElementById('notif-permission');
  if (!('Notification' in window)) {
    el.textContent = 'Not Supported';
    el.className = 'badge badge-pink';
    return;
  }
  const p = Notification.permission;
  el.textContent = p;
  el.className = 'badge ' + (p === 'granted' ? 'badge-green' : p === 'denied' ? 'badge-pink' : 'badge-purple');
}

function demoNotifPermission() {
  const output = document.getElementById('notif-output');
  if (!('Notification' in window)) {
    output.textContent = '‚ùå Notification API not supported in this browser.';
    return;
  }

  output.textContent = '‚è≥ Requesting permission...';
  Notification.requestPermission().then(permission => {
    output.textContent = `Permission result: "${permission}"`;
    checkNotifPermission();
  });
}

function demoNotifBasic() {
  const output = document.getElementById('notif-output');
  if (!('Notification' in window)) {
    output.textContent = '‚ùå Not supported';
    return;
  }
  if (Notification.permission !== 'granted') {
    output.textContent = '‚ö†Ô∏è Permission not granted. Click "Request Permission" first!';
    return;
  }

  const n = new Notification('Hello from Web APIs! üëã', {
    body: 'You just triggered a real browser notification!',
    tag: 'demo-basic'
  });

  n.onclick = () => {
    output.textContent = 'üñ±Ô∏è Notification was clicked!';
    n.close();
    window.focus();
  };

  output.textContent = '‚úÖ Basic notification sent! Check your notifications.';
}

function demoNotifRich() {
  const output = document.getElementById('notif-output');
  if (Notification.permission !== 'granted') {
    output.textContent = '‚ö†Ô∏è Permission not granted!';
    return;
  }

  const n = new Notification('üîî New Achievement Unlocked!', {
    body: 'You mastered the Notification API. +100 XP!',
    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><text y="50" font-size="50">üèÜ</text></svg>',
    tag: 'demo-rich',
    requireInteraction: false,
    data: { xp: 100 }
  });

  n.onclick = () => {
    output.textContent = `üñ±Ô∏è Clicked! XP data: ${n.data?.xp || 'N/A'}`;
    n.close();
  };

  output.textContent = '‚úÖ Rich notification sent!';
}

// ========================================
// QUIZ ENGINE
// ========================================
const quizData = {
  geo: [
    {
      q: "Which object provides access to the Geolocation API?",
      opts: ["window.geolocation", "navigator.geolocation", "document.geolocation", "navigator.location"],
      correct: 1,
      explain: "The Geolocation API is accessed via navigator.geolocation. Don't confuse with window.location (URL info)!"
    },
    {
      q: "What does watchPosition() return?",
      opts: ["A Promise", "A Position object", "A watch ID (number)", "undefined"],
      correct: 2,
      explain: "watchPosition() returns a numeric ID that you pass to clearWatch() to stop tracking."
    },
    {
      q: "Which protocol is required for Geolocation to work?",
      opts: ["HTTP only", "HTTPS (or localhost)", "FTP", "Any protocol"],
      correct: 1,
      explain: "Geolocation requires a secure context (HTTPS) for privacy. localhost is exempt for development."
    },
    {
      q: "What happens if enableHighAccuracy is true?",
      opts: ["It always uses GPS", "It may use GPS which is slower but more accurate", "It enables real-time tracking", "It reduces battery usage"],
      correct: 1,
      explain: "enableHighAccuracy hints to use GPS if available. It's slower and uses more battery, but gives better accuracy."
    },
    {
      q: "What error code indicates the user denied permission?",
      opts: ["error.TIMEOUT", "error.POSITION_UNAVAILABLE", "error.PERMISSION_DENIED (code 1)", "error.ACCESS_DENIED"],
      correct: 2,
      explain: "PERMISSION_DENIED (code 1) fires when the user clicks 'Block' on the permission prompt."
    }
  ],
  workers: [
    {
      q: "What can a Web Worker NOT access?",
      opts: ["fetch()", "setTimeout()", "document (DOM)", "navigator"],
      correct: 2,
      explain: "Workers run in a separate thread without DOM access. They cannot touch document, window, or any DOM elements."
    },
    {
      q: "How do you send data from a Worker back to the main thread?",
      opts: ["return data", "self.postMessage(data)", "window.postMessage(data)", "self.send(data)"],
      correct: 1,
      explain: "Workers communicate via postMessage(). In a worker, 'self' refers to the worker's global scope."
    },
    {
      q: "What are Transferable Objects used for?",
      opts: ["Making workers faster", "Transferring ownership of data without copying", "Sharing DOM elements with workers", "Creating shared memory"],
      correct: 1,
      explain: "Transferable Objects (like ArrayBuffer) move data to the worker without cloning ‚Äî zero copy, but the source loses access."
    },
    {
      q: "How do you stop a Web Worker?",
      opts: ["worker.stop()", "worker.terminate()", "worker.close()", "worker.kill()"],
      correct: 1,
      explain: "worker.terminate() immediately stops the worker. From inside the worker, use self.close()."
    },
    {
      q: "What is an inline worker?",
      opts: ["A worker embedded in HTML", "A worker created from a Blob URL without a separate file", "A synchronous worker", "A worker that accesses the DOM"],
      correct: 1,
      explain: "Inline workers use Blob + URL.createObjectURL() to create workers from string code ‚Äî no separate file needed!"
    }
  ],
  sw: [
    {
      q: "What is the correct order of the Service Worker lifecycle?",
      opts: ["Register ‚Üí Fetch ‚Üí Install ‚Üí Activate", "Install ‚Üí Register ‚Üí Activate ‚Üí Fetch", "Register ‚Üí Install ‚Üí Activate ‚Üí Fetch", "Register ‚Üí Activate ‚Üí Install ‚Üí Fetch"],
      correct: 2,
      explain: "The lifecycle is: Register ‚Üí Install (cache assets) ‚Üí Activate (clean up) ‚Üí Fetch (intercept requests)."
    },
    {
      q: "What does event.waitUntil() do in the install event?",
      opts: ["Pauses the main thread", "Extends the install event lifetime until the promise resolves", "Delays registration", "Waits for user permission"],
      correct: 1,
      explain: "waitUntil() tells the browser: don't complete this lifecycle event until my async operation (like caching) finishes."
    },
    {
      q: "Why does a new Service Worker enter the 'waiting' state?",
      opts: ["It's downloading assets", "The old SW still controls open tabs", "It needs HTTPS", "The cache is full"],
      correct: 1,
      explain: "The new SW waits until all tabs using the old SW are closed. Use skipWaiting() to bypass this."
    },
    {
      q: "Which caching strategy serves from cache first, then updates in background?",
      opts: ["Cache First", "Network First", "Stale While Revalidate", "Cache Only"],
      correct: 2,
      explain: "Stale While Revalidate serves the cached version immediately for speed, then fetches a fresh copy to update the cache."
    },
    {
      q: "Service Workers require which of the following?",
      opts: ["localStorage access", "HTTPS (or localhost)", "Web Workers", "window.onload"],
      correct: 1,
      explain: "Service Workers only work on secure origins (HTTPS) to prevent man-in-the-middle attacks. localhost is an exception."
    }
  ],
  ws: [
    {
      q: "What protocol do WebSockets use for secure connections?",
      opts: ["https://", "ws://", "wss://", "tcp://"],
      correct: 2,
      explain: "wss:// is the secure WebSocket protocol, analogous to https:// for HTTP."
    },
    {
      q: "What is the readyState value when a WebSocket is open?",
      opts: ["0 (CONNECTING)", "1 (OPEN)", "2 (CLOSING)", "3 (CLOSED)"],
      correct: 1,
      explain: "readyState 1 (OPEN) means the connection is established and communication is possible."
    },
    {
      q: "What happens if you call ws.send() before the connection is open?",
      opts: ["The message is queued", "An error is thrown", "The message is silently dropped", "It triggers a reconnection"],
      correct: 1,
      explain: "Calling send() on a non-OPEN WebSocket throws an InvalidStateError. Always check readyState or wait for 'open'."
    },
    {
      q: "What is exponential backoff in reconnection?",
      opts: ["Reconnecting faster each time", "Increasing delay between retries (1s, 2s, 4s, 8s...)", "Sending more data each retry", "Using multiple connections"],
      correct: 1,
      explain: "Exponential backoff increases wait time between retries to avoid hammering a failing server."
    },
    {
      q: "How do you send a JavaScript object via WebSocket?",
      opts: ["ws.send(obj)", "ws.sendJSON(obj)", "ws.send(JSON.stringify(obj))", "ws.emit(obj)"],
      correct: 2,
      explain: "WebSocket.send() only accepts string, Blob, or ArrayBuffer. Objects must be serialized with JSON.stringify()."
    }
  ],
  notif: [
    {
      q: "What are the three possible values of Notification.permission?",
      opts: ["'yes', 'no', 'maybe'", "'granted', 'denied', 'default'", "'allowed', 'blocked', 'pending'", "'on', 'off', 'ask'"],
      correct: 1,
      explain: "'granted' (can notify), 'denied' (blocked, can't re-ask), 'default' (hasn't decided, can ask)."
    },
    {
      q: "When should you request notification permission?",
      opts: ["On page load", "After a user interaction (button click)", "In a Service Worker", "In a Web Worker"],
      correct: 1,
      explain: "Browsers may auto-deny permission requests not tied to user gestures. Always request after a click!"
    },
    {
      q: "What does the 'tag' option do?",
      opts: ["Adds a label to the notification", "Prevents duplicate notifications with the same tag", "Categorizes notifications", "Enables click tracking"],
      correct: 1,
      explain: "If a notification with the same tag already exists, it gets replaced instead of stacking a new one."
    },
    {
      q: "Can notification action buttons be used from the main thread?",
      opts: ["Yes, always", "No, actions only work from Service Worker's showNotification()", "Only on mobile", "Only with permission"],
      correct: 1,
      explain: "Action buttons (reply, dismiss, etc.) only work with ServiceWorkerRegistration.showNotification(), not 'new Notification()'."
    }
  ],
  final: [
    {
      q: "Which API provides multi-threading capabilities in the browser?",
      opts: ["Service Workers", "Web Workers", "WebSockets", "Geolocation"],
      correct: 1,
      explain: "Web Workers run scripts in background threads for parallel processing. Service Workers are for caching/offline, not computation."
    },
    {
      q: "You need to build a real-time stock ticker. Which API is best?",
      opts: ["Geolocation API", "Notification API", "WebSocket API", "Fetch API with setInterval"],
      correct: 2,
      explain: "WebSockets provide persistent bidirectional connections ‚Äî perfect for real-time data streaming without polling overhead."
    },
    {
      q: "A Service Worker is in the 'waiting' state. How do you activate it immediately?",
      opts: ["Close all browser tabs", "Call self.skipWaiting() in the install event", "Call navigator.serviceWorker.activate()", "Refresh the page twice"],
      correct: 1,
      explain: "self.skipWaiting() in the install event forces the new SW to skip waiting and activate immediately."
    },
    {
      q: "What data can be passed between main thread and Web Worker?",
      opts: ["Only strings", "Anything serializable (structured clone algorithm)", "Only ArrayBuffers", "Any JavaScript object including DOM nodes"],
      correct: 1,
      explain: "postMessage uses the structured clone algorithm. It can clone most types except DOM nodes, functions, and Error objects."
    },
    {
      q: "Which of these APIs does NOT require HTTPS?",
      opts: ["Web Workers", "Service Workers", "Geolocation", "Push API"],
      correct: 0,
      explain: "Web Workers work on any origin. Service Workers, Geolocation, and Push API all require secure contexts (HTTPS)."
    },
    {
      q: "What pattern prevents WebSocket reconnection from overwhelming the server?",
      opts: ["Round-robin", "Exponential backoff", "Load balancing", "Message queuing"],
      correct: 1,
      explain: "Exponential backoff increases the delay between reconnection attempts (1s, 2s, 4s, 8s...) to avoid server hammering."
    },
    {
      q: "In a Service Worker, how do you intercept and respond to network requests?",
      opts: ["Override window.fetch", "Listen for 'request' event", "Listen for 'fetch' event and use event.respondWith()", "Override XMLHttpRequest"],
      correct: 2,
      explain: "The 'fetch' event fires for every network request. Use event.respondWith() to provide a custom response."
    },
    {
      q: "What method stops a watchPosition() call?",
      opts: ["navigator.geolocation.stop()", "navigator.geolocation.clearWatch(id)", "navigator.geolocation.unwatch()", "watchPosition.cancel()"],
      correct: 1,
      explain: "clearWatch(id) stops position tracking. The id is the return value from watchPosition()."
    },
    {
      q: "Once notification permission is 'denied', what can your code do?",
      opts: ["Ask again after 24 hours", "Nothing ‚Äî user must change it in browser settings", "Use Service Worker to bypass", "Show an alert instead"],
      correct: 1,
      explain: "Once denied, you cannot programmatically re-request. The user must manually change the setting in their browser."
    },
    {
      q: "Which is TRUE about Web Workers?",
      opts: [
        "They can access localStorage",
        "They share memory with the main thread by default",
        "They communicate via postMessage()",
        "They can modify the DOM indirectly"
      ],
      correct: 2,
      explain: "Workers use postMessage() for communication. They cannot access localStorage, DOM, or share memory by default (SharedArrayBuffer is an exception)."
    },
    {
      q: "What's the best caching strategy for a news site's articles?",
      opts: ["Cache Only", "Cache First", "Network First", "No caching"],
      correct: 2,
      explain: "Network First ensures users get the latest articles while having cached versions as fallback when offline."
    },
    {
      q: "How do you check if the browser supports the Notification API?",
      opts: ["typeof Notification !== 'undefined'", "'Notification' in window", "navigator.notifications", "Both A and B work"],
      correct: 3,
      explain: "Both 'Notification' in window and typeof Notification !== 'undefined' are valid ways to check for support."
    },
    {
      q: "What's the key difference between ws.onmessage and ws.addEventListener('message')?",
      opts: [
        "No difference ‚Äî both work the same",
        "onmessage can only have one handler; addEventListener supports multiple",
        "addEventListener is faster",
        "onmessage works in workers, addEventListener doesn't"
      ],
      correct: 1,
      explain: "onmessage overwrites previous handlers. addEventListener allows multiple handlers for the same event."
    },
    {
      q: "A user's app keeps showing stale content after updates. What's likely wrong?",
      opts: [
        "Service Worker is serving old cached assets",
        "WebSocket connection is stale",
        "Browser cookies expired",
        "Geolocation cache is outdated"
      ],
      correct: 0,
      explain: "The SW is likely serving cached content without proper version management. Implement cache versioning and clean old caches on activate."
    },
    {
      q: "Which combination would you use for a PWA that works offline with push notifications?",
      opts: [
        "Web Workers + WebSockets",
        "Service Workers + Notification API + Cache API",
        "Geolocation + WebSockets",
        "Web Workers + Notification API"
      ],
      correct: 1,
      explain: "Service Workers handle caching/offline + push events. The Notification API displays alerts. Cache API stores assets for offline use."
    }
  ]
};

function buildQuiz(containerId, questions) {
  const container = document.getElementById(containerId);
  if (!container) return;

  let html = '';
  questions.forEach((q, i) => {
    html += `<div class="quiz-question" data-quiz="${containerId}" data-index="${i}">
      <h4><span class="quiz-q-num">${i + 1}</span>${q.q}</h4>
      <div class="quiz-options">`;
    q.opts.forEach((opt, j) => {
      html += `<div class="quiz-opt" data-correct="${j === q.correct}" onclick="handleQuizAnswer(this, ${j === q.correct}, '${containerId}', ${i})">${opt}</div>`;
    });
    html += `</div>
      <div class="quiz-explanation" id="${containerId}-exp-${i}">üí° ${q.explain}</div>
    </div>`;
  });

  html += `<div class="quiz-score" id="${containerId}-score" style="display:none;">
    <p style="color:var(--text-dim); margin-bottom:8px;">Your Score</p>
    <div class="score-num" id="${containerId}-score-num"></div>
    <p style="color:var(--text-dim); margin-top:8px;" id="${containerId}-score-msg"></p>
  </div>`;

  container.innerHTML = html;
}

const quizState = {};

function handleQuizAnswer(el, isCorrect, quizId, qIndex) {
  // Prevent re-answering
  const question = el.closest('.quiz-question');
  if (question.classList.contains('answered')) return;
  question.classList.add('answered');

  // Initialize state
  if (!quizState[quizId]) {
    quizState[quizId] = { total: document.querySelectorAll(`[data-quiz="${quizId}"]`).length, correct: 0, answered: 0 };
  }

  quizState[quizId].answered++;

  // Mark options
  question.querySelectorAll('.quiz-opt').forEach(opt => {
    opt.classList.add('disabled');
    if (opt.dataset.correct === 'true') opt.classList.add('correct');
  });

  if (isCorrect) {
    el.classList.add('correct');
    quizState[quizId].correct++;
  } else {
    el.classList.add('wrong');
  }

  // Show explanation
  document.getElementById(`${quizId}-exp-${qIndex}`).style.display = 'block';

  // Check if quiz complete
  if (quizState[quizId].answered === quizState[quizId].total) {
    showQuizScore(quizId);
  }
}

function showQuizScore(quizId) {
  const s = quizState[quizId];
  const pct = Math.round((s.correct / s.total) * 100);
  const scoreDiv = document.getElementById(`${quizId}-score`);
  scoreDiv.style.display = 'block';
  document.getElementById(`${quizId}-score-num`).textContent = `${s.correct}/${s.total} (${pct}%)`;

  let msg = '';
  if (pct === 100) msg = 'üèÜ PERFECT! You\'re a Web API master!';
  else if (pct >= 80) msg = 'üåü Excellent! You\'re interview-ready!';
  else if (pct >= 60) msg = 'üëç Good job! Review the mistakes above.';
  else msg = 'üìö Keep studying! Re-read the section and try again.';

  document.getElementById(`${quizId}-score-msg`).textContent = msg;

  if (pct === 100) launchConfetti();

  scoreDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// ========================================
// INITIALIZE
// ========================================
function init() {
  buildQuiz('quiz-geo', quizData.geo);
  buildQuiz('quiz-workers', quizData.workers);
  buildQuiz('quiz-sw', quizData.sw);
  buildQuiz('quiz-ws', quizData.ws);
  buildQuiz('quiz-notif', quizData.notif);
  buildQuiz('quiz-final', quizData.final);
  checkNotifPermission();
  updateProgress();
}

init();
</script>
</body>
</html>