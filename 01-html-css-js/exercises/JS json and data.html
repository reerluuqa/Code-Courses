<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JSON & Data Serialization Mastery</title>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #0a0e1a;
  --surface: #131829;
  --surface2: #1a2035;
  --surface3: #212845;
  --accent: #6c5ce7;
  --accent2: #a29bfe;
  --green: #00e676;
  --red: #ff5252;
  --orange: #ffab40;
  --cyan: #18ffff;
  --yellow: #ffd740;
  --text: #e8eaf6;
  --text2: #9fa8c7;
  --border: #2a3158;
  --radius: 12px;
}

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.7;
  overflow-x: hidden;
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 3px; }

/* Header */
.hero {
  text-align: center;
  padding: 60px 20px 40px;
  background: linear-gradient(135deg, #0a0e1a 0%, #1a1040 50%, #0a0e1a 100%);
  position: relative;
  overflow: hidden;
}

.hero::before {
  content: '{ }';
  position: absolute;
  font-size: 300px;
  color: rgba(108, 92, 231, 0.04);
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-weight: 900;
}

.hero h1 {
  font-size: clamp(2rem, 5vw, 3.5rem);
  background: linear-gradient(135deg, var(--accent2), var(--cyan));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 10px;
}

.hero p { color: var(--text2); font-size: 1.15rem; max-width: 600px; margin: 0 auto; }

/* Progress bar */
.progress-container {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 10px 20px;
}

.progress-bar-wrap {
  max-width: 900px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 15px;
}

.progress-bar {
  flex: 1;
  height: 8px;
  background: var(--surface3);
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--accent), var(--cyan));
  border-radius: 4px;
  transition: width 0.5s ease;
}

.progress-text {
  font-size: 0.85rem;
  color: var(--accent2);
  min-width: 80px;
  text-align: right;
}

/* Navigation */
.nav-tabs {
  display: flex;
  gap: 6px;
  padding: 15px 20px;
  max-width: 1200px;
  margin: 0 auto;
  overflow-x: auto;
  scrollbar-width: none;
}

.nav-tabs::-webkit-scrollbar { display: none; }

.nav-tab {
  padding: 10px 20px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 25px;
  cursor: pointer;
  white-space: nowrap;
  font-size: 0.9rem;
  color: var(--text2);
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}

.nav-tab:hover { border-color: var(--accent); color: var(--text); }
.nav-tab.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}

.nav-tab .check { display: none; }
.nav-tab.completed .check { display: inline; }

/* Main content */
.main { max-width: 1000px; margin: 0 auto; padding: 20px; }

.section {
  display: none;
  animation: fadeIn 0.4s ease;
}

.section.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Cards */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 30px;
  margin-bottom: 25px;
}

.card h2 {
  font-size: 1.6rem;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card h3 {
  font-size: 1.2rem;
  margin: 20px 0 10px;
  color: var(--accent2);
}

/* Visual explanation boxes */
.visual-box {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 25px;
  margin: 20px 0;
  position: relative;
}

.visual-box.highlight {
  border-left: 4px solid var(--accent);
}

/* Code blocks */
.code-block {
  background: #0d1117;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 20px;
  margin: 15px 0;
  overflow-x: auto;
  font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
  font-size: 0.9rem;
  line-height: 1.8;
  position: relative;
}

.code-block .line-numbers {
  position: absolute;
  left: 0;
  top: 20px;
  padding: 0 10px;
  color: #4a5568;
  text-align: right;
  user-select: none;
  font-size: 0.8rem;
}

.code-block code { display: block; padding-left: 10px; }

/* Syntax highlighting */
.kw { color: #c678dd; }
.str { color: #98c379; }
.num { color: #d19a66; }
.cmt { color: #5c6370; font-style: italic; }
.fn { color: #61afef; }
.prop { color: #e06c75; }
.op { color: #56b6c2; }
.bool { color: #d19a66; }
.null { color: #d19a66; }
.key { color: #e06c75; }
.bracket { color: #ffd700; }

/* Interactive playground */
.playground {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin: 20px 0;
  overflow: hidden;
}

.playground-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  background: var(--surface3);
  border-bottom: 1px solid var(--border);
}

.playground-header h4 {
  font-size: 0.9rem;
  color: var(--accent2);
  display: flex;
  align-items: center;
  gap: 8px;
}

.playground-body {
  display: grid;
  grid-template-columns: 1fr 1fr;
  min-height: 200px;
}

@media (max-width: 700px) {
  .playground-body { grid-template-columns: 1fr; }
}

.playground textarea {
  background: #0d1117;
  color: var(--text);
  border: none;
  padding: 15px;
  font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
  font-size: 0.85rem;
  line-height: 1.7;
  resize: vertical;
  min-height: 200px;
  outline: none;
}

.playground-output {
  background: #0a0f1a;
  padding: 15px;
  font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
  font-size: 0.85rem;
  line-height: 1.7;
  border-left: 1px solid var(--border);
  overflow-y: auto;
  white-space: pre-wrap;
  word-break: break-word;
}

.output-success { color: var(--green); }
.output-error { color: var(--red); }
.output-info { color: var(--cyan); }

.btn {
  padding: 8px 20px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 600;
  transition: all 0.2s;
}

.btn:hover { background: #7c6cf7; transform: translateY(-1px); }
.btn:active { transform: translateY(0); }

.btn-sm {
  padding: 6px 14px;
  font-size: 0.8rem;
}

.btn-green { background: #2e7d32; }
.btn-green:hover { background: #388e3c; }

.btn-orange { background: #e65100; }
.btn-orange:hover { background: #f57c00; }

.btn-outline {
  background: transparent;
  border: 1px solid var(--accent);
  color: var(--accent2);
}

.btn-outline:hover {
  background: var(--accent);
  color: white;
}

/* Pitfall / Warning boxes */
.pitfall {
  background: rgba(255, 82, 82, 0.08);
  border: 1px solid rgba(255, 82, 82, 0.3);
  border-left: 4px solid var(--red);
  border-radius: var(--radius);
  padding: 20px 25px;
  margin: 20px 0;
}

.pitfall h4 { color: var(--red); margin-bottom: 8px; font-size: 1rem; }

.tip {
  background: rgba(0, 230, 118, 0.08);
  border: 1px solid rgba(0, 230, 118, 0.3);
  border-left: 4px solid var(--green);
  border-radius: var(--radius);
  padding: 20px 25px;
  margin: 20px 0;
}

.tip h4 { color: var(--green); margin-bottom: 8px; font-size: 1rem; }

.info-box {
  background: rgba(24, 255, 255, 0.06);
  border: 1px solid rgba(24, 255, 255, 0.2);
  border-left: 4px solid var(--cyan);
  border-radius: var(--radius);
  padding: 20px 25px;
  margin: 20px 0;
}

.info-box h4 { color: var(--cyan); margin-bottom: 8px; }

/* Visual diagrams */
.diagram {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  margin: 25px 0;
  flex-wrap: wrap;
}

.diagram-box {
  background: var(--surface3);
  border: 2px solid var(--border);
  border-radius: 10px;
  padding: 20px 25px;
  text-align: center;
  min-width: 150px;
  transition: all 0.3s;
}

.diagram-box.js { border-color: var(--yellow); }
.diagram-box.json { border-color: var(--green); }
.diagram-box.api { border-color: var(--cyan); }

.diagram-box h5 {
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.diagram-box.js h5 { color: var(--yellow); }
.diagram-box.json h5 { color: var(--green); }
.diagram-box.api h5 { color: var(--cyan); }

.diagram-arrow {
  font-size: 2rem;
  color: var(--accent2);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}

/* Comparison tables */
.compare-table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
  font-size: 0.9rem;
}

.compare-table th {
  background: var(--surface3);
  padding: 12px 15px;
  text-align: left;
  border-bottom: 2px solid var(--accent);
  color: var(--accent2);
}

.compare-table td {
  padding: 12px 15px;
  border-bottom: 1px solid var(--border);
}

.compare-table tr:hover td {
  background: rgba(108, 92, 231, 0.05);
}

/* Quiz styles */
.quiz {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 25px;
  margin: 20px 0;
}

.quiz-question {
  font-size: 1.05rem;
  margin-bottom: 15px;
  font-weight: 600;
}

.quiz-options { display: flex; flex-direction: column; gap: 8px; }

.quiz-option {
  padding: 12px 18px;
  background: var(--surface3);
  border: 2px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 0.9rem;
  font-family: inherit;
  color: var(--text);
  text-align: left;
  width: 100%;
}

.quiz-option:hover:not(.disabled) {
  border-color: var(--accent);
  background: rgba(108, 92, 231, 0.1);
}

.quiz-option.correct {
  border-color: var(--green);
  background: rgba(0, 230, 118, 0.1);
}

.quiz-option.wrong {
  border-color: var(--red);
  background: rgba(255, 82, 82, 0.1);
}

.quiz-option.disabled { cursor: default; opacity: 0.7; }
.quiz-option.correct.disabled { opacity: 1; }

.quiz-feedback {
  margin-top: 12px;
  padding: 12px 15px;
  border-radius: 8px;
  font-size: 0.9rem;
  display: none;
}

.quiz-feedback.show { display: block; }
.quiz-feedback.correct { background: rgba(0,230,118,0.1); color: var(--green); }
.quiz-feedback.wrong { background: rgba(255,82,82,0.1); color: var(--red); }

/* Exercise styles */
.exercise {
  background: linear-gradient(135deg, var(--surface2), var(--surface));
  border: 1px solid var(--accent);
  border-radius: var(--radius);
  padding: 25px;
  margin: 25px 0;
}

.exercise h4 {
  color: var(--accent2);
  margin-bottom: 5px;
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.exercise h3 {
  margin-bottom: 15px;
  color: var(--text);
}

.exercise-result {
  margin-top: 12px;
  padding: 12px;
  border-radius: 8px;
  display: none;
  font-size: 0.9rem;
}

.exercise-result.show { display: block; }
.exercise-result.pass { background: rgba(0,230,118,0.1); border: 1px solid rgba(0,230,118,0.3); color: var(--green); }
.exercise-result.fail { background: rgba(255,82,82,0.1); border: 1px solid rgba(255,82,82,0.3); color: var(--red); }

/* Memory visualization */
.memory-viz {
  display: flex;
  gap: 30px;
  margin: 20px 0;
  justify-content: center;
  flex-wrap: wrap;
}

.mem-block {
  background: var(--surface3);
  border: 2px solid var(--border);
  border-radius: 10px;
  padding: 15px 20px;
  min-width: 180px;
  position: relative;
}

.mem-block h5 {
  font-size: 0.8rem;
  color: var(--text2);
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.mem-item {
  padding: 6px 10px;
  margin: 4px 0;
  background: var(--surface);
  border-radius: 4px;
  font-size: 0.85rem;
  font-family: monospace;
}

.mem-item.ref { 
  border-left: 3px solid var(--orange);
  cursor: help;
}

.mem-item.val {
  border-left: 3px solid var(--green);
}

.mem-pointer {
  position: absolute;
  color: var(--orange);
  font-size: 1.5rem;
}

/* Tags */
.tag {
  display: inline-block;
  padding: 3px 10px;
  background: var(--surface3);
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tag-json { color: var(--green); border: 1px solid rgba(0,230,118,0.3); }
.tag-js { color: var(--yellow); border: 1px solid rgba(255,215,64,0.3); }
.tag-pitfall { color: var(--red); border: 1px solid rgba(255,82,82,0.3); }

/* Animated JSON tree */
.json-tree {
  padding: 15px;
  background: var(--surface3);
  border-radius: 8px;
  margin: 15px 0;
  font-family: monospace;
  font-size: 0.9rem;
}

.json-tree .node {
  padding: 4px 0 4px 20px;
  border-left: 1px dashed var(--border);
  margin-left: 10px;
  position: relative;
}

.json-tree .node::before {
  content: '';
  position: absolute;
  left: 0;
  top: 14px;
  width: 12px;
  height: 1px;
  background: var(--border);
}

.json-tree .collapsible {
  cursor: pointer;
  user-select: none;
}

.json-tree .collapsible:hover { color: var(--accent2); }

/* Score display */
.score-display {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--surface);
  border: 1px solid var(--accent);
  border-radius: 50px;
  padding: 10px 20px;
  font-size: 0.9rem;
  z-index: 50;
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  gap: 8px;
}

.score-num { color: var(--cyan); font-weight: 700; }

/* Inline code */
code:not([class]) {
  background: var(--surface3);
  padding: 2px 8px;
  border-radius: 4px;
  font-family: 'Fira Code', monospace;
  font-size: 0.87em;
  color: var(--accent2);
}

/* Animated flow */
.flow-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.flow-step {
  padding: 15px 20px;
  background: var(--surface3);
  border-radius: 10px;
  text-align: center;
  border: 1px solid var(--border);
  min-width: 120px;
  transition: all 0.3s;
}

.flow-step:hover {
  transform: translateY(-3px);
  border-color: var(--accent);
}

.flow-step .icon { font-size: 1.5rem; margin-bottom: 5px; }
.flow-step .label { font-size: 0.8rem; color: var(--text2); }

.flow-arrow { color: var(--accent2); font-size: 1.5rem; }

/* Accordion */
.accordion {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin: 15px 0;
}

.accordion-item { border-bottom: 1px solid var(--border); }
.accordion-item:last-child { border-bottom: none; }

.accordion-header {
  padding: 15px 20px;
  background: var(--surface2);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: 600;
  transition: background 0.2s;
}

.accordion-header:hover { background: var(--surface3); }

.accordion-header .arrow {
  transition: transform 0.3s;
  font-size: 0.8rem;
}

.accordion-item.open .accordion-header .arrow {
  transform: rotate(180deg);
}

.accordion-body {
  padding: 0 20px;
  max-height: 0;
  overflow: hidden;
  transition: all 0.3s ease;
}

.accordion-item.open .accordion-body {
  padding: 15px 20px;
  max-height: 2000px;
}

/* Section complete */
.section-complete {
  text-align: center;
  padding: 30px;
  margin: 30px 0;
  background: linear-gradient(135deg, rgba(108,92,231,0.1), rgba(24,255,255,0.1));
  border: 1px solid var(--accent);
  border-radius: var(--radius);
}

.section-complete h3 { color: var(--green); margin-bottom: 10px; }

.btn-next {
  margin-top: 15px;
  padding: 12px 30px;
  font-size: 1rem;
  background: linear-gradient(135deg, var(--accent), #4a3cc9);
}

/* Responsive */
@media (max-width: 600px) {
  .card { padding: 20px; }
  .playground-body { grid-template-columns: 1fr; }
  .playground-output { border-left: none; border-top: 1px solid var(--border); }
  .diagram { flex-direction: column; }
  .diagram-arrow { transform: rotate(90deg); }
  .memory-viz { flex-direction: column; align-items: center; }
}

.highlight-anim {
  animation: highlightPulse 0.5s ease;
}

@keyframes highlightPulse {
  0% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.5); }
  100% { box-shadow: 0 0 0 10px rgba(108, 92, 231, 0); }
}

.badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  background: rgba(108,92,231,0.2);
  border-radius: 20px;
  font-size: 0.75rem;
  color: var(--accent2);
}

/* Data flow animation */
.data-flow {
  position: relative;
  padding: 20px;
  margin: 20px 0;
}

.particle {
  width: 8px;
  height: 8px;
  background: var(--cyan);
  border-radius: 50%;
  position: absolute;
  animation: particleMove 3s infinite ease-in-out;
}

@keyframes particleMove {
  0% { left: 10%; opacity: 0; }
  20% { opacity: 1; }
  80% { opacity: 1; }
  100% { left: 90%; opacity: 0; }
}

.valid-json { border-color: var(--green) !important; }
.invalid-json { border-color: var(--red) !important; }

.type-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 700;
  font-family: monospace;
}

.type-string { background: rgba(152,195,121,0.2); color: #98c379; }
.type-number { background: rgba(209,154,102,0.2); color: #d19a66; }
.type-boolean { background: rgba(198,120,221,0.2); color: #c678dd; }
.type-null { background: rgba(86,182,194,0.2); color: #56b6c2; }
.type-object { background: rgba(255,215,64,0.2); color: #ffd740; }
.type-array { background: rgba(97,175,239,0.2); color: #61afef; }
</style>
</head>
<body>

<div class="hero">
  <h1>{ JSON } Mastery</h1>
  <p>Master JSON & Data Serialization through interactive examples, visual explanations, and hands-on exercises</p>
</div>

<div class="progress-container">
  <div class="progress-bar-wrap">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <span class="progress-text" id="progressText">0 / 6 sections</span>
  </div>
</div>

<div class="nav-tabs" id="navTabs"></div>

<div class="main" id="mainContent"></div>

<div class="score-display">
  ‚≠ê Score: <span class="score-num" id="scoreDisplay">0</span>
</div>

<script>
// ============================================================
// APP STATE
// ============================================================
const state = {
  currentSection: 0,
  score: 0,
  completedSections: new Set(),
  answeredQuizzes: new Set(),
  completedExercises: new Set()
};

// ============================================================
// SECTION DATA
// ============================================================
const sections = [
  {
    id: 'intro',
    title: 'üì¶ What is JSON?',
    icon: 'üì¶'
  },
  {
    id: 'parse-stringify',
    title: 'üîÑ Parse & Stringify',
    icon: 'üîÑ'
  },
  {
    id: 'deep-shallow',
    title: 'ü™û Deep vs Shallow Copy',
    icon: 'ü™û'
  },
  {
    id: 'api-data',
    title: 'üåê Working with APIs',
    icon: 'üåê'
  },
  {
    id: 'transform',
    title: 'üîß Data Transformation',
    icon: 'üîß'
  },
  {
    id: 'final',
    title: 'üèÜ Final Challenge',
    icon: 'üèÜ'
  }
];

// ============================================================
// RENDER NAVIGATION
// ============================================================
function renderNav() {
  const nav = document.getElementById('navTabs');
  nav.innerHTML = sections.map((s, i) => `
    <div class="nav-tab ${i === state.currentSection ? 'active' : ''} ${state.completedSections.has(i) ? 'completed' : ''}" 
         onclick="goToSection(${i})">
      <span class="check">‚úÖ</span>
      ${s.icon} ${s.title}
    </div>
  `).join('');
}

function goToSection(idx) {
  state.currentSection = idx;
  renderNav();
  renderSection();
  window.scrollTo({ top: 200, behavior: 'smooth' });
}

function completeSection(idx) {
  if (!state.completedSections.has(idx)) {
    state.completedSections.add(idx);
    addScore(20);
  }
  updateProgress();
  renderNav();
}

function updateProgress() {
  const pct = (state.completedSections.size / sections.length) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = `${state.completedSections.size} / ${sections.length} sections`;
}

function addScore(points) {
  state.score += points;
  document.getElementById('scoreDisplay').textContent = state.score;
  const el = document.getElementById('scoreDisplay');
  el.parentElement.classList.add('highlight-anim');
  setTimeout(() => el.parentElement.classList.remove('highlight-anim'), 500);
}

// ============================================================
// SECTION RENDERERS
// ============================================================
function renderSection() {
  const main = document.getElementById('mainContent');
  const renderers = [
    renderIntro,
    renderParseStringify,
    renderDeepShallow,
    renderApiData,
    renderTransform,
    renderFinalChallenge
  ];
  main.innerHTML = `<div class="section active">${renderers[state.currentSection]()}</div>`;
  attachEventListeners();
}

// ---- SECTION 0: What is JSON? ----
function renderIntro() {
  return `
    <div class="card">
      <h2>üì¶ What is JSON?</h2>
      <p><strong>JSON</strong> stands for <strong>JavaScript Object Notation</strong>. It's a lightweight data format used to store and exchange data. It's the <em>lingua franca</em> of the web.</p>
      
      <div class="diagram">
        <div class="diagram-box js">
          <h5>JavaScript Object</h5>
          <code>{ name: "Ada" }</code>
        </div>
        <div class="diagram-arrow">‚ü∂</div>
        <div class="diagram-box json">
          <h5>JSON String</h5>
          <code>{"name":"Ada"}</code>
        </div>
        <div class="diagram-arrow">‚ü∂</div>
        <div class="diagram-box api">
          <h5>API / File / Storage</h5>
          <code>üì° üóÑÔ∏è üíæ</code>
        </div>
      </div>

      <h3>JSON Data Types</h3>
      <div class="visual-box">
        <div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center">
          <span class="type-badge type-string">String "hello"</span>
          <span class="type-badge type-number">Number 42</span>
          <span class="type-badge type-boolean">Boolean true/false</span>
          <span class="type-badge type-null">null</span>
          <span class="type-badge type-object">Object { }</span>
          <span class="type-badge type-array">Array [ ]</span>
        </div>
        <p style="text-align:center;margin-top:12px;color:var(--text2);font-size:0.9rem">These are the <strong>only</strong> types JSON supports ‚Äî no functions, no undefined, no Date objects!</p>
      </div>

      <h3>JSON vs JavaScript Object ‚Äî Key Differences</h3>
      <table class="compare-table">
        <tr><th>Feature</th><th>JavaScript Object</th><th>JSON</th></tr>
        <tr><td>Keys</td><td>Can be unquoted</td><td>Must be <strong>double-quoted</strong> strings</td></tr>
        <tr><td>Strings</td><td>Single or double quotes</td><td>Must use <strong>double quotes</strong></td></tr>
        <tr><td>Trailing commas</td><td>Allowed</td><td><strong>‚ùå Not allowed</strong></td></tr>
        <tr><td>Functions</td><td>Allowed as values</td><td><strong>‚ùå Not allowed</strong></td></tr>
        <tr><td>undefined</td><td>Valid value</td><td><strong>‚ùå Not valid</strong></td></tr>
        <tr><td>Comments</td><td>// and /* */</td><td><strong>‚ùå Not allowed</strong></td></tr>
      </table>

      <h3>Interactive: Valid vs Invalid JSON</h3>
      <div class="playground" id="jsonValidator">
        <div class="playground-header">
          <h4>üß™ JSON Validator ‚Äî Type JSON and see if it's valid</h4>
          <button class="btn btn-sm" onclick="validateJSON()">Validate</button>
        </div>
        <div class="playground-body">
          <textarea id="jsonInput" placeholder="Type JSON here...">{ "name": "Ada", "age": 30, "skills": ["JS", "Python"] }</textarea>
          <div class="playground-output" id="jsonOutput">Click "Validate" to check your JSON...</div>
        </div>
      </div>

      <div class="pitfall">
        <h4>‚ö†Ô∏è Common Mistake: Single Quotes</h4>
        <div class="code-block"><code><span class="cmt">// ‚ùå INVALID JSON ‚Äî single quotes!</span>
{ <span class="str">'name'</span>: <span class="str">'Ada'</span> }

<span class="cmt">// ‚úÖ VALID JSON ‚Äî double quotes!</span>
{ <span class="str">"name"</span>: <span class="str">"Ada"</span> }</code></div>
      </div>

      <div class="pitfall">
        <h4>‚ö†Ô∏è Common Mistake: Trailing Comma</h4>
        <div class="code-block"><code><span class="cmt">// ‚ùå INVALID ‚Äî trailing comma after last item!</span>
{ <span class="str">"name"</span>: <span class="str">"Ada"</span>, <span class="str">"age"</span>: <span class="num">30</span><span class="op">,</span> }

<span class="cmt">// ‚úÖ VALID</span>
{ <span class="str">"name"</span>: <span class="str">"Ada"</span>, <span class="str">"age"</span>: <span class="num">30</span> }</code></div>
      </div>

      ${renderQuiz('q-intro-1', 'Which of these is valid JSON?', [
        { text: "{ name: 'Ada' }", correct: false },
        { text: '{ "name": "Ada" }', correct: true },
        { text: "{ 'name': 'Ada' }", correct: false },
        { text: '{ "name": undefined }', correct: false }
      ], 'JSON requires double quotes for both keys and string values. No single quotes, no undefined!')}

      ${renderQuiz('q-intro-2', 'Which data type is NOT supported in JSON?', [
        { text: 'null', correct: false },
        { text: 'Array', correct: false },
        { text: 'Function', correct: true },
        { text: 'Number', correct: false }
      ], 'Functions cannot be serialized to JSON. Only strings, numbers, booleans, null, objects, and arrays are valid JSON types.')}
      
      <div class="section-complete">
        <h3>‚úÖ Section Complete!</h3>
        <p>You understand JSON basics. Let's learn to convert between JS and JSON!</p>
        <button class="btn btn-next" onclick="completeSection(0); goToSection(1)">Next: Parse & Stringify ‚Üí</button>
      </div>
    </div>
  `;
}

// ---- SECTION 1: Parse & Stringify ----
function renderParseStringify() {
  return `
    <div class="card">
      <h2>üîÑ JSON.parse() & JSON.stringify()</h2>
      <p>These two methods are your bridge between JavaScript objects and JSON strings.</p>
      
      <div class="flow-container">
        <div class="flow-step">
          <div class="icon">üü®</div>
          <div><strong>JS Object</strong></div>
          <div class="label">In memory</div>
        </div>
        <div class="flow-arrow">
          <div style="font-size:0.7rem;color:var(--green)">stringify()</div>
          ‚ü∂
        </div>
        <div class="flow-step">
          <div class="icon">üìÑ</div>
          <div><strong>JSON String</strong></div>
          <div class="label">Transmittable</div>
        </div>
        <div class="flow-arrow">
          <div style="font-size:0.7rem;color:var(--cyan)">parse()</div>
          ‚ü∂
        </div>
        <div class="flow-step">
          <div class="icon">üü®</div>
          <div><strong>JS Object</strong></div>
          <div class="label">Usable again</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>üì§ JSON.stringify() ‚Äî Object ‚Üí String</h3>
      <p>Converts a JavaScript value to a JSON string.</p>
      
      <div class="code-block"><code><span class="kw">const</span> user = {
  name: <span class="str">"Ada Lovelace"</span>,
  age: <span class="num">36</span>,
  skills: [<span class="str">"math"</span>, <span class="str">"programming"</span>],
  active: <span class="bool">true</span>
};

<span class="kw">const</span> jsonString = <span class="fn">JSON</span>.<span class="fn">stringify</span>(user);
<span class="fn">console</span>.<span class="fn">log</span>(jsonString);
<span class="cmt">// '{"name":"Ada Lovelace","age":36,"skills":["math","programming"],"active":true}'</span>

<span class="fn">console</span>.<span class="fn">log</span>(<span class="kw">typeof</span> jsonString);
<span class="cmt">// "string" ‚Üê it's just text now!</span></code></div>

      <h3>Pretty Printing with stringify</h3>
      <div class="code-block"><code><span class="cmt">// The 3rd argument controls indentation!</span>
<span class="kw">const</span> pretty = <span class="fn">JSON</span>.<span class="fn">stringify</span>(user, <span class="null">null</span>, <span class="num">2</span>);
<span class="fn">console</span>.<span class="fn">log</span>(pretty);
<span class="cmt">// {
//   "name": "Ada Lovelace",
//   "age": 36,
//   "skills": [
//     "math",
//     "programming"
//   ],
//   "active": true
// }</span></code></div>

      <div class="info-box">
        <h4>üí° stringify() Signature</h4>
        <code>JSON.stringify(value, replacer, space)</code>
        <ul style="margin-top:8px;padding-left:20px;color:var(--text2)">
          <li><strong>value</strong> ‚Äî the thing to convert</li>
          <li><strong>replacer</strong> ‚Äî filter function or array of keys (or null)</li>
          <li><strong>space</strong> ‚Äî indentation (number of spaces or string)</li>
        </ul>
      </div>

      <h3>The Replacer ‚Äî Filtering Output</h3>
      <div class="code-block"><code><span class="cmt">// Only include certain keys</span>
<span class="fn">JSON</span>.<span class="fn">stringify</span>(user, [<span class="str">"name"</span>, <span class="str">"age"</span>], <span class="num">2</span>);
<span class="cmt">// {
//   "name": "Ada Lovelace",
//   "age": 36
// }</span>

<span class="cmt">// Use a function to transform values</span>
<span class="fn">JSON</span>.<span class="fn">stringify</span>(user, (key, value) => {
  <span class="kw">if</span> (<span class="kw">typeof</span> value === <span class="str">"string"</span>) <span class="kw">return</span> value.<span class="fn">toUpperCase</span>();
  <span class="kw">return</span> value;
}, <span class="num">2</span>);
<span class="cmt">// {
//   "name": "ADA LOVELACE",
//   "skills": ["MATH", "PROGRAMMING"],
//   ...
// }</span></code></div>
    </div>

    <div class="card">
      <h3>üì• JSON.parse() ‚Äî String ‚Üí Object</h3>
      <p>Converts a JSON string back into a JavaScript value.</p>

      <div class="code-block"><code><span class="kw">const</span> jsonStr = <span class="str">'{"name":"Ada","age":36}'</span>;
<span class="kw">const</span> obj = <span class="fn">JSON</span>.<span class="fn">parse</span>(jsonStr);

<span class="fn">console</span>.<span class="fn">log</span>(obj.name);  <span class="cmt">// "Ada"</span>
<span class="fn">console</span>.<span class="fn">log</span>(obj.age);   <span class="cmt">// 36</span>
<span class="fn">console</span>.<span class="fn">log</span>(<span class="kw">typeof</span> obj); <span class="cmt">// "object" ‚Üê it's a real JS object now!</span></code></div>

      <h3>The Reviver ‚Äî Transform During Parse</h3>
      <div class="code-block"><code><span class="kw">const</span> json = <span class="str">'{"name":"Ada","birthDate":"1815-12-10"}'</span>;

<span class="kw">const</span> parsed = <span class="fn">JSON</span>.<span class="fn">parse</span>(json, (key, value) => {
  <span class="kw">if</span> (key === <span class="str">"birthDate"</span>) <span class="kw">return new</span> <span class="fn">Date</span>(value);
  <span class="kw">return</span> value;
});

<span class="fn">console</span>.<span class="fn">log</span>(parsed.birthDate <span class="kw">instanceof</span> Date); <span class="cmt">// true!</span></code></div>
    </div>

    <div class="card">
      <h3>üß™ Interactive Playground: Parse & Stringify</h3>
      <div class="playground">
        <div class="playground-header">
          <h4>‚ö° Try It ‚Äî Write JS code using JSON.parse/stringify</h4>
          <button class="btn btn-sm btn-green" onclick="runPlayground('ps-play')">‚ñ∂ Run</button>
        </div>
        <div class="playground-body">
          <textarea id="ps-play-input">const user = {
  name: "Ada",
  age: 36,
  hobbies: ["math", "code"]
};

// Convert to JSON string
const json = JSON.stringify(user, null, 2);
console.log("JSON String:");
console.log(json);
console.log("Type:", typeof json);

// Parse it back
const parsed = JSON.parse(json);
console.log("\\nParsed back:");
console.log("Name:", parsed.name);
console.log("Type:", typeof parsed);</textarea>
          <div class="playground-output" id="ps-play-output">Click Run to see output...</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>‚ö†Ô∏è What stringify LOSES</h3>
      <div class="pitfall">
        <h4>üö® These values get LOST or changed during stringify!</h4>
        <div class="code-block"><code><span class="kw">const</span> tricky = {
  fn: <span class="kw">function</span>() { <span class="kw">return</span> <span class="num">42</span>; },  <span class="cmt">// ‚ùå DROPPED</span>
  undef: <span class="kw">undefined</span>,                  <span class="cmt">// ‚ùå DROPPED</span>
  sym: <span class="fn">Symbol</span>(<span class="str">"id"</span>),                <span class="cmt">// ‚ùå DROPPED</span>
  date: <span class="kw">new</span> <span class="fn">Date</span>(),                  <span class="cmt">// ‚ö†Ô∏è Becomes string</span>
  regex: <span class="op">/</span>hello<span class="op">/</span>,                    <span class="cmt">// ‚ö†Ô∏è Becomes {}</span>
  nan: <span class="num">NaN</span>,                          <span class="cmt">// ‚ö†Ô∏è Becomes null</span>
  inf: <span class="num">Infinity</span>,                     <span class="cmt">// ‚ö†Ô∏è Becomes null</span>
  name: <span class="str">"Ada"</span>,                       <span class="cmt">// ‚úÖ Kept</span>
  age: <span class="num">36</span>,                            <span class="cmt">// ‚úÖ Kept</span>
};

<span class="fn">console</span>.<span class="fn">log</span>(<span class="fn">JSON</span>.<span class="fn">stringify</span>(tricky, <span class="null">null</span>, <span class="num">2</span>));
<span class="cmt">// {
//   "date": "2024-01-15T10:30:00.000Z",  ‚Üê string, not Date!
//   "regex": {},                          ‚Üê empty object!
//   "nan": null,                          ‚Üê null!
//   "inf": null,                          ‚Üê null!
//   "name": "Ada",                        ‚Üê fine
//   "age": 36                             ‚Üê fine
// }</span></code></div>
      </div>

      <div class="tip">
        <h4>‚úÖ Use toJSON() for Custom Serialization</h4>
        <div class="code-block"><code><span class="kw">class</span> <span class="fn">User</span> {
  <span class="fn">constructor</span>(name, password) {
    <span class="kw">this</span>.name = name;
    <span class="kw">this</span>.password = password;  <span class="cmt">// sensitive!</span>
  }
  
  <span class="fn">toJSON</span>() {
    <span class="kw">return</span> { name: <span class="kw">this</span>.name };  <span class="cmt">// exclude password</span>
  }
}

<span class="kw">const</span> u = <span class="kw">new</span> <span class="fn">User</span>(<span class="str">"Ada"</span>, <span class="str">"secret123"</span>);
<span class="fn">console</span>.<span class="fn">log</span>(<span class="fn">JSON</span>.<span class="fn">stringify</span>(u));
<span class="cmt">// '{"name":"Ada"}' ‚Äî password excluded!</span></code></div>
      </div>
    </div>

    <div class="card">
      <h3>üí• Circular References</h3>
      <div class="pitfall">
        <h4>üö® Pitfall: Circular references CRASH stringify!</h4>
        <div class="code-block"><code><span class="kw">const</span> obj = { name: <span class="str">"Ada"</span> };
obj.self = obj;  <span class="cmt">// circular reference!</span>

<span class="fn">JSON</span>.<span class="fn">stringify</span>(obj);
<span class="cmt">// ‚ùå TypeError: Converting circular structure to JSON</span></code></div>
        <p style="margin-top:10px">Solutions: Use a replacer function, or libraries like <code>flatted</code>.</p>
        <div class="code-block"><code><span class="cmt">// Fix with replacer</span>
<span class="kw">const</span> seen = <span class="kw">new</span> <span class="fn">WeakSet</span>();
<span class="fn">JSON</span>.<span class="fn">stringify</span>(obj, (key, value) => {
  <span class="kw">if</span> (<span class="kw">typeof</span> value === <span class="str">"object"</span> && value !== <span class="null">null</span>) {
    <span class="kw">if</span> (seen.<span class="fn">has</span>(value)) <span class="kw">return</span> <span class="str">"[Circular]"</span>;
    seen.<span class="fn">add</span>(value);
  }
  <span class="kw">return</span> value;
});</code></div>
      </div>
    </div>

    <div class="card">
      <h3>üìù Safe Parsing Pattern</h3>
      <div class="pitfall">
        <h4>üö® Pitfall: parse() throws on invalid JSON!</h4>
        <div class="code-block"><code><span class="fn">JSON</span>.<span class="fn">parse</span>(<span class="str">"not json"</span>);
<span class="cmt">// ‚ùå SyntaxError: Unexpected token 'o'</span></code></div>
      </div>
      <div class="tip">
        <h4>‚úÖ Always wrap parse in try/catch!</h4>
        <div class="code-block"><code><span class="kw">function</span> <span class="fn">safeParse</span>(jsonStr) {
  <span class="kw">try</span> {
    <span class="kw">return</span> { data: <span class="fn">JSON</span>.<span class="fn">parse</span>(jsonStr), error: <span class="null">null</span> };
  } <span class="kw">catch</span> (e) {
    <span class="kw">return</span> { data: <span class="null">null</span>, error: e.message };
  }
}

<span class="cmt">// Usage</span>
<span class="kw">const</span> result = <span class="fn">safeParse</span>(<span class="str">'{"name":"Ada"}'</span>);
<span class="kw">if</span> (result.error) {
  <span class="fn">console</span>.<span class="fn">error</span>(<span class="str">"Bad JSON!"</span>, result.error);
} <span class="kw">else</span> {
  <span class="fn">console</span>.<span class="fn">log</span>(result.data);
}</code></div>
      </div>
    </div>

    <div class="card">
      ${renderQuiz('q-ps-1', 'What does JSON.stringify(undefined) return?', [
        { text: '"undefined"', correct: false },
        { text: 'null', correct: false },
        { text: 'undefined', correct: true },
        { text: 'Throws an error', correct: false }
      ], 'JSON.stringify(undefined) returns the JS value undefined (not the string "undefined"). Only valid JSON root values (objects, arrays, strings, numbers, booleans, null) produce a string output.')}

      ${renderQuiz('q-ps-2', 'What does JSON.parse(\'{"a":1}\').a return?', [
        { text: '"1"', correct: false },
        { text: '1', correct: true },
        { text: 'undefined', correct: false },
        { text: 'Throws an error', correct: false }
      ], 'JSON.parse correctly converts JSON number 1 to JavaScript number 1.')}

      ${renderQuiz('q-ps-3', 'What is the 3rd parameter of JSON.stringify used for?', [
        { text: 'Encoding type', correct: false },
        { text: 'Max depth', correct: false },
        { text: 'Indentation / formatting', correct: true },
        { text: 'Error handler', correct: false }
      ], 'The third parameter controls pretty-printing. Pass a number (spaces) or string to indent the output.')}
    </div>

    <div class="card">
      <h3>üí™ Exercise: Fix the Broken Code</h3>
      ${renderExercise('ex-ps-1', 
        'The code below tries to store user data in localStorage and retrieve it. Fix the bugs!',
        `// Store user data
const user = { name: "Ada", score: 100 };

// BUG 1: What's wrong here?
localStorage.setItem("user", user);

// BUG 2: What's wrong here?
const loaded = localStorage.getItem("user");
console.log(loaded.name);`,
        `// Store user data
const user = { name: "Ada", score: 100 };

// FIX: Must stringify before storing!
localStorage.setItem("user", JSON.stringify(user));

// FIX: Must parse after retrieving!
const loaded = JSON.parse(localStorage.getItem("user"));
console.log(loaded.name);`,
        function(code) {
          return code.includes('JSON.stringify') && code.includes('JSON.parse');
        }
      )}
    </div>

    <div class="card">
      <div class="section-complete">
        <h3>‚úÖ Parse & Stringify Mastered!</h3>
        <p>You know how to convert between JS objects and JSON strings.</p>
        <button class="btn btn-next" onclick="completeSection(1); goToSection(2)">Next: Deep vs Shallow Copy ‚Üí</button>
      </div>
    </div>
  `;
}

// ---- SECTION 2: Deep vs Shallow Copy ----
function renderDeepShallow() {
  return `
    <div class="card">
      <h2>ü™û Deep vs Shallow Copy</h2>
      <p>One of the most important concepts when working with data in JavaScript. Misunderstanding this causes <em>countless</em> bugs.</p>
    </div>

    <div class="card">
      <h3>üß† How JavaScript Stores Values</h3>
      <div class="visual-box highlight">
        <div class="memory-viz">
          <div class="mem-block">
            <h5>Primitives (copied by value)</h5>
            <div class="mem-item val">let a = 42 ‚Üí <strong>42</strong></div>
            <div class="mem-item val">let b = a ‚Üí <strong>42</strong> (independent copy)</div>
            <p style="color:var(--green);font-size:0.8rem;margin-top:8px">‚úÖ Changing b doesn't affect a</p>
          </div>
          <div class="mem-block">
            <h5>Objects (copied by reference)</h5>
            <div class="mem-item ref">let obj1 = {x:1} ‚Üí üìç ref#001</div>
            <div class="mem-item ref">let obj2 = obj1 ‚Üí üìç ref#001</div>
            <p style="color:var(--orange);font-size:0.8rem;margin-top:8px">‚ö†Ô∏è Both point to SAME data!</p>
          </div>
        </div>
      </div>

      <div class="code-block"><code><span class="cmt">// Primitives: Independent copies</span>
<span class="kw">let</span> a = <span class="num">42</span>;
<span class="kw">let</span> b = a;
b = <span class="num">99</span>;
<span class="fn">console</span>.<span class="fn">log</span>(a); <span class="cmt">// 42 ‚Üê unchanged! ‚úÖ</span>

<span class="cmt">// Objects: Shared reference</span>
<span class="kw">let</span> obj1 = { x: <span class="num">1</span> };
<span class="kw">let</span> obj2 = obj1;
obj2.x = <span class="num">999</span>;
<span class="fn">console</span>.<span class="fn">log</span>(obj1.x); <span class="cmt">// 999 ‚Üê CHANGED! ‚ö†Ô∏è</span></code></div>
    </div>

    <div class="card">
      <h3>üìã Shallow Copy Methods</h3>
      <p>These create a <strong>new top-level object</strong>, but nested objects are still shared!</p>

      <div class="code-block"><code><span class="kw">const</span> original = {
  name: <span class="str">"Ada"</span>,
  scores: [<span class="num">95</span>, <span class="num">87</span>, <span class="num">92</span>],
  address: { city: <span class="str">"London"</span> }
};

<span class="cmt">// Shallow copy methods:</span>
<span class="kw">const</span> copy1 = { ...original };                 <span class="cmt">// Spread operator</span>
<span class="kw">const</span> copy2 = <span class="fn">Object</span>.<span class="fn">assign</span>({}, original);      <span class="cmt">// Object.assign</span>
<span class="kw">const</span> copy3 = <span class="fn">Array</span>.<span class="fn">from</span>(original.scores);   <span class="cmt">// For arrays</span>
<span class="kw">const</span> copy4 = [...original.scores];            <span class="cmt">// Array spread</span></code></div>

      <div class="pitfall">
        <h4>üö® The Shallow Copy Trap</h4>
        <div class="code-block"><code><span class="kw">const</span> original = {
  name: <span class="str">"Ada"</span>,
  address: { city: <span class="str">"London"</span>, zip: <span class="str">"SW1"</span> }
};

<span class="kw">const</span> shallow = { ...original };

<span class="cmt">// Changing top-level: SAFE ‚úÖ</span>
shallow.name = <span class="str">"Grace"</span>;
<span class="fn">console</span>.<span class="fn">log</span>(original.name); <span class="cmt">// "Ada" ‚Üê unchanged ‚úÖ</span>

<span class="cmt">// Changing nested object: DANGER ‚ö†Ô∏è</span>
shallow.address.city = <span class="str">"Paris"</span>;
<span class="fn">console</span>.<span class="fn">log</span>(original.address.city); <span class="cmt">// "Paris" ‚Üê MUTATED! üí•</span></code></div>
      </div>

      <h3>Visual: Shallow Copy Memory Layout</h3>
      <div class="visual-box">
        <div class="memory-viz">
          <div class="mem-block" style="border-color:var(--yellow)">
            <h5 style="color:var(--yellow)">original</h5>
            <div class="mem-item val">name: "Ada"</div>
            <div class="mem-item ref">address: ‚Üí üìç ref#42</div>
          </div>
          <div class="mem-block" style="border-color:var(--cyan)">
            <h5 style="color:var(--cyan)">shallowCopy</h5>
            <div class="mem-item val">name: "Ada" (own copy)</div>
            <div class="mem-item ref">address: ‚Üí üìç ref#42</div>
          </div>
          <div class="mem-block" style="border-color:var(--orange)">
            <h5 style="color:var(--orange)">üìç ref#42 (SHARED!)</h5>
            <div class="mem-item val">city: "London"</div>
            <div class="mem-item val">zip: "SW1"</div>
          </div>
        </div>
        <p style="text-align:center;margin-top:15px;color:var(--orange)">‚ö†Ô∏è Both variables point to the SAME address object!</p>
      </div>
    </div>

    <div class="card">
      <h3>üèä Deep Copy Methods</h3>
      <p>Deep copies create <strong>completely independent clones</strong> ‚Äî nested objects included.</p>

      <h3>Method 1: JSON.parse(JSON.stringify()) ‚Äî The Classic Hack</h3>
      <div class="code-block"><code><span class="kw">const</span> original = {
  name: <span class="str">"Ada"</span>,
  scores: [<span class="num">95</span>, <span class="num">87</span>],
  address: { city: <span class="str">"London"</span> }
};

<span class="kw">const</span> deep = <span class="fn">JSON</span>.<span class="fn">parse</span>(<span class="fn">JSON</span>.<span class="fn">stringify</span>(original));

deep.address.city = <span class="str">"Paris"</span>;
<span class="fn">console</span>.<span class="fn">log</span>(original.address.city); <span class="cmt">// "London" ‚Üê SAFE! ‚úÖ</span>

deep.scores.<span class="fn">push</span>(<span class="num">100</span>);
<span class="fn">console</span>.<span class="fn">log</span>(original.scores); <span class="cmt">// [95, 87] ‚Üê SAFE! ‚úÖ</span></code></div>

      <div class="pitfall">
        <h4>‚ö†Ô∏è Limitations of JSON deep copy</h4>
        <div class="code-block"><code><span class="kw">const</span> problematic = {
  date: <span class="kw">new</span> <span class="fn">Date</span>(),         <span class="cmt">// ‚ùå Becomes string</span>
  regex: <span class="op">/</span>hello<span class="op">/</span>i,           <span class="cmt">// ‚ùå Becomes {}</span>
  fn: () => <span class="num">42</span>,              <span class="cmt">// ‚ùå Lost entirely</span>
  undef: <span class="kw">undefined</span>,           <span class="cmt">// ‚ùå Lost entirely</span>
  map: <span class="kw">new</span> <span class="fn">Map</span>([[<span class="str">"a"</span>,<span class="num">1</span>]]),  <span class="cmt">// ‚ùå Becomes {}</span>
  set: <span class="kw">new</span> <span class="fn">Set</span>([<span class="num">1</span>,<span class="num">2</span>,<span class="num">3</span>]),     <span class="cmt">// ‚ùå Becomes {}</span>
};

<span class="kw">const</span> copy = <span class="fn">JSON</span>.<span class="fn">parse</span>(<span class="fn">JSON</span>.<span class="fn">stringify</span>(problematic));
<span class="cmt">// date is now a string, not a Date object!</span>
<span class="cmt">// regex, fn, undef, map, set are all broken!</span></code></div>
      </div>

      <h3>Method 2: structuredClone() ‚Äî The Modern Way üåü</h3>
      <div class="tip">
        <h4>‚úÖ Best option in modern environments!</h4>
        <div class="code-block"><code><span class="kw">const</span> original = {
  name: <span class="str">"Ada"</span>,
  date: <span class="kw">new</span> <span class="fn">Date</span>(),
  data: <span class="kw">new</span> <span class="fn">Map</span>([[<span class="str">"key"</span>, <span class="str">"value"</span>]]),
  nums: <span class="kw">new</span> <span class="fn">Set</span>([<span class="num">1</span>, <span class="num">2</span>, <span class="num">3</span>]),
  nested: { deep: { value: <span class="num">42</span> } }
};

<span class="kw">const</span> clone = <span class="fn">structuredClone</span>(original);
<span class="cmt">// ‚úÖ Date stays a Date</span>
<span class="cmt">// ‚úÖ Map stays a Map</span>
<span class="cmt">// ‚úÖ Set stays a Set</span>
<span class="cmt">// ‚úÖ Everything deeply cloned!</span>

clone.nested.deep.value = <span class="num">999</span>;
<span class="fn">console</span>.<span class="fn">log</span>(original.nested.deep.value); <span class="cmt">// 42 ‚Üê safe!</span></code></div>
        <p style="margin-top:8px;font-size:0.85rem">Available in all modern browsers and Node.js 17+. Still can't clone functions or DOM elements.</p>
      </div>

      <h3>Comparison Table</h3>
      <table class="compare-table">
        <tr><th>Method</th><th>Deep?</th><th>Dates</th><th>Maps/Sets</th><th>Functions</th><th>Circular</th></tr>
        <tr><td>Spread / Object.assign</td><td>‚ùå Shallow</td><td>‚úÖ Ref</td><td>‚úÖ Ref</td><td>‚úÖ Ref</td><td>N/A</td></tr>
        <tr><td>JSON parse/stringify</td><td>‚úÖ Deep</td><td>‚ùå String</td><td>‚ùå Lost</td><td>‚ùå Lost</td><td>‚ùå Crash</td></tr>
        <tr><td>structuredClone</td><td>‚úÖ Deep</td><td>‚úÖ Clone</td><td>‚úÖ Clone</td><td>‚ùå Error</td><td>‚úÖ Handled</td></tr>
      </table>
    </div>

    <div class="card">
      <h3>üß™ Interactive: See It Yourself</h3>
      <div class="playground">
        <div class="playground-header">
          <h4>‚ö° Experiment with Shallow vs Deep Copy</h4>
          <button class="btn btn-sm btn-green" onclick="runPlayground('ds-play')">‚ñ∂ Run</button>
        </div>
        <div class="playground-body">
          <textarea id="ds-play-input">const original = {
  name: "Ada",
  hobbies: ["math", "music"],
  address: { city: "London" }
};

// SHALLOW copy
const shallow = { ...original };
shallow.address.city = "Paris";
console.log("After shallow copy mutation:");
console.log("original.address.city:", original.address.city);
console.log("Same ref?", original.address === shallow.address);

console.log("\\n--- Reset ---\\n");

// DEEP copy with JSON
const original2 = {
  name: "Ada",
  address: { city: "London" }
};
const deep = JSON.parse(JSON.stringify(original2));
deep.address.city = "Berlin";
console.log("After deep copy mutation:");
console.log("original2.address.city:", original2.address.city);
console.log("Same ref?", original2.address === deep.address);</textarea>
          <div class="playground-output" id="ds-play-output">Click Run to see output...</div>
        </div>
      </div>
    </div>

    <div class="card">
      ${renderQuiz('q-ds-1', 'What does this log?\nconst a = { x: { y: 1 } };\nconst b = { ...a };\nb.x.y = 99;\nconsole.log(a.x.y);', [
        { text: '1', correct: false },
        { text: '99', correct: true },
        { text: 'undefined', correct: false },
        { text: 'Throws an error', correct: false }
      ], 'Spread operator creates a shallow copy. a.x and b.x point to the same nested object, so mutating b.x.y also changes a.x.y.')}

      ${renderQuiz('q-ds-2', 'Which deep copy method preserves Date objects?', [
        { text: 'JSON.parse(JSON.stringify(obj))', correct: false },
        { text: '{ ...obj }', correct: false },
        { text: 'structuredClone(obj)', correct: true },
        { text: 'Object.assign({}, obj)', correct: false }
      ], 'structuredClone preserves Date, Map, Set, and many other built-in types. The JSON method converts Dates to strings.')}

      ${renderQuiz('q-ds-3', 'When is JSON.parse(JSON.stringify()) the BEST choice for deep cloning?', [
        { text: 'When data has functions', correct: false },
        { text: 'When data is plain JSON-safe objects/arrays', correct: true },
        { text: 'When data has circular references', correct: false },
        { text: 'Always', correct: false }
      ], 'JSON deep clone works perfectly for plain data ‚Äî strings, numbers, booleans, arrays, and simple objects. It\'s fast and widely supported.')}
    </div>

    <div class="card">
      ${renderExercise('ex-ds-1',
        'Write a function deepClone(obj) that creates a deep clone using JSON methods. Test it by cloning the object and modifying the clone\'s nested property without affecting the original.',
        `function deepClone(obj) {
  // Your code here
}

const original = {
  user: { name: "Ada", scores: [10, 20] }
};

const clone = deepClone(original);
clone.user.name = "Grace";
clone.user.scores.push(30);

// These should prove independence:
console.log(original.user.name);    // should be "Ada"
console.log(original.user.scores);  // should be [10, 20]`,
        `function deepClone(obj) {
  return JSON.parse(JSON.stringify(obj));
}

const original = {
  user: { name: "Ada", scores: [10, 20] }
};

const clone = deepClone(original);
clone.user.name = "Grace";
clone.user.scores.push(30);

console.log(original.user.name);    // "Ada"
console.log(original.user.scores);  // [10, 20]`,
        function(code) {
          return code.includes('JSON.parse') && code.includes('JSON.stringify');
        }
      )}
    </div>

    <div class="card">
      <div class="section-complete">
        <h3>‚úÖ Deep vs Shallow Copy Mastered!</h3>
        <p>You understand reference vs value, shallow vs deep copies, and their tradeoffs.</p>
        <button class="btn btn-next" onclick="completeSection(2); goToSection(3)">Next: Working with APIs ‚Üí</button>
      </div>
    </div>
  `;
}

// ---- SECTION 3: Working with API Data ----
function renderApiData() {
  return `
    <div class="card">
      <h2>üåê Working with API Data</h2>
      <p>APIs send and receive data as JSON. Here's how to handle the entire flow.</p>

      <div class="flow-container">
        <div class="flow-step">
          <div class="icon">üì±</div>
          <div><strong>Your App</strong></div>
        </div>
        <div class="flow-arrow">‚Üí fetch()</div>
        <div class="flow-step">
          <div class="icon">üåê</div>
          <div><strong>API Server</strong></div>
        </div>
        <div class="flow-arrow">‚Üí JSON</div>
        <div class="flow-step">
          <div class="icon">üì•</div>
          <div><strong>.json()</strong></div>
        </div>
        <div class="flow-arrow">‚Üí</div>
        <div class="flow-step">
          <div class="icon">üü®</div>
          <div><strong>JS Object</strong></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>üì° Fetching JSON Data</h3>
      <div class="code-block"><code><span class="cmt">// Basic GET request</span>
<span class="kw">async function</span> <span class="fn">getUsers</span>() {
  <span class="kw">const</span> response = <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">"https://jsonplaceholder.typicode.com/users"</span>);
  
  <span class="cmt">// response.json() parses the JSON body ‚Üí JS object</span>
  <span class="kw">const</span> users = <span class="kw">await</span> response.<span class="fn">json</span>();
  
  <span class="fn">console</span>.<span class="fn">log</span>(users);  <span class="cmt">// Array of user objects</span>
  <span class="kw">return</span> users;
}</code></div>

      <div class="pitfall">
        <h4>üö® Pitfall: response.json() is NOT the same as JSON.parse()</h4>
        <div class="code-block"><code><span class="cmt">// ‚ùå Common mistake</span>
<span class="kw">const</span> response = <span class="kw">await</span> <span class="fn">fetch</span>(url);
<span class="kw">const</span> data = <span class="fn">JSON</span>.<span class="fn">parse</span>(response); <span class="cmt">// ‚ùå Wrong! Response is not a string</span>

<span class="cmt">// ‚úÖ Correct</span>
<span class="kw">const</span> response = <span class="kw">await</span> <span class="fn">fetch</span>(url);
<span class="kw">const</span> data = <span class="kw">await</span> response.<span class="fn">json</span>();  <span class="cmt">// ‚úÖ Built-in method</span></code></div>
      </div>

      <div class="pitfall">
        <h4>üö® Pitfall: Forgetting await on response.json()</h4>
        <div class="code-block"><code><span class="cmt">// ‚ùå Missing await!</span>
<span class="kw">const</span> data = response.<span class="fn">json</span>();  <span class="cmt">// Returns a Promise, not data!</span>
<span class="fn">console</span>.<span class="fn">log</span>(data.name);  <span class="cmt">// undefined! üò±</span>

<span class="cmt">// ‚úÖ With await</span>
<span class="kw">const</span> data = <span class="kw">await</span> response.<span class="fn">json</span>();
<span class="fn">console</span>.<span class="fn">log</span>(data.name);  <span class="cmt">// "Ada" ‚úÖ</span></code></div>
      </div>
    </div>

    <div class="card">
      <h3>üì§ Sending JSON Data</h3>
      <div class="code-block"><code><span class="kw">async function</span> <span class="fn">createUser</span>(userData) {
  <span class="kw">const</span> response = <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">"https://api.example.com/users"</span>, {
    method: <span class="str">"POST"</span>,
    headers: {
      <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span>,  <span class="cmt">// ‚Üê Tell server it's JSON!</span>
    },
    body: <span class="fn">JSON</span>.<span class="fn">stringify</span>(userData),  <span class="cmt">// ‚Üê Must stringify!</span>
  });
  
  <span class="kw">const</span> result = <span class="kw">await</span> response.<span class="fn">json</span>();
  <span class="kw">return</span> result;
}

<span class="cmt">// Usage</span>
<span class="fn">createUser</span>({ name: <span class="str">"Ada"</span>, email: <span class="str">"ada@code.com"</span> });</code></div>

      <div class="pitfall">
        <h4>üö® Pitfall: Forgetting Content-Type header</h4>
        <p>Without <code>"Content-Type": "application/json"</code>, the server might not know how to read your data!</p>
      </div>

      <div class="pitfall">
        <h4>üö® Pitfall: Forgetting to stringify the body</h4>
        <div class="code-block"><code><span class="cmt">// ‚ùå Sending raw object</span>
body: userData  <span class="cmt">// Server gets "[object Object]"!</span>

<span class="cmt">// ‚úÖ Must stringify!</span>
body: <span class="fn">JSON</span>.<span class="fn">stringify</span>(userData)</code></div>
      </div>
    </div>

    <div class="card">
      <h3>üõ°Ô∏è Robust API Pattern</h3>
      <div class="code-block"><code><span class="kw">async function</span> <span class="fn">apiRequest</span>(url, options = {}) {
  <span class="kw">try</span> {
    <span class="kw">const</span> response = <span class="kw">await</span> <span class="fn">fetch</span>(url, {
      headers: { <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span>, ...options.headers },
      ...options,
      body: options.body ? <span class="fn">JSON</span>.<span class="fn">stringify</span>(options.body) : <span class="kw">undefined</span>,
    });

    <span class="cmt">// Check if request was successful</span>
    <span class="kw">if</span> (!response.ok) {
      <span class="kw">throw new</span> <span class="fn">Error</span>(<span class="str">\`HTTP \${response.status}: \${response.statusText}\`</span>);
    }

    <span class="cmt">// Safely parse JSON response</span>
    <span class="kw">const</span> contentType = response.headers.<span class="fn">get</span>(<span class="str">"content-type"</span>);
    <span class="kw">if</span> (contentType?.includes(<span class="str">"application/json"</span>)) {
      <span class="kw">return await</span> response.<span class="fn">json</span>();
    }
    
    <span class="kw">return await</span> response.<span class="fn">text</span>();
  } <span class="kw">catch</span> (error) {
    <span class="fn">console</span>.<span class="fn">error</span>(<span class="str">"API Error:"</span>, error.message);
    <span class="kw">throw</span> error;
  }
}

<span class="cmt">// Usage</span>
<span class="kw">const</span> users = <span class="kw">await</span> <span class="fn">apiRequest</span>(<span class="str">"https://jsonplaceholder.typicode.com/users"</span>);
<span class="kw">const</span> newUser = <span class="kw">await</span> <span class="fn">apiRequest</span>(<span class="str">"/api/users"</span>, {
  method: <span class="str">"POST"</span>,
  body: { name: <span class="str">"Ada"</span> }
});</code></div>
    </div>

    <div class="card">
      <h3>üìÇ Working with Nested API Responses</h3>
      <p>Real API data is often deeply nested. Here's how to navigate it safely.</p>

      <div class="code-block"><code><span class="cmt">// Typical API response</span>
<span class="kw">const</span> apiResponse = {
  status: <span class="str">"success"</span>,
  data: {
    users: [
      {
        id: <span class="num">1</span>,
        name: <span class="str">"Ada"</span>,
        company: {
          name: <span class="str">"Lovelace Inc"</span>,
          address: {
            street: <span class="str">"123 Code Lane"</span>,
            geo: { lat: <span class="num">51.5</span>, lng: <span class="num">-0.1</span> }
          }
        }
      }
    ]
  }
};

<span class="cmt">// ‚ùå Dangerous ‚Äî any null/undefined in chain = crash</span>
<span class="kw">const</span> lat = apiResponse.data.users[<span class="num">0</span>].company.address.geo.lat;

<span class="cmt">// ‚úÖ Safe with optional chaining</span>
<span class="kw">const</span> safeLat = apiResponse?.data?.users?.[<span class="num">0</span>]?.company?.address?.geo?.lat;

<span class="cmt">// ‚úÖ With default value</span>
<span class="kw">const</span> city = apiResponse?.data?.users?.[<span class="num">0</span>]?.company?.address?.city ?? <span class="str">"Unknown"</span>;</code></div>

      <div class="tip">
        <h4>‚úÖ Destructuring Nested API Data</h4>
        <div class="code-block"><code><span class="kw">const</span> {
  data: {
    users: [{
      name,
      company: {
        name: companyName,
        address: { geo: { lat, lng } }
      }
    }]
  }
} = apiResponse;

<span class="fn">console</span>.<span class="fn">log</span>(name);        <span class="cmt">// "Ada"</span>
<span class="fn">console</span>.<span class="fn">log</span>(companyName); <span class="cmt">// "Lovelace Inc"</span>
<span class="fn">console</span>.<span class="fn">log</span>(lat, lng);    <span class="cmt">// 51.5 -0.1</span></code></div>
      </div>
    </div>

    <div class="card">
      <h3>üß™ Live API Playground</h3>
      <div class="playground">
        <div class="playground-header">
          <h4>‚ö° Fetch Real Data from JSONPlaceholder API</h4>
          <button class="btn btn-sm btn-green" onclick="runPlayground('api-play')">‚ñ∂ Run</button>
        </div>
        <div class="playground-body">
          <textarea id="api-play-input">// Simulated API response (real APIs work the same way)
const apiData = {
  status: "success",
  results: [
    { id: 1, title: "Learn JSON", completed: true },
    { id: 2, title: "Master APIs", completed: false },
    { id: 3, title: "Build Projects", completed: false }
  ],
  meta: { total: 3, page: 1 }
};

// Navigate the response
console.log("Status:", apiData.status);
console.log("Total items:", apiData.meta.total);

// Extract just what you need
const titles = apiData.results.map(r => r.title);
console.log("Titles:", titles);

// Filter data
const pending = apiData.results.filter(r => !r.completed);
console.log("Pending:", pending.length, "items");
pending.forEach(t => console.log(" -", t.title));</textarea>
          <div class="playground-output" id="api-play-output">Click Run to see output...</div>
        </div>
      </div>
    </div>

    <div class="card">
      ${renderQuiz('q-api-1', 'What does response.json() return?', [
        { text: 'A JSON string', correct: false },
        { text: 'A JavaScript object', correct: false },
        { text: 'A Promise that resolves to a JS object', correct: true },
        { text: 'undefined', correct: false }
      ], 'response.json() returns a Promise. You need await (or .then()) to get the actual parsed JavaScript object.')}

      ${renderQuiz('q-api-2', 'When sending JSON in a POST request, you must:', [
        { text: 'Only set the body', correct: false },
        { text: 'Stringify the body AND set Content-Type header', correct: true },
        { text: 'Use JSON.parse on the body', correct: false },
        { text: 'Send the object directly', correct: false }
      ], 'You must JSON.stringify() the body and set the Content-Type header to "application/json" so the server knows how to parse it.')}
    </div>

    <div class="card">
      ${renderExercise('ex-api-1',
        'Write a function that takes an API response object and safely extracts a user list, handling cases where the data might be missing.',
        `function extractUsers(response) {
  // Extract users safely from this structure:
  // { data: { users: [...] } }
  // Return empty array if anything is missing
  // Your code here
}

// Test cases:
console.log(extractUsers({ data: { users: [{name:"Ada"}] } }));
console.log(extractUsers({ data: {} }));
console.log(extractUsers(null));
console.log(extractUsers({ data: { users: null } }));`,
        `function extractUsers(response) {
  return response?.data?.users ?? [];
}

// Test cases:
console.log(extractUsers({ data: { users: [{name:"Ada"}] } }));
// [{name:"Ada"}]
console.log(extractUsers({ data: {} }));
// []
console.log(extractUsers(null));
// []
console.log(extractUsers({ data: { users: null } }));
// []`,
        function(code) {
          return (code.includes('?.') || code.includes('try')) && 
                 (code.includes('??') || code.includes('||') || code.includes('return'));
        }
      )}
    </div>

    <div class="card">
      <div class="section-complete">
        <h3>‚úÖ API Data Handling Mastered!</h3>
        <p>You can fetch, send, and safely navigate API data.</p>
        <button class="btn btn-next" onclick="completeSection(3); goToSection(4)">Next: Data Transformation ‚Üí</button>
      </div>
    </div>
  `;
}

// ---- SECTION 4: Data Transformation ----
function renderTransform() {
  return `
    <div class="card">
      <h2>üîß Data Transformation</h2>
      <p>Real-world data rarely comes in the format you need. Transforming data is a <strong>critical</strong> job skill.</p>
    </div>

    <div class="card">
      <h3>üó∫Ô∏è map() ‚Äî Transform Every Item</h3>
      <div class="code-block"><code><span class="kw">const</span> apiUsers = [
  { id: <span class="num">1</span>, first_name: <span class="str">"Ada"</span>, last_name: <span class="str">"Lovelace"</span>, email_address: <span class="str">"ada@code.com"</span> },
  { id: <span class="num">2</span>, first_name: <span class="str">"Grace"</span>, last_name: <span class="str">"Hopper"</span>, email_address: <span class="str">"grace@navy.mil"</span> }
];

<span class="cmt">// Transform API format ‚Üí app format</span>
<span class="kw">const</span> users = apiUsers.<span class="fn">map</span>(u => ({
  id: u.id,
  fullName: <span class="str">\`\${u.first_name} \${u.last_name}\`</span>,
  email: u.email_address,
  initials: <span class="str">\`\${u.first_name[0]}\${u.last_name[0]}\`</span>
}));

<span class="cmt">// Result:
// [
//   { id: 1, fullName: "Ada Lovelace", email: "ada@code.com", initials: "AL" },
//   { id: 2, fullName: "Grace Hopper", email: "grace@navy.mil", initials: "GH" }
// ]</span></code></div>
    </div>

    <div class="card">
      <h3>üîç filter() + map() ‚Äî Select & Transform</h3>
      <div class="code-block"><code><span class="kw">const</span> products = [
  { name: <span class="str">"Laptop"</span>, price: <span class="num">999</span>, inStock: <span class="bool">true</span>, category: <span class="str">"electronics"</span> },
  { name: <span class="str">"Book"</span>, price: <span class="num">15</span>, inStock: <span class="bool">true</span>, category: <span class="str">"books"</span> },
  { name: <span class="str">"Phone"</span>, price: <span class="num">699</span>, inStock: <span class="bool">false</span>, category: <span class="str">"electronics"</span> },
  { name: <span class="str">"Pen"</span>, price: <span class="num">2</span>, inStock: <span class="bool">true</span>, category: <span class="str">"office"</span> }
];

<span class="cmt">// Get available electronics with formatted prices</span>
<span class="kw">const</span> available = products
  .<span class="fn">filter</span>(p => p.inStock && p.category === <span class="str">"electronics"</span>)
  .<span class="fn">map</span>(p => ({
    name: p.name,
    displayPrice: <span class="str">\`$\${p.price.toFixed(2)}\`</span>
  }));

<span class="cmt">// [{ name: "Laptop", displayPrice: "$999.00" }]</span></code></div>
    </div>

    <div class="card">
      <h3>üìä reduce() ‚Äî Reshape Data Structures</h3>
      <div class="code-block"><code><span class="cmt">// Array ‚Üí Object (index by ID)</span>
<span class="kw">const</span> users = [
  { id: <span class="num">1</span>, name: <span class="str">"Ada"</span> },
  { id: <span class="num">2</span>, name: <span class="str">"Grace"</span> },
  { id: <span class="num">3</span>, name: <span class="str">"Alan"</span> }
];

<span class="kw">const</span> userMap = users.<span class="fn">reduce</span>((acc, user) => {
  acc[user.id] = user;
  <span class="kw">return</span> acc;
}, {});

<span class="cmt">// { 1: { id: 1, name: "Ada" }, 2: {...}, 3: {...} }</span>
<span class="cmt">// Now you can access: userMap[2].name ‚Üí "Grace"</span></code></div>

      <div class="code-block"><code><span class="cmt">// Group items by category</span>
<span class="kw">const</span> items = [
  { name: <span class="str">"Apple"</span>, type: <span class="str">"fruit"</span> },
  { name: <span class="str">"Carrot"</span>, type: <span class="str">"vegetable"</span> },
  { name: <span class="str">"Banana"</span>, type: <span class="str">"fruit"</span> },
  { name: <span class="str">"Broccoli"</span>, type: <span class="str">"vegetable"</span> }
];

<span class="kw">const</span> grouped = items.<span class="fn">reduce</span>((acc, item) => {
  <span class="kw">const</span> key = item.type;
  <span class="kw">if</span> (!acc[key]) acc[key] = [];
  acc[key].<span class="fn">push</span>(item.name);
  <span class="kw">return</span> acc;
}, {});

<span class="cmt">// { fruit: ["Apple", "Banana"], vegetable: ["Carrot", "Broccoli"] }</span></code></div>
    </div>

    <div class="card">
      <h3>üîÑ Flattening Nested Structures</h3>
      <div class="code-block"><code><span class="cmt">// Flatten nested arrays</span>
<span class="kw">const</span> nested = [[<span class="num">1</span>,<span class="num">2</span>], [<span class="num">3</span>,<span class="num">4</span>], [<span class="num">5</span>,[<span class="num">6</span>,<span class="num">7</span>]]];

nested.<span class="fn">flat</span>();       <span class="cmt">// [1, 2, 3, 4, 5, [6, 7]]  ‚Äî one level</span>
nested.<span class="fn">flat</span>(<span class="num">2</span>);      <span class="cmt">// [1, 2, 3, 4, 5, 6, 7]    ‚Äî two levels</span>
nested.<span class="fn">flat</span>(<span class="num">Infinity</span>); <span class="cmt">// [1, 2, 3, 4, 5, 6, 7]   ‚Äî all levels</span>

<span class="cmt">// flatMap ‚Äî map + flatten in one step</span>
<span class="kw">const</span> sentences = [<span class="str">"Hello world"</span>, <span class="str">"foo bar"</span>];
<span class="kw">const</span> words = sentences.<span class="fn">flatMap</span>(s => s.<span class="fn">split</span>(<span class="str">" "</span>));
<span class="cmt">// ["Hello", "world", "foo", "bar"]</span></code></div>
    </div>

    <div class="card">
      <h3>üîó Chaining Transformations</h3>
      <div class="code-block"><code><span class="kw">const</span> rawData = [
  { name: <span class="str">"Alice"</span>, scores: [<span class="num">85</span>, <span class="num">92</span>, <span class="num">78</span>], active: <span class="bool">true</span> },
  { name: <span class="str">"Bob"</span>, scores: [<span class="num">65</span>, <span class="num">70</span>, <span class="num">68</span>], active: <span class="bool">true</span> },
  { name: <span class="str">"Charlie"</span>, scores: [<span class="num">95</span>, <span class="num">98</span>, <span class="num">97</span>], active: <span class="bool">false</span> },
  { name: <span class="str">"Diana"</span>, scores: [<span class="num">88</span>, <span class="num">91</span>, <span class="num">85</span>], active: <span class="bool">true</span> }
];

<span class="cmt">// Pipeline: filter ‚Üí map ‚Üí sort</span>
<span class="kw">const</span> leaderboard = rawData
  .<span class="fn">filter</span>(s => s.active)                                 <span class="cmt">// active only</span>
  .<span class="fn">map</span>(s => ({
    name: s.name,
    avg: s.scores.<span class="fn">reduce</span>((a, b) => a + b) / s.scores.length  <span class="cmt">// calc average</span>
  }))
  .<span class="fn">sort</span>((a, b) => b.avg - a.avg)                         <span class="cmt">// highest first</span>
  .<span class="fn">map</span>((s, i) => ({
    rank: i + <span class="num">1</span>,
    ...s,
    avg: s.avg.<span class="fn">toFixed</span>(<span class="num">1</span>)                                  <span class="cmt">// format</span>
  }));

<span class="cmt">// [
//   { rank: 1, name: "Diana", avg: "88.0" },
//   { rank: 2, name: "Alice", avg: "85.0" },
//   { rank: 3, name: "Bob",   avg: "67.7" }
// ]</span></code></div>
    </div>

    <div class="card">
      <h3>üîë Reshaping Object Keys</h3>
      <div class="code-block"><code><span class="cmt">// snake_case to camelCase conversion</span>
<span class="kw">function</span> <span class="fn">snakeToCamel</span>(str) {
  <span class="kw">return</span> str.<span class="fn">replace</span>(<span class="op">/</span>_([a-z])<span class="op">/g</span>, (_, c) => c.<span class="fn">toUpperCase</span>());
}

<span class="kw">function</span> <span class="fn">transformKeys</span>(obj) {
  <span class="kw">if</span> (<span class="fn">Array</span>.<span class="fn">isArray</span>(obj)) <span class="kw">return</span> obj.<span class="fn">map</span>(<span class="fn">transformKeys</span>);
  <span class="kw">if</span> (obj !== <span class="null">null</span> && <span class="kw">typeof</span> obj === <span class="str">"object"</span>) {
    <span class="kw">return</span> <span class="fn">Object</span>.<span class="fn">fromEntries</span>(
      <span class="fn">Object</span>.<span class="fn">entries</span>(obj).<span class="fn">map</span>(([k, v]) => [<span class="fn">snakeToCamel</span>(k), <span class="fn">transformKeys</span>(v)])
    );
  }
  <span class="kw">return</span> obj;
}

<span class="cmt">// Transform API response keys</span>
<span class="kw">const</span> apiData = { first_name: <span class="str">"Ada"</span>, last_name: <span class="str">"Lovelace"</span>, home_address: { zip_code: <span class="str">"SW1"</span> } };
<span class="kw">const</span> result = <span class="fn">transformKeys</span>(apiData);
<span class="cmt">// { firstName: "Ada", lastName: "Lovelace", homeAddress: { zipCode: "SW1" } }</span></code></div>
    </div>

    <div class="card">
      <h3>üß™ Transformation Playground</h3>
      <div class="playground">
        <div class="playground-header">
          <h4>‚ö° Practice Data Transformations</h4>
          <button class="btn btn-sm btn-green" onclick="runPlayground('tx-play')">‚ñ∂ Run</button>
        </div>
        <div class="playground-body">
          <textarea id="tx-play-input">const orders = [
  { id: 1, customer: "Ada", items: [
    { product: "Laptop", price: 999, qty: 1 },
    { product: "Mouse", price: 29, qty: 2 }
  ]},
  { id: 2, customer: "Grace", items: [
    { product: "Monitor", price: 450, qty: 1 },
    { product: "Keyboard", price: 79, qty: 1 }
  ]}
];

// Calculate total per order
const summary = orders.map(order => ({
  id: order.id,
  customer: order.customer,
  itemCount: order.items.reduce((sum, i) => sum + i.qty, 0),
  total: order.items.reduce((sum, i) => sum + i.price * i.qty, 0)
}));

console.log("Order Summary:");
summary.forEach(s => 
  console.log(\`  #\${s.id} \${s.customer}: \${s.itemCount} items, $\${s.total}\`)
);

// Grand total
const grandTotal = summary.reduce((sum, s) => sum + s.total, 0);
console.log(\`\\nGrand Total: $\${grandTotal}\`);</textarea>
          <div class="playground-output" id="tx-play-output">Click Run to see output...</div>
        </div>
      </div>
    </div>

    <div class="card">
      ${renderQuiz('q-tx-1', 'What does [1,2,3].map(x => x * 2) return?', [
        { text: '6', correct: false },
        { text: '[2, 4, 6]', correct: true },
        { text: '[1, 2, 3, 1, 2, 3]', correct: false },
        { text: 'undefined', correct: false }
      ], 'map() creates a new array with each element transformed by the callback. 1*2=2, 2*2=4, 3*2=6.')}

      ${renderQuiz('q-tx-2', 'How do you convert an array of objects into an object indexed by id?', [
        { text: 'array.map()', correct: false },
        { text: 'array.filter()', correct: false },
        { text: 'array.reduce()', correct: true },
        { text: 'array.find()', correct: false }
      ], 'reduce() is the best tool for reshaping data from one structure to another, like array ‚Üí object.')}

      ${renderQuiz('q-tx-3', 'What does [[1,2],[3,4]].flat() return?', [
        { text: '[[1,2],[3,4]]', correct: false },
        { text: '[1, 2, 3, 4]', correct: true },
        { text: '10', correct: false },
        { text: '[1, [2, 3], 4]', correct: false }
      ], 'flat() flattens one level of nesting by default, producing [1, 2, 3, 4].')}
    </div>

    <div class="card">
      ${renderExercise('ex-tx-1',
        'Given an array of students with scores, create a transformation pipeline that: 1) Filters students with average score ‚â• 80, 2) Maps to { name, grade } where grade is A (‚â•90), B (‚â•80), 3) Sorts alphabetically by name.',
        `const students = [
  { name: "Zara", scores: [95, 88, 92] },
  { name: "Ada", scores: [85, 90, 88] },
  { name: "Bob", scores: [60, 55, 70] },
  { name: "Mia", scores: [92, 95, 98] }
];

// Your transformation pipeline here:
const honors = students
  // ... your code

console.log(honors);
// Expected: [
//   { name: "Ada", grade: "B" },
//   { name: "Mia", grade: "A" },
//   { name: "Zara", grade: "A" }
// ]`,
        `const students = [
  { name: "Zara", scores: [95, 88, 92] },
  { name: "Ada", scores: [85, 90, 88] },
  { name: "Bob", scores: [60, 55, 70] },
  { name: "Mia", scores: [92, 95, 98] }
];

const honors = students
  .map(s => ({
    name: s.name,
    avg: s.scores.reduce((a, b) => a + b, 0) / s.scores.length
  }))
  .filter(s => s.avg >= 80)
  .map(s => ({
    name: s.name,
    grade: s.avg >= 90 ? "A" : "B"
  }))
  .sort((a, b) => a.name.localeCompare(b.name));

console.log(honors);`,
        function(code) {
          return code.includes('.filter') && code.includes('.map') && code.includes('.sort');
        }
      )}
    </div>

    <div class="card">
      <div class="section-complete">
        <h3>‚úÖ Data Transformation Mastered!</h3>
        <p>You can reshape, filter, and transform complex data structures.</p>
        <button class="btn btn-next" onclick="completeSection(4); goToSection(5)">Next: Final Challenge ‚Üí</button>
      </div>
    </div>
  `;
}

// ---- SECTION 5: Final Challenge ----
function renderFinalChallenge() {
  return `
    <div class="card">
      <h2>üèÜ Final Challenge</h2>
      <p>Put everything together! These challenges test all the concepts you've learned.</p>
    </div>

    <div class="card">
      <h3>Challenge 1: API Data Pipeline</h3>
      ${renderExercise('ex-final-1',
        'You receive raw API data about blog posts. Build a complete pipeline: parse the JSON string, extract posts, transform them, and produce a clean summary.',
        `const rawJson = '{"status":"ok","data":{"posts":[{"id":1,"title":"Learn JSON","author_name":"Ada","tags":["json","javascript"],"views":1500,"published":true},{"id":2,"title":"Draft Post","author_name":"Bob","tags":["draft"],"views":50,"published":false},{"id":3,"title":"API Guide","author_name":"Ada","tags":["api","json"],"views":3200,"published":true},{"id":4,"title":"CSS Tips","author_name":"Grace","tags":["css"],"views":800,"published":true}]}}';

// Step 1: Parse the JSON safely
// Step 2: Extract only published posts
// Step 3: Transform to: { title, author, tagCount, popular (views > 1000) }
// Step 4: Sort by views (highest first)
// Step 5: Convert back to a formatted JSON string

// Your code here:`,
        `const rawJson = '{"status":"ok","data":{"posts":[{"id":1,"title":"Learn JSON","author_name":"Ada","tags":["json","javascript"],"views":1500,"published":true},{"id":2,"title":"Draft Post","author_name":"Bob","tags":["draft"],"views":50,"published":false},{"id":3,"title":"API Guide","author_name":"Ada","tags":["api","json"],"views":3200,"published":true},{"id":4,"title":"CSS Tips","author_name":"Grace","tags":["css"],"views":800,"published":true}]}}';

// Step 1: Parse
const parsed = JSON.parse(rawJson);

// Step 2-4: Extract, Transform, Sort
const result = parsed.data.posts
  .filter(p => p.published)
  .map(p => ({
    title: p.title,
    author: p.author_name,
    tagCount: p.tags.length,
    popular: p.views > 1000
  }))
  .sort((a, b) => b.popular - a.popular);

// Step 5: Back to JSON
const output = JSON.stringify(result, null, 2);
console.log(output);`,
        function(code) {
          return code.includes('JSON.parse') && code.includes('.filter') && 
                 code.includes('.map') && code.includes('JSON.stringify');
        }
      )}
    </div>

    <div class="card">
      <h3>Challenge 2: Deep Clone & Modify</h3>
      ${renderExercise('ex-final-2',
        'Create a function that takes a config object, deep clones it, modifies the clone for a different environment, and returns both without the original being modified.',
        `const productionConfig = {
  app: { name: "MyApp", version: "2.0" },
  database: {
    host: "prod-db.example.com",
    port: 5432,
    credentials: { user: "admin", password: "secret" }
  },
  features: { darkMode: true, beta: false }
};

function createStagingConfig(prodConfig) {
  // 1. Deep clone the config
  // 2. Change database host to "staging-db.example.com"  
  // 3. Enable beta features
  // 4. Return staging config WITHOUT modifying production config
  // Your code here:
}

const stagingConfig = createStagingConfig(productionConfig);
console.log("Prod DB:", productionConfig.database.host);
console.log("Staging DB:", stagingConfig.database.host);
console.log("Prod beta:", productionConfig.features.beta);
console.log("Staging beta:", stagingConfig.features.beta);`,
        `const productionConfig = {
  app: { name: "MyApp", version: "2.0" },
  database: {
    host: "prod-db.example.com",
    port: 5432,
    credentials: { user: "admin", password: "secret" }
  },
  features: { darkMode: true, beta: false }
};

function createStagingConfig(prodConfig) {
  const staging = JSON.parse(JSON.stringify(prodConfig));
  staging.database.host = "staging-db.example.com";
  staging.features.beta = true;
  return staging;
}

const stagingConfig = createStagingConfig(productionConfig);
console.log("Prod DB:", productionConfig.database.host);
console.log("Staging DB:", stagingConfig.database.host);
console.log("Prod beta:", productionConfig.features.beta);
console.log("Staging beta:", stagingConfig.features.beta);`,
        function(code) {
          return code.includes('JSON.parse') && code.includes('JSON.stringify') &&
                 code.includes('staging');
        }
      )}
    </div>

    <div class="card">
      <h3>üß† Comprehensive Quiz</h3>

      ${renderQuiz('q-final-1', 'What happens when you JSON.stringify an object with a method?\nconst obj = { greet: function() { return "hi"; } };\nJSON.stringify(obj);', [
        { text: '"{\\"greet\\":\\"function() { return \\\\\\"hi\\\\\\"; }\\"}"', correct: false },
        { text: '"{}"', correct: true },
        { text: 'Throws TypeError', correct: false },
        { text: '"{\\"greet\\":null}"', correct: false }
      ], 'Functions are silently dropped from JSON.stringify output. The result is an empty object "{}".')}

      ${renderQuiz('q-final-2', 'const a = {x:{y:1}}; const b = JSON.parse(JSON.stringify(a)); b.x.y = 2; What is a.x.y?', [
        { text: '2', correct: false },
        { text: '1', correct: true },
        { text: 'undefined', correct: false },
        { text: 'null', correct: false }
      ], 'JSON.parse(JSON.stringify()) creates a deep clone. Modifying b.x.y does NOT affect a.x.y. They are completely independent.')}

      ${renderQuiz('q-final-3', 'Which safely handles potentially invalid JSON?', [
        { text: 'JSON.parse(data) || {}', correct: false },
        { text: 'try { JSON.parse(data) } catch(e) { ... }', correct: true },
        { text: 'JSON.parse(data ?? "{}")', correct: false },
        { text: 'if (JSON.valid(data)) JSON.parse(data)', correct: false }
      ], 'JSON.parse throws on invalid input. The only safe way is try/catch. There is no JSON.valid() method.')}

      ${renderQuiz('q-final-4', 'Which array method transforms [{id:1},{id:2}] into {1:{id:1}, 2:{id:2}}?', [
        { text: '.map()', correct: false },
        { text: '.filter()', correct: false },
        { text: '.reduce()', correct: true },
        { text: '.flatMap()', correct: false }
      ], 'reduce() is used to transform an array into a different data structure ‚Äî in this case, an object indexed by id.')}
    </div>

    <div class="card">
      <h3>Challenge 3: The Ultimate Playground</h3>
      <div class="playground">
        <div class="playground-header">
          <h4>‚ö° Your Sandbox ‚Äî Try anything!</h4>
          <button class="btn btn-sm btn-green" onclick="runPlayground('final-play')">‚ñ∂ Run</button>
        </div>
        <div class="playground-body">
          <textarea id="final-play-input">// üèÜ FINAL PLAYGROUND - Combine everything!
// Try: parsing, stringifying, deep copy, transforms

const rawApiResponse = JSON.stringify({
  users: [
    { id: 1, name: "Ada", role: "admin", last_login: "2024-01-15" },
    { id: 2, name: "Grace", role: "user", last_login: "2024-01-14" },
    { id: 3, name: "Alan", role: "user", last_login: "2024-01-10" },
    { id: 4, name: "Linus", role: "admin", last_login: "2024-01-13" }
  ]
});

// Parse the response
const data = JSON.parse(rawApiResponse);

// Deep clone to preserve original
const processed = JSON.parse(JSON.stringify(data));

// Transform: get admin names, sorted
const admins = processed.users
  .filter(u => u.role === "admin")
  .map(u => u.name)
  .sort();

console.log("Admin users:", admins);

// Group users by role
const byRole = data.users.reduce((acc, u) => {
  if (!acc[u.role]) acc[u.role] = [];
  acc[u.role].push(u.name);
  return acc;
}, {});

console.log("\\nGrouped by role:");
console.log(JSON.stringify(byRole, null, 2));

// Verify original is unchanged
console.log("\\nOriginal preserved:", 
  data.users.length === 4 ? "‚úÖ Yes" : "‚ùå No");</textarea>
          <div class="playground-output" id="final-play-output">Click Run to see output...</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>üìã Cheat Sheet ‚Äî Keep This!</h3>
      
      <div class="accordion">
        <div class="accordion-item" onclick="toggleAccordion(this)">
          <div class="accordion-header">
            JSON.parse() & JSON.stringify() <span class="arrow">‚ñº</span>
          </div>
          <div class="accordion-body">
            <div class="code-block"><code><span class="fn">JSON</span>.<span class="fn">stringify</span>(value)                 <span class="cmt">// JS ‚Üí JSON string</span>
<span class="fn">JSON</span>.<span class="fn">stringify</span>(value, <span class="null">null</span>, <span class="num">2</span>)         <span class="cmt">// Pretty print</span>
<span class="fn">JSON</span>.<span class="fn">stringify</span>(value, [<span class="str">"key1"</span>])        <span class="cmt">// Only certain keys</span>
<span class="fn">JSON</span>.<span class="fn">stringify</span>(value, replacerFn)      <span class="cmt">// Custom transform</span>
<span class="fn">JSON</span>.<span class="fn">parse</span>(jsonString)                 <span class="cmt">// JSON string ‚Üí JS</span>
<span class="fn">JSON</span>.<span class="fn">parse</span>(jsonString, reviverFn)      <span class="cmt">// With transform</span></code></div>
          </div>
        </div>
        <div class="accordion-item" onclick="toggleAccordion(this)">
          <div class="accordion-header">
            Deep vs Shallow Copy <span class="arrow">‚ñº</span>
          </div>
          <div class="accordion-body">
            <div class="code-block"><code><span class="cmt">// Shallow copies</span>
<span class="kw">const</span> shallow = { ...obj };
<span class="kw">const</span> shallow = <span class="fn">Object</span>.<span class="fn">assign</span>({}, obj);
<span class="kw">const</span> shallow = [...arr];

<span class="cmt">// Deep copies</span>
<span class="kw">const</span> deep = <span class="fn">JSON</span>.<span class="fn">parse</span>(<span class="fn">JSON</span>.<span class="fn">stringify</span>(obj)); <span class="cmt">// JSON-safe only</span>
<span class="kw">const</span> deep = <span class="fn">structuredClone</span>(obj);            <span class="cmt">// Modern, better</span></code></div>
          </div>
        </div>
        <div class="accordion-item" onclick="toggleAccordion(this)">
          <div class="accordion-header">
            Data Transformations <span class="arrow">‚ñº</span>
          </div>
          <div class="accordion-body">
            <div class="code-block"><code>arr.<span class="fn">map</span>(fn)      <span class="cmt">// Transform each item</span>
arr.<span class="fn">filter</span>(fn)   <span class="cmt">// Keep matching items</span>
arr.<span class="fn">reduce</span>(fn,i) <span class="cmt">// Reshape to anything</span>
arr.<span class="fn">find</span>(fn)     <span class="cmt">// First match</span>
arr.<span class="fn">sort</span>(fn)     <span class="cmt">// Sort in place</span>
arr.<span class="fn">flat</span>(n)      <span class="cmt">// Flatten n levels</span>
arr.<span class="fn">flatMap</span>(fn)  <span class="cmt">// map + flat(1)</span>
<span class="fn">Object</span>.<span class="fn">entries</span>(o) <span class="cmt">// ‚Üí [[key, val], ...]</span>
<span class="fn">Object</span>.<span class="fn">fromEntries</span>(arr) <span class="cmt">// [[k,v],...] ‚Üí obj</span></code></div>
          </div>
        </div>
        <div class="accordion-item" onclick="toggleAccordion(this)">
          <div class="accordion-header">
            Safe Patterns <span class="arrow">‚ñº</span>
          </div>
          <div class="accordion-body">
            <div class="code-block"><code><span class="cmt">// Safe JSON parse</span>
<span class="kw">try</span> { <span class="kw">const</span> data = <span class="fn">JSON</span>.<span class="fn">parse</span>(str); }
<span class="kw">catch</span>(e) { <span class="fn">console</span>.<span class="fn">error</span>(<span class="str">"Invalid JSON"</span>); }

<span class="cmt">// Safe nested access</span>
<span class="kw">const</span> val = obj?.deep?.nested?.prop ?? <span class="str">"default"</span>;

<span class="cmt">// Safe API fetch</span>
<span class="kw">const</span> res = <span class="kw">await</span> <span class="fn">fetch</span>(url);
<span class="kw">if</span> (!res.ok) <span class="kw">throw new</span> <span class="fn">Error</span>(res.status);
<span class="kw">const</span> data = <span class="kw">await</span> res.<span class="fn">json</span>();</code></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="section-complete" style="background: linear-gradient(135deg, rgba(0,230,118,0.15), rgba(108,92,231,0.15));">
        <h3 style="font-size:2rem">üéâ Congratulations!</h3>
        <p style="font-size:1.1rem;margin-bottom:20px">You've completed the JSON & Data Serialization course!</p>
        <div style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap;margin-bottom:20px">
          <div class="badge" style="font-size:1rem;padding:8px 16px">üì¶ JSON Basics</div>
          <div class="badge" style="font-size:1rem;padding:8px 16px">üîÑ Parse/Stringify</div>
          <div class="badge" style="font-size:1rem;padding:8px 16px">ü™û Deep/Shallow Copy</div>
          <div class="badge" style="font-size:1rem;padding:8px 16px">üåê API Data</div>
          <div class="badge" style="font-size:1rem;padding:8px 16px">üîß Transformations</div>
        </div>
        <button class="btn btn-next btn-green" onclick="completeSection(5); celebrateFinish()">üèÜ Complete Course!</button>
      </div>
    </div>
  `;
}

// ============================================================
// COMPONENT RENDERERS
// ============================================================

function renderQuiz(id, question, options, explanation) {
  return `
    <div class="quiz" data-quiz-id="${id}">
      <div class="quiz-question">${question.replace(/\n/g, '<br>')}</div>
      <div class="quiz-options">
        ${options.map((opt, i) => `
          <button class="quiz-option" 
                  data-correct="${opt.correct}" 
                  onclick="handleQuiz('${id}', this, ${opt.correct})">
            ${String.fromCharCode(65 + i)}. <code>${escapeHtml(opt.text)}</code>
          </button>
        `).join('')}
      </div>
      <div class="quiz-feedback" id="fb-${id}">${explanation}</div>
    </div>
  `;
}

function renderExercise(id, description, starterCode, solutionCode, validator) {
  window['validator_' + id] = validator;
  window['solution_' + id] = solutionCode;
  return `
    <div class="exercise" data-exercise-id="${id}">
      <h4>üí™ Exercise</h4>
      <h3>${description}</h3>
      <div class="playground">
        <div class="playground-header">
          <h4>üìù Your Solution</h4>
          <div style="display:flex;gap:8px">
            <button class="btn btn-sm btn-orange" onclick="showSolution('${id}')">Show Solution</button>
            <button class="btn btn-sm btn-green" onclick="checkExercise('${id}')">‚úì Check</button>
            <button class="btn btn-sm" onclick="runPlayground('${id}')">‚ñ∂ Run</button>
          </div>
        </div>
        <div class="playground-body">
          <textarea id="${id}-input">${escapeHtml(starterCode)}</textarea>
          <div class="playground-output" id="${id}-output">Run your code or click Check...</div>
        </div>
      </div>
      <div class="exercise-result" id="result-${id}"></div>
    </div>
  `;
}

// ============================================================
// EVENT HANDLERS
// ============================================================

function handleQuiz(id, btn, isCorrect) {
  if (state.answeredQuizzes.has(id)) return;
  state.answeredQuizzes.add(id);

  const quiz = btn.closest('.quiz');
  const options = quiz.querySelectorAll('.quiz-option');
  const feedback = document.getElementById('fb-' + id);

  options.forEach(opt => {
    opt.classList.add('disabled');
    if (opt.dataset.correct === 'true') opt.classList.add('correct');
  });

  if (isCorrect) {
    btn.classList.add('correct');
    feedback.className = 'quiz-feedback show correct';
    feedback.innerHTML = '‚úÖ Correct! ' + feedback.innerHTML;
    addScore(10);
  } else {
    btn.classList.add('wrong');
    feedback.className = 'quiz-feedback show wrong';
    feedback.innerHTML = '‚ùå Not quite. ' + feedback.innerHTML;
  }
}

function runPlayground(id) {
  const input = document.getElementById(id + '-input');
  const output = document.getElementById(id + '-output');
  
  if (!input || !output) return;
  
  const code = input.value;
  const logs = [];
  
  const fakeConsole = {
    log: (...args) => logs.push(args.map(formatValue).join(' ')),
    error: (...args) => logs.push('‚ùå ' + args.map(formatValue).join(' ')),
    warn: (...args) => logs.push('‚ö†Ô∏è ' + args.map(formatValue).join(' ')),
    table: (data) => logs.push(JSON.stringify(data, null, 2)),
    dir: (...args) => logs.push(args.map(a => JSON.stringify(a, null, 2)).join(' '))
  };

  try {
    const fn = new Function('console', code);
    fn(fakeConsole);
    output.innerHTML = `<span class="output-success">${escapeHtml(logs.join('\n')) || '(no output)'}</span>`;
  } catch (e) {
    output.innerHTML = `<span class="output-error">‚ùå Error: ${escapeHtml(e.message)}</span>`;
  }
}

function formatValue(val) {
  if (val === undefined) return 'undefined';
  if (val === null) return 'null';
  if (typeof val === 'object') {
    try { return JSON.stringify(val, null, 2); }
    catch { return String(val); }
  }
  return String(val);
}

function checkExercise(id) {
  const input = document.getElementById(id + '-input');
  const result = document.getElementById('result-' + id);
  const validator = window['validator_' + id];
  
  if (!input || !result || !validator) return;

  const code = input.value;
  const isValid = validator(code);

  if (isValid) {
    result.className = 'exercise-result show pass';
    result.innerHTML = '‚úÖ Great job! Your solution looks correct!';
    if (!state.completedExercises.has(id)) {
      state.completedExercises.add(id);
      addScore(15);
    }
  } else {
    result.className = 'exercise-result show fail';
    result.innerHTML = '‚ùå Not quite right. Make sure you\'re using the required methods. Click "Show Solution" if you\'re stuck.';
  }
  
  runPlayground(id);
}

function showSolution(id) {
  const input = document.getElementById(id + '-input');
  const solution = window['solution_' + id];
  if (input && solution) {
    input.value = solution;
    runPlayground(id);
  }
}

function validateJSON() {
  const input = document.getElementById('jsonInput');
  const output = document.getElementById('jsonOutput');
  
  try {
    const parsed = JSON.parse(input.value);
    const pretty = JSON.stringify(parsed, null, 2);
    const type = Array.isArray(parsed) ? 'Array' : typeof parsed;
    output.innerHTML = `<span class="output-success">‚úÖ Valid JSON! (Type: ${type})\n\nParsed & Pretty-printed:\n${escapeHtml(pretty)}</span>`;
    input.style.borderColor = 'var(--green)';
  } catch (e) {
    output.innerHTML = `<span class="output-error">‚ùå Invalid JSON!\n\n${escapeHtml(e.message)}\n\nüí° Common fixes:\n‚Ä¢ Use double quotes for keys and strings\n‚Ä¢ Remove trailing commas\n‚Ä¢ Check for missing brackets</span>`;
    input.style.borderColor = 'var(--red)';
  }
}

function toggleAccordion(el) {
  el.classList.toggle('open');
}

function celebrateFinish() {
  const colors = ['#6c5ce7', '#00e676', '#18ffff', '#ffd740', '#ff5252', '#a29bfe'];
  for (let i = 0; i < 100; i++) {
    setTimeout(() => {
      const confetti = document.createElement('div');
      confetti.style.cssText = `
        position: fixed;
        top: -10px;
        left: ${Math.random() * 100}%;
        width: ${6 + Math.random() * 8}px;
        height: ${6 + Math.random() * 8}px;
        background: ${colors[Math.floor(Math.random() * colors.length)]};
        border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
        z-index: 10000;
        pointer-events: none;
        animation: confettiFall ${2 + Math.random() * 3}s linear forwards;
      `;
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 5000);
    }, i * 30);
  }

  const style = document.createElement('style');
  style.textContent = `
    @keyframes confettiFall {
      to {
        transform: translateY(110vh) rotate(${360 + Math.random() * 720}deg);
        opacity: 0;
      }
    }
  `;
  document.head.appendChild(style);
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

function attachEventListeners() {
  // textarea tab support
  document.querySelectorAll('.playground textarea').forEach(ta => {
    ta.addEventListener('keydown', function(e) {
      if (e.key === 'Tab') {
        e.preventDefault();
        const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 2;
      }
    });
  });
}

// ============================================================
// INITIALIZE
// ============================================================
renderNav();
renderSection();
updateProgress();
</script>
</body>
</html>