<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript 'this' Keyword Masterclass</title>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --accent: #38bdf8;
            --accent-hover: #0ea5e9;
            --success: #4ade80;
            --warning: #fbbf24;
            --error: #f87171;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Navigation */
        nav {
            background: var(--bg-secondary);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            list-style: none;
        }

        .nav-links button {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .nav-links button:hover, .nav-links button.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
            transform: translateY(-2px);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            color: var(--accent);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card h3 {
            color: var(--warning);
            margin: 1.5rem 0 0.5rem 0;
        }

        /* Visual Diagrams */
        .visual-container {
            background: var(--bg-tertiary);
            border-radius: 0.5rem;
            padding: 2rem;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }

        .this-pointer {
            display: inline-block;
            background: var(--accent);
            color: var(--bg-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: bold;
            font-family: monospace;
            position: relative;
            animation: point 2s infinite;
        }

        @keyframes point {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }

        .context-box {
            border: 2px dashed var(--border);
            padding: 1rem;
            margin: 0.5rem;
            border-radius: 0.5rem;
            background: rgba(56, 189, 248, 0.1);
            transition: all 0.3s;
        }

        .context-box.active {
            border-color: var(--accent);
            background: rgba(56, 189, 248, 0.2);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
        }

        /* Code Blocks */
        .code-block {
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            font-family: 'Consolas', 'Monaco', monospace;
            overflow-x: auto;
            position: relative;
        }

        .code-block .comment { color: #8b949e; font-style: italic; }
        .code-block .keyword { color: #ff7b72; }
        .code-block .function { color: #d2a8ff; }
        .code-block .string { color: #a5d6ff; }
        .code-block .this-keyword { 
            color: #ff7b72; 
            font-weight: bold;
            background: rgba(255, 123, 114, 0.2);
            padding: 0 2px;
            border-radius: 3px;
        }
        .code-block .object { color: #79c0ff; }

        /* Interactive Playground */
        .playground {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            .playground { grid-template-columns: 1fr; }
            .nav-links { flex-wrap: wrap; justify-content: center; }
        }

        .editor {
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: monospace;
            min-height: 200px;
            color: var(--text-primary);
            resize: vertical;
            width: 100%;
            tab-size: 2;
        }

        .output {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: monospace;
            min-height: 200px;
            color: var(--success);
        }

        .output.error { color: var(--error); }

        button.action-btn {
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: bold;
            margin: 0.5rem 0;
            transition: all 0.3s;
        }

        button.action-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.4);
        }

        /* Quiz Styles */
        .quiz-option {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quiz-option:hover {
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(74, 222, 128, 0.2);
        }

        .quiz-option.wrong {
            border-color: var(--error);
            background: rgba(248, 113, 113, 0.2);
        }

        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* Pitfall Cards */
        .pitfall {
            border-left: 4px solid var(--error);
            background: rgba(248, 113, 113, 0.1);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        .pitfall h4 {
            color: var(--error);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .solution {
            border-left: 4px solid var(--success);
            background: rgba(74, 222, 128, 0.1);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--bg-tertiary);
            height: 10px;
            border-radius: 5px;
            margin: 2rem 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--accent), var(--success));
            height: 100%;
            width: 0%;
            transition: width 0.5s;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 2px dotted var(--accent);
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            z-index: 10;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Binding Visualizer */
        .binding-demo {
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .obj-box {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            min-width: 150px;
            transition: all 0.3s;
        }

        .obj-box.highlight {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3);
            transform: scale(1.05);
        }

        .arrow {
            font-size: 2rem;
            color: var(--accent);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo">
                <span>üéØ</span>
                <span>this.Master()</span>
            </div>
            <ul class="nav-links">
                <li><button onclick="showSection('learn')" class="nav-btn active" data-section="learn">üìö Learn</button></li>
                <li><button onclick="showSection('visualize')" class="nav-btn" data-section="visualize">üëÅÔ∏è Visualize</button></li>
                <li><button onclick="showSection('playground')" class="nav-btn" data-section="playground">üî¨ Playground</button></li>
                <li><button onclick="showSection('pitfalls')" class="nav-btn" data-section="pitfalls">‚ö†Ô∏è Pitfalls</button></li>
                <li><button onclick="showSection('quiz')" class="nav-btn" data-section="quiz">üéØ Quiz</button></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- LEARN SECTION -->
        <section id="learn" class="section active">
            <div class="card">
                <h2>üé¨ What is `this`?</h2>
                <p>The <span class="tooltip" data-tip="The context object">this</span> keyword is one of JavaScript's most powerful but confusing features. Think of it as a <strong>special variable</strong> that automatically gets created when a function runs.</p>
                
                <div class="visual-container">
                    <div style="text-align: center; font-size: 1.2rem;">
                        <p>üí° The Golden Rule:</p>
                        <p style="font-size: 1.5rem; color: var(--accent); margin: 1rem 0;">
                            <strong>`this` is determined by HOW a function is called,<br>not WHERE it is defined!</strong>
                        </p>
                    </div>
                </div>

                <h3>The 4 Rules of `this` Binding</h3>
                <p>JavaScript determines what `this` refers to based on four rules, checked in this order:</p>
            </div>

            <!-- Rule 1 -->
            <div class="card">
                <h2>1Ô∏è‚É£ Default Binding</h2>
                <p>When you call a function "plainly" (without any context), <code>this</code> defaults to the global object (window in browsers, global in Node).</p>
                
                <div class="code-block">
<span class="keyword">function</span> <span class="function">showThis</span>() {
    <span class="comment">// In non-strict mode: this = window (browser)</span>
    <span class="comment">// In strict mode: this = undefined</span>
    console.<span class="function">log</span>(<span class="this-keyword">this</span>);
}

<span class="function">showThis</span>(); <span class="comment">// Plain call = Default Binding</span>
                </div>

                <div class="pitfall">
                    <h4>‚ö†Ô∏è Strict Mode Trap</h4>
                    <p>In strict mode (<code>'use strict'</code>), default binding returns <code>undefined</code> instead of the global object. This prevents accidental global pollution!</p>
                </div>
            </div>

            <!-- Rule 2 -->
            <div class="card">
                <h2>2Ô∏è‚É£ Implicit Binding</h2>
                <p>When a function is called as a method of an object (using dot notation), <code>this</code> binds to that object.</p>

                <div class="code-block">
<span class="keyword">const</span> user = {
    name: <span class="string">'Alice'</span>,
    <span class="function">greet</span>() {
        console.<span class="function">log</span>(<span class="string">'Hello, '</span> + <span class="this-keyword">this</span>.name);
    }
};

user.<span class="function">greet</span>(); <span class="comment">// this = user object</span>
<span class="comment">// Output: "Hello, Alice"</span>
                </div>

                <div class="visual-container">
                    <div class="binding-demo">
                        <div class="obj-box highlight">
                            <strong>user</strong><br>
                            <small>object</small>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="obj-box">
                            <strong>greet()</strong><br>
                            <small>method</small>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="obj-box highlight">
                            <strong>this</strong><br>
                            <small>points to user</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rule 3 -->
            <div class="card">
                <h2>3Ô∏è‚É£ Explicit Binding (call, apply, bind)</h2>
                <p>You can force <code>this</code> to be whatever you want using these three methods:</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1rem 0;">
                    <div class="context-box">
                        <h4 style="color: var(--accent); margin-bottom: 0.5rem;">.call(context, arg1, arg2)</h4>
                        <p>Invokes function immediately with specific <code>this</code> and individual arguments.</p>
                    </div>
                    <div class="context-box">
                        <h4 style="color: var(--accent); margin-bottom: 0.5rem;">.apply(context, [args])</h4>
                        <p>Like call, but arguments are passed as an array.</p>
                    </div>
                    <div class="context-box">
                        <h4 style="color: var(--accent); margin-bottom: 0.5rem;">.bind(context)</h4>
                        <p>Returns a new function permanently bound to the context. Doesn't invoke immediately!</p>
                    </div>
                </div>

                <div class="code-block">
<span class="keyword">function</span> <span class="function">introduce</span>(greeting, punctuation) {
    console.<span class="function">log</span>(greeting + <span class="string">', '</span> + <span class="this-keyword">this</span>.name + punctuation);
}

<span class="keyword">const</span> person = { name: <span class="string">'Bob'</span> };

<span class="comment">// call - individual arguments</span>
introduce.<span class="function">call</span>(person, <span class="string">'Hello'</span>, <span class="string">'!'</span>);

<span class="comment">// apply - array of arguments</span>
introduce.<span class="function">apply</span>(person, [<span class="string">'Hi'</span>, <span class="string">'...'</span>]);

<span class="comment">// bind - returns new function</span>
<span class="keyword">const</span> boundIntroduce = introduce.<span class="function">bind</span>(person);
<span class="function">boundIntroduce</span>(<span class="string">'Hey'</span>, <span class="string">'?'</span>);
                </div>
            </div>

            <!-- Rule 4 -->
            <div class="card">
                <h2>4Ô∏è‚É£ New Binding</h2>
                <p>When a function is called with the <code>new</code> keyword, JavaScript creates a new empty object and sets <code>this</code> to that object.</p>

                <div class="code-block">
<span class="keyword">function</span> <span class="function">Person</span>(name) {
    <span class="comment">// this = {} (new empty object)</span>
    <span class="this-keyword">this</span>.name = name;
    <span class="comment">// return this (implicitly)</span>
}

<span class="keyword">const</span> alice = <span class="keyword">new</span> <span class="function">Person</span>(<span class="string">'Alice'</span>);
console.<span class="function">log</span>(alice.name); <span class="comment">// "Alice"</span>
                </div>
            </div>

            <!-- Arrow Functions -->
            <div class="card">
                <h2>üèπ Arrow Functions & Lexical `this`</h2>
                <p>Arrow functions don't have their own <code>this</code>! They <strong>inherit</strong> <code>this</code> from the surrounding (parent) scope where they were defined.</p>

                <div class="code-block">
<span class="keyword">const</span> team = {
    name: <span class="string">'Code Wizards'</span>,
    members: [<span class="string">'Alice'</span>, <span class="string">'Bob'</span>],
    
    <span class="comment">// Regular function - has its own 'this'</span>
    <span class="function">showTeamRegular</span>() {
        console.<span class="function">log</span>(<span class="this-keyword">this</span>.name); <span class="comment">// "Code Wizards"</span>
        
        <span class="this-keyword">this</span>.members.<span class="function">forEach</span>(<span class="keyword">function</span>(member) {
            <span class="comment">// This regular function has its own 'this' (undefined or window)</span>
            console.<span class="function">log</span>(member + <span class="string">' from '</span> + <span class="this-keyword">this</span>.name); <span class="comment">// Error!</span>
        });
    },
    
    <span class="comment">// Arrow function - inherits 'this'</span>
    <span class="function">showTeamArrow</span>() {
        <span class="this-keyword">this</span>.members.<span class="function">forEach</span>((member) => {
            <span class="comment">// Inherits 'this' from showTeamArrow</span>
            console.<span class="function">log</span>(member + <span class="string">' from '</span> + <span class="this-keyword">this</span>.name); <span class="comment">// Works!</span>
        });
    }
};
                </div>

                <div class="solution">
                    <h4>‚úÖ Remember:</h4>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Regular functions: <code>this</code> depends on <strong>how</strong> they're called</li>
                        <li>Arrow functions: <code>this</code> depends on <strong>where</strong> they're defined</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- VISUALIZE SECTION -->
        <section id="visualize" class="section">
            <div class="card">
                <h2>üëÅÔ∏è Interactive Context Visualizer</h2>
                <p>Click the buttons to see how <code>this</code> changes in real-time!</p>
                
                <div class="visual-container" style="min-height: 300px;">
                    <div id="vizContainer" style="text-align: center; padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üéØ</div>
                        <div id="vizContext" class="this-pointer">this = window (global)</div>
                        <div style="margin-top: 2rem; font-size: 1.2rem;" id="vizExplanation">
                            Default binding - function called plainly
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <button class="action-btn" onclick="vizDefault()">Test Default Binding</button>
                    <button class="action-btn" onclick="vizImplicit()">Test Implicit Binding</button>
                    <button class="action-btn" onclick="vizExplicit()">Test Explicit Binding</button>
                    <button class="action-btn" onclick="vizArrow()">Test Arrow Function</button>
                </div>
            </div>

            <div class="card">
                <h2>üé® The "this" Binding Comparison</h2>
                <div class="binding-demo" id="comparisonViz">
                    <div class="obj-box" id="obj1">
                        <strong>Object A</strong><br>
                        <small>{ name: 'Alice' }</small>
                    </div>
                    <div style="text-align: center;">
                        <div class="arrow" id="arrow1">‚Üí</div>
                        <small id="bindType">Implicit</small>
                    </div>
                    <div class="obj-box" id="funcBox">
                        <strong>function()</strong><br>
                        <small>sayName()</small>
                    </div>
                    <div style="text-align: center;">
                        <div class="arrow" id="arrow2">‚Üí</div>
                        <small>this points to</small>
                    </div>
                    <div class="obj-box highlight" id="targetBox">
                        <strong>Object A</strong><br>
                        <small>this.name = "Alice"</small>
                    </div>
                </div>
                <button class="action-btn" onclick="cycleBindingTypes()">Cycle Binding Types</button>
            </div>
        </section>

        <!-- PLAYGROUND SECTION -->
        <section id="playground" class="section">
            <div class="card">
                <h2>üî¨ Binding Laboratory</h2>
                <p>Experiment with different binding methods. Edit the code and run it!</p>
                
                <div class="playground">
                    <div>
                        <h4>Code Editor</h4>
                        <textarea class="editor" id="codeEditor" spellcheck="false">const obj = {
    name: 'Alice',
    age: 30,
    greet: function() {
        return `Hello, I'm ${this.name}`;
    }
};

// Try different ways to call:
console.log("1. Method call:", obj.greet());

const fn = obj.greet;
console.log("2. Direct call:", fn());

const boundFn = obj.greet.bind({ name: 'Bob' });
console.log("3. Bound call:", boundFn());

// Arrow function test
const arrow = () => `Arrow: ${this.name}`;
console.log("4. Arrow:", arrow());</textarea>
                        <button class="action-btn" onclick="runCode()">‚ñ∂ Run Code</button>
                        <button class="action-btn" onclick="resetCode()" style="background: var(--bg-tertiary);">‚Ü∫ Reset</button>
                    </div>
                    <div>
                        <h4>Console Output</h4>
                        <div class="output" id="consoleOutput">// Output will appear here...</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üéØ Fix the Code Exercises</h2>
                <p>These examples have <code>this</code>-related bugs. Fix them!</p>
                
                <div style="margin-top: 1rem;">
                    <h4>Exercise 1: The Callback Problem</h4>
                    <div class="code-block" id="exercise1">
<span class="keyword">const</span> user = {
    name: <span class="string">'Alice'</span>,
    <span class="function">delayGreet</span>() {
        setTimeout(<span class="keyword">function</span>() {
            console.<span class="function">log</span>(<span class="string">'Hello, '</span> + <span class="this-keyword">this</span>.name);
        }, 1000);
    }
};

user.<span class="function">delayGreet</span>(); <span class="comment">// Output: "Hello, undefined" ‚ùå</span>
                    </div>
                    <button class="action-btn" onclick="toggleSolution(1)">Show Solution</button>
                    <div id="solution1" style="display: none; margin-top: 1rem;">
                        <div class="solution">
                            <strong>Fix:</strong> Use an arrow function or bind <code>this</code>:
                            <div class="code-block" style="margin-top: 0.5rem;">
setTimeout(() => {
    console.log('Hello, ' + this.name); // Arrow inherits 'this'
}, 1000);

<span class="comment">// OR</span>

setTimeout(<span class="keyword">function</span>() {
    console.<span class="function">log</span>(<span class="string">'Hello, '</span> + <span class="this-keyword">this</span>.name);
}.<span class="function">bind</span>(<span class="this-keyword">this</span>), 1000);
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- PITFALLS SECTION -->
        <section id="pitfalls" class="section">
            <div class="card">
                <h2>‚ö†Ô∏è Common "this" Pitfalls & How to Avoid Them</h2>
                
                <div class="pitfall">
                    <h4>ü™§ Pitfall 1: Method Extraction</h4>
                    <p>When you store a method in a variable, it loses its context!</p>
                    <div class="code-block">
<span class="keyword">const</span> user = {
    name: <span class="string">'Alice'</span>,
    <span class="function">greet</span>() { console.<span class="function">log</span>(<span class="this-keyword">this</span>.name); }
};

<span class="keyword">const</span> greet = user.greet; <span class="comment">// Method extracted!</span>
<span class="function">greet</span>(); <span class="comment">// undefined (or window.name) - Default binding applied</span>
                    </div>
                    <div class="solution">
                        <strong>Fix:</strong> Use <code>bind()</code> when extracting: <code>const greet = user.greet.bind(user);</code>
                    </div>
                </div>

                <div class="pitfall">
                    <h4>ü™§ Pitfall 2: Callbacks in Event Listeners</h4>
                    <p>In DOM event listeners, <code>this</code> refers to the DOM element, not your object!</p>
                    <div class="code-block">
<span class="keyword">const</span> button = document.<span class="function">querySelector</span>(<span class="string">'button'</span>);
<span class="keyword">const</span> app = {
    name: <span class="string">'MyApp'</span>,
    <span class="function">init</span>() {
        button.<span class="function">addEventListener</span>(<span class="string">'click'</span>, <span class="keyword">function</span>() {
            console.<span class="function">log</span>(<span class="this-keyword">this</span>.name); <span class="comment">// undefined! 'this' is the button element</span>
        });
    }
};
                    </div>
                    <div class="solution">
                        <strong>Fix:</strong> Use arrow functions: <code>addEventListener('click', () => { ... })</code>
                    </div>
                </div>

                <div class="pitfall">
                    <h4>ü™§ Pitfall 3: Nested Functions</h4>
                    <p>Every regular function defines its own <code>this</code> context.</p>
                    <div class="code-block">
<span class="keyword">const</span> obj = {
    name: <span class="string">'Outer'</span>,
    <span class="function">outer</span>() {
        console.<span class="function">log</span>(<span class="this-keyword">this</span>.name); <span class="comment">// "Outer"</span>
        
        <span class="keyword">function</span> <span class="function">inner</span>() {
            console.<span class="function">log</span>(<span class="this-keyword">this</span>.name); <span class="comment">// undefined! New binding context</span>
        }
        <span class="function">inner</span>();
    }
};
                    </div>
                    <div class="solution">
                        <strong>Fix:</strong> Use arrow functions for nested callbacks, or store outer <code>this</code> in a variable: <code>const self = this;</code>
                    </div>
                </div>

                <div class="pitfall">
                    <h4>ü™§ Pitfall 4: Arrow Functions as Methods</h4>
                    <p>Never use arrow functions for object methods if you need access to the object!</p>
                    <div class="code-block">
<span class="keyword">const</span> user = {
    name: <span class="string">'Alice'</span>,
    <span class="comment">// DON'T DO THIS:</span>
    greet: () => {
        console.<span class="function">log</span>(<span class="this-keyword">this</span>.name); <span class="comment">// undefined! Inherits 'this' from outer scope</span>
    }
};
                    </div>
                    <div class="solution">
                        <strong>Rule:</strong> Use regular functions for methods, arrow functions for callbacks/nested functions.
                    </div>
                </div>
            </div>
        </section>

        <!-- QUIZ SECTION -->
        <section id="quiz" class="section">
            <div class="card">
                <h2>üéØ Test Your Knowledge</h2>
                <div id="quizContainer">
                    <!-- Quiz content generated by JS -->
                </div>
                <div id="quizScore" style="display: none; text-align: center; margin-top: 2rem;">
                    <h3 style="color: var(--accent); font-size: 2rem;">Score: <span id="scoreValue">0</span>/5</h3>
                    <button class="action-btn" onclick="resetQuiz()">Retake Quiz</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            // Update progress
            updateProgress(sectionId);
            
            // Initialize specific sections
            if (sectionId === 'quiz') initQuiz();
        }

        function updateProgress(section) {
            const sections = ['learn', 'visualize', 'playground', 'pitfalls', 'quiz'];
            const index = sections.indexOf(section);
            const progress = ((index + 1) / sections.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Visualization Logic
        function vizDefault() {
            function test() { return this; }
            const result = test();
            updateViz('window (global)', 'Default Binding - function called without context', 'üåç');
        }

        function vizImplicit() {
            const obj = { 
                name: 'Alice',
                getThis() { return this; }
            };
            const result = obj.getThis();
            updateViz('obj (Alice)', 'Implicit Binding - method called on object', 'üë§');
        }

        function vizExplicit() {
            function fn() { return this; }
            const boundObj = { name: 'Bob' };
            const result = fn.call(boundObj);
            updateViz('{ name: "Bob" }', 'Explicit Binding - using .call(), .apply(), or .bind()', 'üéØ');
        }

        function vizArrow() {
            const obj = {
                name: 'Parent',
                arrow: () => this
            };
            // In global scope, arrow function this = window
            updateViz('window (lexical)', 'Arrow Function - inherits this from parent scope (window)', 'üèπ');
        }

        function updateViz(context, explanation, emoji) {
            document.getElementById('vizContext').textContent = `this = ${context}`;
            document.getElementById('vizExplanation').textContent = explanation;
            document.querySelector('#vizContainer div').textContent = emoji;
        }

        let bindingIndex = 0;
        const bindingTypes = [
            { name: 'Implicit', desc: 'obj.method() ‚Üí this = obj', target: 'obj1' },
            { name: 'Explicit', desc: 'fn.call(obj) ‚Üí this = obj', target: 'obj1' },
            { name: 'Default', desc: 'fn() ‚Üí this = window', target: 'window' }
        ];

        function cycleBindingTypes() {
            bindingIndex = (bindingIndex + 1) % bindingTypes.length;
            const type = bindingTypes[bindingIndex];
            
            document.getElementById('bindType').textContent = type.name;
            document.getElementById('targetBox').innerHTML = `
                <strong>${type.target === 'window' ? 'Global' : 'Object'}</strong><br>
                <small>${type.desc}</small>
            `;
            
            // Visual feedback
            document.querySelectorAll('.obj-box').forEach(b => b.classList.remove('highlight'));
            if (type.target === 'obj1') {
                document.getElementById('obj1').classList.add('highlight');
                document.getElementById('targetBox').classList.add('highlight');
            }
        }

        // Code Playground
        const defaultCode = document.getElementById('codeEditor').value;

        function runCode() {
            const code = document.getElementById('codeEditor').value;
            const output = document.getElementById('consoleOutput');
            
            // Capture console.log
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => logs.push(args.join(' '));
            
            try {
                // Safe-ish eval for learning purposes
                const fn = new Function(code);
                fn();
                output.textContent = logs.join('\n') || 'Code executed (no output)';
                output.classList.remove('error');
            } catch (err) {
                output.textContent = 'Error: ' + err.message;
                output.classList.add('error');
            } finally {
                console.log = originalLog;
            }
        }

        function resetCode() {
            document.getElementById('codeEditor').value = defaultCode;
            document.getElementById('consoleOutput').textContent = '// Output will appear here...';
            document.getElementById('consoleOutput').classList.remove('error');
        }

        function toggleSolution(id) {
            const el = document.getElementById('solution' + id);
            el.style.display = el.style.display === 'none' ? 'block' : 'none';
        }

        // Quiz Data
        const quizQuestions = [
            {
                question: "What does `this` refer to in a regular function called as `obj.method()`?",
                options: ["The global object", "obj", "undefined", "The function itself"],
                correct: 1,
                explanation: "This is Implicit Binding. When a method is called with dot notation, `this` binds to the object before the dot."
            },
            {
                question: "What is the output of: `const fn = obj.method; fn();` assuming method uses `this`?",
                options: ["The obj properties", "undefined or window", "null", "Error"],
                correct: 1,
                explanation: "When you extract a method, it loses its context. Calling it plainly applies Default Binding."
            },
            {
                question: "How do arrow functions handle `this`?",
                options: ["They create their own `this`", "They inherit `this` from parent scope", "They always refer to window", "They don't have `this`"],
                correct: 1,
                explanation: "Arrow functions use lexical scoping - they inherit `this` from where they were defined, not where they were called."
            },
            {
                question: "Which method creates a NEW function with permanently bound `this`?",
                options: [".call()", ".apply()", ".bind()", "All of the above"],
                correct: 2,
                explanation: ".bind() returns a new function. .call() and .apply() invoke the function immediately."
            },
            {
                question: "In strict mode, what is `this` in a regular standalone function?",
                options: ["window", "undefined", "null", "globalThis"],
                correct: 1,
                explanation: "Strict mode prevents default binding to the global object. `this` becomes undefined."
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let answered = false;

        function initQuiz() {
            currentQuestion = 0;
            score = 0;
            showQuestion();
        }

        function showQuestion() {
            const container = document.getElementById('quizContainer');
            const q = quizQuestions[currentQuestion];
            
            container.innerHTML = `
                <h3 style="margin-bottom: 1rem;">Question ${currentQuestion + 1} of ${quizQuestions.length}</h3>
                <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">${q.question}</p>
                <div id="options">
                    ${q.options.map((opt, i) => `
                        <div class="quiz-option" onclick="selectOption(${i})" data-index="${i}">
                            <span style="font-weight: bold; color: var(--accent);">${String.fromCharCode(65 + i)}.</span>
                            ${opt}
                        </div>
                    `).join('')}
                </div>
                <div id="explanation" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 0.5rem;"></div>
                <button class="action-btn" id="nextBtn" style="display: none; margin-top: 1rem;" onclick="nextQuestion()">Next Question ‚Üí</button>
            `;
            
            document.getElementById('quizScore').style.display = 'none';
            answered = false;
        }

        function selectOption(index) {
            if (answered) return;
            answered = true;
            
            const q = quizQuestions[currentQuestion];
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach((opt, i) => {
                opt.classList.add('disabled');
                if (i === q.correct) {
                    opt.classList.add('correct');
                } else if (i === index && i !== q.correct) {
                    opt.classList.add('wrong');
                }
            });
            
            if (index === q.correct) score++;
            
            document.getElementById('explanation').innerHTML = `
                <strong>${index === q.correct ? '‚úÖ Correct!' : '‚ùå Wrong!'}</strong><br>
                ${q.explanation}
            `;
            document.getElementById('explanation').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < quizQuestions.length) {
                showQuestion();
            } else {
                showFinalScore();
            }
        }

        function showFinalScore() {
            document.getElementById('quizContainer').innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">${score === quizQuestions.length ? 'üèÜ' : score >= 3 ? 'üëç' : 'üí™'}</div>
                    <h3>Quiz Complete!</h3>
                    <p style="margin: 1rem 0; color: var(--text-secondary);">You got ${score} out of ${quizQuestions.length} correct!</p>
                    <p style="font-style: italic; color: var(--accent);">
                        ${score === quizQuestions.length ? 'Perfect! You are a this() master!' : 
                          score >= 3 ? 'Good job! Review the pitfalls section to improve.' : 
                          'Keep practicing! Check the Learn section again.'}
                    </p>
                </div>
            `;
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('quizScore').style.display = 'block';
        }

        function resetQuiz() {
            initQuiz();
        }

        // Initialize
        updateProgress('learn');
    </script>
</body>
</html>