<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Quest: The Debugging Dojo | Master JS Error Handling</title>
    <style>
        :root {
            --bg-dark: #0a0e1a;
            --bg-card: #151b2d;
            --accent-cyan: #00f0ff;
            --accent-pink: #ff006e;
            --accent-green: #0aff60;
            --accent-yellow: #ffbe0b;
            --accent-red: #ff0040;
            --text-primary: #e0e6ed;
            --text-secondary: #8b9bb4;
            --border-glow: rgba(0, 240, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'SF Mono', Monaco, monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated Background Grid */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
        }

        /* Header & Progress */
        header {
            background: rgba(21, 27, 45, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border-glow);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--accent-cyan), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stats-bar {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-cyan);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .progress-container {
            width: 200px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green));
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--accent-cyan);
        }

        /* Navigation */
        nav {
            background: var(--bg-card);
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(0, 240, 255, 0.1);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
        }

        .nav-btn.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Main Content */
        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            margin-bottom: 1rem;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--text-primary), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-cyan), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover::before {
            opacity: 1;
        }

        /* Interactive Code Blocks */
        .code-playground {
            background: #0d1117;
            border-radius: 12px;
            border: 1px solid #30363d;
            overflow: hidden;
            margin: 1rem 0;
        }

        .code-header {
            background: #161b22;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #30363d;
        }

        .code-dots {
            display: flex;
            gap: 0.5rem;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27ca40; }

        textarea.code-editor {
            width: 100%;
            min-height: 200px;
            background: transparent;
            color: #e6edf3;
            border: none;
            padding: 1rem;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 14px;
            resize: vertical;
            outline: none;
            line-height: 1.5;
        }

        .code-output {
            background: #0d1117;
            border-top: 1px solid #30363d;
            padding: 1rem;
            font-family: monospace;
            min-height: 60px;
            color: var(--accent-green);
        }

        .code-output.error {
            color: var(--accent-red);
            border-left: 3px solid var(--accent-red);
        }

        .run-btn {
            background: linear-gradient(135deg, var(--accent-cyan), #0099cc);
            color: #000;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 240, 255, 0.3);
        }

        /* Visual Error Taxonomy */
        .error-zoo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .error-specimen {
            background: linear-gradient(135deg, rgba(255,0,110,0.1), rgba(255,0,64,0.1));
            border: 1px solid var(--accent-pink);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .error-specimen:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255,0,110,0.2);
        }

        .error-specimen h3 {
            color: var(--accent-pink);
            margin-bottom: 0.5rem;
        }

        .error-specimen.syntax { border-color: var(--accent-yellow); background: linear-gradient(135deg, rgba(255,190,11,0.1), rgba(255,150,0,0.1)); }
        .error-specimen.syntax h3 { color: var(--accent-yellow); }
        
        .error-specimen.type { border-color: var(--accent-cyan); background: linear-gradient(135deg, rgba(0,240,255,0.1), rgba(0,153,204,0.1)); }
        .error-specimen.type h3 { color: var(--accent-cyan); }

        .error-specimen.ref { border-color: var(--accent-green); background: linear-gradient(135deg, rgba(10,255,96,0.1), rgba(0,200,100,0.1)); }
        .error-specimen.ref h3 { color: var(--accent-green); }

        /* Stack Visualizer */
        .stack-visualizer {
            background: #0d1117;
            border-radius: 8px;
            padding: 1.5rem;
            font-family: monospace;
            position: relative;
            min-height: 300px;
        }

        .stack-frame {
            background: rgba(0, 240, 255, 0.1);
            border-left: 3px solid var(--accent-cyan);
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            animation: slideIn 0.3s ease-out;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stack-frame:hover {
            background: rgba(0, 240, 255, 0.2);
            transform: translateX(10px);
        }

        .stack-frame.error-frame {
            border-left-color: var(--accent-red);
            background: rgba(255, 0, 64, 0.1);
            animation: shake 0.5s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Quiz Styles */
        .quiz-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .quiz-option {
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quiz-option:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--accent-cyan);
        }

        .quiz-option.correct {
            background: rgba(10, 255, 96, 0.1);
            border-color: var(--accent-green);
        }

        .quiz-option.wrong {
            background: rgba(255, 0, 64, 0.1);
            border-color: var(--accent-red);
            animation: shake 0.5s;
        }

        .quiz-option input {
            display: none;
        }

        /* Pitfall Cards */
        .pitfall {
            background: linear-gradient(135deg, rgba(255,0,64,0.05), rgba(255,0,110,0.05));
            border: 1px solid rgba(255,0,64,0.3);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            position: relative;
        }

        .pitfall::before {
            content: '‚ö†Ô∏è PITFALL';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--bg-card);
            padding: 0 10px;
            color: var(--accent-red);
            font-size: 0.75rem;
            font-weight: bold;
        }

        .pitfall h4 {
            color: var(--accent-red);
            margin-bottom: 0.5rem;
        }

        .solution {
            background: rgba(10, 255, 96, 0.05);
            border-left: 3px solid var(--accent-green);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0 4px 4px 0;
        }

        /* Badge/Achievement */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, rgba(255,190,11,0.2), rgba(255,150,0,0.2));
            border: 1px solid var(--accent-yellow);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--accent-yellow);
            margin: 0.5rem;
        }

        /* Source Map Visual */
        .source-map-viz {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .code-column {
            background: #0d1117;
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.85rem;
            line-height: 1.8;
        }

        .minified {
            color: var(--text-secondary);
            word-break: break-all;
        }

        .original {
            color: var(--accent-cyan);
        }

        .mapping-line {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
            position: relative;
        }

        .mapping-arrow {
            color: var(--accent-pink);
            margin: 0 1rem;
            font-size: 1.5rem;
        }

        /* Debugger Console Mock */
        .console-mock {
            background: #0d1117;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Fira Code', monospace;
            margin: 1rem 0;
        }

        .console-line {
            padding: 0.25rem 0;
            border-left: 2px solid transparent;
            padding-left: 0.5rem;
            margin: 0.25rem 0;
        }

        .console-line.log { border-left-color: var(--accent-cyan); color: #e6edf3; }
        .console-line.warn { border-left-color: var(--accent-yellow); color: var(--accent-yellow); }
        .console-line.error { border-left-color: var(--accent-red); color: var(--accent-red); }
        .console-line.info { border-left-color: var(--accent-green); color: var(--accent-green); }

        /* Challenge Mode */
        .challenge-editor {
            position: relative;
        }

        .bug-indicator {
            position: absolute;
            left: -20px;
            color: var(--accent-red);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--accent-cyan);
            cursor: help;
        }

        .tooltip-content {
            visibility: hidden;
            width: 250px;
            background: var(--bg-card);
            color: var(--text-primary);
            text-align: left;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--accent-cyan);
            font-size: 0.85rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .tooltip:hover .tooltip-content {
            visibility: visible;
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .source-map-viz { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; gap: 1rem; }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>

    <header>
        <div class="header-content">
            <div class="logo">
                <span>üêõ</span>
                <span>Error Quest</span>
            </div>
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value" id="xp-display">0</div>
                    <div class="stat-label">XP Earned</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="level-display">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="progress-container">
                    <div class="progress-fill" id="main-progress"></div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <button class="nav-btn active" onclick="showSection('intro')">üéØ Mission Brief</button>
        <button class="nav-btn" onclick="showSection('taxonomy')">üß¨ Error Zoo</button>
        <button class="nav-btn" onclick="showSection('custom')">üèóÔ∏è Custom Errors</button>
        <button class="nav-btn" onclick="showSection('patterns')">üé≠ Advanced Patterns</button>
        <button class="nav-btn" onclick="showSection('debugging')">üïµÔ∏è Debugging Dojo</button>
        <button class="nav-btn" onclick="showSection('sourcemaps')">üó∫Ô∏è Source Maps</button>
        <button class="nav-btn" onclick="showSection('boundaries')">üõ°Ô∏è Error Boundaries</button>
        <button class="nav-btn" onclick="showSection('challenges')">‚öîÔ∏è Bug Hunt</button>
        <button class="nav-btn" onclick="showSection('pitfalls')">‚ò†Ô∏è Pitfall Museum</button>
    </nav>

    <main>
        <!-- INTRO SECTION -->
        <section id="intro" class="section active">
            <h1>Welcome to The Debugging Dojo</h1>
            <div class="card">
                <p style="font-size: 1.2rem; margin-bottom: 1rem;">
                    Master the art of <span class="tooltip">error handling<span class="tooltip-content">The process of responding to and recovering from error conditions in your program</span></span> and become the developer who never lets a bug reach production.
                </p>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                    Competitive companies don't just want coders‚Äîthey want <strong>problem solvers</strong> who understand the runtime intimately. Ready to level up?
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üéØ</div>
                        <h3>Precise Diagnosis</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Learn to read stack traces like a medical chart</p>
                    </div>
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üõ°Ô∏è</div>
                        <h3>Defensive Coding</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Build unbreakable error boundaries</p>
                    </div>
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö°</div>
                        <h3>Async Mastery</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">Tame the chaos of asynchronous errors</p>
                    </div>
                </div>

                <div style="margin-top: 2rem; text-align: center;">
                    <button class="run-btn" onclick="showSection('taxonomy')" style="font-size: 1.1rem; padding: 1rem 2rem;">
                        Start Training ‚Üí
                    </button>
                </div>
            </div>
        </section>

        <!-- ERROR TAXONOMY -->
        <section id="taxonomy" class="section">
            <h1>üß¨ The Error Zoo</h1>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                Know your enemy. Click each specimen to see it in action and learn how to capture it.
            </p>

            <div class="error-zoo">
                <div class="error-specimen syntax" onclick="demonstrateError('syntax')">
                    <h3>SyntaxError</h3>
                    <p>The parser caught you writing invalid JavaScript grammar.</p>
                    <code style="display: block; margin-top: 1rem; padding: 0.5rem; background: rgba(0,0,0,0.3); border-radius: 4px;">
                        JSON.parse("{invalid}")
                    </code>
                    <small style="color: var(--accent-yellow);">üí° Caught at parse time</small>
                </div>

                <div class="error-specimen ref" onclick="demonstrateError('reference')">
                    <h3>ReferenceError</h3>
                    <p>You tried to access a variable that doesn't exist in scope.</p>
                    <code style="display: block; margin-top: 1rem; padding: 0.5rem; background: rgba(0,0,0,0.3); border-radius: 4px;">
                        console.log(undefinedVar)
                    </code>
                    <small style="color: var(--accent-green);">üí° Temporal Dead Zone culprit</small>
                </div>

                <div class="error-specimen type" onclick="demonstrateError('type')">
                    <h3>TypeError</h3>
                    <p>Operation cannot be performed on that type. The most common runtime error.</p>
                    <code style="display: block; margin-top: 1rem; padding: 0.5rem; background: rgba(0,0,0,0.3); border-radius: 4px;">
                        null.toString()
                    </code>
                    <small style="color: var(--accent-cyan);">üí° Check your nulls!</small>
                </div>

                <div class="error-specimen" onclick="demonstrateError('range')">
                    <h3>RangeError</h3>
                    <p>Numeric value outside allowable range.</p>
                    <code style="display: block; margin-top: 1rem; padding: 0.5rem; background: rgba(0,0,0,0.3); border-radius: 4px;">
                        new Array(2**32)
                    </code>
                    <small style="color: var(--accent-pink);">üí° Stack overflow too!</small>
                </div>
            </div>

            <div class="card" style="margin-top: 2rem;">
                <h3>üß™ Live Experimentation Lab</h3>
                <div class="code-playground">
                    <div class="code-header">
                        <div class="code-dots">
                            <div class="dot dot-red"></div>
                            <div class="dot dot-yellow"></div>
                            <div class="dot dot-green"></div>
                        </div>
                        <button class="run-btn" onclick="runTaxonomyCode()">‚ñ∂ Run Code</button>
                    </div>
                    <textarea class="code-editor" id="taxonomy-code" spellcheck="false">// Try generating different errors!
// Uncomment one line at a time to see what happens:

// 1. ReferenceError
// console.log(nonExistentVariable);

// 2. TypeError
// const obj = null;
// obj.method();

// 3. RangeError  
// Array(-1);

// 4. SyntaxError (won't even run!)
// eval("if (true) {");

// Safe code:
console.log("All systems nominal");</textarea>
                    <div class="code-output" id="taxonomy-output">Ready to experiment...</div>
                </div>
            </div>
        </section>

        <!-- CUSTOM ERRORS -->
        <section id="custom" class="section">
            <h1>üèóÔ∏è Architecting Custom Errors</h1>
            
            <div class="card">
                <h3>Why Custom Errors?</h3>
                <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                    <li>Semantic meaning: <code>DatabaseConnectionError</code> vs generic <code>Error</code></li>
                    <li>Additional context: HTTP status codes, error codes, user-facing messages</li>
                    <li>Type checking: <code>err instanceof ValidationError</code></li>
                    <li>Stack trace preservation</li>
                </ul>
            </div>

            <div class="card">
                <h3>The Professional Pattern (ES2022+)</h3>
                <div class="code-playground">
                    <div class="code-header">
                        <span style="color: var(--text-secondary);">Modern Error Class Hierarchy</span>
                        <button class="run-btn" onclick="runCustomErrorDemo()">‚ñ∂ Execute</button>
                    </div>
                    <textarea class="code-editor" id="custom-error-code" spellcheck="false">// Base Application Error
class AppError extends Error {
  constructor(message, code, statusCode) {
    super(message);
    this.name = this.constructor.name;
    this.code = code;
    this.statusCode = statusCode;
    this.timestamp = new Date().toISOString();
    
    // Maintains proper stack trace for where error was thrown
    Error.captureStackTrace(this, this.constructor);
  }
  
  toJSON() {
    return {
      error: this.name,
      message: this.message,
      code: this.code,
      statusCode: this.statusCode,
      timestamp: this.timestamp
    };
  }
}

// Specific Error Types
class ValidationError extends AppError {
  constructor(field, message) {
    super(`Validation failed for ${field}: ${message}`, 'VAL_001', 400);
    this.field = field;
  }
}

class DatabaseError extends AppError {
  constructor(operation, originalError) {
    super(`DB ${operation} failed`, 'DB_001', 500);
    // Error chaining (ES2022) - preserves original error
    this.cause = originalError;
  }
}

// Usage Demo
try {
  throw new ValidationError('email', 'Invalid format');
} catch (err) {
  console.log('Caught:', err.name);
  console.log('Details:', err.toJSON());
}</textarea>
                    <div class="code-output" id="custom-error-output"></div>
                </div>
            </div>

            <div class="card">
                <h3>üéØ Exercise: Build Your Own</h3>
                <p>Create an <code>AuthenticationError</code> that:</p>
                <ol style="margin: 1rem 0 1rem 2rem; color: var(--text-secondary);">
                    <li>Extends AppError</li>
                    <li>Accepts <code>username</code> and <code>reason</code></li>
                    <li>Has code 'AUTH_001' and status 401</li>
                    <li>Includes a <code>logSecurityEvent()</code> method</li>
                </ol>
                <button class="run-btn" onclick="checkCustomExercise()">Verify Solution</button>
                <div id="custom-exercise-feedback" style="margin-top: 1rem;"></div>
            </div>
        </section>

        <!-- ADVANCED PATTERNS -->
        <section id="patterns" class="section">
            <h1>üé≠ Advanced Error Patterns</h1>

            <div class="card">
                <h3>Async Error Handling Matrix</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    The #1 mistake in JS interviews: mishandling async errors. Master these patterns:
                </p>
                
                <div class="code-playground">
                    <div class="code-header">
                        <span style="color: var(--text-secondary);">Pattern Comparison</span>
                        <button class="run-btn" onclick="runAsyncPatterns()">‚ñ∂ Run All Patterns</button>
                    </div>
                    <textarea class="code-editor" id="async-code" spellcheck="false">// PATTERN 1: The Async/Await Trap
async function badPattern() {
  try {
    // This WON'T catch the error!
    setTimeout(() => { throw new Error('Oops'); }, 0);
  } catch (e) {
    console.log('Caught:', e.message);
  }
}

// PATTERN 2: Proper Async Handling
async function goodPattern() {
  try {
    await Promise.reject(new Error('Handled correctly'));
  } catch (e) {
    console.log('‚úì Caught:', e.message);
  }
}

// PATTERN 3: Unhandled Rejection (Node.js vs Browser)
process?.on('unhandledRejection', (err) => {
  console.log('Last resort:', err.message);
});

// PATTERN 4: AggregateError (ES2021)
async function multiplePromises() {
  try {
    await Promise.any([
      Promise.reject(new Error('API 1 down')),
      Promise.reject(new Error('API 2 down'))
    ]);
  } catch (err) {
    if (err instanceof AggregateError) {
      console.log('Multiple failures:', err.errors.length);
    }
  }
}

// Run demonstrations
badPattern().then(() => 
  setTimeout(() => console.log('---'), 100)
);
setTimeout(goodPattern, 200);
setTimeout(multiplePromises, 400);</textarea>
                    <div class="code-output" id="async-output"></div>
                </div>
            </div>

            <div class="card">
                <h3>üîÑ The Retry Pattern with Exponential Backoff</h3>
                <p>Production-grade resilience pattern:</p>
                <div class="code-playground">
                    <textarea class="code-editor" id="retry-code" spellcheck="false">async function fetchWithRetry(url, options = {}, maxRetries = 3) {
  let lastError;
  
  for (let i = 0; i <= maxRetries; i++) {
    try {
      const response = await fetch(url, options);
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      return response;
    } catch (error) {
      lastError = error;
      
      if (i === maxRetries) {
        throw new Error(`Failed after ${maxRetries} attempts: ${error.message}`);
      }
      
      // Exponential backoff: 1s, 2s, 4s
      const delay = Math.pow(2, i) * 1000;
      console.log(`Attempt ${i + 1} failed, retrying in ${delay}ms...`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
}</textarea>
                </div>
            </div>
        </section>

        <!-- DEBUGGING -->
        <section id="debugging" class="section">
            <h1>üïµÔ∏è The Debugging Dojo</h1>

            <div class="card">
                <h3>Visualizing the Call Stack</h3>
                <p>Understanding execution context is crucial. Click functions to see the stack build:</p>
                
                <div class="stack-visualizer" id="stack-viz">
                    <button class="run-btn" onclick="simulateStack()" style="margin-bottom: 1rem;">‚ñ∂ Simulate Function Calls</button>
                    <div id="stack-container"></div>
                </div>
            </div>

            <div class="card">
                <h3>Console Mastery (The Debugger's Toolkit)</h3>
                <div class="console-mock">
                    <div class="console-line log">
                        <span style="color: var(--accent-cyan);">console.</span><span style="color: var(--accent-yellow);">table</span>(data) 
                        <span style="color: var(--text-secondary);">// Pretty print arrays/objects</span>
                    </div>
                    <div class="console-line warn">
                        <span style="color: var(--accent-cyan);">console.</span><span style="color: var(--accent-yellow);">group</span>(<span style="color: var(--accent-green);">'API Calls'</span>) 
                        <span style="color: var(--text-secondary);">// Collapsible sections</span>
                    </div>
                    <div class="console-line error">
                        <span style="color: var(--accent-cyan);">console.</span><span style="color: var(--accent-yellow);">trace</span>() 
                        <span style="color: var(--text-secondary);">// Print stack trace without throwing</span>
                    </div>
                    <div class="console-line info">
                        <span style="color: var(--accent-cyan);">console.</span><span style="color: var(--accent-yellow);">time</span>(<span style="color: var(--accent-green);">'operation'</span>) 
                        <span style="color: var(--text-secondary);">// Performance timing</span>
                    </div>
                    <div class="console-line log">
                        <span style="color: var(--accent-cyan);">console.</span><span style="color: var(--accent-yellow);">assert</span>(condition, msg) 
                        <span style="color: var(--text-secondary);">// Conditional logging</span>
                    </div>
                </div>
                
                <div class="code-playground" style="margin-top: 1rem;">
                    <div class="code-header">
                        <span>Try Advanced Console Methods</span>
                        <button class="run-btn" onclick="runConsoleDemo()">‚ñ∂ Execute</button>
                    </div>
                    <textarea class="code-editor" id="console-code" spellcheck="false">const users = [
  { name: 'Alice', role: 'admin', lastLogin: '2024-01-15' },
  { name: 'Bob', role: 'user', lastLogin: '2024-01-20' }
];

// Instead of console.log:
console.table(users);

// Conditional debugging:
console.assert(users.length > 5, 'Expected more users!');

// Styled output (great for error severity):
console.log('%c Critical Error ', 
  'background: #ff0040; color: white; font-size: 20px; padding: 5px;'
);

// Stack trace without crashing:
function deepFunction() { console.trace('Where am I called from?'); }
function middleFunction() { deepFunction(); }
middleFunction();</textarea>
                    <div class="code-output" id="console-output"></div>
                </div>
            </div>

            <div class="card">
                <h3>Breakpoint Strategies</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        <h4 style="color: var(--accent-cyan);">debugger;</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">
                            The programmatic breakpoint. Use when you need to stop execution at an exact state, especially in conditional blocks.
                        </p>
                    </div>
                    <div style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        <h4 style="color: var(--accent-cyan);">Conditional Breakpoints</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">
                            Right-click line number in DevTools ‚Üí "Add conditional breakpoint". 
                            Example: <code>items.length > 100 && user === null</code>
                        </p>
                    </div>
                    <div style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        <h4 style="color: var(--accent-cyan);">Logpoints</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">
                            Right-click ‚Üí "Add logpoint". Log values without modifying code. Invaluable for production debugging.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SOURCE MAPS -->
        <section id="sourcemaps" class="section">
            <h1>üó∫Ô∏è Source Maps Deep Dive</h1>
            
            <div class="card">
                <h3>Why Source Maps Matter</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    When you minify/bundle code, line numbers change. Source maps bridge the gap between production errors and your source code.
                </p>

                <div class="source-map-viz">
                    <div>
                        <h4 style="color: var(--accent-red); margin-bottom: 1rem;">Production (Minified)</h4>
                        <div class="code-column minified">
                            <div style="color: var(--accent-red);">Error at line 1, col 427</div>
                            <div style="margin-top: 1rem;">
                                function(a,b){return a+b}function calcTax(n){return n*0.2}...
                            </div>
                        </div>
                        <div style="text-align: center; margin: 1rem 0;">
                            <span style="color: var(--text-secondary);">‚Üê Impossible to debug</span>
                        </div>
                    </div>

                    <div>
                        <h4 style="color: var(--accent-green); margin-bottom: 1rem;">Source Map Applied</h4>
                        <div class="code-column original">
                            <div style="color: var(--accent-green);">Error at utils.js:42</div>
                            <div style="margin-top: 1rem; color: var(--text-primary);">
                                function calculateTotal(price, tax) {<br>
                                &nbsp;&nbsp;return price + (price * tax);<br>
                                }
                            </div>
                        </div>
                        <div style="text-align: center; margin: 1rem 0;">
                            <span style="color: var(--text-secondary);">‚Üê Original context preserved</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>VLQ Encoding Visualization</h3>
                <p>Source maps use Variable Length Quantity encoding to keep files small. Here's how mappings work:</p>
                
                <div style="background: #0d1117; padding: 1.5rem; border-radius: 8px; margin-top: 1rem; font-family: monospace;">
                    <div style="color: var(--text-secondary); margin-bottom: 1rem;">// mappings: "AAAA,SAAS,CAAC;AAEV,SAAS,IAAI"</div>
                    
                    <div class="mapping-line">
                        <div style="flex: 1; padding: 0.5rem; background: rgba(255,0,0,0.1); border-radius: 4px;">
                            Generated Column 0
                        </div>
                        <div class="mapping-arrow">‚Üí</div>
                        <div style="flex: 1; padding: 0.5rem; background: rgba(0,255,0,0.1); border-radius: 4px;">
                            Source File 0, Line 1, Col 0
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,190,11,0.1); border-radius: 4px; border-left: 3px solid var(--accent-yellow);">
                        <strong>Pro Tip:</strong> In Node.js, use <code>--enable-source-maps</code> flag to automatically apply source maps to stack traces.
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Implementing Source Map Support</h3>
                <div class="code-playground">
                    <textarea class="code-editor" spellcheck="false">// Node.js with source map support (v12.12.0+)
node --enable-source-maps index.js

// Or programmatically:
const sourceMapSupport = require('source-map-support');
sourceMapSupport.install({
  environment: 'node',
  handleUncaughtExceptions: true,
  hookRequire: true  // Hook into require() for on-the-fly mapping
});

// Webpack configuration for production debugging:
module.exports = {
  devtool: 'source-map',  // Full separate file
  // OR
  devtool: 'eval-source-map', // Faster, for development
  // OR  
  devtool: 'hidden-source-map', // For error reporting services (Sentry)
};</textarea>
                </div>
            </div>
        </section>

        <!-- ERROR BOUNDARIES -->
        <section id="boundaries" class="section">
            <h1>üõ°Ô∏è Error Boundaries (Vanilla JS Implementation)</h1>
            
            <div class="card">
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    React made Error Boundaries famous, but you can implement similar fault isolation in vanilla JS to prevent total app crashes.
                </p>

                <div class="code-playground">
                    <div class="code-header">
                        <span>The Error Boundary Pattern</span>
                        <button class="run-btn" onclick="runBoundaryDemo()">‚ñ∂ Test Resilience</button>
                    </div>
                    <textarea class="code-editor" id="boundary-code" spellcheck="false">class ErrorBoundary {
  constructor(options = {}) {
    this.fallback = options.fallback || this.defaultFallback;
    this.onError = options.onError || console.error;
    this.recoveryAttempts = options.recoveryAttempts || 3;
  }

  defaultFallback(error, context) {
    return `<div style="color: red; padding: 20px;">
      üí• Component Error: ${error.message}
    </div>`;
  }

  wrap(fn, context = 'anonymous') {
    const boundary = this;
    
    return function(...args) {
      try {
        const result = fn.apply(this, args);
        
        // Handle async functions
        if (result && typeof result.then === 'function') {
          return result.catch(err => boundary.handleError(err, context));
        }
        
        return result;
      } catch (err) {
        return boundary.handleError(err, context);
      }
    };
  }

  handleError(error, context) {
    this.onError(error, context);
    
    // Telemetry/reporting
    this.reportError(error, context);
    
    // Return fallback UI/state
    return this.fallback(error, context);
  }

  reportError(error, context) {
    // Send to monitoring service (Sentry, LogRocket, etc.)
    console.log(`[ErrorBoundary] ${context}:`, error);
  }
}

// Usage Example:
const boundary = new ErrorBoundary({
  fallback: (err) => ({ error: true, message: err.message }),
  onError: (err, ctx) => console.warn(`Crash in ${ctx}:`, err)
});

// Protect unstable components
const safeFunction = boundary.wrap(() => {
  throw new Error('Critical failure!');
}, 'PaymentComponent');

console.log(safeFunction());</textarea>
                    <div class="code-output" id="boundary-output"></div>
                </div>
            </div>

            <div class="card">
                <h3>Global Error Handlers</h3>
                <div class="code-playground">
                    <textarea class="code-editor" spellcheck="false">// The last line of defense

// 1. Synchronous errors
window.onerror = function(message, source, lineno, colno, error) {
  console.log('Global catch:', { message, source, lineno });
  // Prevent default browser handling?
  return true; // Yes, handled
};

// 2. Unhandled Promise rejections
window.addEventListener('unhandledrejection', event => {
  console.warn('Unhandled Promise:', event.reason);
  event.preventDefault(); // Prevent console error
});

// 3. Resource loading errors (images, scripts)
window.addEventListener('error', event => {
  if (event.target !== window) {
    console.log('Resource failed:', event.target.src);
  }
}, true); // Capture phase!

// 4. React-like error boundary for async
window.addEventListener('error', (e) => {
  // Check if error originated in specific component
  if (e.error?.componentName) {
    // Trigger component-specific recovery
  }
});</textarea>
                </div>
            </div>
        </section>

        <!-- CHALLENGES -->
        <section id="challenges" class="section">
            <h1>‚öîÔ∏è Bug Hunt Arena</h1>
            
            <div class="card">
                <h3>Challenge 1: The Async Mistake</h3>
                <p>Fix the error handling in this code. There are 2 bugs.</p>
                <div class="challenge-editor">
                    <div class="code-playground">
                        <textarea class="code-editor" id="challenge-1" spellcheck="false">async function getUserData(userId) {
  try {
    const response = await fetch(`/api/users/${userId}`);
    const data = response.json(); // Bug 1
    
    if (!data.active) {
      throw 'User inactive'; // Bug 2
    }
    
    return data;
  } catch (error) {
    console.log('Error:', error);
    return null;
  }
}</textarea>
                        <button class="run-btn" onclick="checkChallenge1()" style="margin: 1rem;">Submit Fix</button>
                        <div id="challenge-1-feedback"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>Challenge 2: The Silent Failure</h3>
                <p>This code is swallowing errors. Make it fail loudly and informatively.</p>
                <div class="code-playground">
                    <textarea class="code-editor" id="challenge-2" spellcheck="false">function processPayment(order) {
  try {
    validateOrder(order);
    chargeCustomer(order.total);
    updateInventory(order.items);
    sendConfirmation();
  } catch (e) {
    return false;
  }
}</textarea>
                    <button class="run-btn" onclick="checkChallenge2()" style="margin: 1rem;">Submit Fix</button>
                    <div id="challenge-2-feedback"></div>
                </div>
            </div>

            <div class="card">
                <h3>Challenge 3: Custom Error Implementation</h3>
                <p>Complete the ValidationError class following best practices:</p>
                <div class="code-playground">
                    <textarea class="code-editor" id="challenge-3" spellcheck="false">// TODO: Complete this class
class ValidationError extends Error {
  constructor(field, value, constraint) {
    // Your code here
    
    // Requirements:
    // 1. Message format: "Field 'email' (value: 'abc') violates constraint: 'must contain @'"
    // 2. Add properties: field, value, constraint
    // 3. Maintain proper stack trace
    // 4. instanceof should work correctly
  }
}

// Test:
const err = new ValidationError('email', 'abc', 'must contain @');
console.log(err.message);
console.log(err instanceof ValidationError); // should be true
console.log(err instanceof Error); // should be true</textarea>
                    <button class="run-btn" onclick="checkChallenge3()" style="margin: 1rem;">Run Tests</button>
                    <div id="challenge-3-feedback"></div>
                </div>
            </div>
        </section>

        <!-- PITFALLS -->
        <section id="pitfalls" class="section">
            <h1>‚ò†Ô∏è The Museum of Mistakes</h1>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                Learn from the scars of others. These are production disasters waiting to happen.
            </p>

            <div class="pitfall">
                <h4>1. Throwing Strings, Not Errors</h4>
                <div class="code-playground">
                    <div style="padding: 1rem; background: rgba(255,0,0,0.1);">
                        <code>throw "Something went wrong"; // ‚ùå Loses stack trace!</code>
                    </div>
                </div>
                <div class="solution">
                    <strong>‚úÖ Always throw Error objects:</strong><br>
                    <code>throw new Error("Something went wrong");</code><br>
                    <small>Preserves stack trace, supports .message, .stack, instanceof checks</small>
                </div>
            </div>

            <div class="pitfall">
                <h4>2. The Empty Catch Block (Error Swallowing)</h4>
                <div class="code-playground">
                    <div style="padding: 1rem; background: rgba(255,0,0,0.1);">
<pre>try {
  criticalOperation();
} catch (e) {
  // TODO: handle error
}</pre>
                    </div>
                </div>
                <div class="solution">
                    <strong>‚úÖ At minimum, log it:</strong><br>
                    <code>console.error("Critical operation failed:", e);</code><br>
                    <small>Even better: Send to monitoring service, re-throw if unrecoverable, or return Result type</small>
                </div>
            </div>

            <div class="pitfall">
                <h4>3. Breaking the Promise Chain</h4>
                <div class="code-playground">
                    <div style="padding: 1rem; background: rgba(255,0,0,0.1);">
<pre>// Fire and forget - error goes to unhandledRejection
async function saveData() {
  database.save(data); // Missing await!
}</pre>
                    </div>
                </div>
                <div class="solution">
                    <strong>‚úÖ Always await or return promises:</strong><br>
                    <code>await database.save(data);</code><br>
                    <small>If you must fire-and-forget, attach catch: <code>db.save().catch(handleError)</code></small>
                </div>
            </div>

            <div class="pitfall">
                <h4>4. instanceof in Different Realms</h4>
                <div class="code-playground">
                    <div style="padding: 1rem; background: rgba(255,0,0,0.1);">
<pre>// iframe or vm module context
try {
  iframe.contentWindow.runCode();
} catch (e) {
  // Might be false even if it's an Error!
  if (e instanceof Error) { ... }
}</pre>
                    </div>
                </div>
                <div class="solution">
                    <strong>‚úÖ Use duck typing for cross-realm:</strong><br>
                    <code>if (e && typeof e.message === 'string') { ... }</code><br>
                    <small>Or check constructor name: <code>e.constructor.name === 'Error'</code></small>
                </div>
            </div>

            <div class="card" style="margin-top: 2rem; border-color: var(--accent-green);">
                <h3 style="color: var(--accent-green);">üèÜ Final Boss: The Perfect Error Handler</h3>
                <p>Combine everything you've learned:</p>
                <div class="code-playground">
                    <textarea class="code-editor" spellcheck="false">class ResilientApp {
  constructor() {
    this.boundary = new ErrorBoundary({
      fallback: this.renderErrorUI.bind(this),
      onError: this.telemetry.bind(this)
    });
    
    this.setupGlobalHandlers();
  }

  async executeCriticalPath(operations) {
    const results = [];
    
    for (const [name, op] of operations) {
      try {
        const result = await this.boundary.wrap(op, name)();
        results.push({ status: 'fulfilled', value: result });
      } catch (error) {
        results.push({ status: 'rejected', reason: error });
        
        // Don't break the chain, but log severity
        if (error instanceof FatalError) throw error;
      }
    }
    
    return results;
  }

  setupGlobalHandlers() {
    window.addEventListener('error', (e) => {
      this.telemetry(e.error, { type: 'global', fatal: true });
      this.gracefulDegradation();
    });
    
    window.addEventListener('unhandledrejection', (e) => {
      e.preventDefault();
      this.telemetry(e.reason, { type: 'unhandledPromise' });
    });
  }
}</textarea>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Game State
        const state = {
            xp: 0,
            level: 1,
            completedSections: [],
            challengesSolved: 0
        };

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            if (!state.completedSections.includes(sectionId)) {
                state.completedSections.push(sectionId);
                addXP(50);
                updateProgress();
            }
        }

        function addXP(amount) {
            state.xp += amount;
            document.getElementById('xp-display').textContent = state.xp;
            
            // Level up every 500 XP
            const newLevel = Math.floor(state.xp / 500) + 1;
            if (newLevel > state.level) {
                state.level = newLevel;
                document.getElementById('level-display').textContent = state.level;
                alert(`üéâ Level Up! You're now level ${state.level}`);
            }
        }

        function updateProgress() {
            const totalSections = 8;
            const progress = (state.completedSections.length / totalSections) * 100;
            document.getElementById('main-progress').style.width = `${progress}%`;
        }

        // Error Taxonomy Demo
        function demonstrateError(type) {
            const examples = {
                syntax: () => { try { JSON.parse('{bad}'); } catch(e) { return e; } },
                reference: () => { try { console.log(x); } catch(e) { return e; } },
                type: () => { try { null.method(); } catch(e) { return e; } },
                range: () => { try { Array(-1); } catch(e) { return e; } }
            };
            
            try {
                const err = examples[type]();
                document.getElementById('taxonomy-code').value = `// Generated ${err.name}:\n${err.stack}`;
                addXP(25);
            } catch(e) {
                console.error(e);
            }
        }

        function runTaxonomyCode() {
            const code = document.getElementById('taxonomy-code').value;
            const output = document.getElementById('taxonomy-output');
            
            output.className = 'code-output';
            output.innerHTML = '';
            
            // Override console.log for this execution
            const originalLog = console.log;
            const logs = [];
            console.log = (...args) => logs.push(args.join(' '));
            
            try {
                eval(code);
                output.innerHTML = logs.join('\n') || 'Executed successfully (no output)';
                output.classList.add('success');
                addXP(10);
            } catch (err) {
                output.innerHTML = `‚ùå ${err.name}: ${err.message}\n\nStack:\n${err.stack}`;
                output.classList.add('error');
                addXP(5); // Learning from mistakes!
            } finally {
                console.log = originalLog;
            }
        }

        // Custom Error Demo
        function runCustomErrorDemo() {
            const output = document.getElementById('custom-error-output');
            
            class AppError extends Error {
                constructor(message, code, statusCode) {
                    super(message);
                    this.name = this.constructor.name;
                    this.code = code;
                    this.statusCode = statusCode;
                    this.timestamp = new Date().toISOString();
                    Error.captureStackTrace(this, this.constructor);
                }
                
                toJSON() {
                    return {
                        error: this.name,
                        message: this.message,
                        code: this.code,
                        statusCode: this.statusCode,
                        timestamp: this.timestamp
                    };
                }
            }

            class ValidationError extends AppError {
                constructor(field, message) {
                    super(`Validation failed for ${field}: ${message}`, 'VAL_001', 400);
                    this.field = field;
                }
            }

            try {
                throw new ValidationError('email', 'Invalid format');
            } catch (err) {
                output.innerHTML = `Caught: ${err.name}\n\nDetails:\n${JSON.stringify(err.toJSON(), null, 2)}`;
                addXP(30);
            }
        }

        // Async Patterns
        function runAsyncPatterns() {
            const output = document.getElementById('async-output');
            let logs = [];
            
            const log = (msg) => {
                logs.push(msg);
                output.innerHTML = logs.join('\n');
            };

            // Pattern 1: The trap (setTimeout throws but can't be caught by surrounding try-catch)
            try {
                setTimeout(() => { 
                    log('‚ùå This error crashes the app! Check console'); 
                    // Actually throwing would crash the script, so we log instead
                }, 0);
            } catch (e) {
                log('This never runs');
            }

            // Pattern 2: Good pattern
            setTimeout(async () => {
                try {
                    await Promise.reject(new Error('Handled correctly'));
                } catch (e) {
                    log('‚úì Caught: ' + e.message);
                }
            }, 100);

            // Pattern 4: Aggregate
            setTimeout(async () => {
                try {
                    await Promise.any([
                        Promise.reject(new Error('API 1 down')),
                        Promise.reject(new Error('API 2 down'))
                    ]);
                } catch (err) {
                    if (err instanceof AggregateError) {
                        log('‚úì Multiple failures: ' + err.errors.length);
                        addXP(20);
                    }
                }
            }, 300);
        }

        // Stack Visualizer
        function simulateStack() {
            const container = document.getElementById('stack-container');
            container.innerHTML = '';
            
            const frames = [
                'global()',
                'main()',
                'processOrder()',
                'validatePayment()',
                'calculateTotal() ‚Üê Error thrown here!'
            ];
            
            frames.forEach((frame, i) => {
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = 'stack-frame';
                    if (i === frames.length - 1) div.classList.add('error-frame');
                    div.textContent = frame;
                    div.style.zIndex = frames.length - i;
                    container.appendChild(div);
                    
                    if (i === frames.length - 1) addXP(15);
                }, i * 600);
            });
        }

        // Console Demo
        function runConsoleDemo() {
            const output = document.getElementById('console-output');
            const logs = [];
            
            // Mock console methods
            const mockConsole = {
                log: (...args) => logs.push(`[LOG] ${args.join(' ')}`),
                table: (data) => logs.push(`[TABLE]\n${JSON.stringify(data, null, 2)}`),
                assert: (cond, msg) => !cond && logs.push(`[ASSERT FAIL] ${msg}`),
                trace: () => logs.push(`[TRACE] console.trace()\n    at deepFunction\n    at middleFunction\n    at global`)
            };

            try {
                const users = [
                    { name: 'Alice', role: 'admin' },
                    { name: 'Bob', role: 'user' }
                ];
                
                mockConsole.table(users);
                mockConsole.assert(users.length > 5, 'Expected more users!');
                mockConsole.log('%c Critical Error ', 'background: #ff0040; color: white;');
                
                output.innerHTML = logs.join('\n');
                addXP(15);
            } catch (e) {
                output.innerHTML = 'Error: ' + e.message;
            }
        }

        // Error Boundary Demo
        function runBoundaryDemo() {
            const output = document.getElementById('boundary-output');
            
            class ErrorBoundary {
                constructor(options = {}) {
                    this.fallback = options.fallback || ((err) => `Error: ${err.message}`);
                    this.onError = options.onError || console.error;
                }

                wrap(fn, context = 'anonymous') {
                    const boundary = this;
                    return function(...args) {
                        try {
                            const result = fn.apply(this, args);
                            if (result && typeof result.then === 'function') {
                                return result.catch(err => boundary.handleError(err, context));
                            }
                            return result;
                        } catch (err) {
                            return boundary.handleError(err, context);
                        }
                    };
                }

                handleError(error, context) {
                    this.onError(`[${context}]`, error);
                    return this.fallback(error, context);
                }
            }

            const boundary = new ErrorBoundary({
                fallback: (err) => ({ error: true, message: err.message, recovered: true }),
                onError: (ctx, err) => console.log(`Logged from ${ctx}`)
            });

            const safeFunction = boundary.wrap(() => {
                throw new Error('Critical failure!');
            }, 'PaymentComponent');

            const result = safeFunction();
            output.innerHTML = `Recovered gracefully:\n${JSON.stringify(result, null, 2)}`;
            addXP(30);
        }

        // Challenges
        function checkChallenge1() {
            const code = document.getElementById('challenge-1').value;
            const feedback = document.getElementById('challenge-1-feedback');
            
            const hasAwait = code.includes('await') && code.includes('response.json()');
            const throwsError = code.includes('throw new') || code.includes('Error(');
            
            if (hasAwait && throwsError) {
                feedback.innerHTML = '<div style="color: var(--accent-green);">‚úÖ Correct! You fixed both bugs: added await for the Promise and threw a proper Error object.</div>';
                addXP(50);
                state.challengesSolved++;
            } else {
                feedback.innerHTML = '<div style="color: var(--accent-red);">‚ùå Not quite. Remember: response.json() returns a Promise, and always throw Error objects, not strings.</div>';
            }
        }

        function checkChallenge2() {
            const code = document.getElementById('challenge-2').value;
            const feedback = document.getElementById('challenge-2-feedback');
            
            if (code.includes('throw') || code.includes('console.error') || code.includes('log')) {
                feedback.innerHTML = '<div style="color: var(--accent-green);">‚úÖ Better! Now the error is visible. In production, you\'d also want to wrap this in a transaction for rollback capability.</div>';
                addXP(50);
            } else {
                feedback.innerHTML = '<div style="color: var(--accent-red);">‚ùå Still swallowing errors! At minimum, log the error before returning false.</div>';
            }
        }

        function checkChallenge3() {
            const code = document.getElementById('challenge-3').value;
            const feedback = document.getElementById('challenge-3-feedback');
            
            try {
                // This is a simplified check - in reality we'd eval in sandbox
                if (code.includes('super(') && code.includes('this.field') && code.includes('Error.captureStackTrace')) {
                    feedback.innerHTML = '<div style="color: var(--accent-green);">‚úÖ Excellent! Proper inheritance, properties attached, and stack trace captured.</div>';
                    addXP(100);
                } else {
                    feedback.innerHTML = '<div style="color: var(--accent-yellow);">‚ö†Ô∏è Getting there. Make sure you call super(), attach properties to this, and capture the stack trace.</div>';
                }
            } catch (e) {
                feedback.innerHTML = '<div style="color: var(--accent-red);">Syntax error in your solution</div>';
            }
        }

        // Initialize
        console.log('%c Error Quest Loaded ', 'background: linear-gradient(45deg, #00f0ff, #ff006e); color: white; font-size: 20px; padding: 10px; border-radius: 5px;');
        console.log('Complete all sections to achieve Error Handling Mastery!');
    </script>
</body>
</html>