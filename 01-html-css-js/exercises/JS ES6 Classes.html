
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassCraft Academy - Master ES6+ Classes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav-bar {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .progress-bar {
            width: 300px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 80px auto 2rem;
            padding: 2rem;
        }

        .module-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
        }

        /* Sidebar */
        .sidebar {
            background: var(--glass);
            border-radius: 16px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 100px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav-item {
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.6;
            border-left: 3px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            opacity: 1;
            border-left-color: var(--primary);
        }

        .nav-item.completed::after {
            content: " ‚úì";
            color: var(--success);
            float: right;
        }

        /* Content Area */
        .content-area {
            background: var(--glass);
            border-radius: 16px;
            padding: 2.5rem;
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 600px;
        }

        .module-header {
            margin-bottom: 2rem;
        }

        .module-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Visual Metaphor Container */
        .visual-stage {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            min-height: 300px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Factory Visualization */
        .factory-floor {
            display: flex;
            align-items: center;
            justify-content: space-around;
            height: 250px;
            position: relative;
        }

        .blueprint {
            width: 120px;
            height: 160px;
            border: 3px dashed var(--primary);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(99, 102, 241, 0.1);
            position: relative;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.2); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.4); }
        }

        .conveyor-belt {
            flex: 1;
            height: 40px;
            background: repeating-linear-gradient(
                90deg,
                #334155,
                #334155 20px,
                #475569 20px,
                #475569 40px
            );
            margin: 0 2rem;
            position: relative;
            border-radius: 4px;
        }

        .conveyor-belt::after {
            content: "‚ñ∂";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--success);
            animation: moveArrow 1s linear infinite;
        }

        @keyframes moveArrow {
            0% { opacity: 0; transform: translateY(-50%) translateX(-10px); }
            100% { opacity: 1; transform: translateY(-50%) translateX(0); }
        }

        .product {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--secondary), #f97316);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transform: scale(0);
            animation: popIn 0.5s forwards;
        }

        @keyframes popIn {
            to { transform: scale(1); }
        }

        /* Code Playground */
        .playground {
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            margin: 2rem 0;
            border: 1px solid #333;
        }

        .playground-header {
            background: #2d2d2d;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }

        .code-input {
            width: 100%;
            min-height: 200px;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: vertical;
            outline: none;
        }

        .output-console {
            background: #000;
            color: #0f0;
            padding: 1rem;
            font-family: monospace;
            min-height: 100px;
            border-top: 1px solid #333;
            white-space: pre-wrap;
        }

        .run-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .run-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        /* Pitfall Cards */
        .pitfall-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .pitfall-card {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            position: relative;
        }

        .pitfall-card::before {
            content: "‚ö†Ô∏è PITFALL";
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--error);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .pitfall-card h4 {
            color: var(--error);
            margin-bottom: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Quiz Section */
        .quiz-container {
            background: rgba(99, 102, 241, 0.05);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .quiz-option {
            background: rgba(255,255,255,0.05);
            border: 2px solid transparent;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }

        .quiz-option.correct {
            background: rgba(34, 197, 94, 0.2);
            border-color: var(--success);
        }

        .quiz-option.wrong {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--error);
        }

        /* Challenge Area */
        .challenge-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .challenge-box h3 {
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .hint-box {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--warning);
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0 8px 8px 0;
            display: none;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 1rem;
        }

        /* Inheritance Tree Visual */
        .inheritance-tree {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
        }

        .tree-node {
            padding: 1rem 2rem;
            background: var(--glass);
            border: 2px solid var(--primary);
            border-radius: 8px;
            position: relative;
            min-width: 200px;
            text-align: center;
        }

        .tree-node.child::before {
            content: "extends";
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--secondary);
            font-size: 0.9rem;
        }

        .tree-node.child::after {
            content: "";
            position: absolute;
            top: -20px;
            left: 50%;
            width: 2px;
            height: 20px;
            background: var(--secondary);
        }

        .static-workshop {
            display: flex;
            gap: 2rem;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .tool-rack {
            background: #334155;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid var(--warning);
        }

        .tool {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--warning);
            color: #000;
            border-radius: 4px;
            margin: 0.25rem;
            font-weight: bold;
        }

        .instance-zone {
            flex: 1;
            min-height: 150px;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            padding: 1rem;
        }

        @media (max-width: 968px) {
            .module-grid {
                grid-template-columns: 1fr;
            }
            .sidebar {
                position: relative;
                top: 0;
            }
            .pitfall-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden { display: none; }
        
        .success-message {
            color: var(--success);
            font-weight: bold;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <div class="logo">‚ö° ClassCraft Academy</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>
    </nav>

    <div class="container">
        <div class="module-grid">
            <aside class="sidebar">
                <div class="nav-item active" onclick="loadModule(0)">1. The Blueprint</div>
                <div class="nav-item" onclick="loadModule(1)">2. The Factory</div>
                <div class="nav-item" onclick="loadModule(2)">3. Instance Methods</div>
                <div class="nav-item" onclick="loadModule(3)">4. Inheritance</div>
                <div class="nav-item" onclick="loadModule(4)">5. Static Power</div>
            </aside>

            <main class="content-area" id="contentArea">
                <!-- Content injected via JS -->
            </main>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    
    <script>
        // Module Data
        const modules = [
            {
                title: "The Blueprint: Class Declaration vs Expression",
                icon: "üìê",
                content: `
                    <div class="module-header">
                        <h1 class="module-title">üìê The Blueprint</h1>
                        <p>Classes in JavaScript are templates for creating objects. Think of them as blueprints in a factory.</p>
                    </div>

                    <div class="visual-stage">
                        <div class="factory-floor">
                            <div style="text-align: center;">
                                <div class="blueprint">
                                    <div style="font-size: 2rem;">üìã</div>
                                    <div style="font-size: 0.8rem; margin-top: 0.5rem;">class Car {...}</div>
                                </div>
                                <p style="margin-top: 1rem; opacity: 0.8;">The Blueprint (Class)</p>
                            </div>
                            <div class="conveyor-belt"></div>
                            <div style="text-align: center;">
                                <div class="product" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
                                    üöó
                                </div>
                                <p style="margin-top: 1rem; opacity: 0.8;">Instance</p>
                            </div>
                        </div>
                    </div>

                    <h3>Two Ways to Define Classes</h3>
                    
                    <div class="playground">
                        <div class="playground-header">
                            <span style="color: #888;">Declaration (Hoisted)</span>
                            <button class="run-btn" onclick="runCode(0)">‚ñ∂ Run</button>
                        </div>
                        <textarea class="code-input" id="code-0">// Class Declaration - The common way
class Vehicle {
    constructor(type) {
        this.type = type;
    }
    
    describe() {
        return \`I am a \${this.type}\`;
    }
}

const car = new Vehicle("car");
console.log(car.describe());
console.log(typeof Vehicle); // "function" - classes are functions!</textarea>
                        <div class="output-console" id="output-0"></div>
                    </div>

                    <div class="playground">
                        <div class="playground-header">
                            <span style="color: #888;">Expression (Anonymous & Named)</span>
                            <button class="run-btn" onclick="runCode(1)">‚ñ∂ Run</button>
                        </div>
                        <textarea class="code-input" id="code-1">// Class Expression - Like function expressions
const Person = class {
    constructor(name) {
        this.name = name;
    }
};

// Named expression (useful for debugging)
const Animal = class LivingBeing {
    constructor(species) {
        this.species = species;
        // LivingBeing.name is available here internally
    }
};

const john = new Person("John");
console.log(john.name);</textarea>
                        <div class="output-console" id="output-1"></div>
                    </div>

                    <div class="pitfall-grid">
                        <div class="pitfall-card">
                            <h4>No Hoisting!</h4>
                            <p>Unlike function declarations, class declarations are NOT hoisted. You must declare before using.</p>
                            <pre style="background: #000; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;"><code>new Car(); // ‚ùå ReferenceError
class Car {} // Declaration comes after</code></pre>
                        </div>
                        <div class="pitfall-card">
                            <h4>Strict Mode Enforced</h4>
                            <p>Class bodies are automatically in strict mode. You cannot accidentally create global variables.</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <h3>üß† Quick Check</h3>
                        <p>What's the main difference between class declarations and function declarations?</p>
                        <div class="quiz-option" onclick="checkAnswer(this, false)">
                            A) Classes can have constructors, functions cannot
                        </div>
                        <div class="quiz-option" onclick="checkAnswer(this, true)">
                            B) Function declarations are hoisted, class declarations are not
                        </div>
                        <div class="quiz-option" onclick="checkAnswer(this, false)">
                            C) Class declarations create objects automatically
                        </div>
                    </div>

                    <div class="challenge-box">
                        <h3>üí™ Challenge: Create a Blueprint</h3>
                        <p>Create a class declaration named <code>Robot</code> with a constructor that accepts <code>name</code> and <code>purpose</code>. Then create an instance.</p>
                        <div class="playground">
                            <textarea class="code-input" id="challenge-0" placeholder="// Your code here...">class Robot {
    // Your constructor here
    
}

// Create an instance
const robo = new Robot("Helper", "cleaning");
console.log(robo);</textarea>
                            <button class="run-btn" onclick="checkChallenge(0)" style="margin: 1rem;">Check Solution</button>
                            <div id="challenge-output-0"></div>
                        </div>
                        <button class="btn-secondary" onclick="toggleHint(0)">üí° Need a hint?</button>
                        <div class="hint-box" id="hint-0">
                            constructor(name, purpose) {<br>
                            &nbsp;&nbsp;this.name = name;<br>
                            &nbsp;&nbsp;this.purpose = purpose;<br>
                            }
                        </div>
                    </div>
                `
            },
            {
                title: "The Factory: Constructor & Instances",
                icon: "üè≠",
                content: `
                    <div class="module-header">
                        <h1 class="module-title">üè≠ The Factory</h1>
                        <p>The constructor method is a special method that creates and initializes object instances.</p>
                    </div>

                    <div class="visual-stage">
                        <div style="padding: 2rem; text-align: center;">
                            <div style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem;">
                                <div style="text-align: left; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                                    <div style="color: var(--primary); font-weight: bold;">Constructor Inputs:</div>
                                    <div style="font-family: monospace; margin-top: 0.5rem;">
                                        name: "Tesla"<br>
                                        year: 2024<br>
                                        color: "Red"
                                    </div>
                                </div>
                                <div style="font-size: 3rem; display: flex; align-items: center;">‚ûî</div>
                                <div style="text-align: left; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                                    <div style="color: var(--secondary); font-weight: bold;">Instance Created:</div>
                                    <div style="font-family: monospace; margin-top: 0.5rem;">
                                        {<br>
                                        &nbsp;&nbsp;name: "Tesla",<br>
                                        &nbsp;&nbsp;year: 2024,<br>
                                        &nbsp;&nbsp;color: "Red"<br>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>The Constructor Method</h3>
                    <p>Every time you use <code>new</code>, JavaScript:</p>
                    <ol style="margin: 1rem 0; padding-left: 2rem; line-height: 2;">
                        <li>Creates a new empty object</li>
                        <li>Sets <code>this</code> to that object</li>
                        <li>Executes the constructor code</li>
                        <li>Returns <code>this</code> (unless you return your own object)</li>
                    </ol>

                    <div class="playground">
                        <div class="playground-header">
                            <span style="color: #888;">Constructor Patterns</span>
                            <button class="run-btn" onclick="runCode(2)">‚ñ∂ Run</button>
                        </div>
                        <textarea class="code-input" id="code-2">class User {
    constructor(username, age) {
        // Instance properties
        this.username = username;
        this.age = age;
        this.createdAt = new Date();
        
        // You can add methods too (but don't! Use prototype instead)
        this.logAccess = () => {
            console.log("This creates a new function for EVERY instance!");
        };
    }
    
    // This is shared across all instances (better)
    greet() {
        return \`Hi, I'm \${this.username}\`;
    }
}

const user1 = new User("Alice", 25);
const user2 = new User("Bob", 30);

console.log(user1.greet === user2.greet); // true (shared)
console.log(user1.logAccess === user2.logAccess); // false (new function each time!)</textarea>
                        <div class="output-console" id="output-2"></div>
                    </div>

                    <div class="pitfall-grid">
                        <div class="pitfall-card">
                            <h4>Forgetting 'new'</h4>
                            <p>Calling a class without <code>new</code> throws TypeError in ES6+</p>
                            <pre style="background: #000; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;"><code>const u = User("Tom", 20); 
// ‚ùå TypeError: Class constructor 
// User cannot be invoked without 'new'</code></pre>
                        </div>
                        <div class="pitfall-card">
                            <h4>Implicit Return</h4>
                            <p>If you return a non-primitive in constructor, it becomes the instance!</p>
                            <pre style="background: #000; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;"><code>class Trick {
    constructor() {
        return { surprise: "Different object!" };
    }
}
console.log(new Trick()); // {surprise...} not Trick</code></pre>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <h3>üß† Quick Check</h3>
                        <p>What happens if you define a method inside the constructor using arrow function vs outside using method shorthand?</p>
                        <div class="quiz-option" onclick="checkAnswer(this, false)">
                            A) Nothing, they behave exactly the same
                        </div>
                        <div class="quiz-option" onclick="checkAnswer(this, true)">
                            B) Inside constructor creates new function per instance (memory waste)
                        </div>
                        <div class="quiz-option" onclick="checkAnswer(this, false)">
                            C) Outside method cannot access 'this'
                        </div>
                    </div>

                    <div class="challenge-box">
                        <h3>üí™ Challenge: Bank Account</h3>
                        <p>Create a <code>BankAccount</code> class with constructor that accepts <code>owner</code> and <code>balance</code> (default to 0). Add a method <code>deposit(amount)</code> that adds to balance.</p>
                        <div class="playground">
                            <textarea class="code-input" id="challenge-1">class BankAccount {
    // Constructor here
    
    // deposit method here
    
}

// Test
const account = new BankAccount("Sarah", 100);
account.deposit(50);
console.log(account.balance); // Should be 150</textarea>
                            <button class="run-btn" onclick="checkChallenge(1)" style="margin: 1rem;">Check Solution</button>
                            <div id="challenge-output-1"></div>
                        </div>
                        <button class="btn-secondary" onclick="toggleHint(1)">üí° Hint</button>
                        <div class="hint-box" id="hint-1">
                            constructor(owner, balance = 0) {<br>
                            &nbsp;&nbsp;this.owner = owner;<br>
                            &nbsp;&nbsp;this.balance = balance;<br>
                            }<br><br>
                            deposit(amount) {<br>
                            &nbsp;&nbsp;this.balance += amount;<br>
                            }
                        </div>
                    </div>
                `
            },
            {
                title: "Instance Methods & 'this' Binding",
                icon: "üéØ",
                content: `
                    <div class="module-header">
                        <h1 class="module-title">üéØ Instance Methods</h1>
                        <p>Methods defined in classes are shared across all instances via the prototype chain.</p>
                    </div>

                    <h3>Method Types Comparison</h3>
                    <div class="playground">
                        <div class="playground-header">
                            <span style="color: #888;">Regular vs Arrow Methods</span>
                            <button class="run-btn" onclick="runCode(3)">‚ñ∂ Run</button>
                        </div>
                        <textarea class="code-input" id="code-3">class Button {
    constructor(label) {
        this.label = label;
        this.clickCount = 0;
        
        // Arrow function binds 'this' lexically
        this.handleClickArrow = () => {
            this.clickCount++;
            console.log(\`Arrow: \${this.label} clicked (\${this.clickCount})\`);
        };
    }
    
    // Regular method - 'this' depends on call site
    handleClickRegular() {
        this.clickCount++;
        console.log(\`Regular: \${this.label} clicked (\${this.clickCount})\`);
    }
}

const btn = new Button("Submit");

// Simulate passing as callback (loses context)
setTimeout(btn.handleClickRegular, 100); // ‚ùå NaN or error - 'this' is window/undefined
setTimeout(btn.handleClickArrow, 200);   // ‚úÖ Works! 'this' is preserved</textarea>
                        <div class="output-console" id="output-3"></div>
                    </div>

                    <div class="pitfall-grid">
                        <div class="pitfall-card">
                            <h4>Extracted Method Losing Context</h4>
                            <pre style="background: #000; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;"><code>const dog = new Dog("Rex");
const speak = dog.speak;
speak(); // ‚ùå 'this' is undefined (strict mode)</code></pre>
                            <p>Fix: Use arrow functions in constructor, bind in constructor, or use class fields syntax (arrow properties)</p>
                        </div>
                        <div class="pitfall-card">
                            <h4>Prototype vs Instance</h4>
                            <p>Methods go on prototype (shared). Properties go on instance (unique).</p>
                        </div>
                    </div>

                    <div class="challenge-box">
                        <h3>üí™ Challenge: Fix the Binding</h3>
                        <p>The below code loses context when the method is passed to setTimeout. Fix it using arrow function syntax.</p>
                        <div class="playground">
                            <textarea class="code-input" id="challenge-2">class Counter {
    constructor() {
        this.count = 0;
        // Fix this method so 'this' works when passed as callback
        this.increment = function() {
            this.count++;
            console.log(this.count);
        };
    }
}

const c = new Counter();
setTimeout(c.increment, 100); // Should log 1, not NaN</textarea>
                            <button class="run-btn" onclick="checkChallenge(2)" style="margin: 1rem;">Check</button>
                            <div id="challenge-output-2"></div>
                        </div>
                    </div>
                `
            },
            {
                title: "Inheritance: extends & super",
                icon: "üß¨",
                content: `
                    <div class="module-header">
                        <h1 class="module-title">üß¨ Inheritance</h1>
                        <p>Create specialized classes based on parent classes. The <code>extends</code> keyword sets up the prototype chain.</p>
                    </div>

                    <div class="visual-stage">
                        <div class="inheritance-tree">
                            <div class="tree-node">
                                <strong>Animal</strong><br>
                                <small>eat(), sleep()</small>
                            </div>
                            <div class="tree-node child">
                                <strong>Dog</strong> extends Animal<br>
                                <small>bark()</small>
                            </div>
                            <div class="tree-node child">
                                <strong>Puppy</strong> extends Dog<br>
                                <small>whine()</small>
                            </div>
                        </div>
                    </div>

                    <h3>The super() Call</h3>
                    <ul style="margin: 1rem 0; padding-left: 2rem;">
                        <li>Must call <code>super()</code> before using <code>this</code> in subclass constructor</li>
                        <li><code>super.method()</code> calls parent method</li>
                        <li>If no constructor in child, parent's constructor is used automatically</li>
                    </ul>

                    <div class="playground">
                        <div class="playground-header">
                            <span style="color: #888;">Inheritance Example</span>
                            <button class="run-btn" onclick="runCode(4)">‚ñ∂ Run</button>
                        </div>
                        <textarea class="code-input" id="code-4">class Animal {
    constructor(name) {
        this.name = name;
        this.energy = 100;
    }
    
    eat() {
        this.energy += 10;
        console.log(\`\${this.name} eats. Energy: \${this.energy}\`);
    }
    
    sleep() {
        console.log(\`\${this.name} is sleeping\`);
    }
}

class Dog extends Animal {
    constructor(name, breed) {
        // MUST call super before using 'this'
        super(name); // Calls Animal's constructor
        this.breed = breed;
        this.tricks = [];
    }
    
    bark() {
        console.log("Woof! Woof!");
        this.energy -= 5;
    }
    
    learnTrick(trick) {
        this.tricks.push(trick);
        console.log(\`\${this.name} learned \${trick}!\`);
    }
    
    // Override parent method
    sleep() {
        super.sleep(); // Call parent's version
        console.log("...and dreaming of bones");
    }
}

const rex = new Dog("Rex", "German Shepherd");
rex.eat();    // Inherited from Animal
rex.bark();   // Own method
rex.sleep();  // Overridden method</textarea>
                        <div class="output-console" id="output-4"></div>
                    </div>

                    <div class="pitfall-grid">
                        <div class="pitfall-card">
                            <h4>super() Before this</h4>
                            <pre style="background: #000; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem;"><code>class Cat extends Animal {
    constructor(name) {
        this.lives = 9; // ‚ùå ReferenceError!
        super(name);    // Must be first
    }
}</code></pre>
                        </div>
                        <div class="pitfall-card">
                            <h4>Forgetting extends</h4>
                            <p>If you use <code>super</code> without <code>extends</code>, it's a syntax error.</p>
                        </div>
                    </div>

                    <div class="quiz-container">
                        <h3>üß† Quick Check</h3>
                        <p>In a subclass constructor, when must you call super()?</p>
                        <div class="quiz-option" onclick="checkAnswer(this, false)">
                            A) At the end of the constructor
                        </div>
                        <div class="quiz-option" onclick="checkAnswer(this, true)">
                            B) Before accessing 'this'
                        </div>
                        <div class="quiz-option" onclick="checkAnswer(this, false)">
                            C) Only if the parent has a constructor
                        </div>
                    </div>

                    <div class="challenge-box">
                        <h3>üí™ Challenge: Electric Vehicle</h3>
                        <p>Create a <code>ElectricCar</code> class that extends <code>Car</code> (provided below). Add <code>batteryLevel</code> and override <code>drive()</code> to reduce battery instead of gas.</p>
                        <div class="playground">
                            <textarea class="code-input" id="challenge-3">class Car {
    constructor(model) {
        this.model = model;
        this.gas = 100;
    }
    drive() {
        this.gas -= 10;
        console.log(\`Driving... Gas: \${this.gas}\`);
    }
}

// Your ElectricCar here
class ElectricCar {

}

// Test
const tesla = new ElectricCar("Model 3");
tesla.drive(); // Should reduce battery, not gas
console.log(tesla.batteryLevel); // Should exist</textarea>
                            <button class="run-btn" onclick="checkChallenge(3)" style="margin: 1rem;">Check</button>
                            <div id="challenge-output-3"></div>
                        </div>
                    </div>
                `
            },
            {
                title: "Static Methods & Properties",
                icon: "üõ†Ô∏è",
                content: `
                    <div class="module-header">
                        <h1 class="module-title">üõ†Ô∏è Static Power</h1>
                        <p>Static members belong to the class itself, not instances. Perfect for utility functions or class-wide configuration.</p>
                    </div>

                    <div class="visual-stage">
                        <div class="static-workshop">
                            <div class="tool-rack">
                                <div style="font-weight: bold; margin-bottom: 0.5rem;">Class Toolbox (Static)</div>
                                <span class="tool">validate()</span>
                                <span class="tool">create()</span>
                                <span class="tool">count</span>
                            </div>
                            <div style="font-size: 2rem;">‚Üî</div>
                            <div class="instance-zone" id="instanceZone">
                                <div style="color: rgba(255,255,255,0.5);">Instances can't access static tools directly</div>
                            </div>
                        </div>
                        <button class="run-btn" onclick="spawnInstance()" style="margin-top: 1rem;">Create Instance</button>
                    </div>

                    <div class="playground">
                        <div class="playground-header">
                            <span style="color: #888;">Static Methods & Properties</span>
                            <button class="run-btn" onclick="runCode(5)">‚ñ∂ Run</button>
                        </div>
                        <textarea class="code-input" id="code-5">class DatabaseConnection {
    // Static property (ES2022+)
    static connectionCount = 0;
    static instances = [];
    
    constructor(config) {
        this.id = ++DatabaseConnection.connectionCount;
        this.config = config;
        DatabaseConnection.instances.push(this);
    }
    
    // Instance method
    query(sql) {
        console.log(\`Query #\${this.id}: \${sql}\`);
    }
    
    // Static method - utility function on the class
    static getCount() {
        // 'this' refers to the class itself in static methods
        return this.connectionCount;
    }
    
    static getInstance(id) {
        return this.instances.find(inst => inst.id === id);
    }
    
    // Factory pattern
    static createDefault() {
        return new this({ host: "localhost", port: 5432 });
    }
}

const db1 = new DatabaseConnection({ host: "prod" });
const db2 = DatabaseConnection.createDefault();

console.log("Total connections:", DatabaseConnection.getCount());
// db1.getCount(); // ‚ùå Error: db1.getCount is not a function</textarea>
                        <div class="output-console" id="output-5"></div>
                    </div>

                    <div class="pitfall-grid">
                        <div class="pitfall-card">
                            <h4>Static 'this'</h4>
                            <p>In static methods, <code>this</code> refers to the class, not an instance. But avoid relying on it if subclassing.</p>
                        </div>
                        <div class="pitfall-card">
                            <h4>Instance Access</h4>
                            <p>Instances cannot access static properties directly. Use <code>ClassName.property</code> or pass it in constructor.</p>
                        </div>
                    </div>

                    <div class="challenge-box">
                        <h3>üí™ Final Challenge: Singleton Pattern</h3>
                        <p>Create a <code>Settings</code> class that uses a static method <code>getInstance()</code> to ensure only one instance exists (Singleton pattern).</p>
                        <div class="playground">
                            <textarea class="code-input" id="challenge-4">class Settings {
    // Static property to hold instance
    
    constructor() {
        this.theme = "dark";
    }
    
    static getInstance() {
        // Return existing instance or create new one
    }
}

const s1 = Settings.getInstance();
const s2 = Settings.getInstance();
console.log(s1 === s2); // Should be true (same instance)</textarea>
                            <button class="run-btn" onclick="checkChallenge(4)" style="margin: 1rem;">Check</button>
                            <div id="challenge-output-4"></div>
                        </div>
                    </div>

                    <div style="background: linear-gradient(135deg, var(--success), #16a34a); padding: 2rem; border-radius: 12px; text-align: center; margin-top: 2rem;">
                        <h2>üéâ Congratulations!</h2>
                        <p>You've mastered ES6+ Classes! You now understand prototypes, inheritance, and the power of static members.</p>
                        <button class="run-btn" onclick="location.reload()" style="margin-top: 1rem; background: white; color: var(--success);">Restart Course</button>
                    </div>
                `
            }
        ];

        // State Management
        let currentModule = 0;
        let completedModules = JSON.parse(localStorage.getItem('classCraftProgress') || '[]');

        // Initialization
        function init() {
            loadModule(0);
            updateProgress();
        }

        function loadModule(index) {
            currentModule = index;
            document.getElementById('contentArea').innerHTML = modules[index].content;
            
            // Update sidebar
            document.querySelectorAll('.nav-item').forEach((el, i) => {
                el.classList.remove('active');
                if (i === index) el.classList.add('active');
                if (completedModules.includes(i)) el.classList.add('completed');
            });

            // Re-highlight code
            if (window.Prism) Prism.highlightAll();
        }

        function updateProgress() {
            const progress = (completedModules.length / modules.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function markComplete() {
            if (!completedModules.includes(currentModule)) {
                completedModules.push(currentModule);
                localStorage.setItem('classCraftProgress', JSON.stringify(completedModules));
                updateProgress();
                document.querySelectorAll('.nav-item')[currentModule].classList.add('completed');
            }
        }

        // Code Execution
        function runCode(id) {
            const code = document.getElementById('code-' + id).value;
            const output = document.getElementById('output-' + id);
            
            // Capture console.log
            const originalLog = console.log;
            let logs = [];
            console.log = (...args) => logs.push(args.join(' '));
            
            try {
                // Safe-ish eval for learning purposes
                const fn = new Function(code);
                fn();
                output.innerHTML = logs.join('\n') || 'Code executed successfully (no output)';
                output.style.color = '#0f0';
            } catch (err) {
                output.innerHTML = '‚ùå ' + err.message;
                output.style.color = '#f44';
            } finally {
                console.log = originalLog;
            }
        }

        // Quiz System
        function checkAnswer(el, isCorrect) {
            const parent = el.parentElement;
            parent.querySelectorAll('.quiz-option').forEach(opt => {
                opt.onclick = null;
                opt.style.cursor = 'default';
            });
            
            if (isCorrect) {
                el.classList.add('correct');
                el.innerHTML += ' ‚úÖ';
                markComplete();
            } else {
                el.classList.add('wrong');
                el.innerHTML += ' ‚ùå';
                // Show correct one
                parent.querySelectorAll('.quiz-option').forEach(opt => {
                    if (opt.onclick.toString().includes('true')) {
                        opt.classList.add('correct');
                    }
                });
            }
        }

        // Challenge Validation
        function checkChallenge(id) {
            const code = document.getElementById('challenge-' + id).value;
            const output = document.getElementById('challenge-output-' + id);
            let passed = false;
            let message = '';

            // Capture console
            const originalLog = console.log;
            let logs = [];
            console.log = (...args) => logs.push(args.join(' '));

            try {
                switch(id) {
                    case 0: // Robot class
                        if (code.includes('constructor') && code.includes('this.name') && code.includes('new Robot')) {
                            passed = true;
                            message = '‚úÖ Perfect! You created a working Robot class.';
                        } else {
                            message = '‚ùå Make sure you have a constructor that sets this.name and this.purpose';
                        }
                        break;
                    case 1: // Bank Account
                        if (code.includes('constructor') && code.includes('deposit') && code.includes('this.balance')) {
                            const fn = new Function(code + '; const acc = new BankAccount("Test", 100); acc.deposit(50); return acc.balance;');
                            const result = fn();
                            passed = result === 150;
                            message = passed ? '‚úÖ Correct! Balance is 150.' : '‚ùå Balance should be 150, got ' + result;
                        }
                        break;
                    case 2: // Binding fix
                        if (code.includes('=>') && code.includes('this.count')) {
                            passed = true;
                            message = '‚úÖ Arrow function binds this correctly!';
                        } else {
                            message = '‚ùå Convert the method to an arrow function property';
                        }
                        break;
                    case 3: // ElectricCar
                        if (code.includes('extends Car') && code.includes('super(') && code.includes('batteryLevel')) {
                            passed = true;
                            message = '‚úÖ Excellent inheritance!';
                        } else {
                            message = '‚ùå Make sure to extend Car, call super(), and add batteryLevel';
                        }
                        break;
                    case 4: // Singleton
                        if (code.includes('static') && code.includes('getInstance')) {
                            passed = true;
                            message = '‚úÖ Singleton pattern implemented correctly!';
                        } else {
                            message = '‚ùå Use a static property to store the instance';
                        }
                        break;
                }
            } catch (err) {
                message = '‚ùå Error: ' + err.message;
            } finally {
                console.log = originalLog;
            }

            output.innerHTML = '<div class="' + (passed ? 'success-message' : '') + '" style="margin-top: 0.5rem;">' + message + '</div>';
            if (passed) markComplete();
        }

        function toggleHint(id) {
            const hint = document.getElementById('hint-' + id);
            hint.style.display = hint.style.display === 'none' ? 'block' : 'none';
        }

        // Visual Demo for Static Methods
        function spawnInstance() {
            const zone = document.getElementById('instanceZone');
            const instance = document.createElement('div');
            instance.className = 'product';
            instance.style.width = '60px';
            instance.style.height = '60px';
            instance.style.fontSize = '1.5rem';
            instance.textContent = 'üì¶';
            instance.title = "I can't access static tools!";
            
            if (zone.children[0] && zone.children[0].tagName === 'DIV') {
                zone.innerHTML = '';
            }
            zone.appendChild(instance);
            
            // Animate
            instance.style.animation = 'none';
            setTimeout(() => instance.style.animation = 'popIn 0.5s', 10);
        }

        // Start
        init();
    </script>
</body>
</html>
