<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Dojo: Master JavaScript Security</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #151b3d;
            --bg-tertiary: #1e2746;
            --accent-primary: #00f0ff;
            --accent-secondary: #ff006e;
            --accent-success: #00ff88;
            --accent-warning: #ffbe0b;
            --text-primary: #e0e6ed;
            --text-secondary: #8b92a8;
            --border-color: #2a3352;
            --danger: #ff2e63;
            --safe: #00d9ff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Background Animation */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            pointer-events: none;
        }

        .floating-shapes {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            pointer-events: none;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 20s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-100px) rotate(180deg); }
        }

        /* Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-size: 3rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        /* Navigation */
        nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 40px;
            position: sticky;
            top: 0;
            background: rgba(10, 14, 39, 0.95);
            padding: 20px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
        }

        .nav-btn {
            padding: 12px 24px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .nav-btn:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 240, 255, 0.2);
        }

        .nav-btn.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
            border-color: var(--accent-primary);
        }

        .nav-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--accent-success);
            color: var(--bg-primary);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 2.5rem;
            color: var(--accent-primary);
            margin-bottom: 10px;
        }

        .section-desc {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        }

        .card-title {
            font-size: 1.5rem;
            color: var(--accent-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.8rem;
        }

        /* Interactive Playground */
        .playground {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid var(--border-color);
        }

        .playground-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--danger);
            border-radius: 15px;
            cursor: pointer;
            transition: 0.3s;
        }

        .toggle.safe {
            background: var(--accent-success);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.3s;
        }

        .toggle.safe::after {
            left: 32px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            transition: 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 240, 255, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #ff1a4f;
        }

        .output-box {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            position: relative;
        }

        .output-label {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--bg-secondary);
            padding: 0 10px;
            font-size: 0.8rem;
            color: var(--accent-primary);
        }

        .alert-box {
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-danger {
            background: rgba(255, 46, 99, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .alert-success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--accent-success);
            color: var(--accent-success);
        }

        .alert-warning {
            background: rgba(255, 190, 11, 0.1);
            border: 1px solid var(--accent-warning);
            color: var(--accent-warning);
        }

        /* Code Blocks */
        .code-block {
            background: #0d1117;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
            border-left: 4px solid var(--accent-primary);
            font-family: 'Courier New', monospace;
            position: relative;
        }

        .code-label {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .code-bad {
            border-left-color: var(--danger);
        }

        .code-good {
            border-left-color: var(--accent-success);
        }

        pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-comment {
            color: #8b949e;
        }

        .code-keyword {
            color: #ff7b72;
        }

        .code-string {
            color: #a5d6ff;
        }

        .code-function {
            color: #d2a8ff;
        }

        /* Comparison */
        .compare-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .compare-grid {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 2rem; }
            .section-title { font-size: 1.8rem; }
        }

        /* Quiz */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-question {
            font-size: 1.2rem;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border-left: 4px solid var(--accent-primary);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quiz-option:hover {
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .quiz-option.correct {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--accent-success);
        }

        .quiz-option.wrong {
            background: rgba(255, 46, 99, 0.1);
            border-color: var(--danger);
        }

        .quiz-option input {
            display: none;
        }

        .quiz-feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        /* Visual Demo */
        .visual-demo {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
            padding: 40px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin: 20px 0;
            position: relative;
            min-height: 300px;
        }

        .site-box {
            width: 200px;
            height: 150px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s;
        }

        .site-box.attacker {
            border-color: var(--danger);
            box-shadow: 0 0 20px rgba(255, 46, 99, 0.2);
        }

        .site-box.victim {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
        }

        .site-label {
            position: absolute;
            top: -30px;
            font-weight: bold;
            color: var(--text-secondary);
        }

        .arrow {
            font-size: 2rem;
            color: var(--text-secondary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .packet {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--danger);
            border-radius: 50%;
            display: none;
        }

        .packet.animate {
            display: block;
            animation: sendPacket 2s linear;
        }

        @keyframes sendPacket {
            0% { transform: translateX(-100px); opacity: 1; }
            100% { transform: translateX(100px); opacity: 0; }
        }

        /* Progress */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-tertiary);
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            width: 0%;
            transition: width 0.5s;
        }

        /* Pitfalls */
        .pitfall {
            background: rgba(255, 46, 99, 0.05);
            border: 1px solid rgba(255, 46, 99, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            position: relative;
            padding-left: 50px;
        }

        .pitfall::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
        }

        .pitfall-title {
            color: var(--danger);
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid var(--accent-primary);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--accent-primary);
            margin-top: 10px;
        }

        /* CSP Builder */
        .csp-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .csp-directives {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .csp-directive {
            background: var(--bg-primary);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .csp-preview {
            background: #0d1117;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            border: 1px solid var(--border-color);
        }

        .resource-tag {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background: var(--bg-secondary);
            border-radius: 4px;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }

        .resource-tag.blocked {
            background: rgba(255, 46, 99, 0.2);
            border-color: var(--danger);
            text-decoration: line-through;
        }

        .resource-tag.allowed {
            background: rgba(0, 255, 136, 0.2);
            border-color: var(--accent-success);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .csp-builder {
                grid-template-columns: 1fr;
            }
            .visual-demo {
                flex-direction: column;
            }
            .arrow {
                transform: rotate(90deg);
            }
        }

        /* Typing effect */
        .typing {
            overflow: hidden;
            border-right: 2px solid var(--accent-primary);
            white-space: nowrap;
            animation: typing 3s steps(40, end), blink-caret 0.75s step-end infinite;
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--accent-primary) }
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--accent-primary);
            position: absolute;
            animation: fall linear forwards;
            z-index: 1000;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .score-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid var(--accent-primary);
            font-weight: bold;
            z-index: 99;
            box-shadow: 0 5px 20px rgba(0, 240, 255, 0.2);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="floating-shapes">
        <div class="shape" style="left: 10%; top: 20%; width: 50px; height: 50px; background: var(--accent-primary); border-radius: 50%;"></div>
        <div class="shape" style="left: 80%; top: 60%; width: 80px; height: 80px; background: var(--accent-secondary); clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%); animation-delay: 5s;"></div>
        <div class="shape" style="left: 40%; top: 80%; width: 60px; height: 60px; background: var(--accent-warning); transform: rotate(45deg); animation-delay: 10s;"></div>
    </div>

    <div class="score-display">
        üõ°Ô∏è Security Score: <span id="total-score">0</span>/100
    </div>

    <div class="container">
        <header>
            <h1>üîê Security Dojo</h1>
            <p class="subtitle">Master JavaScript Security & Land That Dream Job</p>
            <div class="progress-bar">
                <div class="progress-fill" id="main-progress"></div>
            </div>
        </header>

     <nav>
  <button class="nav-btn active" type="button" data-section="intro">üéØ Start Here</button>
  <button class="nav-btn" type="button" data-section="xss">‚ò†Ô∏è XSS</button>
  <button class="nav-btn" type="button" data-section="csrf">üé≠ CSRF</button>
  <button class="nav-btn" type="button" data-section="csp">üõ°Ô∏è CSP</button>
  <button class="nav-btn" type="button" data-section="input">üßπ Sanitization</button>
  <button class="nav-btn" type="button" data-section="auth">üîë Authentication</button>
  <button class="nav-btn" type="button" data-section="final">üèÜ Challenge</button>
</nav>

        <!-- INTRO SECTION -->
        <section id="intro" class="section active">
            <div class="section-header">
                <h2 class="section-title">Welcome to the Security Dojo</h2>
                <p class="section-desc">Interactive training for modern web security. Master the skills top companies demand.</p>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üéÆ</span> How This Works</h3>
                <p>Each module contains:</p>
                <ul style="margin: 20px 0; padding-left: 30px; line-height: 2;">
                    <li><strong>Visual Explanations:</strong> See attacks happening in real-time</li>
                    <li><strong>Interactive Labs:</strong> Break things safely, then fix them</li>
                    <li><strong>Code Comparisons:</strong> Vulnerable vs Secure patterns</li>
                    <li><strong>Pitfalls:</strong> Common mistakes that cost developers jobs</li>
                    <li><strong>Quizzes:</strong> Test your knowledge and earn points</li>
                </ul>
                <button class="btn btn-primary" onclick="showSection('xss')">Start Learning ‚Üí</button>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üíº</span> Why This Matters for Jobs</h3>
                <p>Top tech companies (FAANG, startups, fintech) screen for security knowledge. One XSS vulnerability in a coding interview can disqualify you. One secure architecture discussion can land you the offer.</p>
                <div class="badge">üöÄ FAANG Ready</div>
                <div class="badge">üí∞ High Impact</div>
                <div class="badge">üî• In Demand</div>
            </div>
        </section>

        <!-- XSS SECTION -->
        <section id="xss" class="section">
            <div class="section-header">
                <h2 class="section-title">Cross-Site Scripting (XSS)</h2>
                <p class="section-desc">The #1 web vulnerability. Learn to prevent attackers from injecting malicious scripts.</p>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">‚ò†Ô∏è</span> The Vulnerability</h3>
                <p>XSS allows attackers to execute JavaScript in your users' browsers. This can steal cookies, session tokens, or perform actions as the user.</p>
                
                <div class="visual-demo">
                    <div class="site-box attacker">
                        <div class="site-label">Attacker's Server</div>
                        <div style="font-size: 3rem;">üòà</div>
                        <small>Hosts malicious script</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="site-box victim">
                        <div class="site-label">Your App</div>
                        <div style="font-size: 3rem;">üíª</div>
                        <small>Executes script</small>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="site-box" style="border-color: var(--accent-warning);">
                        <div class="site-label">User's Browser</div>
                        <div style="font-size: 3rem;">üò±</div>
                        <small>Data stolen!</small>
                    </div>
                </div>

                <div class="compare-grid">
                    <div class="code-block code-bad">
                        <span class="code-label">Vulnerable</span>
                        <pre><span class="code-comment">// NEVER do this with user input</span>
element.<span class="code-function">innerHTML</span> = userInput;
<span class="code-comment">// or dangerouslySetInnerHTML in React</span></pre>
                    </div>
                    <div class="code-block code-good">
                        <span class="code-label">Secure</span>
                        <pre>element.<span class="code-function">textContent</span> = userInput;
<span class="code-comment">// Or use DOMPurify before innerHTML</span>
element.<span class="code-function">innerHTML</span> = <span class="code-function">DOMPurify.sanitize</span>(userInput);</pre>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üß™</span> Interactive XSS Lab</h3>
                <p>Try injecting a script. Toggle between Vulnerable and Secure modes.</p>
                
                <div class="playground">
                    <div class="playground-header">
                        <span style="color: var(--text-secondary);">Comment System Simulation</span>
                        <div class="mode-toggle">
                            <span id="mode-label" style="color: var(--danger); font-weight: bold;">VULNERABLE</span>
                            <div class="toggle" id="xss-toggle" onclick="toggleXSSMode()"></div>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Enter a comment (try: &lt;img src=x onerror="alert('hacked')"&gt;)</label>
                        <input type="text" id="xss-input" placeholder="<script>alert('xss')</script>">
                    </div>
                    
                    <button class="btn btn-danger" onclick="submitXSS()">Post Comment</button>
                    
                    <div class="output-box">
                        <span class="output-label">Live Preview</span>
                        <div id="xss-output" style="margin-top: 10px;"></div>
                    </div>
                    
                    <div id="xss-alert" class="alert-box">
                        <span style="font-size: 1.5rem;">üö®</span>
                        <div>
                            <strong>XSS Attack Detected!</strong>
                            <p style="margin: 5px 0 0 0; font-size: 0.9rem;">In vulnerable mode, this script would execute and steal user data.</p>
                        </div>
                    </div>
                </div>

                <div class="pitfall">
                    <div class="pitfall-title">The .innerHTML Trap</div>
                    <p>Using innerHTML with user input is the most common XSS vulnerability. Even if you "sanitize" by removing &lt;script&gt; tags, attackers can use event handlers like onerror, onload, or SVG vectors.</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üìù</span> XSS Types & Prevention</h3>
                <div style="display: grid; gap: 15px; margin-top: 15px;">
                    <div style="padding: 15px; background: var(--bg-primary); border-radius: 8px; border-left: 4px solid var(--accent-warning);">
                        <strong>Stored XSS</strong> - Malicious script saved to database (comments, profiles). <em>Mitigation: Sanitize on input AND output.</em>
                    </div>
                    <div style="padding: 15px; background: var(--bg-primary); border-radius: 8px; border-left: 4px solid var(--accent-primary);">
                        <strong>Reflected XSS</strong> - Script in URL parameters. <em>Mitigation: URL encoding, CSP.</em>
                    </div>
                    <div style="padding: 15px; background: var(--bg-primary); border-radius: 8px; border-left: 4px solid var(--accent-secondary);">
                        <strong>DOM-based XSS</strong> - Client-side JavaScript writes user input to DOM. <em>Mitigation: Avoid innerHTML, use textContent.</em>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">‚ùì</span> XSS Quiz</h3>
                <div class="quiz-container" id="xss-quiz">
                    <div class="quiz-question">1. Which method safely inserts user text into the DOM?</div>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q1"> element.innerHTML = userInput
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, true, 'xss')">
                            <input type="radio" name="q1"> element.textContent = userInput
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q1"> document.write(userInput)
                        </label>
                    </div>
                    <div class="quiz-feedback" id="quiz-feedback-xss"></div>
                </div>
            </div>
        </section>

        <!-- CSRF SECTION -->
        <section id="csrf" class="section">
            <div class="section-header">
                <h2 class="section-title">Cross-Site Request Forgery</h2>
                <p class="section-desc">Tricking users into performing unwanted actions. Learn to verify requests.</p>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üé≠</span> The Attack</h3>
                <p>CSRF forces users to execute unwanted actions on a web application where they're authenticated. The attacker doesn't steal data‚Äîthey perform actions (transfer money, change email, delete account).</p>
                
                <div class="visual-demo" style="flex-direction: column;">
                    <div style="display: flex; align-items: center; gap: 40px; flex-wrap: wrap; justify-content: center;">
                        <div class="site-box attacker">
                            <div class="site-label">Evil Site</div>
                            <div style="font-size: 2rem;">üé£</div>
                            <form id="evil-form">
                                <button type="button" class="btn btn-danger" onclick="simulateCSRF()">Click for Prize!</button>
                            </form>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <div class="arrow" style="transform: rotate(0deg);">‚Üí</div>
                            <small style="color: var(--text-secondary); max-width: 200px; text-align: center;">
                                Hidden form submits to bank.com/transfer
                            </small>
                        </div>

                        <div class="site-box victim">
                            <div class="site-label">Bank.com (Logged In)</div>
                            <div style="font-size: 2rem;">üè¶</div>
                            <div id="csrf-result" style="margin-top: 10px; font-size: 0.9rem; color: var(--accent-success);"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: var(--bg-primary); border-radius: 8px; width: 100%; max-width: 600px;">
                        <strong>Without CSRF Token:</strong> The request goes through because the browser automatically sends cookies.<br><br>
                        <strong>With CSRF Token:</strong> Evil site cannot guess the random token, so request is rejected.
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üõ°Ô∏è</span> CSRF Protection Strategies</h3>
                
                <div class="compare-grid">
                    <div>
                        <h4 style="color: var(--accent-success); margin-bottom: 10px;">‚úì Synchronizer Token Pattern</h4>
                        <div class="code-block">
                            <pre><span class="code-comment">// Server generates unique token per session</span>
&lt;form action="/transfer" method="POST"&gt;
  &lt;input type="hidden" name="csrf_token" value="<span class="code-string">random-uuid-123</span>"&gt;
  &lt;button&gt;Transfer&lt;/button&gt;
&lt;/form&gt;

<span class="code-comment">// Server validates token matches session</span></pre>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--accent-success); margin-bottom: 10px;">‚úì SameSite Cookies</h4>
                        <div class="code-block">
                            <pre><span class="code-comment">// Set cookie header</span>
Set-Cookie: session=abc123; <span class="code-keyword">SameSite=Strict</span>;

<span class="code-comment">// Or for cross-site subrequests:</span>
Set-Cookie: session=abc123; <span class="code-keyword">SameSite=Lax</span>;</pre>
                        </div>
                    </div>
                </div>

                <div class="pitfall">
                    <div class="pitfall-title">GET Requests for Actions</div>
                    <p>Never use GET requests for state-changing operations. A simple &lt;img src="https://yoursite.com/delete-account "&gt; on a forum can trigger actions if the user is logged in.</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">‚ùì</span> CSRF Quiz</h3>
                <div class="quiz-container">
                    <div class="quiz-question">2. Which cookie attribute prevents CSRF by restricting cross-origin requests?</div>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q2"> HttpOnly
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, true, 'csrf')">
                            <input type="radio" name="q2"> SameSite
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q2"> Secure
                        </label>
                    </div>
                    <div class="quiz-feedback" id="quiz-feedback-csrf"></div>
                </div>
            </div>
        </section>

        <!-- CSP SECTION -->
        <section id="csp" class="section">
            <div class="section-header">
                <h2 class="section-title">Content Security Policy</h2>
                <p class="section-desc">Your last line of defense. Define approved sources of content.</p>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üèóÔ∏è</span> Interactive CSP Builder</h3>
                <p>Configure your CSP header and see what gets blocked:</p>
                
                <div class="csp-builder">
                    <div class="csp-directives">
                        <div class="csp-directive">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="csp-default" checked onchange="updateCSP()"> 
                                default-src 'self'
                            </label>
                        </div>
                        <div class="csp-directive">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="csp-script" onchange="updateCSP()"> 
                                script-src 'unsafe-inline'
                            </label>
                            <small style="color: var(--danger);">‚ö†Ô∏è Avoid in production</small>
                        </div>
                        <div class="csp-directive">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="csp-script-https" checked onchange="updateCSP()"> 
                                script-src https:
                            </label>
                        </div>
                        <div class="csp-directive">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="csp-style" onchange="updateCSP()"> 
                                style-src 'unsafe-inline'
                            </label>
                        </div>
                    </div>
                    
                    <div class="csp-preview">
                        <div style="color: var(--text-secondary); margin-bottom: 10px;">Generated Header:</div>
                        <div id="csp-header" style="color: var(--accent-primary); word-break: break-all;">
                            Content-Security-Policy: default-src 'self';
                        </div>
                        
                        <div style="margin-top: 20px; color: var(--text-secondary);">Resource Loading:</div>
                        <div id="csp-resources" style="margin-top: 10px;">
                            <span class="resource-tag allowed">&lt;script src="app.js"&gt;</span>
                            <span class="resource-tag blocked">&lt;script&gt;alert(1)&lt;/script&gt;</span>
                            <span class="resource-tag blocked">&lt;img src="http://evil.com "&gt;</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üéØ</span> CSP Strategies</h3>
                <div class="code-block">
                    <span class="code-label">Strict Policy</span>
                    <pre><span class="code-comment">// Lockdown mode - allows only same-origin</span>
Content-Security-Policy: 
  default-src 'self';
  script-src 'self' https://trusted-cdn.com ;
  style-src 'self' 'unsafe-inline'; <span class="code-comment">// inline styles often needed</span>
  img-src 'self' data: https:;
  connect-src 'self' https://api.yoursite.com ;
  frame-ancestors 'none'; <span class="code-comment">// Prevent clickjacking</span>
  base-uri 'self';
  form-action 'self';</pre>
                </div>
                
                <div class="pitfall">
                    <div class="pitfall-title">unsafe-inline and unsafe-eval</div>
                    <p>Using 'unsafe-inline' for scripts negates most XSS protection. If you must use inline scripts, use nonces (nonce-random123) or hashes (sha256-abc...).</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">‚ùì</span> CSP Quiz</h3>
                <div class="quiz-container">
                    <div class="quiz-question">3. What does 'default-src self' mean in a CSP header?</div>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="checkAnswer(this, true, 'csp')">
                            <input type="radio" name="q3"> Only load resources from same origin
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q3"> Allow all resources but log violations
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q3"> Allow self-signed certificates
                        </label>
                    </div>
                    <div class="quiz-feedback" id="quiz-feedback-csp"></div>
                </div>
            </div>
        </section>

        <!-- INPUT SANITIZATION SECTION -->
        <section id="input" class="section">
            <div class="section-header">
                <h2 class="section-title">Input Sanitization</h2>
                <p class="section-desc">Never trust user input. Validate, sanitize, escape.</p>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üßπ</span> Validation vs Sanitization</h3>
                <div class="compare-grid">
                    <div style="padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                        <h4 style="color: var(--accent-primary); margin-bottom: 10px;">Validation</h4>
                        <p>Check if input meets criteria (type, length, format). <strong>Reject</strong> if invalid.</p>
                        <div class="code-block" style="margin-top: 10px;">
                            <pre><span class="code-comment">// Whitelist approach</span>
<span class="code-keyword">const</span> emailRegex = <span class="code-string">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>;
<span class="code-keyword">if</span> (!emailRegex.<span class="code-function">test</span>(input)) {
  <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-function">Error</span>(<span class="code-string">'Invalid email'</span>);
}</pre>
                        </div>
                    </div>
                    <div style="padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                        <h4 style="color: var(--accent-secondary); margin-bottom: 10px;">Sanitization</h4>
                        <p>Clean input to remove dangerous characters. <strong>Modify</strong> to make safe.</p>
                        <div class="code-block" style="margin-top: 10px;">
                            <pre><span class="code-comment">// Escape HTML entities</span>
<span class="code-keyword">function</span> <span class="code-function">escapeHtml</span>(text) {
  <span class="code-keyword">return</span> text
    .<span class="code-function">replace</span>(<span class="code-string">/&/g</span>, <span class="code-string">"&amp;"</span>)
    .<span class="code-function">replace</span>(<span class="code-string">/</span>, <span class="code-string">"&lt;"</span>)
    .<span class="code-function">replace</span>(<span class="code-string">/>/g</span>, <span class="code-string">"&gt;"</span>);
}</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üî¨</span> Regex Tester</h3>
                <p>Test whitelist validation patterns:</p>
                
                <div class="playground">
                    <div class="input-group">
                        <label>Input String</label>
                        <input type="text" id="regex-input" placeholder="Try: <script>alert(1)</script> or john@example.com">
                    </div>
                    
                    <div class="input-group">
                        <label>Validation Pattern (Whitelist)</label>
                        <select id="regex-pattern" onchange="testRegex()">
                            <option value="alphanumeric">Alphanumeric only: /^[a-zA-Z0-9]+$/</option>
                            <option value="email">Email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/</option>
                            <option value="username">Safe Username: /^[a-zA-Z0-9_]{3,16}$/</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" onclick="testRegex()">Test Validation</button>
                    
                    <div id="regex-result" class="alert-box" style="margin-top: 15px;">
                        <span id="regex-icon" style="font-size: 1.5rem;"></span>
                        <span id="regex-message"></span>
                    </div>
                </div>

                <div class="pitfall">
                    <div class="pitfall-title">Blacklist Approach</div>
                    <p>Trying to remove "bad" characters (like stripping &lt;script&gt;) is dangerous. Attackers use encoding, case variations (&lt;ScRiPt&gt;), or alternative tags (SVG, IMG) to bypass filters. Always use <strong>whitelist</strong> validation (accept only known good patterns).</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">‚ùì</span> Sanitization Quiz</h3>
                <div class="quiz-container">
                    <div class="quiz-question">4. Which approach is more secure for input validation?</div>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q4"> Blacklist (remove <script> tags)
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, true, 'input')">
                            <input type="radio" name="q4"> Whitelist (only allow a-z, 0-9)
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q4"> Client-side JavaScript validation only
                        </label>
                    </div>
                    <div class="quiz-feedback" id="quiz-feedback-input"></div>
                </div>
            </div>
        </section>

        <!-- AUTHENTICATION SECTION -->
        <section id="auth" class="section">
            <div class="section-header">
                <h2 class="section-title">Secure Authentication</h2>
                <p class="section-desc">Protecting sessions and credentials. The keys to the kingdom.</p>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üç™</span> Token Storage: The Great Debate</h3>
                <div class="visual-demo">
                    <div style="text-align: center; max-width: 300px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">üíÄ</div>
                        <h4 style="color: var(--danger);">localStorage</h4>
                        <ul style="text-align: left; color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                            <li>Accessible via JavaScript</li>
                            <li>Vulnerable to XSS theft</li>
                            <li>Sent automatically to all origins (if fetched)</li>
                        </ul>
                        <div class="code-block code-bad" style="margin-top: 10px;">
                            <pre>localStorage.<span class="code-function">setItem</span>(<span class="code-string">'jwt'</span>, token);</pre>
                        </div>
                    </div>

                    <div style="font-size: 2rem; color: var(--accent-warning);">VS</div>

                    <div style="text-align: center; max-width: 300px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">üõ°Ô∏è</div>
                        <h4 style="color: var(--accent-success);">HttpOnly Cookies</h4>
                        <ul style="text-align: left; color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                            <li>Not accessible via JavaScript</li>
                            <li>Immune to XSS theft</li>
                            <li>SameSite protection available</li>
                        </ul>
                        <div class="code-block code-good" style="margin-top: 10px;">
                            <pre>Set-Cookie: token=xyz; <span class="code-keyword">HttpOnly</span>; <span class="code-keyword">Secure</span>; <span class="code-keyword">SameSite=Strict</span></pre>
                        </div>
                    </div>
                </div>

                <div class="pitfall">
                    <div class="pitfall-title">Storing JWT in localStorage</div>
                    <p>While convenient, any XSS vulnerability instantly compromises your tokens. With HttpOnly cookies, even if XSS occurs, the attacker cannot exfiltrate the session token (though they can still perform actions via the compromised browser).</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üîê</span> Password Security</h3>
                <div class="compare-grid">
                    <div>
                        <h4 style="color: var(--danger); margin-bottom: 10px;">Never Do This</h4>
                        <div class="code-block code-bad">
                            <pre><span class="code-comment">// Storing plain text</span>
db.<span class="code-function">query</span>(<span class="code-string">"INSERT INTO users (password) VALUES (?)"</span>, [password]);

<span class="code-comment">// Client-side hashing only</span>
<span class="code-keyword">const</span> hash = <span class="code-function">md5</span>(password); <span class="code-comment">// Weak!</span></pre>
                        </div>
                    </div>
                    <div>
                        <h4 style="color: var(--accent-success); margin-bottom: 10px;">Best Practice</h4>
                        <div class="code-block code-good">
                            <pre><span class="code-comment">// Server-side bcrypt/Argon2</span>
<span class="code-keyword">const</span> hash = <span class="code-keyword">await</span> bcrypt.<span class="code-function">hash</span>(password, 12);
<span class="code-comment">// Verify</span>
<span class="code-keyword">const</span> valid = <span class="code-keyword">await</span> bcrypt.<span class="code-function">compare</span>(input, hash);</pre>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 20px; background: var(--bg-primary); border-radius: 8px;">
                    <strong>Password Requirements:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px; color: var(--text-secondary);">
                        <li>Minimum 12 characters (NIST guidelines)</li>
                        <li>Check against breached databases (Have I Been Pwned API)</li>
                        <li>No complexity requirements (they reduce entropy)</li>
                        <li>Rate limiting on login attempts</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">‚ùì</span> Authentication Quiz</h3>
                <div class="quiz-container">
                    <div class="quiz-question">5. Why are HttpOnly cookies more secure than localStorage for session tokens?</div>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="checkAnswer(this, true, 'auth')">
                            <input type="radio" name="q5"> They cannot be accessed by JavaScript (XSS protection)
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q5"> They are encrypted automatically by the browser
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q5"> They expire faster than localStorage
                        </label>
                    </div>
                    <div class="quiz-feedback" id="quiz-feedback-auth"></div>
                </div>
            </div>
        </section>

        <!-- FINAL CHALLENGE -->
        <section id="final" class="section">
            <div class="section-header">
                <h2 class="section-title">üèÜ Final Challenge</h2>
                <p class="section-desc">Apply everything you've learned. Fix the vulnerable application.</p>
            </div>

            <div class="card">
                <h3 class="card-title"><span class="card-icon">üêõ</span> The Bug Bounty</h3>
                <p>Below is a vulnerable code snippet from a "production" app. Identify all 5 security issues and select the fixes:</p>
                
                <div class="code-block" style="margin: 20px 0;">
                    <pre><span class="code-comment">// Vulnerable Social Media App</span>
<span class="code-keyword">const</span> express = <span class="code-function">require</span>(<span class="code-string">'express'</span>);
<span class="code-keyword">const</span> app = <span class="code-function">express</span>();

<span class="code-comment">// Issue 1: Missing CSP</span>
app.<span class="code-function">get</span>(<span class="code-string">'/'</span>, (req, res) => {
    <span class="code-keyword">const</span> username = req.query.name; <span class="code-comment">// Issue 2: No validation</span>
    res.<span class="code-function">send</span>(<span class="code-string">`&lt;h1&gt;Welcome ${username}!&lt;/h1&gt;`</span>); <span class="code-comment">// Issue 3: XSS</span>
});

<span class="code-comment">// Issue 4: No CSRF protection</span>
app.<span class="code-function">post</span>(<span class="code-string">'/transfer'</span>, (req, res) => {
    <span class="code-keyword">const</span> amount = req.body.amount;
    <span class="code-comment">// Process transfer...</span>
});

<span class="code-comment">// Issue 5: Insecure cookie</span>
res.<span class="code-function">cookie</span>(<span class="code-string">'session'</span>, token, { maxAge: 900000 });</pre>
                </div>

                <div id="challenge-container">
                    <div class="quiz-question">Select all fixes needed:</div>
                    <div class="quiz-options" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <label class="quiz-option" onclick="toggleChallenge(this)">
                            <input type="checkbox" data-fix="csp"> Add Content-Security-Policy header
                        </label>
                        <label class="quiz-option" onclick="toggleChallenge(this)">
                            <input type="checkbox" data-fix="escape"> Escape username with html-entities
                        </label>
                        <label class="quiz-option" onclick="toggleChallenge(this)">
                            <input type="checkbox" data-fix="validation"> Validate username length and characters
                        </label>
                        <label class="quiz-option" onclick="toggleChallenge(this)">
                            <input type="checkbox" data-fix="csrf"> Implement CSRF tokens for POST endpoints
                        </label>
                        <label class="quiz-option" onclick="toggleChallenge(this)">
                            <input type="checkbox" data-fix="cookie"> Set HttpOnly, Secure, SameSite on cookies
                        </label>
                        <label class="quiz-option" onclick="toggleChallenge(this)">
                            <input type="checkbox" data-fix="cors"> Enable CORS for all origins
                        </label>
                    </div>
                    
                    <button class="btn btn-primary" style="margin-top: 20px; width: 100%;" onclick="checkFinalChallenge()">Submit Fixes</button>
                    
                    <div id="final-feedback" class="quiz-feedback"></div>
                </div>
            </div>

            <div id="completion-card" class="card hidden" style="text-align: center; border: 2px solid var(--accent-success);">
                <div style="font-size: 4rem; margin-bottom: 20px;">üéâ</div>
                <h2 style="color: var(--accent-success); margin-bottom: 15px;">Security Master!</h2>
                <p>You've completed the Security Dojo. You're now ready to:</p>
                <ul style="text-align: left; display: inline-block; margin: 20px 0; line-height: 2;">
                    <li>Pass security rounds in technical interviews</li>
                    <li>Implement defense-in-depth in your applications</li>
                    <li>Conduct security code reviews</li>
                    <li>Protect users from OWASP Top 10 vulnerabilities</li>
                </ul>
                <div style="margin-top: 30px;">
                    <div class="badge" style="font-size: 1.2rem; padding: 10px 20px;">üèÖ XSS Defender</div>
                    <div class="badge" style="font-size: 1.2rem; padding: 10px 20px;">üõ°Ô∏è CSRF Guardian</div>
                    <div class="badge" style="font-size: 1.2rem; padding: 10px 20px;">üîê Auth Expert</div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // State Management
        let state = {
            currentSection: 'intro',
            score: 0,
            completedSections: new Set(),
            xssMode: 'vulnerable', // 'vulnerable' or 'safe'
            challengeSelections: new Set()
        };

        const sections = ['intro', 'xss', 'csrf', 'csp', 'input', 'auth', 'final'];
        const sectionScores = {
            'xss': 15,
            'csrf': 15,
            'csp': 15,
            'input': 15,
            'auth': 15,
            'final': 25
        };

        // Navigation - FIXED VERSION
       // Navigation
function showSection(sectionId) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

  const targetSection = document.getElementById(sectionId);
  if (targetSection) targetSection.classList.add('active');

  const activeBtn = document.querySelector(`.nav-btn[data-section="${sectionId}"]`);
  if (activeBtn) activeBtn.classList.add('active');

  state.currentSection = sectionId;
  updateProgress();
  window.scrollTo(0, 0);
}

// Bind nav clicks (no inline handlers)
document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
  btn.addEventListener('click', () => showSection(btn.dataset.section));
});

      function updateProgress() {
  const progress = (state.completedSections.size / (sections.length - 2)) * 100;
  document.getElementById('main-progress').style.width = progress + '%';
  document.getElementById('total-score').textContent = state.score;

  state.completedSections.forEach(section => {
    const btn = document.querySelector(`.nav-btn[data-section="${section}"]`);
    if (btn) btn.classList.add('completed');
  });
}

        // XSS Lab
        function toggleXSSMode() {
            const toggle = document.getElementById('xss-toggle');
            const label = document.getElementById('mode-label');
            
            if(state.xssMode === 'vulnerable') {
                state.xssMode = 'safe';
                toggle.classList.add('safe');
                label.textContent = 'SECURE';
                label.style.color = 'var(--accent-success)';
            } else {
                state.xssMode = 'vulnerable';
                toggle.classList.remove('safe');
                label.textContent = 'VULNERABLE';
                label.style.color = 'var(--danger)';
            }
        }

        function submitXSS() {
            const input = document.getElementById('xss-input').value;
            const output = document.getElementById('xss-output');
            const alert = document.getElementById('xss-alert');
            
            if(!input) return;
            
            if(state.xssMode === 'vulnerable') {
                // Simulate vulnerability (but safely)
                output.innerHTML = input;
                alert.className = 'alert-box alert-danger';
                alert.style.display = 'flex';
                alert.innerHTML = `
                    <span style="font-size: 1.5rem;">üö®</span>
                    <div>
                        <strong>XSS Payload Executed!</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem;">If this were real, cookies would be stolen!</p>
                    </div>
                `;
            } else {
                // Safe mode - escape HTML
                const escaped = input
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
                output.innerHTML = escaped;
                alert.className = 'alert-box alert-success';
                alert.style.display = 'flex';
                alert.innerHTML = `
                    <span style="font-size: 1.5rem;">‚úÖ</span>
                    <div>
                        <strong>Input Sanitized!</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.9rem;">HTML entities prevent script execution.</p>
                    </div>
                `;
            }
        }

        // CSRF Simulation
        function simulateCSRF() {
            const result = document.getElementById('csrf-result');
            result.innerHTML = '<span style="color: var(--danger);">‚ùå Transfer Executed! $1000 sent to Attacker</span>';
            setTimeout(() => {
                result.innerHTML = '';
            }, 3000);
        }

        // CSP Builder
        function updateCSP() {
            const defaultSrc = document.getElementById('csp-default').checked;
            const scriptUnsafe = document.getElementById('csp-script').checked;
            const scriptHttps = document.getElementById('csp-script-https').checked;
            const styleUnsafe = document.getElementById('csp-style').checked;
            
            let header = "Content-Security-Policy: ";
            const directives = [];
            
            if(defaultSrc) directives.push("default-src 'self'");
            if(scriptUnsafe) directives.push("script-src 'unsafe-inline'");
            else if(scriptHttps) directives.push("script-src https:");
            
            if(styleUnsafe) directives.push("style-src 'unsafe-inline'");
            else if(defaultSrc) directives.push("style-src 'self'");
            
            header += directives.join('; ');
            document.getElementById('csp-header').textContent = header;
            
            // Update resources visualization
            const resources = document.getElementById('csp-resources');
            let html = '';
            
            // Script inline
            if(scriptUnsafe) {
                html += '<span class="resource-tag allowed">&lt;script&gt;alert(1)&lt;/script&gt; ‚ö†Ô∏è</span>';
            } else {
                html += '<span class="resource-tag blocked">&lt;script&gt;alert(1)&lt;/script&gt; üö´</span>';
            }
            
            // External script
            if(scriptHttps || scriptUnsafe || defaultSrc) {
                html += '<span class="resource-tag allowed">&lt;script src="https://cdn.com "&gt; ‚úÖ</span>';
            } else {
                html += '<span class="resource-tag blocked">&lt;script src="https://cdn.com "&gt; üö´</span>';
            }
            
            // Inline style
            if(styleUnsafe || defaultSrc) {
                html += '<span class="resource-tag allowed">style="color: red" ‚úÖ</span>';
            } else {
                html += '<span class="resource-tag blocked">style="color: red" üö´</span>';
            }
            
            resources.innerHTML = html;
        }

        // Regex Tester
        function testRegex() {
            const input = document.getElementById('regex-input').value;
            const pattern = document.getElementById('regex-pattern').value;
            const resultDiv = document.getElementById('regex-result');
            const icon = document.getElementById('regex-icon');
            const message = document.getElementById('regex-message');
            
            let regex;
            switch(pattern) {
                case 'alphanumeric':
                    regex = /^[a-zA-Z0-9]+$/;
                    break;
                case 'email':
                    regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    break;
                case 'username':
                    regex = /^[a-zA-Z0-9_]{3,16}$/;
                    break;
            }
            
            const isValid = regex.test(input);
            resultDiv.style.display = 'flex';
            
            if(isValid) {
                resultDiv.className = 'alert-box alert-success';
                icon.textContent = '‚úÖ';
                message.textContent = 'Valid input! Matches whitelist pattern.';
            } else {
                resultDiv.className = 'alert-box alert-danger';
                icon.textContent = '‚ùå';
                message.textContent = 'Invalid input! Rejected by whitelist validation.';
            }
        }

        // Quiz System
        function checkAnswer(element, isCorrect, section) {
            const container = element.parentElement;
            const feedback = document.getElementById('quiz-feedback-' + section);
            
            // Reset all options
            container.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('correct', 'wrong');
                opt.style.pointerEvents = 'none';
            });
            
            if(isCorrect) {
                element.classList.add('correct');
                feedback.style.display = 'block';
                feedback.className = 'quiz-feedback alert-success';
                feedback.innerHTML = '<strong>Correct!</strong> ' + getExplanation(section);
                
                if(!state.completedSections.has(section)) {
                    state.score += sectionScores[section] || 10;
                    state.completedSections.add(section);
                    updateProgress();
                    createConfetti(element);
                }
            } else {
                element.classList.add('wrong');
                feedback.style.display = 'block';
                feedback.className = 'quiz-feedback alert-danger';
                feedback.innerHTML = '<strong>Incorrect.</strong> Try reviewing the material above.';
                
                // Re-enable after delay
                setTimeout(() => {
                    container.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('correct', 'wrong');
                        opt.style.pointerEvents = 'auto';
                    });
                    feedback.style.display = 'none';
                }, 2000);
            }
        }

        function getExplanation(section) {
            const explanations = {
                'xss': 'textContent treats input as plain text, preventing HTML/JS execution. innerHTML parses and executes HTML.',
                'csrf': 'SameSite cookies prevent the browser from sending cookies in cross-site requests, blocking CSRF.',
                'csp': 'default-src \'self\' restricts all resources (scripts, images, etc.) to the same origin unless overridden.',
                'input': 'Whitelist validation (accepting only known good) is safer than blacklist (trying to block known bad).',
                'auth': 'HttpOnly prevents JavaScript from reading the cookie, protecting it from XSS theft.'
            };
            return explanations[section] || '';
        }

        // Final Challenge
        function toggleChallenge(element) {
            const checkbox = element.querySelector('input');
            const fix = checkbox.getAttribute('data-fix');
            
            if(checkbox.checked) {
                state.challengeSelections.add(fix);
                element.style.borderColor = 'var(--accent-primary)';
            } else {
                state.challengeSelections.delete(fix);
                element.style.borderColor = 'var(--border-color)';
            }
        }

        function checkFinalChallenge() {
            const correct = ['csp', 'escape', 'validation', 'csrf', 'cookie'];
            const selected = Array.from(state.challengeSelections);
            const feedback = document.getElementById('final-feedback');
            const isCorrect = correct.every(c => selected.includes(c)) && selected.length === correct.length;
            
            if(isCorrect) {
                feedback.style.display = 'block';
                feedback.className = 'quiz-feedback alert-success';
                feedback.innerHTML = '<strong>Perfect!</strong> You identified all vulnerabilities. You\'re ready for production!';
                
                if(!state.completedSections.has('final')) {
                    state.score += 25;
                    state.completedSections.add('final');
                    updateProgress();
                    document.getElementById('completion-card').classList.remove('hidden');
                    createConfetti(feedback, 50);
                }
            } else {
                feedback.style.display = 'block';
                feedback.className = 'quiz-feedback alert-warning';
                feedback.innerHTML = '<strong>Not quite.</strong> Hint: There are exactly 5 fixes needed. "Enable CORS for all origins" is actually a vulnerability, not a fix!';
            }
        }

        // Visual Effects
        function createConfetti(element, count = 20) {
            const rect = element.getBoundingClientRect();
            for(let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = rect.left + rect.width/2 + 'px';
                confetti.style.top = rect.top + 'px';
                confetti.style.background = ['#00f0ff', '#ff006e', '#00ff88', '#ffbe0b'][Math.floor(Math.random() * 4)];
                confetti.style.animationDuration = (Math.random() * 2 + 1) + 's';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 3000);
            }
        }

// Bind nav clicks without inline handlers (CSP-safe)
document.querySelectorAll('.nav-btn[data-section]').forEach(btn => {
  btn.addEventListener('click', () => {
    const sectionId = btn.dataset.section;
    showSection(sectionId);
  });
});

        // Initialize
        updateCSP();
        updateProgress();

        // Prevent actual form submissions
        document.addEventListener('submit', e => e.preventDefault());
    </script>
</body>
</html>