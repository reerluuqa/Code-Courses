<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Browser Storage Mastery</title>
<style>
  /* ============================================
     RESET & BASE STYLES
  ============================================ */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  :root {
    --primary: #6C63FF;
    --secondary: #FF6584;
    --success: #43D9AD;
    --warning: #FFB347;
    --danger: #FF4757;
    --dark: #0F0E17;
    --darker: #080710;
    --card: #1A1A2E;
    --card2: #16213E;
    --border: #2A2A4A;
    --text: #E8E8F0;
    --text-dim: #8888AA;
    --local-color: #6C63FF;
    --session-color: #FF6584;
    --code-bg: #0D1117;
  }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'Segoe UI', system-ui, sans-serif;
    background: var(--darker);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
  }

  /* ============================================
     SCROLLBAR
  ============================================ */
  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-track { background: var(--darker); }
  ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; }

  /* ============================================
     LAYOUT
  ============================================ */
  .app-container { display: flex; min-height: 100vh; }

  /* ============================================
     SIDEBAR NAVIGATION
  ============================================ */
  .sidebar {
    width: 280px;
    background: var(--card);
    border-right: 1px solid var(--border);
    position: fixed;
    top: 0; left: 0;
    height: 100vh;
    overflow-y: auto;
    z-index: 100;
    transition: transform 0.3s ease;
  }

  .sidebar-header {
    padding: 24px 20px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    text-align: center;
  }

  .sidebar-header .logo {
    font-size: 2rem;
    margin-bottom: 8px;
  }

  .sidebar-header h2 {
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 1px;
  }

  .sidebar-header p {
    font-size: 0.75rem;
    opacity: 0.85;
    margin-top: 4px;
  }

  .progress-bar-container {
    padding: 16px 20px;
    background: var(--card2);
    border-bottom: 1px solid var(--border);
  }

  .progress-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: var(--text-dim);
    margin-bottom: 8px;
  }

  .progress-bar {
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--success));
    border-radius: 3px;
    transition: width 0.5s ease;
    width: 0%;
  }

  .nav-section { padding: 12px 0; }

  .nav-section-title {
    padding: 8px 20px;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-dim);
    font-weight: 700;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    cursor: pointer;
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
    color: var(--text-dim);
    font-size: 0.9rem;
  }

  .nav-item:hover {
    background: rgba(108, 99, 255, 0.1);
    color: var(--text);
    border-left-color: var(--primary);
  }

  .nav-item.active {
    background: rgba(108, 99, 255, 0.15);
    color: var(--primary);
    border-left-color: var(--primary);
    font-weight: 600;
  }

  .nav-item .nav-icon { font-size: 1.1rem; width: 20px; text-align: center; }
  .nav-item .nav-check { margin-left: auto; color: var(--success); font-size: 0.8rem; opacity: 0; transition: opacity 0.3s; }
  .nav-item.completed .nav-check { opacity: 1; }

  /* ============================================
     MAIN CONTENT
  ============================================ */
  .main-content {
    margin-left: 280px;
    flex: 1;
    min-height: 100vh;
  }

  .section {
    display: none;
    padding: 40px;
    min-height: 100vh;
    animation: fadeIn 0.4s ease;
  }

  .section.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ============================================
     TYPOGRAPHY
  ============================================ */
  .section-title {
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 8px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .section-subtitle {
    color: var(--text-dim);
    font-size: 1rem;
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border);
  }

  h3 { font-size: 1.3rem; margin-bottom: 16px; color: var(--text); }
  h4 { font-size: 1rem; margin-bottom: 12px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

  p { margin-bottom: 12px; color: var(--text-dim); }

  /* ============================================
     CARDS
  ============================================ */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
  }

  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
  }

  .info-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    transition: transform 0.2s, border-color 0.2s;
  }

  .info-card:hover { transform: translateY(-2px); }

  .info-card.local { border-top: 3px solid var(--local-color); }
  .info-card.session { border-top: 3px solid var(--session-color); }
  .info-card.success { border-top: 3px solid var(--success); }
  .info-card.warning { border-top: 3px solid var(--warning); }
  .info-card.danger { border-top: 3px solid var(--danger); }

  .card-icon { font-size: 2rem; margin-bottom: 12px; }
  .card-title { font-weight: 700; margin-bottom: 8px; font-size: 1rem; }
  .card-desc { font-size: 0.85rem; color: var(--text-dim); }

  /* ============================================
     CODE BLOCKS
  ============================================ */
  .code-block {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin: 16px 0;
    position: relative;
    overflow-x: auto;
  }

  .code-block pre {
    font-family: 'Fira Code', 'Cascadia Code', 'Courier New', monospace;
    font-size: 0.85rem;
    line-height: 1.8;
    color: #ABB2BF;
  }

  .code-label {
    position: absolute;
    top: 10px;
    right: 12px;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    background: var(--border);
    padding: 2px 8px;
    border-radius: 4px;
  }

  .copy-btn {
    position: absolute;
    top: 10px;
    right: 80px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-dim);
    padding: 2px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.7rem;
    transition: all 0.2s;
  }

  .copy-btn:hover { background: var(--border); color: var(--text); }

  /* Syntax highlighting */
  .kw { color: #C678DD; }
  .fn { color: #61AFEF; }
  .str { color: #98C379; }
  .num { color: #D19A66; }
  .cmt { color: #5C6370; font-style: italic; }
  .prop { color: #E06C75; }
  .const { color: #56B6C2; }

  /* ============================================
     VISUAL DIAGRAMS
  ============================================ */
  .comparison-diagram {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 24px 0;
  }

  .storage-box {
    border-radius: 12px;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }

  .storage-box.local {
    background: rgba(108, 99, 255, 0.1);
    border: 2px solid var(--local-color);
  }

  .storage-box.session {
    background: rgba(255, 101, 132, 0.1);
    border: 2px solid var(--session-color);
  }

  .storage-box h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
  }

  .storage-badge {
    font-size: 0.7rem;
    padding: 3px 10px;
    border-radius: 20px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .local .storage-badge { background: var(--local-color); color: white; }
  .session .storage-badge { background: var(--session-color); color: white; }

  .feature-list { list-style: none; }

  .feature-list li {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    font-size: 0.85rem;
    color: var(--text-dim);
  }

  .feature-list li:last-child { border-bottom: none; }
  .feature-list li .fi { font-size: 1rem; }

  /* ============================================
     INTERACTIVE STORAGE EXPLORER
  ============================================ */
  .storage-explorer {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 24px;
  }

  .explorer-tabs {
    display: flex;
    background: var(--card2);
    border-bottom: 1px solid var(--border);
  }

  .explorer-tab {
    flex: 1;
    padding: 14px;
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.2s;
    color: var(--text-dim);
    border: none;
    background: transparent;
  }

  .explorer-tab.active.local { background: rgba(108,99,255,0.15); color: var(--local-color); border-bottom: 3px solid var(--local-color); }
  .explorer-tab.active.session { background: rgba(255,101,132,0.15); color: var(--session-color); border-bottom: 3px solid var(--session-color); }

  .explorer-body { padding: 24px; }

  .explorer-controls {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 12px;
    margin-bottom: 20px;
  }

  .inp {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    color: var(--text);
    font-size: 0.9rem;
    transition: border-color 0.2s;
    width: 100%;
  }

  .inp:focus { outline: none; border-color: var(--primary); }

  .btn {
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .btn-primary { background: var(--primary); color: white; }
  .btn-primary:hover { background: #5A52D5; transform: translateY(-1px); }

  .btn-session { background: var(--session-color); color: white; }
  .btn-session:hover { background: #E55570; transform: translateY(-1px); }

  .btn-danger { background: var(--danger); color: white; }
  .btn-danger:hover { background: #E03040; }

  .btn-success { background: var(--success); color: #0F0E17; }
  .btn-success:hover { background: #36C49A; }

  .btn-warning { background: var(--warning); color: #0F0E17; }
  .btn-secondary { background: var(--border); color: var(--text); }
  .btn-secondary:hover { background: #3A3A5A; }

  .btn-sm { padding: 6px 12px; font-size: 0.75rem; }

  .storage-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }

  .storage-table th {
    background: var(--card2);
    padding: 10px 14px;
    text-align: left;
    color: var(--text-dim);
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .storage-table td {
    padding: 10px 14px;
    border-bottom: 1px solid var(--border);
    word-break: break-all;
  }

  .storage-table tr:last-child td { border-bottom: none; }
  .storage-table tr:hover td { background: rgba(255,255,255,0.02); }

  .key-cell { color: var(--primary); font-weight: 600; font-family: monospace; }
  .val-cell { color: var(--success); font-family: monospace; max-width: 250px; }

  .del-btn {
    background: rgba(255,71,87,0.1);
    border: 1px solid rgba(255,71,87,0.3);
    color: var(--danger);
    padding: 4px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.75rem;
    transition: all 0.2s;
  }

  .del-btn:hover { background: var(--danger); color: white; }

  .empty-state {
    text-align: center;
    padding: 40px;
    color: var(--text-dim);
  }

  .empty-state .es-icon { font-size: 3rem; margin-bottom: 12px; }

  .storage-stats {
    display: flex;
    gap: 16px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }

  .stat-item {
    background: var(--card2);
    border-radius: 8px;
    padding: 10px 16px;
    flex: 1;
    text-align: center;
  }

  .stat-value { font-size: 1.4rem; font-weight: 800; }
  .stat-label { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; }

  /* ============================================
     LIFECYCLE DIAGRAM
  ============================================ */
  .lifecycle-diagram {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin: 20px 0;
    text-align: center;
  }

  .lifecycle-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin: 16px 0;
    flex-wrap: wrap;
  }

  .lifecycle-node {
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 12px 20px;
    font-size: 0.85rem;
    font-weight: 600;
    position: relative;
  }

  .lifecycle-node.local { border-color: var(--local-color); color: var(--local-color); }
  .lifecycle-node.session { border-color: var(--session-color); color: var(--session-color); }
  .lifecycle-node.neutral { border-color: var(--success); color: var(--success); }

  .lifecycle-arrow { font-size: 1.5rem; color: var(--text-dim); }

  .scope-diagram {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 20px 0;
  }

  .scope-box {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
  }

  .scope-title {
    font-weight: 700;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
    font-size: 0.9rem;
  }

  .tab-sim {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 8px;
    overflow: hidden;
  }

  .tab-header {
    background: var(--card2);
    padding: 8px 12px;
    font-size: 0.75rem;
    color: var(--text-dim);
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .tab-dot { width: 10px; height: 10px; border-radius: 50%; }
  .tab-dot.red { background: #FF5F57; }
  .tab-dot.yellow { background: #FEBC2E; }
  .tab-dot.green { background: #28C840; }

  .tab-body {
    padding: 12px;
    font-size: 0.8rem;
    color: var(--text-dim);
  }

  .storage-item {
    display: flex;
    justify-content: space-between;
    background: var(--card2);
    border-radius: 4px;
    padding: 6px 10px;
    margin-bottom: 4px;
    font-family: monospace;
    font-size: 0.78rem;
  }

  .storage-item .si-key { color: var(--primary); }
  .storage-item .si-val { color: var(--success); }

  /* ============================================
     PITFALLS
  ============================================ */
  .pitfall-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 16px;
  }

  .pitfall-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .pitfall-icon { font-size: 1.5rem; }

  .pitfall-title {
    font-weight: 700;
    font-size: 1rem;
  }

  .pitfall-severity {
    margin-left: auto;
    font-size: 0.7rem;
    padding: 3px 10px;
    border-radius: 20px;
    font-weight: 700;
    text-transform: uppercase;
  }

  .severity-high { background: rgba(255,71,87,0.2); color: var(--danger); border: 1px solid var(--danger); }
  .severity-med { background: rgba(255,179,71,0.2); color: var(--warning); border: 1px solid var(--warning); }
  .severity-low { background: rgba(67,217,173,0.2); color: var(--success); border: 1px solid var(--success); }

  .bad-good {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .bg-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .bg-label.bad { color: var(--danger); }
  .bg-label.good { color: var(--success); }

  /* ============================================
     STORAGE EVENTS
  ============================================ */
  .event-visualizer {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
  }

  .event-log {
    height: 200px;
    overflow-y: auto;
    background: var(--darker);
    border-radius: 8px;
    padding: 12px;
    font-family: monospace;
    font-size: 0.8rem;
  }

  .event-entry {
    padding: 6px 0;
    border-bottom: 1px solid var(--border);
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .event-entry:last-child { border-bottom: none; }
  .ev-time { color: var(--text-dim); }
  .ev-action { color: var(--warning); font-weight: 600; }
  .ev-key { color: var(--primary); }
  .ev-val { color: var(--success); }

  /* ============================================
     QUIZ
  ============================================ */
  .quiz-container {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
  }

  .quiz-progress-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }

  .quiz-progress-dots {
    display: flex;
    gap: 8px;
  }

  .q-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: var(--border);
    transition: all 0.3s;
  }

  .q-dot.answered { background: var(--success); }
  .q-dot.current { background: var(--primary); transform: scale(1.3); }
  .q-dot.wrong { background: var(--danger); }

  .question-card { display: none; }
  .question-card.active { display: block; animation: fadeIn 0.3s ease; }

  .question-text {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 24px;
    line-height: 1.5;
  }

  .options-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
  }

  .option-btn {
    background: var(--card2);
    border: 2px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text);
    font-size: 0.85rem;
    line-height: 1.4;
  }

  .option-btn:hover:not(:disabled) {
    border-color: var(--primary);
    background: rgba(108,99,255,0.1);
    transform: translateY(-1px);
  }

  .option-btn.correct {
    border-color: var(--success);
    background: rgba(67,217,173,0.15);
    color: var(--success);
  }

  .option-btn.wrong {
    border-color: var(--danger);
    background: rgba(255,71,87,0.15);
    color: var(--danger);
  }

  .option-btn.reveal {
    border-color: var(--success);
    background: rgba(67,217,173,0.08);
  }

  .quiz-feedback {
    padding: 14px;
    border-radius: 8px;
    margin-bottom: 16px;
    display: none;
    font-size: 0.9rem;
  }

  .quiz-feedback.show { display: block; animation: fadeIn 0.3s ease; }
  .quiz-feedback.correct-fb { background: rgba(67,217,173,0.1); border: 1px solid var(--success); color: var(--success); }
  .quiz-feedback.wrong-fb { background: rgba(255,71,87,0.1); border: 1px solid var(--danger); color: var(--danger); }

  .quiz-nav { display: flex; gap: 12px; justify-content: flex-end; }

  .quiz-results {
    text-align: center;
    padding: 40px;
    display: none;
  }

  .quiz-results.show { display: block; animation: fadeIn 0.4s ease; }

  .score-circle {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    border: 8px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
    position: relative;
    overflow: hidden;
  }

  .score-circle::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: conic-gradient(var(--success) var(--score-pct), transparent 0);
    mask: radial-gradient(transparent 55px, black 56px);
    -webkit-mask: radial-gradient(transparent 55px, black 56px);
  }

  .score-num { font-size: 2.5rem; font-weight: 900; color: var(--success); }
  .score-total { font-size: 0.8rem; color: var(--text-dim); }

  /* ============================================
     EXERCISES
  ============================================ */
  .exercise-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
  }

  .exercise-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .exercise-num {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: 0.9rem;
    flex-shrink: 0;
  }

  .exercise-title { font-size: 1.1rem; font-weight: 700; }
  .exercise-difficulty { margin-left: auto; font-size: 0.7rem; padding: 3px 10px; border-radius: 20px; font-weight: 700; }
  .diff-easy { background: rgba(67,217,173,0.2); color: var(--success); }
  .diff-med { background: rgba(255,179,71,0.2); color: var(--warning); }
  .diff-hard { background: rgba(255,71,87,0.2); color: var(--danger); }

  .exercise-desc { color: var(--text-dim); font-size: 0.9rem; margin-bottom: 16px; }

  .code-editor {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 12px;
  }

  .editor-header {
    background: var(--card2);
    padding: 8px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }

  .editor-dots { display: flex; gap: 6px; }
  .editor-dots span { width: 12px; height: 12px; border-radius: 50%; }
  .editor-dots .red { background: #FF5F57; }
  .editor-dots .yellow { background: #FEBC2E; }
  .editor-dots .green { background: #28C840; }

  .editor-label { font-size: 0.75rem; color: var(--text-dim); }

  textarea.code-input {
    width: 100%;
    background: var(--code-bg);
    border: none;
    color: var(--success);
    font-family: 'Fira Code', 'Courier New', monospace;
    font-size: 0.85rem;
    padding: 16px;
    resize: vertical;
    min-height: 150px;
    line-height: 1.6;
  }

  textarea.code-input:focus { outline: none; }

  .exercise-output {
    background: var(--darker);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px;
    font-family: monospace;
    font-size: 0.85rem;
    min-height: 60px;
    color: var(--text-dim);
    margin-bottom: 12px;
  }

  .exercise-output.success-output { color: var(--success); border-color: var(--success); }
  .exercise-output.error-output { color: var(--danger); border-color: var(--danger); }

  .ex-actions { display: flex; gap: 10px; flex-wrap: wrap; }

  /* ============================================
     BEST PRACTICES
  ============================================ */
  .practice-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 16px;
    margin: 20px 0;
  }

  .practice-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    border-left: 4px solid var(--primary);
  }

  .practice-card.do { border-left-color: var(--success); }
  .practice-card.dont { border-left-color: var(--danger); }

  .practice-card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .do-label { color: var(--success); font-weight: 700; font-size: 0.75rem; text-transform: uppercase; }
  .dont-label { color: var(--danger); font-weight: 700; font-size: 0.75rem; text-transform: uppercase; }

  /* ============================================
     CHEAT SHEET
  ============================================ */
  .cheatsheet-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  .cs-section {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .cs-title {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    padding: 12px 16px;
    font-weight: 700;
    font-size: 0.9rem;
  }

  .cs-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 16px;
    border-bottom: 1px solid var(--border);
    font-size: 0.82rem;
  }

  .cs-item:last-child { border-bottom: none; }
  .cs-method { font-family: monospace; color: var(--primary); }
  .cs-desc { color: var(--text-dim); text-align: right; font-size: 0.78rem; }

  /* ============================================
     REAL WORLD DEMO
  ============================================ */
  .demo-app {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 24px;
  }

  .demo-app-header {
    background: linear-gradient(135deg, var(--primary), #5A52D5);
    padding: 16px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .demo-app-title { font-weight: 700; font-size: 1rem; }
  .demo-app-subtitle { font-size: 0.75rem; opacity: 0.8; }

  .demo-app-body { padding: 24px; }

  .theme-switcher {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .theme-btn {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 2px solid var(--border);
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.2s;
    background: transparent;
    color: var(--text);
  }

  .theme-btn:hover { border-color: var(--primary); }
  .theme-btn.active-theme { border-color: var(--primary); background: rgba(108,99,255,0.15); color: var(--primary); }

  .user-profile-form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
  }

  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-group label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); }

  .pref-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
  }

  .pref-row:last-child { border-bottom: none; }
  .pref-label { font-size: 0.9rem; }
  .pref-desc { font-size: 0.75rem; color: var(--text-dim); }

  .toggle {
    position: relative;
    width: 44px;
    height: 24px;
    flex-shrink: 0;
  }

  .toggle input { opacity: 0; width: 0; height: 0; }

  .toggle-slider {
    position: absolute;
    inset: 0;
    background: var(--border);
    border-radius: 12px;
    cursor: pointer;
    transition: 0.3s;
  }

  .toggle-slider::before {
    content: '';
    position: absolute;
    left: 3px;
    top: 3px;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: white;
    transition: 0.3s;
  }

  .toggle input:checked + .toggle-slider { background: var(--primary); }
  .toggle input:checked + .toggle-slider::before { transform: translateX(20px); }

  /* ============================================
     TOAST NOTIFICATIONS
  ============================================ */
  .toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .toast {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 18px;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: toastIn 0.3s ease;
    max-width: 320px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  }

  @keyframes toastIn {
    from { opacity: 0; transform: translateX(100px); }
    to { opacity: 1; transform: translateX(0); }
  }

  @keyframes toastOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100px); }
  }

  .toast.success { border-left: 4px solid var(--success); }
  .toast.error { border-left: 4px solid var(--danger); }
  .toast.info { border-left: 4px solid var(--primary); }
  .toast.warning { border-left: 4px solid var(--warning); }

  /* ============================================
     QUOTA VISUALIZER
  ============================================ */
  .quota-bar-container { margin: 12px 0; }
  .quota-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 6px; }
  .quota-bar { height: 16px; background: var(--border); border-radius: 8px; overflow: hidden; }
  .quota-fill { height: 100%; border-radius: 8px; transition: width 0.5s ease; }
  .quota-fill.local-fill { background: linear-gradient(90deg, var(--local-color), #9C95FF); }
  .quota-fill.session-fill { background: linear-gradient(90deg, var(--session-color), #FF95AA); }

  /* ============================================
     MOBILE TOGGLE
  ============================================ */
  .mobile-toggle {
    display: none;
    position: fixed;
    top: 16px;
    left: 16px;
    z-index: 200;
    background: var(--primary);
    border: none;
    color: white;
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.2rem;
  }

  .sidebar-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 99;
  }

  @media (max-width: 900px) {
    .mobile-toggle { display: flex; align-items: center; }
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .sidebar-overlay.open { display: block; }
    .main-content { margin-left: 0; }
    .section { padding: 24px 16px; padding-top: 70px; }
    .comparison-diagram { grid-template-columns: 1fr; }
    .bad-good { grid-template-columns: 1fr; }
    .options-grid { grid-template-columns: 1fr; }
    .explorer-controls { grid-template-columns: 1fr; }
    .user-profile-form { grid-template-columns: 1fr; }
    .scope-diagram { grid-template-columns: 1fr; }
  }

  /* ============================================
     MISC UTILITIES
  ============================================ */
  .tag {
    display: inline-block;
    font-size: 0.7rem;
    padding: 3px 10px;
    border-radius: 20px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-right: 6px;
    margin-bottom: 4px;
  }

  .tag-local { background: rgba(108,99,255,0.2); color: var(--local-color); }
  .tag-session { background: rgba(255,101,132,0.2); color: var(--session-color); }
  .tag-both { background: rgba(67,217,173,0.2); color: var(--success); }

  .highlight-box {
    background: rgba(108,99,255,0.08);
    border: 1px solid rgba(108,99,255,0.3);
    border-radius: 8px;
    padding: 14px;
    margin: 12px 0;
    font-size: 0.9rem;
  }

  .warning-box {
    background: rgba(255,179,71,0.08);
    border: 1px solid rgba(255,179,71,0.3);
    border-radius: 8px;
    padding: 14px;
    margin: 12px 0;
    font-size: 0.9rem;
    color: var(--warning);
  }

  .danger-box {
    background: rgba(255,71,87,0.08);
    border: 1px solid rgba(255,71,87,0.3);
    border-radius: 8px;
    padding: 14px;
    margin: 12px 0;
    font-size: 0.9rem;
    color: var(--danger);
  }

  .success-box {
    background: rgba(67,217,173,0.08);
    border: 1px solid rgba(67,217,173,0.3);
    border-radius: 8px;
    padding: 14px;
    margin: 12px 0;
    font-size: 0.9rem;
    color: var(--success);
  }

  .flex-row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-bottom: 12px; }

  .divider { border: none; border-top: 1px solid var(--border); margin: 24px 0; }
</style>
</head>
<body>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Mobile Toggle -->
<button class="mobile-toggle" id="mobileToggle">‚ò∞</button>
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<div class="app-container">
  <!-- ============================================
       SIDEBAR
  ============================================ -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo">üíæ</div>
      <h2>Browser Storage</h2>
      <p>Master Local & Session Storage</p>
    </div>
    
    <div class="progress-bar-container">
      <div class="progress-label">
        <span>Your Progress</span>
        <span id="progressText">0%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">üìö Core Concepts</div>
      <div class="nav-item active" onclick="showSection('overview')" data-section="overview">
        <span class="nav-icon">üó∫Ô∏è</span> Overview
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('local')" data-section="local">
        <span class="nav-icon">üíæ</span> localStorage API
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('session')" data-section="session">
        <span class="nav-icon">üóìÔ∏è</span> sessionStorage API
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('explorer')" data-section="explorer">
        <span class="nav-icon">üîç</span> Storage Explorer
        <span class="nav-check">‚úì</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">‚ö° Advanced</div>
      <div class="nav-item" onclick="showSection('events')" data-section="events">
        <span class="nav-icon">üì°</span> Storage Events
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('pitfalls')" data-section="pitfalls">
        <span class="nav-icon">‚ö†Ô∏è</span> Pitfalls
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('practices')" data-section="practices">
        <span class="nav-icon">‚úÖ</span> Best Practices
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('realworld')" data-section="realworld">
        <span class="nav-icon">üåç</span> Real World Demo
        <span class="nav-check">‚úì</span>
      </div>
    </div>

    <div class="nav-section">
      <div class="nav-section-title">üéØ Practice</div>
      <div class="nav-item" onclick="showSection('quiz')" data-section="quiz">
        <span class="nav-icon">üß†</span> Quiz
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('exercises')" data-section="exercises">
        <span class="nav-icon">üí™</span> Exercises
        <span class="nav-check">‚úì</span>
      </div>
      <div class="nav-item" onclick="showSection('cheatsheet')" data-section="cheatsheet">
        <span class="nav-icon">üìã</span> Cheat Sheet
        <span class="nav-check">‚úì</span>
      </div>
    </div>
  </nav>

  <!-- ============================================
       MAIN CONTENT
  ============================================ -->
  <main class="main-content">

    <!-- ==================== OVERVIEW ==================== -->
    <section class="section active" id="section-overview">
      <h1 class="section-title">Browser Storage Overview</h1>
      <p class="section-subtitle">
        Browsers give you multiple ways to persist data on the client side. 
        The two most common are <strong>localStorage</strong> and <strong>sessionStorage</strong> ‚Äî 
        let's master them both!
      </p>

      <div class="comparison-diagram">
        <div class="storage-box local">
          <h3>üíæ <span>localStorage</span> <span class="storage-badge">Persistent</span></h3>
          <ul class="feature-list">
            <li><span class="fi">‚ôæÔ∏è</span> Persists until explicitly cleared</li>
            <li><span class="fi">üóÇÔ∏è</span> Shared across all tabs of same origin</li>
            <li><span class="fi">üì¶</span> ~5MB storage limit</li>
            <li><span class="fi">üîë</span> Survives browser restarts</li>
            <li><span class="fi">üë§</span> Great for user preferences, themes</li>
            <li><span class="fi">üîí</span> Origin-scoped (protocol + domain + port)</li>
          </ul>
        </div>
        <div class="storage-box session">
          <h3>üóìÔ∏è <span>sessionStorage</span> <span class="storage-badge">Temporary</span></h3>
          <ul class="feature-list">
            <li><span class="fi">üí•</span> Cleared when tab/window closes</li>
            <li><span class="fi">üîí</span> Unique per tab ‚Äî NOT shared</li>
            <li><span class="fi">üì¶</span> ~5MB storage limit</li>
            <li><span class="fi">üîÑ</span> Survives page refreshes within same tab</li>
            <li><span class="fi">üìù</span> Great for form data, wizard steps</li>
            <li><span class="fi">üè†</span> Origin + tab scoped</li>
          </ul>
        </div>
      </div>

      <div class="card">
        <h3>üóÑÔ∏è The Web Storage API</h3>
        <p>Both <code style="color:var(--primary)">localStorage</code> and <code style="color:var(--session-color)">sessionStorage</code> implement the same <strong>Storage interface</strong> ‚Äî meaning they have identical methods!</p>

        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// Both objects expose the SAME interface:</span>

<span class="cmt">// ‚úÖ Store a value</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'key'</span>, <span class="str">'value'</span>);
sessionStorage.<span class="fn">setItem</span>(<span class="str">'key'</span>, <span class="str">'value'</span>);

<span class="cmt">// ‚úÖ Retrieve a value</span>
localStorage.<span class="fn">getItem</span>(<span class="str">'key'</span>);    <span class="cmt">// Returns string or null</span>
sessionStorage.<span class="fn">getItem</span>(<span class="str">'key'</span>);   <span class="cmt">// Returns string or null</span>

<span class="cmt">// ‚úÖ Remove a specific item</span>
localStorage.<span class="fn">removeItem</span>(<span class="str">'key'</span>);
sessionStorage.<span class="fn">removeItem</span>(<span class="str">'key'</span>);

<span class="cmt">// ‚úÖ Clear ALL items</span>
localStorage.<span class="fn">clear</span>();
sessionStorage.<span class="fn">clear</span>();

<span class="cmt">// ‚úÖ Get number of items stored</span>
localStorage.<span class="prop">length</span>;    <span class="cmt">// e.g., 3</span>
sessionStorage.<span class="prop">length</span>;   <span class="cmt">// e.g., 1</span>

<span class="cmt">// ‚úÖ Get key by index</span>
localStorage.<span class="fn">key</span>(<span class="num">0</span>);    <span class="cmt">// Returns first key name</span></pre>
        </div>
      </div>

      <!-- Data Flow Diagram -->
      <div class="card">
        <h3>üîÑ Lifecycle Visual</h3>
        <div class="lifecycle-diagram">
          <div style="margin-bottom:20px;">
            <h4 style="color:var(--local-color);margin-bottom:12px;">üíæ localStorage Lifecycle</h4>
            <div class="lifecycle-row">
              <div class="lifecycle-node local">User Visits Site</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node local">Data Written</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node local">Tab Closes</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node local">Data STAYS ‚úì</div>
            </div>
            <div class="lifecycle-row">
              <div class="lifecycle-node local">User Returns</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node local">Data Still There</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node local">Clear / Expire</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node" style="border-color:var(--danger);color:var(--danger)">Data Gone</div>
            </div>
          </div>
          <div>
            <h4 style="color:var(--session-color);margin-bottom:12px;">üóìÔ∏è sessionStorage Lifecycle</h4>
            <div class="lifecycle-row">
              <div class="lifecycle-node session">New Tab Opens</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node session">Data Written</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node session">Page Refresh</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node session">Data STAYS ‚úì</div>
            </div>
            <div class="lifecycle-row">
              <div class="lifecycle-node session">Tab Closes</div>
              <div class="lifecycle-arrow">‚Üí</div>
              <div class="lifecycle-node" style="border-color:var(--danger);color:var(--danger)">Data GONE ‚úó</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab Scope Diagram -->
      <div class="card">
        <h3>üóÇÔ∏è Scope: How Data is Shared Between Tabs</h3>
        <div class="scope-diagram">
          <div class="scope-box">
            <div class="scope-title" style="color:var(--local-color)">üíæ localStorage ‚Äî Shared Across Tabs</div>
            <div class="tab-sim">
              <div class="tab-header"><div class="tab-dot red"></div><div class="tab-dot yellow"></div><div class="tab-dot green"></div> Tab 1 ‚Äî mysite.com</div>
              <div class="tab-body">
                <div class="storage-item"><span class="si-key">theme</span><span class="si-val">"dark"</span></div>
                <div class="storage-item"><span class="si-key">userId</span><span class="si-val">"u_123"</span></div>
              </div>
            </div>
            <div style="text-align:center;color:var(--success);font-size:0.8rem;padding:8px">‚¨áÔ∏è Same data visible in Tab 2</div>
            <div class="tab-sim">
              <div class="tab-header"><div class="tab-dot red"></div><div class="tab-dot yellow"></div><div class="tab-dot green"></div> Tab 2 ‚Äî mysite.com</div>
              <div class="tab-body">
                <div class="storage-item"><span class="si-key">theme</span><span class="si-val">"dark"</span></div>
                <div class="storage-item"><span class="si-key">userId</span><span class="si-val">"u_123"</span></div>
              </div>
            </div>
          </div>
          <div class="scope-box">
            <div class="scope-title" style="color:var(--session-color)">üóìÔ∏è sessionStorage ‚Äî Isolated Per Tab</div>
            <div class="tab-sim">
              <div class="tab-header"><div class="tab-dot red"></div><div class="tab-dot yellow"></div><div class="tab-dot green"></div> Tab 1 ‚Äî mysite.com</div>
              <div class="tab-body">
                <div class="storage-item"><span class="si-key">step</span><span class="si-val">"3"</span></div>
                <div class="storage-item"><span class="si-key">formData</span><span class="si-val">"{...}"</span></div>
              </div>
            </div>
            <div style="text-align:center;color:var(--danger);font-size:0.8rem;padding:8px">‚¨áÔ∏è Tab 2 sees its OWN session data</div>
            <div class="tab-sim">
              <div class="tab-header"><div class="tab-dot red"></div><div class="tab-dot yellow"></div><div class="tab-dot green"></div> Tab 2 ‚Äî mysite.com</div>
              <div class="tab-body">
                <div class="storage-item"><span class="si-key">step</span><span class="si-val">"1"</span></div>
                <div style="font-size:0.75rem;color:var(--text-dim);padding:4px">No formData here ‚Äî different session!</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- When to use which -->
      <div class="card">
        <h3>ü§î When to Use Which?</h3>
        <div class="card-grid">
          <div class="info-card local">
            <div class="card-icon">üíæ</div>
            <div class="card-title">Use localStorage for:</div>
            <div class="card-desc">
              ‚úì User preferences (theme, language)<br>
              ‚úì Shopping cart that persists<br>
              ‚úì Auth tokens (carefully!)<br>
              ‚úì App settings<br>
              ‚úì Cached API responses<br>
              ‚úì User profile data
            </div>
          </div>
          <div class="info-card session">
            <div class="card-icon">üóìÔ∏è</div>
            <div class="card-title">Use sessionStorage for:</div>
            <div class="card-desc">
              ‚úì Multi-step form data<br>
              ‚úì Current wizard/checkout step<br>
              ‚úì Temporary search filters<br>
              ‚úì Tab-specific state<br>
              ‚úì One-time notification flags<br>
              ‚úì Undo/redo history
            </div>
          </div>
          <div class="info-card warning">
            <div class="card-icon">üö´</div>
            <div class="card-title">Never store in either:</div>
            <div class="card-desc">
              ‚úó Passwords<br>
              ‚úó Credit card numbers<br>
              ‚úó Social security numbers<br>
              ‚úó Private keys<br>
              ‚úó Medical records<br>
              ‚úó Anything truly sensitive
            </div>
          </div>
        </div>
      </div>

      <div class="flex-row">
        <button class="btn btn-primary" onclick="showSection('local')">Next: localStorage API ‚Üí</button>
      </div>
    </section>

    <!-- ==================== LOCAL STORAGE ==================== -->
    <section class="section" id="section-local">
      <h1 class="section-title">localStorage API</h1>
      <p class="section-subtitle">
        <span class="tag tag-local">Persistent</span>
        <span class="tag tag-local">Cross-Tab</span>
        <span class="tag tag-local">~5MB Limit</span>
        Deep dive into every method with live, runnable examples.
      </p>

      <!-- setItem -->
      <div class="card">
        <h3>üìù setItem(key, value)</h3>
        <p>Stores a value. <strong>‚ö†Ô∏è Important: localStorage only stores strings!</strong></p>
        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// ‚úÖ Storing strings ‚Äî works directly</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'username'</span>, <span class="str">'Alice'</span>);
localStorage.<span class="fn">setItem</span>(<span class="str">'color'</span>, <span class="str">'#6C63FF'</span>);

<span class="cmt">// ‚ö†Ô∏è Numbers get converted to strings automatically</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'count'</span>, <span class="num">42</span>);
<span class="kw">typeof</span> localStorage.<span class="fn">getItem</span>(<span class="str">'count'</span>); <span class="cmt">// "string", not number!</span>

<span class="cmt">// ‚úÖ Storing objects ‚Äî MUST use JSON.stringify</span>
<span class="kw">const</span> <span class="const">user</span> = { name: <span class="str">'Alice'</span>, age: <span class="num">30</span>, role: <span class="str">'admin'</span> };
localStorage.<span class="fn">setItem</span>(<span class="str">'user'</span>, JSON.<span class="fn">stringify</span>(user));

<span class="cmt">// ‚úÖ Storing arrays ‚Äî also use JSON.stringify</span>
<span class="kw">const</span> <span class="const">favorites</span> = [<span class="str">'React'</span>, <span class="str">'Vue'</span>, <span class="str">'Svelte'</span>];
localStorage.<span class="fn">setItem</span>(<span class="str">'favorites'</span>, JSON.<span class="fn">stringify</span>(favorites));

<span class="cmt">// ‚ö†Ô∏è This is WRONG ‚Äî stores "[object Object]"</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'broken'</span>, { name: <span class="str">'Alice'</span> }); <span class="cmt">// ‚ùå</span></pre>
        </div>

        <div class="flex-row" style="margin-top:12px">
          <input class="inp" id="ls-key-input" placeholder="Key" style="flex:1" value="myKey">
          <input class="inp" id="ls-val-input" placeholder="Value" style="flex:2" value="Hello World!">
          <button class="btn btn-primary" onclick="demoSetItem()">setItem() ‚Üí</button>
        </div>
        <div class="exercise-output" id="setitem-output">Click the button to store a value in localStorage!</div>
      </div>

      <!-- getItem -->
      <div class="card">
        <h3>üìñ getItem(key)</h3>
        <p>Retrieves a stored value. Returns <code style="color:var(--danger)">null</code> if the key doesn't exist ‚Äî not undefined!</p>
        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// ‚úÖ Basic retrieval</span>
<span class="kw">const</span> <span class="const">name</span> = localStorage.<span class="fn">getItem</span>(<span class="str">'username'</span>);
console.<span class="fn">log</span>(name); <span class="cmt">// "Alice" or null</span>

<span class="cmt">// ‚úÖ Always check for null before using</span>
<span class="kw">const</span> <span class="const">count</span> = localStorage.<span class="fn">getItem</span>(<span class="str">'count'</span>);
<span class="kw">if</span> (count !== <span class="kw">null</span>) {
  <span class="fn">useCount</span>(count); <span class="cmt">// Safe to use</span>
}

<span class="cmt">// ‚úÖ Parse objects back with JSON.parse</span>
<span class="kw">const</span> <span class="const">userStr</span> = localStorage.<span class="fn">getItem</span>(<span class="str">'user'</span>);
<span class="kw">const</span> <span class="const">user</span> = userStr ? JSON.<span class="fn">parse</span>(userStr) : <span class="kw">null</span>;
console.<span class="fn">log</span>(user?.name); <span class="cmt">// Safe optional chaining</span>

<span class="cmt">// ‚úÖ With default value using nullish coalescing</span>
<span class="kw">const</span> <span class="const">theme</span> = localStorage.<span class="fn">getItem</span>(<span class="str">'theme'</span>) ?? <span class="str">'dark'</span>;

<span class="cmt">// ‚úÖ Convert number back</span>
<span class="kw">const</span> <span class="const">score</span> = <span class="fn">Number</span>(localStorage.<span class="fn">getItem</span>(<span class="str">'score'</span>)) || <span class="num">0</span>;</pre>
        </div>

        <div class="flex-row" style="margin-top:12px">
          <input class="inp" id="ls-get-input" placeholder="Key to retrieve" style="flex:1" value="myKey">
          <button class="btn btn-primary" onclick="demoGetItem()">getItem() ‚Üí</button>
        </div>
        <div class="exercise-output" id="getitem-output">Set a key first, then retrieve it here!</div>
      </div>

      <!-- removeItem & clear -->
      <div class="card">
        <h3>üóëÔ∏è removeItem(key) & clear()</h3>
        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// ‚úÖ Remove a specific item</span>
localStorage.<span class="fn">removeItem</span>(<span class="str">'username'</span>);
<span class="cmt">// Calling on a non-existent key doesn't throw ‚Äî it just does nothing</span>

<span class="cmt">// ‚úÖ Clear EVERYTHING</span>
localStorage.<span class="fn">clear</span>();
<span class="cmt">// ‚ö†Ô∏è Warning: Clears ALL keys for this origin, not just your app's keys!</span>

<span class="cmt">// ‚úÖ Better approach: use a namespace prefix</span>
<span class="kw">function</span> <span class="fn">clearAppStorage</span>(prefix = <span class="str">'myApp_'</span>) {
  Object.<span class="fn">keys</span>(localStorage)
    .<span class="fn">filter</span>(key => key.<span class="fn">startsWith</span>(prefix))
    .<span class="fn">forEach</span>(key => localStorage.<span class="fn">removeItem</span>(key));
}</pre>
        </div>

        <div class="flex-row" style="margin-top:12px">
          <input class="inp" id="ls-remove-input" placeholder="Key to remove" style="flex:1" value="myKey">
          <button class="btn btn-danger" onclick="demoRemoveItem()">removeItem()</button>
          <button class="btn btn-secondary" onclick="demoClear()">clear() ‚Äî Careful!</button>
        </div>
        <div class="exercise-output" id="remove-output">Use buttons above to remove items.</div>
      </div>

      <!-- length & key() -->
      <div class="card">
        <h3>üìä length & key(index)</h3>
        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// ‚úÖ How many items stored?</span>
console.<span class="fn">log</span>(localStorage.<span class="prop">length</span>); <span class="cmt">// e.g., 5</span>

<span class="cmt">// ‚úÖ Get key by index (order is NOT guaranteed!)</span>
<span class="kw">const</span> <span class="const">firstKey</span> = localStorage.<span class="fn">key</span>(<span class="num">0</span>);

<span class="cmt">// ‚úÖ Iterate all items in localStorage</span>
<span class="kw">for</span> (<span class="kw">let</span> i = <span class="num">0</span>; i < localStorage.<span class="prop">length</span>; i++) {
  <span class="kw">const</span> <span class="const">key</span> = localStorage.<span class="fn">key</span>(i);
  <span class="kw">const</span> <span class="const">value</span> = localStorage.<span class="fn">getItem</span>(key);
  console.<span class="fn">log</span>(`${key}: ${value}`);
}

<span class="cmt">// ‚úÖ Modern approach: get all keys as array</span>
<span class="kw">const</span> <span class="const">allKeys</span> = Object.<span class="fn">keys</span>(localStorage);
<span class="kw">const</span> <span class="const">allEntries</span> = allKeys.<span class="fn">map</span>(key => ({
  key,
  value: localStorage.<span class="fn">getItem</span>(key)
}));</pre>
        </div>
        <button class="btn btn-primary" onclick="demoIterateLS()">Iterate localStorage ‚Üí</button>
        <div class="exercise-output" id="iterate-output" style="margin-top:12px">Click to iterate all localStorage keys</div>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('overview')">‚Üê Overview</button>
        <button class="btn btn-primary" onclick="showSection('session')">Next: sessionStorage ‚Üí</button>
      </div>
    </section>

    <!-- ==================== SESSION STORAGE ==================== -->
    <section class="section" id="section-session">
      <h1 class="section-title">sessionStorage API</h1>
      <p class="section-subtitle">
        <span class="tag tag-session">Temporary</span>
        <span class="tag tag-session">Tab-Scoped</span>
        <span class="tag tag-session">~5MB Limit</span>
        Same API as localStorage ‚Äî different lifespan and scope.
      </p>

      <div class="warning-box">
        üí° <strong>Key Insight:</strong> sessionStorage and localStorage share the exact same API. 
        The difference is entirely in <em>when data expires</em> and <em>how it's shared between tabs</em>.
        Once you know one, you know the other!
      </div>

      <div class="card">
        <h3>üìù Session Storage in Action</h3>
        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// ‚úÖ Exact same methods as localStorage!</span>
sessionStorage.<span class="fn">setItem</span>(<span class="str">'currentStep'</span>, <span class="str">'2'</span>);
sessionStorage.<span class="fn">getItem</span>(<span class="str">'currentStep'</span>);  <span class="cmt">// "2"</span>
sessionStorage.<span class="fn">removeItem</span>(<span class="str">'currentStep'</span>);
sessionStorage.<span class="fn">clear</span>();
sessionStorage.<span class="prop">length</span>;

<span class="cmt">// ‚úÖ Real-world: Save multi-step form progress</span>
<span class="kw">function</span> <span class="fn">saveStep</span>(step, data) {
  sessionStorage.<span class="fn">setItem</span>(<span class="str">'wizardStep'</span>, String(step));
  sessionStorage.<span class="fn">setItem</span>(<span class="str">'wizardData'</span>, JSON.<span class="fn">stringify</span>(data));
}

<span class="kw">function</span> <span class="fn">restoreStep</span>() {
  <span class="kw">const</span> <span class="const">step</span> = <span class="fn">Number</span>(sessionStorage.<span class="fn">getItem</span>(<span class="str">'wizardStep'</span>)) || <span class="num">1</span>;
  <span class="kw">const</span> <span class="const">raw</span> = sessionStorage.<span class="fn">getItem</span>(<span class="str">'wizardData'</span>);
  <span class="kw">const</span> <span class="const">data</span> = raw ? JSON.<span class="fn">parse</span>(raw) : {};
  <span class="kw">return</span> { step, data };
}</pre>
        </div>
      </div>

      <!-- Wizard Demo -->
      <div class="card">
        <h3>üßô Live Demo: Multi-Step Form with sessionStorage</h3>
        <p>Fill out this wizard. Refresh the page ‚Äî your data persists! Close the tab and reopen ‚Äî data is gone.</p>

        <div id="wizard-progress" style="display:flex;gap:8px;margin-bottom:24px;align-items:center">
          <div class="wizard-dot" id="wd-1" style="width:36px;height:36px;border-radius:50%;background:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.85rem;cursor:pointer;" onclick="goToWizardStep(1)">1</div>
          <div style="flex:1;height:3px;background:var(--border);border-radius:2px;" id="wl-1"><div id="wlf-1" style="height:100%;background:var(--primary);border-radius:2px;width:0%;transition:width 0.3s"></div></div>
          <div class="wizard-dot" id="wd-2" style="width:36px;height:36px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.85rem;cursor:pointer;" onclick="goToWizardStep(2)">2</div>
          <div style="flex:1;height:3px;background:var(--border);border-radius:2px;" id="wl-2"><div id="wlf-2" style="height:100%;background:var(--primary);border-radius:2px;width:0%;transition:width 0.3s"></div></div>
          <div class="wizard-dot" id="wd-3" style="width:36px;height:36px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.85rem;cursor:pointer;" onclick="goToWizardStep(3)">3</div>
        </div>

        <div id="wizard-step-1" class="wizard-step">
          <h4>Step 1: Personal Info</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
            <div class="form-group"><label>First Name</label><input class="inp" id="w-fname" placeholder="Alice"></div>
            <div class="form-group"><label>Last Name</label><input class="inp" id="w-lname" placeholder="Smith"></div>
            <div class="form-group" style="grid-column:span 2"><label>Email</label><input class="inp" id="w-email" placeholder="alice@example.com" type="email"></div>
          </div>
          <button class="btn btn-session" onclick="wizardNext(1)">Next Step ‚Üí</button>
        </div>

        <div id="wizard-step-2" class="wizard-step" style="display:none">
          <h4>Step 2: Preferences</h4>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
            <div class="form-group"><label>Favorite Language</label>
              <select class="inp" id="w-lang">
                <option value="">Select...</option>
                <option>JavaScript</option><option>Python</option><option>Rust</option><option>Go</option>
              </select>
            </div>
            <div class="form-group"><label>Experience Level</label>
              <select class="inp" id="w-level">
                <option value="">Select...</option>
                <option>Beginner</option><option>Intermediate</option><option>Advanced</option>
              </select>
            </div>
          </div>
          <div style="display:flex;gap:12px">
            <button class="btn btn-secondary" onclick="wizardBack(2)">‚Üê Back</button>
            <button class="btn btn-session" onclick="wizardNext(2)">Next Step ‚Üí</button>
          </div>
        </div>

        <div id="wizard-step-3" class="wizard-step" style="display:none">
          <h4>Step 3: Review & Submit</h4>
          <div id="wizard-review" style="background:var(--code-bg);border-radius:8px;padding:16px;margin-bottom:16px;font-family:monospace;font-size:0.85rem;line-height:1.8"></div>
          <div style="display:flex;gap:12px">
            <button class="btn btn-secondary" onclick="wizardBack(3)">‚Üê Back</button>
            <button class="btn btn-success" onclick="wizardSubmit()">‚úì Submit</button>
            <button class="btn btn-danger" onclick="clearWizard()">üóë Clear Session</button>
          </div>
        </div>

        <div id="wizard-storage-view" style="margin-top:20px;padding:12px;background:var(--code-bg);border-radius:8px;">
          <div style="font-size:0.75rem;color:var(--text-dim);margin-bottom:8px;text-transform:uppercase;letter-spacing:1px">üì° sessionStorage Live View</div>
          <div id="wizard-ss-view" style="font-family:monospace;font-size:0.82rem;color:var(--text-dim)">Empty</div>
        </div>
      </div>

      <!-- Difference table -->
      <div class="card">
        <h3>üìä Quick Comparison Table</h3>
        <table class="storage-table" style="text-align:center">
          <thead>
            <tr>
              <th>Feature</th>
              <th style="color:var(--local-color)">üíæ localStorage</th>
              <th style="color:var(--session-color)">üóìÔ∏è sessionStorage</th>
            </tr>
          </thead>
          <tbody>
            <tr><td style="font-weight:600">Persistence</td><td>Until cleared</td><td>Until tab closes</td></tr>
            <tr><td style="font-weight:600">Survives refresh</td><td>‚úÖ Yes</td><td>‚úÖ Yes</td></tr>
            <tr><td style="font-weight:600">Survives tab close</td><td>‚úÖ Yes</td><td>‚ùå No</td></tr>
            <tr><td style="font-weight:600">Shared between tabs</td><td>‚úÖ Yes (same origin)</td><td>‚ùå No</td></tr>
            <tr><td style="font-weight:600">Storage limit</td><td>~5MB</td><td>~5MB</td></tr>
            <tr><td style="font-weight:600">Data type</td><td>Strings only</td><td>Strings only</td></tr>
            <tr><td style="font-weight:600">Sync/Async</td><td>Synchronous</td><td>Synchronous</td></tr>
            <tr><td style="font-weight:600">Scope</td><td>Origin</td><td>Origin + Tab</td></tr>
          </tbody>
        </table>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('local')">‚Üê localStorage</button>
        <button class="btn btn-primary" onclick="showSection('explorer')">Next: Storage Explorer ‚Üí</button>
      </div>
    </section>

    <!-- ==================== EXPLORER ==================== -->
    <section class="section" id="section-explorer">
      <h1 class="section-title">Interactive Storage Explorer</h1>
      <p class="section-subtitle">Read, write, and manage your browser's storage in real time. This is exactly like the DevTools Application tab!</p>

      <div class="storage-explorer">
        <div class="explorer-tabs">
          <button class="explorer-tab active local" id="tab-local" onclick="switchExplorerTab('local')">üíæ localStorage</button>
          <button class="explorer-tab session" id="tab-session" onclick="switchExplorerTab('session')">üóìÔ∏è sessionStorage</button>
        </div>
        <div class="explorer-body">
          <div class="explorer-controls">
            <input class="inp" id="exp-key" placeholder="Key (e.g., theme)" value="">
            <input class="inp" id="exp-value" placeholder="Value (strings stored automatically)" value="">
            <button class="btn btn-primary" id="exp-set-btn" onclick="explorerSetItem()">Set Item</button>
          </div>
          <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap">
            <button class="btn btn-secondary btn-sm" onclick="explorerAddSample()">+ Add Sample Data</button>
            <button class="btn btn-danger btn-sm" onclick="explorerClear()">üóë Clear All</button>
            <button class="btn btn-secondary btn-sm" onclick="renderExplorer()">üîÑ Refresh</button>
          </div>
          
          <div id="explorer-table-container">
            <div class="empty-state">
              <div class="es-icon">üì≠</div>
              <p>No items in storage yet.</p>
              <button class="btn btn-primary btn-sm" onclick="explorerAddSample()" style="margin-top:12px">Add Sample Data</button>
            </div>
          </div>

          <div class="storage-stats">
            <div class="stat-item">
              <div class="stat-value" id="exp-count" style="color:var(--primary)">0</div>
              <div class="stat-label">Items</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="exp-size" style="color:var(--success)">0B</div>
              <div class="stat-label">Used Size</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" style="color:var(--warning)">~5MB</div>
              <div class="stat-label">Total Limit</div>
            </div>
          </div>

          <!-- Quota Visualizer -->
          <div style="margin-top:16px">
            <div class="quota-bar-container">
              <div class="quota-label">
                <span>localStorage Usage</span>
                <span id="quota-local-text">0 / ~5MB</span>
              </div>
              <div class="quota-bar">
                <div class="quota-fill local-fill" id="quota-local-fill" style="width:0%"></div>
              </div>
            </div>
            <div class="quota-bar-container">
              <div class="quota-label">
                <span>sessionStorage Usage</span>
                <span id="quota-session-text">0 / ~5MB</span>
              </div>
              <div class="quota-bar">
                <div class="quota-fill session-fill" id="quota-session-fill" style="width:0%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>üí° Pro Tip: Use DevTools</h3>
        <p>Press <kbd style="background:var(--border);padding:2px 8px;border-radius:4px;font-family:monospace">F12</kbd> ‚Üí <strong>Application</strong> tab ‚Üí <strong>Storage</strong> section to see your localStorage and sessionStorage in real-time as you interact with this explorer!</p>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('session')">‚Üê sessionStorage</button>
        <button class="btn btn-primary" onclick="showSection('events')">Next: Storage Events ‚Üí</button>
      </div>
    </section>

    <!-- ==================== EVENTS ==================== -->
    <section class="section" id="section-events">
      <h1 class="section-title">Storage Events</h1>
      <p class="section-subtitle">
        The <code style="color:var(--primary)">storage</code> event fires when localStorage changes in another tab. 
        This is how you sync state between browser tabs!
      </p>

      <div class="card">
        <h3>üì° How Storage Events Work</h3>
        <div class="warning-box">
          ‚ö†Ô∏è <strong>Critical Gotcha:</strong> The <code>storage</code> event fires in <em>other</em> tabs ‚Äî NOT in the tab that made the change! This is by design for cross-tab communication.
        </div>

        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// ‚úÖ Listen for storage changes from OTHER tabs</span>
window.<span class="fn">addEventListener</span>(<span class="str">'storage'</span>, (event) => {
  console.<span class="fn">log</span>(<span class="str">'Storage changed!'</span>);
  
  <span class="cmt">// The event object has these properties:</span>
  event.<span class="prop">key</span>        <span class="cmt">// Which key changed (null if clear() was called)</span>
  event.<span class="prop">oldValue</span>   <span class="cmt">// Previous value (null if key was new)</span>
  event.<span class="prop">newValue</span>   <span class="cmt">// New value (null if key was removed)</span>
  event.<span class="prop">url</span>        <span class="cmt">// URL of the page that changed storage</span>
  event.<span class="prop">storageArea</span> <span class="cmt">// Reference to localStorage or sessionStorage</span>
});

<span class="cmt">// ‚úÖ Real-world: Sync auth state across tabs</span>
window.<span class="fn">addEventListener</span>(<span class="str">'storage'</span>, (event) => {
  <span class="kw">if</span> (event.<span class="prop">key</span> === <span class="str">'authToken'</span>) {
    <span class="kw">if</span> (event.<span class="prop">newValue</span> === <span class="kw">null</span>) {
      <span class="cmt">// User logged out in another tab</span>
      <span class="fn">handleLogout</span>();
    } <span class="kw">else</span> {
      <span class="cmt">// User logged in from another tab</span>
      <span class="fn">handleLogin</span>(event.<span class="prop">newValue</span>);
    }
  }
});

<span class="cmt">// ‚úÖ Sync theme across tabs</span>
window.<span class="fn">addEventListener</span>(<span class="str">'storage'</span>, (event) => {
  <span class="kw">if</span> (event.<span class="prop">key</span> === <span class="str">'theme'</span> && event.<span class="prop">newValue</span>) {
    document.<span class="prop">body</span>.<span class="prop">dataset</span>.<span class="prop">theme</span> = event.<span class="prop">newValue</span>;
  }
});</pre>
        </div>
      </div>

      <!-- Event Visualizer -->
      <div class="card">
        <h3>üéÆ Storage Event Simulator</h3>
        <p>This simulates what happens in <em>another tab</em> when storage changes. Trigger actions below and watch the event log!</p>

        <div class="event-visualizer">
          <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap">
            <button class="btn btn-primary btn-sm" onclick="simulateStorageSet()">üìù Set Item</button>
            <button class="btn btn-warning btn-sm" onclick="simulateStorageUpdate()">‚úèÔ∏è Update Item</button>
            <button class="btn btn-danger btn-sm" onclick="simulateStorageRemove()">üóë Remove Item</button>
            <button class="btn btn-secondary btn-sm" onclick="clearEventLog()">üßπ Clear Log</button>
          </div>
          <div style="font-size:0.75rem;color:var(--text-dim);margin-bottom:8px">üìã Event Log (simulated ‚Äî real events fire in other tabs):</div>
          <div class="event-log" id="eventLog">
            <div class="event-entry" style="color:var(--text-dim)">Waiting for storage events...</div>
          </div>
        </div>
      </div>

      <!-- BroadcastChannel alternative -->
      <div class="card">
        <h3>üì¢ Modern Alternative: BroadcastChannel</h3>
        <p>For same-tab communication or more flexible tab messaging, use the BroadcastChannel API:</p>
        <div class="code-block">
          <div class="code-label">JavaScript</div>
          <pre><span class="cmt">// ‚úÖ Works in SAME tab too, unlike storage events!</span>
<span class="kw">const</span> <span class="const">channel</span> = <span class="kw">new</span> <span class="fn">BroadcastChannel</span>(<span class="str">'app-sync'</span>);

<span class="cmt">// Send a message to all tabs</span>
channel.<span class="fn">postMessage</span>({ type: <span class="str">'THEME_CHANGED'</span>, theme: <span class="str">'dark'</span> });

<span class="cmt">// Receive messages in any tab</span>
channel.<span class="prop">onmessage</span> = (event) => {
  <span class="kw">const</span> { type, theme } = event.<span class="prop">data</span>;
  <span class="kw">if</span> (type === <span class="str">'THEME_CHANGED'</span>) {
    <span class="fn">applyTheme</span>(theme);
  }
};

<span class="cmt">// Clean up when done</span>
channel.<span class="fn">close</span>();</pre>
        </div>
      </div>

      <!-- Event properties demo -->
      <div class="card">
        <h3>üìä StorageEvent Properties Breakdown</h3>
        <div style="display:grid;gap:12px">
          <div style="background:var(--code-bg);border-radius:8px;padding:16px;">
            <div style="display:grid;grid-template-columns:1fr 2fr;gap:12px;font-size:0.85rem">
              <div>
                <div style="color:var(--primary);font-weight:700;font-family:monospace;margin-bottom:4px">event.key</div>
                <div style="color:var(--text-dim)">The key that changed</div>
              </div>
              <div id="ev-prop-key" style="color:var(--success);font-family:monospace;background:var(--darker);padding:8px;border-radius:4px">‚Äî waiting ‚Äî</div>
              
              <div>
                <div style="color:var(--primary);font-weight:700;font-family:monospace;margin-bottom:4px">event.oldValue</div>
                <div style="color:var(--text-dim)">Previous value</div>
              </div>
              <div id="ev-prop-old" style="color:var(--warning);font-family:monospace;background:var(--darker);padding:8px;border-radius:4px">‚Äî waiting ‚Äî</div>
              
              <div>
                <div style="color:var(--primary);font-weight:700;font-family:monospace;margin-bottom:4px">event.newValue</div>
                <div style="color:var(--text-dim)">New value</div>
              </div>
              <div id="ev-prop-new" style="color:var(--success);font-family:monospace;background:var(--darker);padding:8px;border-radius:4px">‚Äî waiting ‚Äî</div>
              
              <div>
                <div style="color:var(--primary);font-weight:700;font-family:monospace;margin-bottom:4px">event.url</div>
                <div style="color:var(--text-dim)">Page that changed storage</div>
              </div>
              <div id="ev-prop-url" style="color:var(--text-dim);font-family:monospace;background:var(--darker);padding:8px;border-radius:4px">‚Äî waiting ‚Äî</div>
            </div>
          </div>
        </div>
        <button class="btn btn-primary btn-sm" style="margin-top:12px" onclick="simulateStorageSet(); updateEventProps()">Simulate Event ‚Üí See Properties</button>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('explorer')">‚Üê Storage Explorer</button>
        <button class="btn btn-primary" onclick="showSection('pitfalls')">Next: Pitfalls ‚Üí</button>
      </div>
    </section>

    <!-- ==================== PITFALLS ==================== -->
    <section class="section" id="section-pitfalls">
      <h1 class="section-title">‚ö†Ô∏è Pitfalls & Mistakes</h1>
      <p class="section-subtitle">
        These are the mistakes that trip up developers in job interviews and production apps. 
        Learn them now, avoid them forever.
      </p>

      <!-- Pitfall 1 -->
      <div class="pitfall-card">
        <div class="pitfall-header">
          <div class="pitfall-icon">üî¢</div>
          <div class="pitfall-title">Pitfall #1: Everything is a String</div>
          <div class="pitfall-severity severity-high">High</div>
        </div>
        <div class="bad-good">
          <div>
            <div class="bg-label bad">‚ùå Wrong</div>
            <div class="code-block">
              <pre><span class="cmt">// Storing a number</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'count'</span>, <span class="num">5</span>);
<span class="kw">const</span> <span class="const">count</span> = localStorage.<span class="fn">getItem</span>(<span class="str">'count'</span>);
count + <span class="num">1</span>; <span class="cmt">// "51" not 6! ‚ùå</span>

<span class="cmt">// Storing a boolean</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'isAdmin'</span>, <span class="kw">false</span>);
<span class="kw">if</span> (localStorage.<span class="fn">getItem</span>(<span class="str">'isAdmin'</span>)) {
  <span class="cmt">// This RUNS! "false" is truthy ‚ùå</span>
}</pre>
            </div>
          </div>
          <div>
            <div class="bg-label good">‚úÖ Correct</div>
            <div class="code-block">
              <pre><span class="cmt">// Numbers: parse back</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'count'</span>, <span class="num">5</span>);
<span class="kw">const</span> <span class="const">count</span> = <span class="fn">Number</span>(
  localStorage.<span class="fn">getItem</span>(<span class="str">'count'</span>)
);
count + <span class="num">1</span>; <span class="cmt">// 6 ‚úÖ</span>

<span class="cmt">// Booleans: use JSON</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'isAdmin'</span>, 
  JSON.<span class="fn">stringify</span>(<span class="kw">false</span>));
<span class="kw">const</span> <span class="const">isAdmin</span> = JSON.<span class="fn">parse</span>(
  localStorage.<span class="fn">getItem</span>(<span class="str">'isAdmin'</span>)
);
<span class="kw">if</span> (isAdmin) { <span class="cmt">// false = skipped ‚úÖ</span> }</pre>
            </div>
          </div>
        </div>
        <button class="btn btn-warning btn-sm" onclick="demoPitfall1()">Run Pitfall Demo</button>
        <div class="exercise-output" id="pitfall1-output" style="margin-top:10px"></div>
      </div>

      <!-- Pitfall 2 -->
      <div class="pitfall-card">
        <div class="pitfall-header">
          <div class="pitfall-icon">üí•</div>
          <div class="pitfall-title">Pitfall #2: JSON.parse Without Try/Catch</div>
          <div class="pitfall-severity severity-high">High</div>
        </div>
        <div class="bad-good">
          <div>
            <div class="bg-label bad">‚ùå Wrong</div>
            <div class="code-block">
              <pre><span class="cmt">// If value is corrupted, this THROWS</span>
<span class="kw">const</span> <span class="const">user</span> = JSON.<span class="fn">parse</span>(
  localStorage.<span class="fn">getItem</span>(<span class="str">'user'</span>)
);
<span class="cmt">// SyntaxError: Unexpected token ‚ùå</span>
<span class="cmt">// Crashes your entire app!</span></pre>
            </div>
          </div>
          <div>
            <div class="bg-label good">‚úÖ Correct</div>
            <div class="code-block">
              <pre><span class="cmt">// ‚úÖ Always wrap in try/catch</span>
<span class="kw">function</span> <span class="fn">safeGetJSON</span>(key, fallback = <span class="kw">null</span>) {
  <span class="kw">try</span> {
    <span class="kw">const</span> <span class="const">item</span> = localStorage.<span class="fn">getItem</span>(key);
    <span class="kw">return</span> item ? JSON.<span class="fn">parse</span>(item) : fallback;
  } <span class="kw">catch</span> {
    localStorage.<span class="fn">removeItem</span>(key); <span class="cmt">// Clean up</span>
    <span class="kw">return</span> fallback;
  }
}</pre>
            </div>
          </div>
        </div>
      </div>

      <!-- Pitfall 3 -->
      <div class="pitfall-card">
        <div class="pitfall-header">
          <div class="pitfall-icon">üìè</div>
          <div class="pitfall-title">Pitfall #3: Storage Quota Exceeded</div>
          <div class="pitfall-severity severity-high">High</div>
        </div>
        <div class="bad-good">
          <div>
            <div class="bg-label bad">‚ùå Wrong</div>
            <div class="code-block">
              <pre><span class="cmt">// This can THROW QuotaExceededError</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'bigData'</span>, hugeString);
<span class="cmt">// DOMException: QuotaExceededError ‚ùå</span>
<span class="cmt">// No try/catch = app breaks!</span></pre>
            </div>
          </div>
          <div>
            <div class="bg-label good">‚úÖ Correct</div>
            <div class="code-block">
              <pre><span class="kw">function</span> <span class="fn">safeSetItem</span>(key, value) {
  <span class="kw">try</span> {
    localStorage.<span class="fn">setItem</span>(key, value);
    <span class="kw">return</span> <span class="kw">true</span>;
  } <span class="kw">catch</span> (error) {
    <span class="kw">if</span> (error.<span class="prop">name</span> === <span class="str">'QuotaExceededError'</span>) {
      console.<span class="fn">warn</span>(<span class="str">'Storage full!'</span>);
      <span class="fn">evictOldData</span>(); <span class="cmt">// LRU eviction</span>
    }
    <span class="kw">return</span> <span class="kw">false</span>;
  }
}</pre>
            </div>
          </div>
        </div>
      </div>

      <!-- Pitfall 4 -->
      <div class="pitfall-card">
        <div class="pitfall-header">
          <div class="pitfall-icon">üîí</div>
          <div class="pitfall-title">Pitfall #4: Storing Sensitive Data</div>
          <div class="pitfall-severity severity-high">High</div>
        </div>
        <div class="danger-box">
          ‚õî <strong>Never store passwords, payment info, or truly sensitive data in storage!</strong> 
          Storage is accessible via JavaScript ‚Äî meaning XSS attacks can steal it. Always use HttpOnly cookies for auth tokens when possible.
        </div>
        <div class="bad-good">
          <div>
            <div class="bg-label bad">‚ùå Never Do This</div>
            <div class="code-block">
              <pre><span class="cmt">// üö® DANGER: XSS can steal these!</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'password'</span>, userPass);
localStorage.<span class="fn">setItem</span>(<span class="str">'creditCard'</span>, cardNum);
localStorage.<span class="fn">setItem</span>(<span class="str">'ssn'</span>, socialSecNum);

<span class="cmt">// Even this is risky for sensitive apps:</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'authToken'</span>, jwtToken);</pre>
            </div>
          </div>
          <div>
            <div class="bg-label good">‚úÖ Better Approach</div>
            <div class="code-block">
              <pre><span class="cmt">// Use HttpOnly cookies for auth tokens</span>
<span class="cmt">// (Server sets these, JS can't read them)</span>

<span class="cmt">// OK for non-sensitive preferences:</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'theme'</span>, <span class="str">'dark'</span>);
localStorage.<span class="fn">setItem</span>(<span class="str">'language'</span>, <span class="str">'en'</span>);
localStorage.<span class="fn">setItem</span>(<span class="str">'fontSize'</span>, <span class="str">'16px'</span>);

<span class="cmt">// If you MUST store JWT, understand the risk</span>
<span class="cmt">// and implement proper XSS prevention</span></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- Pitfall 5 -->
      <div class="pitfall-card">
        <div class="pitfall-header">
          <div class="pitfall-icon">üö´</div>
          <div class="pitfall-title">Pitfall #5: Storage May Not Be Available</div>
          <div class="pitfall-severity severity-med">Medium</div>
        </div>
        <div class="bad-good">
          <div>
            <div class="bg-label bad">‚ùå Assumes Available</div>
            <div class="code-block">
              <pre><span class="cmt">// Breaks in private mode or if blocked</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'key'</span>, <span class="str">'val'</span>);
<span class="cmt">// SecurityError in some browsers! ‚ùå</span></pre>
            </div>
          </div>
          <div>
            <div class="bg-label good">‚úÖ Feature Detection</div>
            <div class="code-block">
              <pre><span class="kw">function</span> <span class="fn">isStorageAvailable</span>(type) {
  <span class="kw">try</span> {
    <span class="kw">const</span> <span class="const">storage</span> = window[type];
    <span class="kw">const</span> <span class="const">test</span> = <span class="str">'__test__'</span>;
    storage.<span class="fn">setItem</span>(test, test);
    storage.<span class="fn">removeItem</span>(test);
    <span class="kw">return</span> <span class="kw">true</span>;
  } <span class="kw">catch</span> { <span class="kw">return</span> <span class="kw">false</span>; }
}

<span class="kw">if</span> (<span class="fn">isStorageAvailable</span>(<span class="str">'localStorage'</span>)) {
  <span class="cmt">// Safe to use!</span>
}</pre>
            </div>
          </div>
        </div>
      </div>

      <!-- Pitfall 6 -->
      <div class="pitfall-card">
        <div class="pitfall-header">
          <div class="pitfall-icon">üì¶</div>
          <div class="pitfall-title">Pitfall #6: Storing Objects Without JSON.stringify</div>
          <div class="pitfall-severity severity-high">High</div>
        </div>
        <div class="bad-good">
          <div>
            <div class="bg-label bad">‚ùå Wrong</div>
            <div class="code-block">
              <pre><span class="kw">const</span> <span class="const">cart</span> = [{ id: <span class="num">1</span>, qty: <span class="num">2</span> }];
localStorage.<span class="fn">setItem</span>(<span class="str">'cart'</span>, cart);
<span class="cmt">// Stored as: "[object Object]" ‚ùå</span>

<span class="kw">const</span> <span class="const">retrieved</span> = localStorage.<span class="fn">getItem</span>(<span class="str">'cart'</span>);
<span class="cmt">// retrieved = "[object Object]" ‚Äî useless!</span></pre>
            </div>
          </div>
          <div>
            <div class="bg-label good">‚úÖ Correct</div>
            <div class="code-block">
              <pre><span class="kw">const</span> <span class="const">cart</span> = [{ id: <span class="num">1</span>, qty: <span class="num">2</span> }];
localStorage.<span class="fn">setItem</span>(<span class="str">'cart'</span>, 
  JSON.<span class="fn">stringify</span>(cart));
<span class="cmt">// Stored: '[{"id":1,"qty":2}]' ‚úÖ</span>

<span class="kw">const</span> <span class="const">retrieved</span> = JSON.<span class="fn">parse</span>(
  localStorage.<span class="fn">getItem</span>(<span class="str">'cart'</span>) || <span class="str">'[]'</span>
);
<span class="cmt">// [{id: 1, qty: 2}] ‚úÖ</span></pre>
            </div>
          </div>
        </div>
        <button class="btn btn-warning btn-sm" onclick="demoPitfall6()">See the Difference</button>
        <div class="exercise-output" id="pitfall6-output" style="margin-top:10px"></div>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('events')">‚Üê Storage Events</button>
        <button class="btn btn-primary" onclick="showSection('practices')">Next: Best Practices ‚Üí</button>
      </div>
    </section>

    <!-- ==================== BEST PRACTICES ==================== -->
    <section class="section" id="section-practices">
      <h1 class="section-title">‚úÖ Best Practices</h1>
      <p class="section-subtitle">
        Write production-quality storage code from day one. These patterns are used at top tech companies.
      </p>

      <!-- Storage Manager Pattern -->
      <div class="card">
        <h3>üèóÔ∏è Pattern 1: Build a Storage Manager Utility</h3>
        <p>Instead of calling localStorage directly everywhere, wrap it in a clean utility class:</p>
        <div class="code-block">
          <div class="code-label">JavaScript ‚Äî Production Pattern</div>
          <pre><span class="kw">class</span> <span class="fn">StorageManager</span> {
  <span class="fn">constructor</span>(prefix = <span class="str">'app'</span>, storage = localStorage) {
    <span class="kw">this</span>.<span class="prop">prefix</span> = prefix;
    <span class="kw">this</span>.<span class="prop">storage</span> = storage;
  }

  <span class="cmt">// Create namespaced key</span>
  <span class="fn">#key</span>(key) {
    <span class="kw">return</span> `${<span class="kw">this</span>.<span class="prop">prefix</span>}:${key}`;
  }

  <span class="fn">set</span>(key, value, expiresInMs = <span class="kw">null</span>) {
    <span class="kw">const</span> <span class="const">payload</span> = {
      value,
      timestamp: Date.<span class="fn">now</span>(),
      expires: expiresInMs ? Date.<span class="fn">now</span>() + expiresInMs : <span class="kw">null</span>
    };
    <span class="kw">try</span> {
      <span class="kw">this</span>.<span class="prop">storage</span>.<span class="fn">setItem</span>(<span class="kw">this</span>.<span class="fn">#key</span>(key), JSON.<span class="fn">stringify</span>(payload));
      <span class="kw">return</span> <span class="kw">true</span>;
    } <span class="kw">catch</span> { <span class="kw">return</span> <span class="kw">false</span>; }
  }

  <span class="fn">get</span>(key, fallback = <span class="kw">null</span>) {
    <span class="kw">try</span> {
      <span class="kw">const</span> <span class="const">raw</span> = <span class="kw">this</span>.<span class="prop">storage</span>.<span class="fn">getItem</span>(<span class="kw">this</span>.<span class="fn">#key</span>(key));
      <span class="kw">if</span> (!raw) <span class="kw">return</span> fallback;
      <span class="kw">const</span> <span class="const">parsed</span> = JSON.<span class="fn">parse</span>(raw);
      <span class="cmt">// Check expiry</span>
      <span class="kw">if</span> (parsed.expires && Date.<span class="fn">now</span>() > parsed.expires) {
        <span class="kw">this</span>.<span class="fn">remove</span>(key);
        <span class="kw">return</span> fallback;
      }
      <span class="kw">return</span> parsed.value;
    } <span class="kw">catch</span> { <span class="kw">return</span> fallback; }
  }

  <span class="fn">remove</span>(key) { <span class="kw">this</span>.<span class="prop">storage</span>.<span class="fn">removeItem</span>(<span class="kw">this</span>.<span class="fn">#key</span>(key)); }

  <span class="fn">clearAll</span>() {
    Object.<span class="fn">keys</span>(<span class="kw">this</span>.<span class="prop">storage</span>)
      .<span class="fn">filter</span>(k => k.<span class="fn">startsWith</span>(`${<span class="kw">this</span>.<span class="prop">prefix</span>}:`))
      .<span class="fn">forEach</span>(k => <span class="kw">this</span>.<span class="prop">storage</span>.<span class="fn">removeItem</span>(k));
  }
}

<span class="cmt">// Usage:</span>
<span class="kw">const</span> <span class="const">store</span> = <span class="kw">new</span> <span class="fn">StorageManager</span>(<span class="str">'myApp'</span>);
store.<span class="fn">set</span>(<span class="str">'theme'</span>, <span class="str">'dark'</span>);
store.<span class="fn">set</span>(<span class="str">'cache'</span>, data, <span class="num">60</span> * <span class="num">60</span> * <span class="num">1000</span>); <span class="cmt">// 1 hour TTL</span>
store.<span class="fn">get</span>(<span class="str">'theme'</span>, <span class="str">'light'</span>); <span class="cmt">// With default value</span></pre>
        </div>
        <button class="btn btn-success btn-sm" onclick="demoStorageManager()">Run StorageManager Demo</button>
        <div class="exercise-output" id="sm-output" style="margin-top:12px"></div>
      </div>

      <div class="practice-grid">
        <div class="practice-card do">
          <div class="practice-card-header">
            <span>‚úÖ</span><span class="do-label">DO: Namespace Your Keys</span>
          </div>
          <div class="code-block">
            <pre><span class="cmt">// Prefix to avoid collisions</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'myApp:theme'</span>, <span class="str">'dark'</span>);
localStorage.<span class="fn">setItem</span>(<span class="str">'myApp:user'</span>, data);</pre>
          </div>
        </div>

        <div class="practice-card dont">
          <div class="practice-card-header">
            <span>‚ùå</span><span class="dont-label">DON'T: Generic Key Names</span>
          </div>
          <div class="code-block">
            <pre><span class="cmt">// Conflicts with other scripts!</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'theme'</span>, <span class="str">'dark'</span>);
localStorage.<span class="fn">setItem</span>(<span class="str">'user'</span>, data);</pre>
          </div>
        </div>

        <div class="practice-card do">
          <div class="practice-card-header">
            <span>‚úÖ</span><span class="do-label">DO: Add Expiry Timestamps</span>
          </div>
          <div class="code-block">
            <pre><span class="kw">const</span> <span class="const">payload</span> = {
  value: data,
  exp: Date.<span class="fn">now</span>() + <span class="num">86400000</span>  <span class="cmt">// 24h</span>
};
localStorage.<span class="fn">setItem</span>(<span class="str">'cache'</span>, 
  JSON.<span class="fn">stringify</span>(payload));</pre>
          </div>
        </div>

        <div class="practice-card dont">
          <div class="practice-card-header">
            <span>‚ùå</span><span class="dont-label">DON'T: Store Stale Data Forever</span>
          </div>
          <div class="code-block">
            <pre><span class="cmt">// No expiry = stale cache forever</span>
localStorage.<span class="fn">setItem</span>(<span class="str">'apiCache'</span>, 
  JSON.<span class="fn">stringify</span>(apiResponse));
<span class="cmt">// Users see outdated data indefinitely!</span></pre>
          </div>
        </div>

        <div class="practice-card do">
          <div class="practice-card-header">
            <span>‚úÖ</span><span class="do-label">DO: Validate Data After Retrieval</span>
          </div>
          <div class="code-block">
            <pre><span class="kw">const</span> <span class="const">raw</span> = localStorage.<span class="fn">getItem</span>(<span class="str">'user'</span>);
<span class="kw">const</span> <span class="const">user</span> = raw ? JSON.<span class="fn">parse</span>(raw) : <span class="kw">null</span>;
<span class="kw">if</span> (user?.id && user?.email) {
  <span class="cmt">// Use validated user</span>
}</pre>
          </div>
        </div>

        <div class="practice-card dont">
          <div class="practice-card-header">
            <span>‚ùå</span><span class="dont-label">DON'T: Trust Storage Blindly</span>
          </div>
          <div class="code-block">
            <pre><span class="cmt">// Storage can be tampered with!</span>
<span class="kw">const</span> <span class="const">user</span> = JSON.<span class="fn">parse</span>(
  localStorage.<span class="fn">getItem</span>(<span class="str">'user'</span>)
);
user.<span class="prop">role</span>; <span class="cmt">// Could be "admin"!</span></pre>
          </div>
        </div>
      </div>

      <!-- React/Framework usage -->
      <div class="card">
        <h3>‚öõÔ∏è Custom Hook Pattern (React)</h3>
        <div class="code-block">
          <div class="code-label">React JavaScript</div>
          <pre><span class="cmt">// ‚úÖ Custom hook for localStorage with React state sync</span>
<span class="kw">function</span> <span class="fn">useLocalStorage</span>(key, initialValue) {
  <span class="kw">const</span> [storedValue, setStoredValue] = useState(() => {
    <span class="kw">try</span> {
      <span class="kw">const</span> <span class="const">item</span> = localStorage.<span class="fn">getItem</span>(key);
      <span class="kw">return</span> item ? JSON.<span class="fn">parse</span>(item) : initialValue;
    } <span class="kw">catch</span> { <span class="kw">return</span> initialValue; }
  });

  <span class="kw">const</span> <span class="fn">setValue</span> = (value) => {
    <span class="kw">try</span> {
      <span class="kw">const</span> <span class="const">valueToStore</span> = value <span class="kw">instanceof</span> Function 
        ? value(storedValue) : value;
      setStoredValue(valueToStore);
      localStorage.<span class="fn">setItem</span>(key, JSON.<span class="fn">stringify</span>(valueToStore));
    } <span class="kw">catch</span> (error) { console.<span class="fn">error</span>(error); }
  };

  <span class="kw">return</span> [storedValue, setValue];
}

<span class="cmt">// Usage:</span>
<span class="kw">const</span> [theme, setTheme] = <span class="fn">useLocalStorage</span>(<span class="str">'theme'</span>, <span class="str">'dark'</span>);</pre>
        </div>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('pitfalls')">‚Üê Pitfalls</button>
        <button class="btn btn-primary" onclick="showSection('realworld')">Next: Real World Demo ‚Üí</button>
      </div>
    </section>

    <!-- ==================== REAL WORLD ==================== -->
    <section class="section" id="section-realworld">
      <h1 class="section-title">üåç Real World Demo</h1>
      <p class="section-subtitle">
        A fully functional mini-app demonstrating localStorage and sessionStorage working together in practice.
        Everything here actually persists in your browser!
      </p>

      <!-- User Preferences App -->
      <div class="demo-app">
        <div class="demo-app-header">
          <div>
            <div class="demo-app-title">‚öôÔ∏è User Preferences Panel</div>
            <div class="demo-app-subtitle">Powered by localStorage ‚Äî persists across page reloads</div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-danger btn-sm" onclick="resetPreferences()">Reset All</button>
          </div>
        </div>
        <div class="demo-app-body">
          <!-- Theme -->
          <h4 style="margin-bottom:12px">üé® Theme</h4>
          <div class="theme-switcher" id="themeSwitcher">
            <button class="theme-btn" onclick="setDemoTheme('dark')">üåô Dark</button>
            <button class="theme-btn" onclick="setDemoTheme('light')">‚òÄÔ∏è Light</button>
            <button class="theme-btn" onclick="setDemoTheme('ocean')">üåä Ocean</button>
            <button class="theme-btn" onclick="setDemoTheme('forest')">üå≤ Forest</button>
          </div>

          <hr class="divider">

          <!-- Profile -->
          <h4 style="margin-bottom:12px">üë§ User Profile</h4>
          <div class="user-profile-form">
            <div class="form-group">
              <label>Display Name</label>
              <input class="inp" id="pref-name" placeholder="Your name" oninput="savePreference('name', this.value)">
            </div>
            <div class="form-group">
              <label>Job Title</label>
              <input class="inp" id="pref-title" placeholder="Frontend Dev" oninput="savePreference('jobTitle', this.value)">
            </div>
          </div>

          <hr class="divider">

          <!-- Toggles -->
          <h4 style="margin-bottom:12px">‚ö° Features</h4>
          <div class="pref-row">
            <div>
              <div class="pref-label">üîî Notifications</div>
              <div class="pref-desc">Enable browser notifications</div>
            </div>
            <label class="toggle">
              <input type="checkbox" id="pref-notifs" onchange="savePreference('notifications', this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="pref-row">
            <div>
              <div class="pref-label">üéµ Sound Effects</div>
              <div class="pref-desc">Play UI interaction sounds</div>
            </div>
            <label class="toggle">
              <input type="checkbox" id="pref-sounds" onchange="savePreference('sounds', this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="pref-row">
            <div>
              <div class="pref-label">üìä Analytics</div>
              <div class="pref-desc">Help us improve (anonymous)</div>
            </div>
            <label class="toggle">
              <input type="checkbox" id="pref-analytics" onchange="savePreference('analytics', this.checked)" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="pref-row">
            <div>
              <div class="pref-label">üåê Auto-translate</div>
              <div class="pref-desc">Translate content automatically</div>
            </div>
            <label class="toggle">
              <input type="checkbox" id="pref-translate" onchange="savePreference('autoTranslate', this.checked)">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div style="margin-top:20px;padding:14px;background:var(--code-bg);border-radius:8px;">
            <div style="font-size:0.75rem;color:var(--text-dim);margin-bottom:8px;text-transform:uppercase;letter-spacing:1px">üíæ localStorage Live View</div>
            <div id="prefs-storage-view" style="font-family:monospace;font-size:0.82rem;color:var(--success);white-space:pre-wrap"></div>
          </div>
        </div>
      </div>

      <!-- Shopping Cart -->
      <div class="demo-app">
        <div class="demo-app-header" style="background: linear-gradient(135deg, var(--session-color), #E55570);">
          <div>
            <div class="demo-app-title">üõí Session Shopping Cart</div>
            <div class="demo-app-subtitle">Powered by sessionStorage ‚Äî clears when tab closes</div>
          </div>
          <div id="cart-badge" style="background:white;color:var(--session-color);border-radius:20px;padding:6px 16px;font-weight:800;font-size:0.9rem">0 items</div>
        </div>
        <div class="demo-app-body">
          <h4 style="margin-bottom:12px">üè™ Products</h4>
          <div class="card-grid" id="products-grid"></div>
          <div id="cart-section" style="display:none">
            <hr class="divider">
            <h4 style="margin-bottom:12px">üõçÔ∏è Your Cart</h4>
            <div id="cart-items"></div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:16px;padding-top:16px;border-top:1px solid var(--border)">
              <div style="font-size:1.1rem;font-weight:700">Total: <span id="cart-total" style="color:var(--success)">$0</span></div>
              <div style="display:flex;gap:10px">
                <button class="btn btn-danger btn-sm" onclick="clearCart()">Clear Cart</button>
                <button class="btn btn-success btn-sm" onclick="checkoutCart()">Checkout ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('practices')">‚Üê Best Practices</button>
        <button class="btn btn-primary" onclick="showSection('quiz')">Next: Quiz ‚Üí</button>
      </div>
    </section>

    <!-- ==================== QUIZ ==================== -->
    <section class="section" id="section-quiz">
      <h1 class="section-title">üß† Knowledge Quiz</h1>
      <p class="section-subtitle">Test your browser storage knowledge! 10 questions covering all concepts.</p>

      <div class="quiz-container">
        <!-- Quiz in progress -->
        <div id="quiz-questions-area">
          <div class="quiz-progress-row">
            <span style="font-weight:600;font-size:0.9rem">Question <span id="q-current">1</span> of <span id="q-total">10</span></span>
            <div class="quiz-progress-dots" id="q-dots"></div>
            <span style="color:var(--success);font-weight:700" id="q-score-display">Score: 0</span>
          </div>

          <div id="q-container"></div>

          <div class="quiz-feedback" id="q-feedback"></div>

          <div class="quiz-nav">
            <button class="btn btn-secondary" id="q-next-btn" onclick="nextQuestion()" style="display:none">Next Question ‚Üí</button>
          </div>
        </div>

        <!-- Quiz Results -->
        <div class="quiz-results" id="quiz-results">
          <div class="score-circle" id="scoreCircle">
            <div class="score-num" id="final-score">0</div>
            <div class="score-total">/ 10</div>
          </div>
          <h3 id="results-title" style="margin-bottom:8px">Good job!</h3>
          <p id="results-msg" style="margin-bottom:24px"></p>
          <div id="results-breakdown" style="text-align:left;margin-bottom:24px"></div>
          <button class="btn btn-primary" onclick="resetQuiz()">üîÑ Retake Quiz</button>
        </div>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('realworld')">‚Üê Real World</button>
        <button class="btn btn-primary" onclick="showSection('exercises')">Next: Exercises ‚Üí</button>
      </div>
    </section>

    <!-- ==================== EXERCISES ==================== -->
    <section class="section" id="section-exercises">
      <h1 class="section-title">üí™ Coding Exercises</h1>
      <p class="section-subtitle">
        Hands-on practice! Write code in the editor and run it to see results.
      </p>

      <!-- Exercise 1 -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-num">1</div>
          <div class="exercise-title">Safe Storage Wrapper</div>
          <div class="exercise-difficulty diff-easy">Easy</div>
        </div>
        <div class="exercise-desc">
          Write a <code>storage.set(key, value)</code> function that safely stores any JavaScript value (including objects and arrays) in localStorage, and a <code>storage.get(key, defaultValue)</code> that safely retrieves it. Handle errors gracefully.
        </div>
        <div class="code-editor">
          <div class="editor-header">
            <div class="editor-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
            <div class="editor-label">exercise-1.js</div>
          </div>
          <textarea class="code-input" id="ex1-code" rows="12">const storage = {
  set(key, value) {
    // Your code here:
    // Use try/catch and JSON.stringify
    
  },
  
  get(key, defaultValue = null) {
    // Your code here:
    // Use try/catch and JSON.parse
    // Return defaultValue if key doesn't exist
    
  }
};

// Test your code:
storage.set('user', { name: 'Alice', age: 30 });
storage.set('score', 100);
storage.set('active', true);

const user = storage.get('user');
const score = storage.get('score');
const missing = storage.get('notExist', 'default!');</textarea>
        </div>
        <div class="exercise-output" id="ex1-output">Click "Run" to test your code.</div>
        <div class="ex-actions">
          <button class="btn btn-success btn-sm" onclick="runExercise1()">‚ñ∂ Run</button>
          <button class="btn btn-secondary btn-sm" onclick="showSolution1()">üí° Show Solution</button>
          <button class="btn btn-secondary btn-sm" onclick="resetExercise('ex1-code', ex1Starter)">‚Ü© Reset</button>
        </div>
      </div>

      <!-- Exercise 2 -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-num">2</div>
          <div class="exercise-title">Session-Based Visit Counter</div>
          <div class="exercise-difficulty diff-easy">Easy</div>
        </div>
        <div class="exercise-desc">
          Build a page visit counter using <strong>sessionStorage</strong>. Track how many times the page has been "visited" within this session and how many total visits using <strong>localStorage</strong>. Click "Run" to simulate a visit.
        </div>
        <div class="code-editor">
          <div class="editor-header">
            <div class="editor-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
            <div class="editor-label">exercise-2.js</div>
          </div>
          <textarea class="code-input" id="ex2-code" rows="14">function trackVisit() {
  // 1. Get current session visit count from sessionStorage
  //    Use 'sessionVisits' as the key
  
  // 2. Increment and save back to sessionStorage
  
  // 3. Get total all-time visits from localStorage
  //    Use 'totalVisits' as the key
  
  // 4. Increment and save to localStorage
  
  // 5. Return an object: { sessionVisits, totalVisits }
  
}

// Test:
const result = trackVisit();
return `Session visits: ${result.sessionVisits}, Total visits: ${result.totalVisits}`;</textarea>
        </div>
        <div class="exercise-output" id="ex2-output">Click "Run" to simulate a page visit!</div>
        <div class="ex-actions">
          <button class="btn btn-success btn-sm" onclick="runExercise2()">‚ñ∂ Run (Simulate Visit)</button>
          <button class="btn btn-secondary btn-sm" onclick="showSolution2()">üí° Show Solution</button>
          <button class="btn btn-danger btn-sm" onclick="clearVisitCounters()">üóë Reset Counters</button>
        </div>
      </div>

      <!-- Exercise 3 -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-num">3</div>
          <div class="exercise-title">Storage with TTL (Time-to-Live)</div>
          <div class="exercise-difficulty diff-med">Medium</div>
        </div>
        <div class="exercise-desc">
          Implement <code>setWithTTL(key, value, ttlMs)</code> that stores data with an expiry time, and <code>getWithTTL(key)</code> that returns null if the data has expired (and cleans it up). This is a common interview question!
        </div>
        <div class="code-editor">
          <div class="editor-header">
            <div class="editor-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
            <div class="editor-label">exercise-3.js</div>
          </div>
          <textarea class="code-input" id="ex3-code" rows="20">function setWithTTL(key, value, ttlMs) {
  // Store an object containing:
  // - The value
  // - An expiry timestamp (Date.now() + ttlMs)
  
}

function getWithTTL(key) {
  // 1. Get the stored JSON
  // 2. Parse it
  // 3. Check if Date.now() > expiry
  // 4. If expired: remove from storage, return null
  // 5. If valid: return the value
  
}

// Test:
setWithTTL('token', 'abc123', 2000); // 2 second TTL

const immediate = getWithTTL('token');

// Simulate waiting 3 seconds:
// (We'll test this in the runner)
return { immediate };</textarea>
        </div>
        <div class="exercise-output" id="ex3-output">Click "Run" to test your TTL implementation!</div>
        <div class="ex-actions">
          <button class="btn btn-success btn-sm" onclick="runExercise3()">‚ñ∂ Run</button>
          <button class="btn btn-warning btn-sm" onclick="testExpiry3()">‚è∞ Test Expiry (wait 2s)</button>
          <button class="btn btn-secondary btn-sm" onclick="showSolution3()">üí° Show Solution</button>
        </div>
      </div>

      <!-- Exercise 4 -->
      <div class="exercise-card">
        <div class="exercise-header">
          <div class="exercise-num">4</div>
          <div class="exercise-title">Todo List with Persistence</div>
          <div class="exercise-difficulty diff-hard">Hard</div>
        </div>
        <div class="exercise-desc">
          Build a mini todo app that saves to localStorage. Complete the functions: <code>addTodo</code>, <code>toggleTodo</code>, <code>deleteTodo</code>, and <code>getTodos</code>. Todos should survive page refresh!
        </div>
        <div class="code-editor">
          <div class="editor-header">
            <div class="editor-dots"><span class="red"></span><span class="yellow"></span><span class="green"></span></div>
            <div class="editor-label">exercise-4.js</div>
          </div>
          <textarea class="code-input" id="ex4-code" rows="22">const TODOS_KEY = 'learn:todos';

function getTodos() {
  // Get todos array from localStorage
  // Return empty array if nothing stored
  
}

function addTodo(text) {
  // Get existing todos
  // Add new todo: { id: Date.now(), text, completed: false }
  // Save back to localStorage
  
}

function toggleTodo(id) {
  // Find todo by id and flip its .completed value
  // Save back to localStorage
  
}

function deleteTodo(id) {
  // Filter out the todo with matching id
  // Save back to localStorage
  
}

// Test:
addTodo('Learn localStorage');
addTodo('Build a project');
addTodo('Get a job!');
toggleTodo(getTodos()[0].id); // Complete first item
return getTodos();</textarea>
        </div>
        <div class="exercise-output" id="ex4-output">Build your todo list!</div>
        <div class="ex-actions">
          <button class="btn btn-success btn-sm" onclick="runExercise4()">‚ñ∂ Run</button>
          <button class="btn btn-secondary btn-sm" onclick="showSolution4()">üí° Show Solution</button>
          <button class="btn btn-danger btn-sm" onclick="clearExercise4()">üóë Clear Todos</button>
        </div>
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('quiz')">‚Üê Quiz</button>
        <button class="btn btn-primary" onclick="showSection('cheatsheet')">Next: Cheat Sheet ‚Üí</button>
      </div>
    </section>

    <!-- ==================== CHEAT SHEET ==================== -->
    <section class="section" id="section-cheatsheet">
      <h1 class="section-title">üìã Cheat Sheet</h1>
      <p class="section-subtitle">Your quick reference guide ‚Äî bookmark this page!</p>

      <div class="cheatsheet-grid">
        <div class="cs-section">
          <div class="cs-title">üíæ localStorage Methods</div>
          <div class="cs-item"><span class="cs-method">localStorage.setItem(k, v)</span><span class="cs-desc">Store value</span></div>
          <div class="cs-item"><span class="cs-method">localStorage.getItem(k)</span><span class="cs-desc">Get value (or null)</span></div>
          <div class="cs-item"><span class="cs-method">localStorage.removeItem(k)</span><span class="cs-desc">Delete one item</span></div>
          <div class="cs-item"><span class="cs-method">localStorage.clear()</span><span class="cs-desc">Delete all items</span></div>
          <div class="cs-item"><span class="cs-method">localStorage.length</span><span class="cs-desc">Number of items</span></div>
          <div class="cs-item"><span class="cs-method">localStorage.key(i)</span><span class="cs-desc">Key at index</span></div>
        </div>

        <div class="cs-section">
          <div class="cs-title">üóìÔ∏è sessionStorage Methods</div>
          <div class="cs-item"><span class="cs-method">sessionStorage.setItem(k, v)</span><span class="cs-desc">Store value</span></div>
          <div class="cs-item"><span class="cs-method">sessionStorage.getItem(k)</span><span class="cs-desc">Get value (or null)</span></div>
          <div class="cs-item"><span class="cs-method">sessionStorage.removeItem(k)</span><span class="cs-desc">Delete one item</span></div>
          <div class="cs-item"><span class="cs-method">sessionStorage.clear()</span><span class="cs-desc">Delete all items</span></div>
          <div class="cs-item"><span class="cs-method">sessionStorage.length</span><span class="cs-desc">Number of items</span></div>
          <div class="cs-item"><span class="cs-method">sessionStorage.key(i)</span><span class="cs-desc">Key at index</span></div>
        </div>

        <div class="cs-section">
          <div class="cs-title">‚úÖ Essential Patterns</div>
          <div class="cs-item"><span class="cs-method">JSON.stringify(obj)</span><span class="cs-desc">Before setItem</span></div>
          <div class="cs-item"><span class="cs-method">JSON.parse(str)</span><span class="cs-desc">After getItem</span></div>
          <div class="cs-item"><span class="cs-method">item ?? defaultVal</span><span class="cs-desc">Null coalescing</span></div>
          <div class="cs-item"><span class="cs-method">try { } catch { }</span><span class="cs-desc">Always wrap!</span></div>
          <div class="cs-item"><span class="cs-method">Object.keys(localStorage)</span><span class="cs-desc">All keys array</span></div>
          <div class="cs-item"><span class="cs-method">Number(getItem(k))</span><span class="cs-desc">Parse number back</span></div>
        </div>

        <div class="cs-section">
          <div class="cs-title">üì° Storage Event Properties</div>
          <div class="cs-item"><span class="cs-method">event.key</span><span class="cs-desc">Changed key</span></div>
          <div class="cs-item"><span class="cs-method">event.oldValue</span><span class="cs-desc">Previous value</span></div>
          <div class="cs-item"><span class="cs-method">event.newValue</span><span class="cs-desc">New value</span></div>
          <div class="cs-item"><span class="cs-method">event.url</span><span class="cs-desc">Origin URL</span></div>
          <div class="cs-item"><span class="cs-method">event.storageArea</span><span class="cs-desc">Which storage</span></div>
          <div class="cs-item"><span class="cs-method">window.addEventListener('storage', fn)</span><span class="cs-desc">Listen for changes</span></div>
        </div>
      </div>

      <!-- Quick Reference Card -->
      <div class="card">
        <h3>üéØ Decision Tree: Which Storage to Use?</h3>
        <div class="code-block">
          <pre style="line-height:2">Is the data sensitive (passwords, PII)? ‚Üí Use <span style="color:var(--danger)">Server-side / HttpOnly Cookies</span>
‚Üì No
Should data persist after browser restart? ‚Üí Yes ‚Üí Use <span style="color:var(--local-color)">localStorage</span>
‚Üì No  
Should data be shared across multiple tabs? ‚Üí Yes ‚Üí Use <span style="color:var(--local-color)">localStorage</span>
‚Üì No
Data only needed for current tab/session? ‚Üí Use <span style="color:var(--session-color)">sessionStorage</span>
‚Üì No
Need cross-device sync? ‚Üí Use <span style="color:var(--success)">Server Database / Cloud</span></pre>
        </div>
      </div>

      <!-- Common Mistakes Quick Ref -->
      <div class="card">
        <h3>‚ö†Ô∏è Most Common Mistakes ‚Äî Quick Reference</h3>
        <div style="display:grid;gap:10px">
          <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:center;padding:12px;background:var(--code-bg);border-radius:8px">
            <div style="font-size:1.5rem">1Ô∏è‚É£</div>
            <div>
              <div style="font-weight:700;margin-bottom:4px">Strings only ‚Äî always JSON.stringify/parse objects</div>
              <code style="font-size:0.8rem;color:var(--text-dim)">localStorage.setItem('key', JSON.stringify(obj))</code>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:center;padding:12px;background:var(--code-bg);border-radius:8px">
            <div style="font-size:1.5rem">2Ô∏è‚É£</div>
            <div>
              <div style="font-weight:700;margin-bottom:4px">Always wrap in try/catch ‚Äî quota errors happen</div>
              <code style="font-size:0.8rem;color:var(--text-dim)">try { localStorage.setItem(k, v) } catch { }</code>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:center;padding:12px;background:var(--code-bg);border-radius:8px">
            <div style="font-size:1.5rem">3Ô∏è‚É£</div>
            <div>
              <div style="font-weight:700;margin-bottom:4px">Check for null ‚Äî getItem returns null, not undefined</div>
              <code style="font-size:0.8rem;color:var(--text-dim)">const val = getItem('k') ?? 'default'</code>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:center;padding:12px;background:var(--code-bg);border-radius:8px">
            <div style="font-size:1.5rem">4Ô∏è‚É£</div>
            <div>
              <div style="font-weight:700;margin-bottom:4px">storage events don't fire in the same tab</div>
              <code style="font-size:0.8rem;color:var(--text-dim)">window.addEventListener('storage', fn) // other tabs only</code>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:auto 1fr;gap:16px;align-items:center;padding:12px;background:var(--code-bg);border-radius:8px">
            <div style="font-size:1.5rem">5Ô∏è‚É£</div>
            <div>
              <div style="font-weight:700;margin-bottom:4px">Namespace your keys to avoid conflicts</div>
              <code style="font-size:0.8rem;color:var(--text-dim)">localStorage.setItem('myApp:theme', 'dark')</code>
            </div>
          </div>
        </div>
      </div>

      <div class="success-box">
        üéâ <strong>You've completed the Browser Storage module!</strong> You now understand localStorage, sessionStorage, storage events, pitfalls, and best practices. Practice the exercises and you'll be ready for any interview question on this topic!
      </div>

      <div class="flex-row">
        <button class="btn btn-secondary" onclick="showSection('exercises')">‚Üê Exercises</button>
        <button class="btn btn-primary" onclick="showSection('overview')">üîÑ Start Over</button>
      </div>
    </section>

  </main>
</div>

<script>
// ================================================================
// APP STATE
// ================================================================
const visitedSections = new Set(['overview']);
const totalSections = 11;

// ================================================================
// NAVIGATION
// ================================================================
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

  const section = document.getElementById(`section-${id}`);
  const navItem = document.querySelector(`[data-section="${id}"]`);
  
  if (section) {
    section.classList.add('active');
    visitedSections.add(id);
    updateProgress();
  }
  if (navItem) navItem.classList.add('active');

  // Init section-specific stuff
  if (id === 'explorer') { renderExplorer(); updateQuota(); }
  if (id === 'quiz') initQuiz();
  if (id === 'realworld') { loadPreferences(); initProducts(); loadCart(); }
  if (id === 'session') initWizard();

  // Close mobile sidebar
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
  window.scrollTo(0, 0);
}

function updateProgress() {
  const pct = Math.round((visitedSections.size / totalSections) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = pct + '%';
  
  visitedSections.forEach(id => {
    const item = document.querySelector(`[data-section="${id}"]`);
    if (item) item.classList.add('completed');
  });
}

// Mobile
document.getElementById('mobileToggle').onclick = () => {
  document.getElementById('sidebar').classList.toggle('open');
  document.getElementById('sidebarOverlay').classList.toggle('open');
};
document.getElementById('sidebarOverlay').onclick = () => {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('open');
};

// ================================================================
// TOAST SYSTEM
// ================================================================
function toast(msg, type = 'info') {
  const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è' };
  const container = document.getElementById('toastContainer');
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${icons[type]}</span><span>${msg}</span>`;
  container.appendChild(el);
  setTimeout(() => {
    el.style.animation = 'toastOut 0.3s ease forwards';
    setTimeout(() => el.remove(), 300);
  }, 3000);
}

// ================================================================
// LOCAL STORAGE DEMOS
// ================================================================
function demoSetItem() {
  const key = document.getElementById('ls-key-input').value.trim();
  const val = document.getElementById('ls-val-input').value.trim();
  if (!key) { toast('Enter a key!', 'warning'); return; }
  
  try {
    localStorage.setItem(key, val);
    const out = document.getElementById('setitem-output');
    out.className = 'exercise-output success-output';
    out.textContent = `‚úÖ Stored! localStorage["${key}"] = "${val}"\nType stored: ${typeof localStorage.getItem(key)} (always string!)`;
    toast(`Stored "${key}"`, 'success');
  } catch(e) {
    document.getElementById('setitem-output').textContent = `‚ùå Error: ${e.message}`;
  }
}

function demoGetItem() {
  const key = document.getElementById('ls-get-input').value.trim();
  const val = localStorage.getItem(key);
  const out = document.getElementById('getitem-output');
  
  if (val === null) {
    out.className = 'exercise-output error-output';
    out.textContent = `‚ö†Ô∏è localStorage.getItem("${key}") returned null\n‚Üí Key doesn't exist! (returns null, NOT undefined)`;
  } else {
    out.className = 'exercise-output success-output';
    out.textContent = `‚úÖ localStorage.getItem("${key}") = "${val}"\nType: ${typeof val}`;
  }
}

function demoRemoveItem() {
  const key = document.getElementById('ls-remove-input').value.trim();
  localStorage.removeItem(key);
  const out = document.getElementById('remove-output');
  out.className = 'exercise-output success-output';
  out.textContent = `‚úÖ removeItem("${key}") called.\n(If key didn't exist, nothing happens ‚Äî no error!)`;
  toast('Item removed', 'info');
}

function demoClear() {
  if (confirm('This will clear ALL localStorage items for this page! Continue?')) {
    localStorage.clear();
    document.getElementById('remove-output').className = 'exercise-output success-output';
    document.getElementById('remove-output').textContent = `‚úÖ localStorage.clear() called. All items removed!`;
    toast('All localStorage cleared!', 'warning');
  }
}

function demoIterateLS() {
  const out = document.getElementById('iterate-output');
  const keys = Object.keys(localStorage);
  
  if (keys.length === 0) {
    out.className = 'exercise-output';
    out.textContent = 'localStorage is empty! Set some items first using the setItem demo above.';
    return;
  }
  
  let result = `üì¶ Found ${keys.length} item(s) in localStorage:\n\n`;
  keys.forEach((key, i) => {
    const val = localStorage.getItem(key);
    result += `[${i}] "${key}" ‚Üí "${val.substring(0, 50)}${val.length > 50 ? '...' : ''}"\n`;
  });
  
  out.className = 'exercise-output success-output';
  out.textContent = result;
}

// ================================================================
// WIZARD (SESSION STORAGE)
// ================================================================
let currentWizardStep = 1;

function initWizard() {
  const savedStep = Number(sessionStorage.getItem('wizardStep')) || 1;
  const savedData = JSON.parse(sessionStorage.getItem('wizardData') || '{}');
  
  if (savedData.fname) document.getElementById('w-fname').value = savedData.fname || '';
  if (savedData.lname) document.getElementById('w-lname').value = savedData.lname || '';
  if (savedData.email) document.getElementById('w-email').value = savedData.email || '';
  if (savedData.lang) document.getElementById('w-lang').value = savedData.lang || '';
  if (savedData.level) document.getElementById('w-level').value = savedData.level || '';
  
  goToWizardStep(savedStep);
  updateWizardSSView();
}

function getWizardData() {
  return {
    fname: document.getElementById('w-fname')?.value || '',
    lname: document.getElementById('w-lname')?.value || '',
    email: document.getElementById('w-email')?.value || '',
    lang: document.getElementById('w-lang')?.value || '',
    level: document.getElementById('w-level')?.value || '',
  };
}

function saveWizardProgress(step) {
  sessionStorage.setItem('wizardStep', String(step));
  sessionStorage.setItem('wizardData', JSON.stringify(getWizardData()));
  updateWizardSSView();
}

function updateWizardSSView() {
  const view = document.getElementById('wizard-ss-view');
  if (!view) return;
  const step = sessionStorage.getItem('wizardStep');
  const data = sessionStorage.getItem('wizardData');
  view.textContent = step 
    ? `wizardStep: "${step}"\nwizardData: ${data}`
    : 'Empty ‚Äî no data saved yet';
}

function wizardNext(fromStep) {
  saveWizardProgress(fromStep + 1);
  goToWizardStep(fromStep + 1);
  if (fromStep + 1 === 3) {
    const data = getWizardData();
    document.getElementById('wizard-review').innerHTML = 
      `<span style="color:var(--local-color)">Name:</span> ${data.fname} ${data.lname}<br>` +
      `<span style="color:var(--local-color)">Email:</span> ${data.email}<br>` +
      `<span style="color:var(--local-color)">Language:</span> ${data.lang || 'Not selected'}<br>` +
      `<span style="color:var(--local-color)">Level:</span> ${data.level || 'Not selected'}`;
  }
}

function wizardBack(fromStep) {
  goToWizardStep(fromStep - 1);
  saveWizardProgress(fromStep - 1);
}

function goToWizardStep(step) {
  currentWizardStep = step;
  document.querySelectorAll('.wizard-step').forEach(s => s.style.display = 'none');
  const target = document.getElementById(`wizard-step-${step}`);
  if (target) target.style.display = 'block';
  
  ['1','2','3'].forEach(n => {
    const dot = document.getElementById(`wd-${n}`);
    const line = document.getElementById(`wlf-${parseInt(n)}`);
    if (dot) {
      dot.style.background = parseInt(n) <= step ? 'var(--primary)' : 'var(--border)';
    }
    if (line) {
      line.style.width = parseInt(n) < step ? '100%' : '0%';
    }
  });
}

function wizardSubmit() {
  toast('üéâ Form submitted! (sessionStorage cleared)', 'success');
  clearWizard();
  goToWizardStep(1);
}

function clearWizard() {
  sessionStorage.removeItem('wizardStep');
  sessionStorage.removeItem('wizardData');
  ['w-fname','w-lname','w-email','w-lang','w-level'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
  updateWizardSSView();
  toast('Session data cleared!', 'info');
}

// ================================================================
// STORAGE EXPLORER
// ================================================================
let currentExplorerStorage = 'local';

function switchExplorerTab(type) {
  currentExplorerStorage = type;
  document.getElementById('tab-local').className = `explorer-tab ${type === 'local' ? 'active local' : ''}`;
  document.getElementById('tab-session').className = `explorer-tab ${type === 'session' ? 'active session' : ''}`;
  document.getElementById('exp-set-btn').className = `btn ${type === 'local' ? 'btn-primary' : 'btn-session'}`;
  renderExplorer();
}

function getActiveStorage() {
  return currentExplorerStorage === 'local' ? localStorage : sessionStorage;
}

function explorerSetItem() {
  const key = document.getElementById('exp-key').value.trim();
  const val = document.getElementById('exp-value').value.trim();
  if (!key) { toast('Enter a key!', 'warning'); return; }
  
  try {
    getActiveStorage().setItem(key, val);
    document.getElementById('exp-key').value = '';
    document.getElementById('exp-value').value = '';
    renderExplorer();
    updateQuota();
    toast(`‚úÖ Stored "${key}"`, 'success');
  } catch(e) {
    toast('Storage full! (QuotaExceededError)', 'error');
  }
}

function explorerClear() {
  if (confirm(`Clear ALL ${currentExplorerStorage === 'local' ? 'localStorage' : 'sessionStorage'} items?`)) {
    getActiveStorage().clear();
    renderExplorer();
    updateQuota();
    toast('Storage cleared!', 'warning');
  }
}

function explorerAddSample() {
  const storage = getActiveStorage();
  const samples = [
    ['theme', 'dark'],
    ['language', 'en-US'],
    ['userId', 'usr_' + Math.random().toString(36).substr(2,6)],
    ['lastVisit', new Date().toISOString()],
    ['preferences', JSON.stringify({ notifications: true, sounds: false })]
  ];
  samples.forEach(([k, v]) => storage.setItem(k, v));
  renderExplorer();
  updateQuota();
  toast('Sample data added!', 'success');
}

function renderExplorer() {
  const storage = getActiveStorage();
  const container = document.getElementById('explorer-table-container');
  const keys = Object.keys(storage);
  
  document.getElementById('exp-count').textContent = keys.length;
  
  let totalBytes = 0;
  keys.forEach(k => totalBytes += (k.length + (storage.getItem(k) || '').length) * 2);
  document.getElementById('exp-size').textContent = formatBytes(totalBytes);

  if (keys.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="es-icon">üì≠</div><p>No items in ${currentExplorerStorage === 'local' ? 'localStorage' : 'sessionStorage'} yet.</p><button class="btn btn-primary btn-sm" onclick="explorerAddSample()" style="margin-top:12px">Add Sample Data</button></div>`;
    return;
  }

  let html = `<table class="storage-table"><thead><tr><th>Key</th><th>Value</th><th>Size</th><th>Actions</th></tr></thead><tbody>`;
  keys.forEach(key => {
    const val = storage.getItem(key) || '';
    const size = (key.length + val.length) * 2;
    const displayVal = val.length > 60 ? val.substring(0, 60) + '...' : val;
    html += `<tr>
      <td class="key-cell">${escapeHtml(key)}</td>
      <td class="val-cell" title="${escapeHtml(val)}">${escapeHtml(displayVal)}</td>
      <td style="color:var(--text-dim);font-size:0.8rem">${formatBytes(size)}</td>
      <td><button class="del-btn" onclick="explorerDeleteItem('${escapeHtml(key)}')">Delete</button></td>
    </tr>`;
  });
  html += '</tbody></table>';
  container.innerHTML = html;
}

function explorerDeleteItem(key) {
  getActiveStorage().removeItem(key);
  renderExplorer();
  updateQuota();
  toast(`Deleted "${key}"`, 'info');
}

function updateQuota() {
  // Estimate localStorage size
  let lsBytes = 0;
  Object.keys(localStorage).forEach(k => lsBytes += (k.length + (localStorage.getItem(k)||'').length) * 2);
  let ssBytes = 0;
  Object.keys(sessionStorage).forEach(k => ssBytes += (k.length + (sessionStorage.getItem(k)||'').length) * 2);
  
  const maxBytes = 5 * 1024 * 1024;
  
  document.getElementById('quota-local-fill').style.width = Math.min((lsBytes/maxBytes)*100, 100) + '%';
  document.getElementById('quota-session-fill').style.width = Math.min((ssBytes/maxBytes)*100, 100) + '%';
  document.getElementById('quota-local-text').textContent = `${formatBytes(lsBytes)} / ~5MB`;
  document.getElementById('quota-session-text').textContent = `${formatBytes(ssBytes)} / ~5MB`;
}

// ================================================================
// STORAGE EVENTS
// ================================================================
let simCounter = 0;

function addEventLog(action, key, oldVal, newVal) {
  const log = document.getElementById('eventLog');
  const time = new Date().toLocaleTimeString();
  const entry = document.createElement('div');
  entry.className = 'event-entry';
  entry.innerHTML = `<span class="ev-time">[${time}]</span> <span class="ev-action">${action}</span> ` +
    `key: <span class="ev-key">"${key}"</span> ` +
    (oldVal !== null ? `oldValue: <span class="ev-val">"${oldVal}"</span> ` : '') +
    (newVal !== null ? `newValue: <span class="ev-val">"${newVal}"</span>` : '<span style="color:var(--danger)">removed</span>');
  
  // Remove "waiting" message
  const waiting = log.querySelector('[style*="waiting"]');
  if (waiting) waiting.remove();
  
  log.prepend(entry);
}

function simulateStorageSet() {
  simCounter++;
  const key = `simKey${simCounter}`;
  const val = `value_${simCounter}`;
  localStorage.setItem(key, val);
  addEventLog('SET', key, null, val);
  toast('Storage set simulated', 'info');
}

function simulateStorageUpdate() {
  const keys = Object.keys(localStorage).filter(k => k.startsWith('simKey'));
  if (keys.length === 0) { toast('Set an item first!', 'warning'); return; }
  const key = keys[keys.length - 1];
  const oldVal = localStorage.getItem(key);
  const newVal = `updated_${Date.now().toString(36)}`;
  localStorage.setItem(key, newVal);
  addEventLog('UPDATE', key, oldVal, newVal);
  toast('Storage update simulated', 'info');
}

function simulateStorageRemove() {
  const keys = Object.keys(localStorage).filter(k => k.startsWith('simKey'));
  if (keys.length === 0) { toast('Set an item first!', 'warning'); return; }
  const key = keys[keys.length - 1];
  const oldVal = localStorage.getItem(key);
  localStorage.removeItem(key);
  addEventLog('REMOVE', key, oldVal, null);
  toast('Storage remove simulated', 'info');
}

function clearEventLog() {
  document.getElementById('eventLog').innerHTML = '<div class="event-entry" style="color:var(--text-dim)">Log cleared. Waiting for events...</div>';
}

function updateEventProps() {
  const keys = Object.keys(localStorage).filter(k => k.startsWith('simKey'));
  const key = keys.length ? keys[keys.length - 1] : 'theme';
  const val = localStorage.getItem(key) || '"dark"';
  
  document.getElementById('ev-prop-key').textContent = `"${key}"`;
  document.getElementById('ev-prop-old').textContent = 'null (new item)';
  document.getElementById('ev-prop-new').textContent = `"${val}"`;
  document.getElementById('ev-prop-url').textContent = window.location.href.substring(0, 60) + '...';
}

// Real storage event listener
window.addEventListener('storage', (e) => {
  if (e.key && !e.key.startsWith('simKey')) {
    addEventLog('EXTERNAL CHANGE', e.key || 'null', e.oldValue, e.newValue);
  }
});

// ================================================================
// PITFALLS DEMOS
// ================================================================
function demoPitfall1() {
  const out = document.getElementById('pitfall1-output');
  
  // Bug 1: Number concatenation
  localStorage.setItem('bugCount', 5);
  const count = localStorage.getItem('bugCount');
  const wrongResult = count + 1;
  const correctResult = Number(count) + 1;
  
  // Bug 2: Boolean truthy
  localStorage.setItem('isAdmin', false);
  const boolStr = localStorage.getItem('isAdmin');
  const isTruthy = Boolean(boolStr);
  const correctBool = JSON.parse(boolStr);
  
  out.className = 'exercise-output error-output';
  out.textContent = 
    `STRING COERCION BUGS:\n` +
    `localStorage.setItem('count', 5) ‚Üí stored as: "${count}"\n` +
    `"${count}" + 1 = "${wrongResult}" ‚ùå (expected 6!)\n` +
    `Number("${count}") + 1 = ${correctResult} ‚úÖ\n\n` +
    `BOOLEAN TRUTHY BUG:\n` +
    `localStorage.setItem('isAdmin', false) ‚Üí stored as: "${boolStr}"\n` +
    `Boolean("${boolStr}") = ${isTruthy} ‚ùå ("false" string is TRUTHY!)\n` +
    `JSON.parse("${boolStr}") = ${correctBool} ‚úÖ`;
  
  localStorage.removeItem('bugCount');
  localStorage.removeItem('isAdmin');
}

function demoPitfall6() {
  const out = document.getElementById('pitfall6-output');
  const cart = [{ id: 1, qty: 2 }, { id: 2, qty: 1 }];
  
  // Wrong way
  localStorage.setItem('wrongCart', cart);
  const wrongResult = localStorage.getItem('wrongCart');
  
  // Right way
  localStorage.setItem('rightCart', JSON.stringify(cart));
  const rightResult = JSON.parse(localStorage.getItem('rightCart'));
  
  out.className = 'exercise-output success-output';
  out.textContent = 
    `‚ùå WITHOUT JSON.stringify:\n` +
    `Stored value: "${wrongResult}"\n` +
    `‚Üí Useless! Can't recover original array.\n\n` +
    `‚úÖ WITH JSON.stringify:\n` +
    `Stored value: "${localStorage.getItem('rightCart')}"\n` +
    `Retrieved & parsed: ${JSON.stringify(rightResult)}\n` +
    `‚Üí Original array recovered!`;
  
  localStorage.removeItem('wrongCart');
  localStorage.removeItem('rightCart');
}

// ================================================================
// STORAGE MANAGER DEMO
// ================================================================
function demoStorageManager() {
  class StorageManager {
    constructor(prefix = 'app', storage = localStorage) {
      this.prefix = prefix;
      this._storage = storage;
    }
    _key(key) { return `${this.prefix}:${key}`; }
    set(key, value, expiresInMs = null) {
      try {
        const payload = { value, timestamp: Date.now(), expires: expiresInMs ? Date.now() + expiresInMs : null };
        this._storage.setItem(this._key(key), JSON.stringify(payload));
        return true;
      } catch { return false; }
    }
    get(key, fallback = null) {
      try {
        const raw = this._storage.getItem(this._key(key));
        if (!raw) return fallback;
        const parsed = JSON.parse(raw);
        if (parsed.expires && Date.now() > parsed.expires) { this.remove(key); return fallback; }
        return parsed.value;
      } catch { return fallback; }
    }
    remove(key) { this._storage.removeItem(this._key(key)); }
  }
  
  const store = new StorageManager('demo');
  store.set('theme', 'dark');
  store.set('user', { name: 'Alice', role: 'admin' });
  store.set('shortLived', 'expires soon!', 5000); // 5 seconds
  
  const theme = store.get('theme');
  const user = store.get('user');
  const missing = store.get('nonExistent', 'defaultValue');
  
  const out = document.getElementById('sm-output');
  out.className = 'exercise-output success-output';
  out.textContent = 
    `‚úÖ StorageManager Demo:\n\n` +
    `store.set('theme', 'dark') ‚Üí saved with namespace "demo:theme"\n` +
    `store.get('theme') ‚Üí "${theme}"\n\n` +
    `store.set('user', {name:'Alice', role:'admin'}) ‚Üí namespaced + JSON serialized\n` +
    `store.get('user') ‚Üí ${JSON.stringify(user)}\n\n` +
    `store.get('nonExistent', 'defaultValue') ‚Üí "${missing}" (fallback)\n\n` +
    `store.set('shortLived', '...', 5000) ‚Üí expires in 5 seconds!`;
    
  toast('StorageManager working!', 'success');
}

// ================================================================
// REAL WORLD DEMO - PREFERENCES
// ================================================================
function loadPreferences() {
  const prefs = JSON.parse(localStorage.getItem('demoPrefs') || '{}');
  
  if (prefs.name) document.getElementById('pref-name').value = prefs.name;
  if (prefs.jobTitle) document.getElementById('pref-title').value = prefs.jobTitle;
  if (typeof prefs.notifications === 'boolean') document.getElementById('pref-notifs').checked = prefs.notifications;
  if (typeof prefs.sounds === 'boolean') document.getElementById('pref-sounds').checked = prefs.sounds;
  if (typeof prefs.analytics === 'boolean') document.getElementById('pref-analytics').checked = prefs.analytics;
  if (typeof prefs.autoTranslate === 'boolean') document.getElementById('pref-translate').checked = prefs.autoTranslate;
  
  const theme = prefs.theme || 'dark';
  updateThemeButtons(theme);
  updatePrefsView();
}

function savePreference(key, value) {
  const prefs = JSON.parse(localStorage.getItem('demoPrefs') || '{}');
  prefs[key] = value;
  localStorage.setItem('demoPrefs', JSON.stringify(prefs));
  updatePrefsView();
}

function setDemoTheme(theme) {
  savePreference('theme', theme);
  updateThemeButtons(theme);
  toast(`Theme set to "${theme}"`, 'success');
}

function updateThemeButtons(active) {
  document.querySelectorAll('.theme-btn').forEach(btn => {
    btn.classList.remove('active-theme');
    if (btn.textContent.toLowerCase().includes(active.toLowerCase())) {
      btn.classList.add('active-theme');
    }
  });
}

function updatePrefsView() {
  const prefs = localStorage.getItem('demoPrefs');
  const view = document.getElementById('prefs-storage-view');
  if (view) view.textContent = prefs ? JSON.stringify(JSON.parse(prefs), null, 2) : 'Nothing saved yet';
}

function resetPreferences() {
  localStorage.removeItem('demoPrefs');
  loadPreferences();
  toast('Preferences reset!', 'warning');
}

// ================================================================
// REAL WORLD DEMO - SHOPPING CART
// ================================================================
const PRODUCTS = [
  { id: 1, name: 'JavaScript Mastery Course', price: 49.99, emoji: 'üìö' },
  { id: 2, name: 'VS Code Pro Theme', price: 9.99, emoji: 'üé®' },
  { id: 3, name: 'Dev Sticker Pack', price: 14.99, emoji: 'üè∑Ô∏è' },
  { id: 4, name: 'Mechanical Keyboard', price: 149.99, emoji: '‚å®Ô∏è' },
];

function initProducts() {
  const grid = document.getElementById('products-grid');
  if (!grid || grid.children.length > 0) return;
  
  grid.innerHTML = PRODUCTS.map(p => `
    <div class="info-card" style="text-align:center">
      <div style="font-size:2.5rem;margin-bottom:8px">${p.emoji}</div>
      <div style="font-weight:700;margin-bottom:4px;font-size:0.9rem">${p.name}</div>
      <div style="color:var(--success);font-weight:800;margin-bottom:12px">$${p.price}</div>
      <button class="btn btn-session btn-sm" onclick="addToCart(${p.id})">+ Add to Cart</button>
    </div>
  `).join('');
}

function getCart() {
  return JSON.parse(sessionStorage.getItem('demoCart') || '[]');
}

function saveCart(cart) {
  sessionStorage.setItem('demoCart', JSON.stringify(cart));
}

function addToCart(productId) {
  const product = PRODUCTS.find(p => p.id === productId);
  const cart = getCart();
  const existing = cart.find(i => i.id === productId);
  
  if (existing) {
    existing.qty++;
  } else {
    cart.push({ ...product, qty: 1 });
  }
  
  saveCart(cart);
  loadCart();
  toast(`${product.emoji} ${product.name} added!`, 'success');
}

function removeFromCart(productId) {
  const cart = getCart().filter(i => i.id !== productId);
  saveCart(cart);
  loadCart();
  toast('Item removed from cart', 'info');
}

function clearCart() {
  sessionStorage.removeItem('demoCart');
  loadCart();
  toast('Cart cleared!', 'warning');
}

function checkoutCart() {
  clearCart();
  toast('üéâ Checkout complete! (cart cleared from session)', 'success');
}

function loadCart() {
  const cart = getCart();
  const badge = document.getElementById('cart-badge');
  const section = document.getElementById('cart-section');
  const itemsEl = document.getElementById('cart-items');
  const totalEl = document.getElementById('cart-total');
  
  if (!badge) return;
  
  const totalItems = cart.reduce((sum, i) => sum + i.qty, 0);
  badge.textContent = `${totalItems} item${totalItems !== 1 ? 's' : ''}`;
  
  if (cart.length === 0) {
    if (section) section.style.display = 'none';
    return;
  }
  
  if (section) section.style.display = 'block';
  
  const total = cart.reduce((sum, i) => sum + i.price * i.qty, 0);
  if (totalEl) totalEl.textContent = '$' + total.toFixed(2);
  
  if (itemsEl) {
    itemsEl.innerHTML = cart.map(item => `
      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)">
        <div>
          <span style="margin-right:8px">${item.emoji}</span>
          <span style="font-size:0.9rem">${item.name}</span>
          <span style="color:var(--text-dim);font-size:0.8rem;margin-left:8px">x${item.qty}</span>
        </div>
        <div style="display:flex;align-items:center;gap:12px">
          <span style="color:var(--success);font-weight:700">$${(item.price * item.qty).toFixed(2)}</span>
          <button class="del-btn" onclick="removeFromCart(${item.id})">Remove</button>
        </div>
      </div>
    `).join('');
  }
}

// ================================================================
// QUIZ
// ================================================================
const QUIZ_DATA = [
  {
    q: "What does localStorage.getItem('key') return if the key doesn't exist?",
    options: ["undefined", "null", "false", "0"],
    correct: 1,
    explanation: "localStorage.getItem() returns null (not undefined) when a key doesn't exist. This is important to check for explicitly!"
  },
  {
    q: "You store: localStorage.setItem('count', 5). What happens when you do localStorage.getItem('count') + 1?",
    options: ["6", '"51"', "NaN", "Error is thrown"],
    correct: 1,
    explanation: 'localStorage only stores strings! So 5 becomes "5", and "5" + 1 = "51" (string concatenation). Always use Number() or parseInt() when retrieving numbers.'
  },
  {
    q: "The 'storage' event fires when localStorage changes. In which tab(s) does it fire?",
    options: ["The same tab that made the change", "All open tabs including the current one", "All OTHER tabs (NOT the current tab)", "No tabs ‚Äî you must poll manually"],
    correct: 2,
    explanation: "The storage event fires in all OTHER tabs with the same origin, but NOT in the tab that made the change. This is by design for cross-tab communication."
  },
  {
    q: "You close a browser tab. What happens to sessionStorage data?",
    options: ["It persists until the browser is closed", "It's immediately deleted when the tab closes", "It expires after 24 hours", "It moves to localStorage automatically"],
    correct: 1,
    explanation: "sessionStorage is scoped to the browser tab. When the tab closes, all sessionStorage for that tab is permanently deleted."
  },
  {
    q: "What is the typical storage limit for localStorage?",
    options: ["1MB", "10MB", "~5MB", "Unlimited"],
    correct: 2,
    explanation: "The typical limit is ~5MB per origin, though this varies slightly by browser. Exceeding it throws a QuotaExceededError, which you should always catch!"
  },
  {
    q: "You open the same website in two different browser tabs. Which storage is SHARED between them?",
    options: ["sessionStorage only", "localStorage only", "Both are shared", "Neither is shared"],
    correct: 1,
    explanation: "localStorage is shared between all tabs of the same origin. sessionStorage is unique per tab ‚Äî each tab has its own isolated sessionStorage."
  },
  {
    q: "What's the correct way to store an object in localStorage?",
    options: ['localStorage.setItem("u", myObj)', 'localStorage.setItem("u", myObj.toString())', 'localStorage.setItem("u", JSON.stringify(myObj))', 'localStorage.setObject("u", myObj)'],
    correct: 2,
    explanation: "You MUST use JSON.stringify() to convert objects to strings before storing. Without it, you'd store '[object Object]' which is useless."
  },
  {
    q: "What does the 'storage' event's 'key' property contain when localStorage.clear() is called?",
    options: ['"clear"', '"all"', "null", "undefined"],
    correct: 2,
    explanation: "When clear() is called, the storage event fires with event.key = null (not a string 'clear'). Check for null to detect clear operations."
  },
  {
    q: "Which of these should NEVER be stored in localStorage?",
    options: ["User's preferred theme", "User's display name", "User's password", "Shopping cart items"],
    correct: 2,
    explanation: "Passwords must NEVER be stored in localStorage (or anywhere client-side in plain text). localStorage is accessible via JavaScript and vulnerable to XSS attacks."
  },
  {
    q: "You refresh the page. What happens to sessionStorage data?",
    options: ["It's cleared immediately", "It persists through refreshes (but not tab close)", "It expires after 30 minutes", "It's moved to localStorage"],
    correct: 1,
    explanation: "sessionStorage persists through page refreshes within the same tab. It only clears when the tab or window is closed. This makes it perfect for multi-step form data."
  }
];

let quizState = { current: 0, score: 0, answers: [], locked: false };

function initQuiz() {
  quizState = { current: 0, score: 0, answers: [], locked: false };
  document.getElementById('quiz-results').classList.remove('show');
  document.getElementById('quiz-questions-area').style.display = 'block';
  document.getElementById('q-total').textContent = QUIZ_DATA.length;
  
  // Build dots
  const dotsEl = document.getElementById('q-dots');
  dotsEl.innerHTML = QUIZ_DATA.map((_, i) => `<div class="q-dot" id="qdot-${i}"></div>`).join('');
  document.getElementById('qdot-0').classList.add('current');
  
  renderQuestion();
}

function renderQuestion() {
  const q = QUIZ_DATA[quizState.current];
  document.getElementById('q-current').textContent = quizState.current + 1;
  document.getElementById('q-score-display').textContent = `Score: ${quizState.score}`;
  document.getElementById('q-feedback').classList.remove('show');
  document.getElementById('q-next-btn').style.display = 'none';
  quizState.locked = false;
  
  document.getElementById('q-container').innerHTML = `
    <div class="question-card active">
      <div class="question-text">${quizState.current + 1}. ${q.q}</div>
      <div class="options-grid">
        ${q.options.map((opt, i) => `
          <button class="option-btn" onclick="selectAnswer(${i})">${opt}</button>
        `).join('')}
      </div>
    </div>
  `;
}

function selectAnswer(idx) {
  if (quizState.locked) return;
  quizState.locked = true;
  
  const q = QUIZ_DATA[quizState.current];
  const correct = idx === q.correct;
  const buttons = document.querySelectorAll('.option-btn');
  
  buttons.forEach((btn, i) => {
    btn.disabled = true;
    if (i === q.correct) btn.classList.add('correct');
    if (i === idx && !correct) btn.classList.add('wrong');
    if (i !== idx && i !== q.correct) btn.classList.add('reveal');
  });
  
  const feedback = document.getElementById('q-feedback');
  feedback.className = `quiz-feedback show ${correct ? 'correct-fb' : 'wrong-fb'}`;
  feedback.innerHTML = `${correct ? '‚úÖ Correct!' : '‚ùå Not quite!'} ‚Äî ${q.explanation}`;
  
  if (correct) quizState.score++;
  quizState.answers.push({ correct, idx, correctIdx: q.correct });
  
  // Update dot
  const dot = document.getElementById(`qdot-${quizState.current}`);
  dot.classList.remove('current');
  dot.classList.add(correct ? 'answered' : 'wrong');
  
  document.getElementById('q-score-display').textContent = `Score: ${quizState.score}`;
  document.getElementById('q-next-btn').style.display = 'block';
}

function nextQuestion() {
  quizState.current++;
  
  if (quizState.current >= QUIZ_DATA.length) {
    showQuizResults();
    return;
  }
  
  const dot = document.getElementById(`qdot-${quizState.current}`);
  if (dot) dot.classList.add('current');
  
  renderQuestion();
}

function showQuizResults() {
  document.getElementById('quiz-questions-area').style.display = 'none';
  const results = document.getElementById('quiz-results');
  results.classList.add('show');
  
  const score = quizState.score;
  const total = QUIZ_DATA.length;
  const pct = Math.round((score / total) * 100);
  
  document.getElementById('final-score').textContent = score;
  document.getElementById('scoreCircle').style.setProperty('--score-pct', pct + '%');
  
  let title, msg;
  if (pct >= 90) { title = 'üèÜ Outstanding!'; msg = "You're a localStorage expert! Ready for any interview question."; }
  else if (pct >= 70) { title = 'üéâ Great job!'; msg = 'Solid understanding! Review the missed questions and you\'ll master it.'; }
  else if (pct >= 50) { title = 'üëç Good start!'; msg = 'Getting there! Go back through the sections and try again.'; }
  else { title = 'üìö Keep studying!'; msg = 'Review the concepts again ‚Äî you\'ve got this!'; }
  
  document.getElementById('results-title').textContent = title;
  document.getElementById('results-msg').textContent = msg;
  
  // Save score
  localStorage.setItem('storageQuizScore', JSON.stringify({ score, total, date: new Date().toLocaleDateString() }));
  
  toast(`Quiz complete! ${score}/${total}`, score >= 7 ? 'success' : 'info');
}

function resetQuiz() {
  initQuiz();
}

// ================================================================
// EXERCISES
// ================================================================
const ex1Starter = `const storage = {
  set(key, value) {
    // Your code here:
    // Use try/catch and JSON.stringify
    
  },
  
  get(key, defaultValue = null) {
    // Your code here:
    // Use try/catch and JSON.parse
    // Return defaultValue if key doesn't exist
    
  }
};

// Test your code:
storage.set('user', { name: 'Alice', age: 30 });
storage.set('score', 100);
storage.set('active', true);

const user = storage.get('user');
const score = storage.get('score');
const missing = storage.get('notExist', 'default!');`;

function runExercise(codeId, outputId, wrapFn) {
  const code = document.getElementById(codeId).value;
  const out = document.getElementById(outputId);
  try {
    const result = wrapFn(code);
    out.className = 'exercise-output success-output';
    out.textContent = result;
  } catch(e) {
    out.className = 'exercise-output error-output';
    out.textContent = `‚ùå Error: ${e.message}`;
  }
}

function runExercise1() {
  const code = document.getElementById('ex1-code').value;
  const out = document.getElementById('ex1-output');
  try {
    const fn = new Function(`
      ${code}
      const user = storage.get('user');
      const score = storage.get('score');  
      const missing = storage.get('notExist', 'default!');
      return { user, score, missing };
    `);
    const result = fn();
    out.className = 'exercise-output success-output';
    out.textContent = 
      `‚úÖ Tests passed!\n\n` +
      `storage.get('user') ‚Üí ${JSON.stringify(result.user)}\n` +
      `  - Type: ${typeof result.user} ‚úÖ (not string!)\n\n` +
      `storage.get('score') ‚Üí ${JSON.stringify(result.score)}\n\n` +
      `storage.get('notExist', 'default!') ‚Üí "${result.missing}"\n` +
      `${result.user?.name === 'Alice' && result.score === 100 && result.missing === 'default!' ? '\nüéâ All assertions passed!' : '\n‚ö†Ô∏è Check your implementation'}`;
    toast('Exercise 1 ran!', 'success');
  } catch(e) {
    out.className = 'exercise-output error-output';
    out.textContent = `‚ùå Error: ${e.message}\n\nMake sure your set() and get() functions are complete!`;
  }
}

function showSolution1() {
  document.getElementById('ex1-code').value = `const storage = {
  set(key, value) {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch (e) {
      console.error('Storage set failed:', e);
    }
  },
  
  get(key, defaultValue = null) {
    try {
      const item = localStorage.getItem(key);
      return item !== null ? JSON.parse(item) : defaultValue;
    } catch (e) {
      return defaultValue;
    }
  }
};

// Test your code:
storage.set('user', { name: 'Alice', age: 30 });
storage.set('score', 100);
storage.set('active', true);

const user = storage.get('user');
const score = storage.get('score');
const missing = storage.get('notExist', 'default!');`;
  toast('Solution revealed! Study it, then try writing your own.', 'info');
}

function resetExercise(id, starter) {
  document.getElementById(id).value = starter;
}

function runExercise2() {
  const code = document.getElementById('ex2-code').value;
  const out = document.getElementById('ex2-output');
  try {
    const fn = new Function(code);
    const result = fn();
    out.className = 'exercise-output success-output';
    out.textContent = typeof result === 'string' ? `‚úÖ ${result}` : `‚úÖ Result: ${JSON.stringify(result)}`;
    toast('Visit tracked!', 'success');
  } catch(e) {
    out.className = 'exercise-output error-output';
    out.textContent = `‚ùå Error: ${e.message}`;
  }
}

function showSolution2() {
  document.getElementById('ex2-code').value = `function trackVisit() {
  // 1. Session visits
  const sessionVisits = Number(sessionStorage.getItem('sessionVisits') || '0') + 1;
  sessionStorage.setItem('sessionVisits', String(sessionVisits));
  
  // 2. Total visits  
  const totalVisits = Number(localStorage.getItem('totalVisits') || '0') + 1;
  localStorage.setItem('totalVisits', String(totalVisits));
  
  return { sessionVisits, totalVisits };
}

const result = trackVisit();
return \`Session visits: \${result.sessionVisits}, Total visits: \${result.totalVisits}\`;`;
}

function clearVisitCounters() {
  sessionStorage.removeItem('sessionVisits');
  localStorage.removeItem('totalVisits');
  document.getElementById('ex2-output').textContent = 'Counters cleared! Run again to start fresh.';
  toast('Counters reset!', 'warning');
}

function runExercise3() {
  const code = document.getElementById('ex3-code').value;
  const out = document.getElementById('ex3-output');
  try {
    const fn = new Function(`
      ${code}
      setWithTTL('testToken', 'abc123', 2000);
      const immediate = getWithTTL('testToken');
      return { immediate };
    `);
    const result = fn();
    out.className = 'exercise-output success-output';
    out.textContent = 
      `‚úÖ Immediate retrieval: "${result.immediate}"\n` +
      `Expected: "abc123"\n\n` +
      `${result.immediate === 'abc123' ? '‚úÖ Correct! Now click "Test Expiry" to test expiration.' : '‚ö†Ô∏è Got: ' + result.immediate + ' (expected "abc123")'}`;
  } catch(e) {
    out.className = 'exercise-output error-output';
    out.textContent = `‚ùå Error: ${e.message}`;
  }
}

function testExpiry3() {
  const code = document.getElementById('ex3-code').value;
  const out = document.getElementById('ex3-output');
  out.className = 'exercise-output';
  out.textContent = '‚è∞ Waiting 2.5 seconds to test expiry...';
  
  setTimeout(() => {
    try {
      const fn = new Function(`
        ${code}
        const expired = getWithTTL('testToken');
        return { expired };
      `);
      const result = fn();
      const success = result.expired === null;
      out.className = `exercise-output ${success ? 'success-output' : 'error-output'}`;
      out.textContent = success 
        ? `‚úÖ After 2.5s: getWithTTL('testToken') = null ‚Äî TTL expiry works!`
        : `‚ö†Ô∏è After 2.5s: got "${result.expired}" (expected null) ‚Äî check your expiry logic`;
    } catch(e) {
      out.textContent = `‚ùå Error: ${e.message}`;
    }
  }, 2500);
}

function showSolution3() {
  document.getElementById('ex3-code').value = `function setWithTTL(key, value, ttlMs) {
  const payload = {
    value,
    expires: Date.now() + ttlMs
  };
  try {
    localStorage.setItem(key, JSON.stringify(payload));
  } catch (e) { /* quota exceeded */ }
}

function getWithTTL(key) {
  try {
    const raw = localStorage.getItem(key);
    if (!raw) return null;
    
    const parsed = JSON.parse(raw);
    
    if (Date.now() > parsed.expires) {
      localStorage.removeItem(key); // Clean up expired data
      return null;
    }
    
    return parsed.value;
  } catch {
    return null;
  }
}

// Test:
setWithTTL('token', 'abc123', 2000);
const immediate = getWithTTL('token');
return { immediate };`;
}

function runExercise4() {
  const code = document.getElementById('ex4-code').value;
  const out = document.getElementById('ex4-output');
  // Clean slate for testing
  localStorage.removeItem('learn:todos');
  try {
    const fn = new Function(`
      ${code}
    `);
    const result = fn();
    const todos = Array.isArray(result) ? result : [];
    out.className = 'exercise-output success-output';
    out.textContent = 
      `‚úÖ Todos stored in localStorage!\n\n` +
      `Found ${todos.length} todos:\n` +
      todos.map((t, i) => `${i+1}. [${t.completed ? '‚úÖ' : '‚¨ú'}] ${t.text} (id: ${t.id})`).join('\n') +
      `\n\n${todos[0]?.completed ? '‚úÖ First todo marked complete!' : '‚ö†Ô∏è First todo not completed ‚Äî check toggleTodo'}`;
    toast('Exercise 4 complete!', 'success');
  } catch(e) {
    out.className = 'exercise-output error-output';
    out.textContent = `‚ùå Error: ${e.message}`;
  }
}

function showSolution4() {
  document.getElementById('ex4-code').value = `const TODOS_KEY = 'learn:todos';

function getTodos() {
  try {
    return JSON.parse(localStorage.getItem(TODOS_KEY) || '[]');
  } catch { return []; }
}

function addTodo(text) {
  const todos = getTodos();
  todos.push({ id: Date.now(), text, completed: false });
  localStorage.setItem(TODOS_KEY, JSON.stringify(todos));
}

function toggleTodo(id) {
  const todos = getTodos().map(todo =>
    todo.id === id ? { ...todo, completed: !todo.completed } : todo
  );
  localStorage.setItem(TODOS_KEY, JSON.stringify(todos));
}

function deleteTodo(id) {
  const todos = getTodos().filter(todo => todo.id !== id);
  localStorage.setItem(TODOS_KEY, JSON.stringify(todos));
}

// Test:
addTodo('Learn localStorage');
addTodo('Build a project');
addTodo('Get a job!');
toggleTodo(getTodos()[0].id);
return getTodos();`;
}

function clearExercise4() {
  localStorage.removeItem('learn:todos');
  document.getElementById('ex4-output').textContent = 'Todos cleared! Run exercise again.';
  toast('Todos cleared!', 'warning');
}

// ================================================================
// UTILITIES
// ================================================================
function formatBytes(bytes) {
  if (bytes === 0) return '0B';
  if (bytes < 1024) return bytes + 'B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + 'KB';
  return (bytes / 1024 / 1024).toFixed(2) + 'MB';
}

function escapeHtml(str) {
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;');
}

// ================================================================
// INIT
// ================================================================
window.addEventListener('DOMContentLoaded', () => {
  updateProgress();
  // Load previous quiz score if exists
  const prevScore = localStorage.getItem('storageQuizScore');
  if (prevScore) {
    const { score, total, date } = JSON.parse(prevScore);
    console.log(`Previous quiz: ${score}/${total} on ${date}`);
  }
});
</script>
</body>
</html>