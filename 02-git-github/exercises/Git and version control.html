<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Mastery Bootcamp - Advanced Version Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border-color: #30363d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-green: #238636;
            --accent-blue: #58a6ff;
            --accent-purple: #a371f7;
            --accent-red: #f85149;
            --accent-yellow: #f0883e;
            --font-mono: 'Courier New', Consolas, monospace;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header & Navigation */
        header {
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-orange);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-bar {
            width: 300px;
            height: 8px;
            background-color: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-blue));
            width: 0%;
            transition: width 0.3s ease;
        }

        nav {
            background-color: var(--bg-secondary);
            padding: 1rem;
            border-right: 1px solid var(--border-color);
            width: 280px;
            height: calc(100vh - 70px);
            position: fixed;
            overflow-y: auto;
        }

        .nav-item {
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .nav-item:hover {
            background-color: var(--bg-tertiary);
        }

        .nav-item.active {
            background-color: var(--accent-blue);
            color: white;
            font-weight: 600;
        }

        .nav-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-section {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin: 1.5rem 0 0.5rem 0.5rem;
            letter-spacing: 0.05em;
        }

        /* Main Content */
        main {
            margin-left: 280px;
            padding: 2rem;
            max-width: 1200px;
        }

        .module-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .module-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .module-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Cards */
        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-interactive {
            background-color: rgba(88, 166, 255, 0.2);
            color: var(--accent-blue);
        }

        .badge-warning {
            background-color: rgba(240, 136, 62, 0.2);
            color: var(--accent-yellow);
        }

        .badge-danger {
            background-color: rgba(248, 81, 73, 0.2);
            color: var(--accent-red);
        }

        /* Terminal */
        .terminal {
            background-color: #000;
            border-radius: 8px;
            padding: 1rem;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
        }

        .terminal-header {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #333;
        }

        .terminal-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .terminal-btn.red { background-color: #ff5f56; }
        .terminal-btn.yellow { background-color: #ffbd2e; }
        .terminal-btn.green { background-color: #27c93f; }

        .terminal-content {
            color: #e6edf3;
            line-height: 1.8;
        }

        .terminal-prompt {
            color: var(--accent-green);
        }

        .terminal-command {
            color: #e6edf3;
        }

        .terminal-output {
            color: var(--text-secondary);
        }

        .terminal-error {
            color: var(--accent-red);
        }

        .terminal-success {
            color: var(--accent-green);
        }

        /* Git Visualizer */
        .git-canvas-container {
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            padding: 2rem;
            margin: 1rem 0;
            position: relative;
            height: 400px;
            overflow: auto;
        }

        #gitCanvas {
            width: 100%;
            height: 100%;
        }

        .git-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--accent-green);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2ea043;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(35, 134, 54, 0.3);
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
        }

        .btn-danger {
            background-color: var(--accent-red);
            color: white;
        }

        /* Quiz Styles */
        .quiz-container {
            margin: 2rem 0;
        }

        .quiz-question {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .quiz-option {
            padding: 1rem;
            background-color: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quiz-option:hover {
            border-color: var(--accent-blue);
            background-color: rgba(88, 166, 255, 0.1);
        }

        .quiz-option.selected {
            border-color: var(--accent-blue);
            background-color: rgba(88, 166, 255, 0.2);
        }

        .quiz-option.correct {
            border-color: var(--accent-green);
            background-color: rgba(35, 134, 54, 0.2);
        }

        .quiz-option.wrong {
            border-color: var(--accent-red);
            background-color: rgba(248, 81, 73, 0.2);
        }

        .quiz-option input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: var(--accent-blue);
        }

        .quiz-feedback {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background-color: rgba(35, 134, 54, 0.2);
            border: 1px solid var(--accent-green);
            color: #3fb950;
        }

        .quiz-feedback.wrong {
            background-color: rgba(248, 81, 73, 0.2);
            border: 1px solid var(--accent-red);
            color: #f85149;
        }

        /* Interactive Scenarios */
        .scenario-container {
            background-color: var(--bg-tertiary);
            border-radius: 8px;
            padding: 2rem;
            margin: 1rem 0;
        }

        .scenario-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .scenario-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .code-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }

        .code-block {
            background-color: #000;
            border-radius: 8px;
            padding: 1rem;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            overflow-x: auto;
            border: 2px solid transparent;
        }

        .code-block.merge {
            border-color: var(--accent-blue);
        }

        .code-block.rebase {
            border-color: var(--accent-purple);
        }

        .code-header {
            font-size: 0.75rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        /* Pitfall Warning */
        .pitfall {
            background-color: rgba(248, 81, 73, 0.1);
            border-left: 4px solid var(--accent-red);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .pitfall-title {
            color: var(--accent-red);
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Tips */
        .pro-tip {
            background-color: rgba(35, 134, 54, 0.1);
            border-left: 4px solid var(--accent-green);
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .pro-tip-title {
            color: var(--accent-green);
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        /* Drag and Drop */
        .drag-container {
            display: flex;
            gap: 2rem;
            margin: 2rem 0;
            min-height: 300px;
        }

        .drag-source, .drag-target {
            flex: 1;
            background-color: var(--bg-tertiary);
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .drag-item {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            cursor: move;
            transition: transform 0.2s;
        }

        .drag-item:hover {
            transform: translateX(5px);
            border-color: var(--accent-blue);
        }

        .drag-item.dragging {
            opacity: 0.5;
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Syntax Highlighting */
        .keyword { color: #ff7b72; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }
        .function { color: #d2a8ff; }

        /* Responsive */
        @media (max-width: 768px) {
            nav {
                width: 100%;
                position: relative;
                height: auto;
            }
            main {
                margin-left: 0;
            }
            .code-comparison {
                grid-template-columns: 1fr;
            }
        }

        /* Animation for commits */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .commit-active {
            animation: pulse 2s infinite;
        }

        /* Exercise completion check */
        .checkmark {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--accent-green);
            color: white;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m4.22-10.22l4.24-4.24M6.34 17.66l-4.24 4.24M23 12h-6m-6 0H1m20.24 4.24l-4.24-4.24M6.34 6.34L2.1 2.1"></path>
                </svg>
                Git Mastery Bootcamp
            </div>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <span style="color: var(--text-secondary); font-size: 0.9rem;">Progress</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <span id="progressText" style="font-weight: 600;">0%</span>
            </div>
        </div>
    </header>

    <nav>
        <div class="nav-section">Fundamentals</div>
        <div class="nav-item active" onclick="loadModule('branching')">
            <span>üåø</span> Git Branching Deep Dive
        </div>
        <div class="nav-item" onclick="loadModule('merge-rebase')">
            <span>üîÄ</span> Merge vs Rebase
        </div>
        
        <div class="nav-section">Advanced Workflows</div>
        <div class="nav-item" onclick="loadModule('workflows')">
            <span>üîÑ</span> Collaboration Workflows
        </div>
        <div class="nav-item" onclick="loadModule('hooks')">
            <span>ü™ù</span> Git Hooks
        </div>
        
        <div class="nav-section">Mastery</div>
        <div class="nav-item" onclick="loadModule('pitfalls')">
            <span>‚ö†Ô∏è</span> Mistakes & Pitfalls
        </div>
        <div class="nav-item" onclick="loadModule('final')">
            <span>üèÜ</span> Final Challenge
        </div>
    </nav>

    <main id="mainContent">
        <!-- Content loaded dynamically -->
    </main>

    <script>
        // State Management
        const state = {
            currentModule: 'branching',
            progress: 0,
            completedModules: [],
            quizScores: {},
            gitVisualization: {
                branches: [],
                commits: [],
                head: null
            }
        };

        // Module Content
        const modules = {
            branching: {
                title: "Git Branching Strategies",
                subtitle: "Master the art of branching for scalable development",
                content: `
                    <div class="card">
                        <span class="badge badge-interactive">Interactive</span>
                        <h2 class="card-title">Visual Branching Simulator</h2>
                        <p style="margin-bottom: 1rem;">Understand how branches work under the hood. Create branches, switch between them, and see how the DAG (Directed Acyclic Graph) evolves.</p>
                        
                        <div class="git-canvas-container">
                            <canvas id="gitCanvas"></canvas>
                        </div>
                        
                        <div class="git-controls">
                            <button class="btn btn-primary" onclick="gitAction('commit')">
                                <span>‚ûï</span> Commit (main)
                            </button>
                            <button class="btn btn-secondary" onclick="gitAction('branch')">
                                <span>üåø</span> New Branch
                            </button>
                            <button class="btn btn-secondary" onclick="gitAction('checkout')">
                                <span>üëÜ</span> Switch Branch
                            </button>
                            <button class="btn btn-danger" onclick="gitAction('reset')">
                                <span>üîÑ</span> Reset
                            </button>
                        </div>
                        
                        <div id="branchInfo" style="margin-top: 1rem; padding: 1rem; background-color: var(--bg-tertiary); border-radius: 6px; font-family: var(--font-mono);">
                            Current: <span style="color: var(--accent-green)">main</span> | HEAD: <span style="color: var(--accent-yellow)">commit-a1b2c3</span>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Branch Naming Conventions</h2>
                        <div class="terminal">
                            <div class="terminal-header">
                                <div class="terminal-btn red"></div>
                                <div class="terminal-btn yellow"></div>
                                <div class="terminal-btn green"></div>
                                <span style="margin-left: 1rem; color: var(--text-secondary); font-size: 0.8rem;">best-practices.sh</span>
                            </div>
                            <div class="terminal-content">
                                <div class="comment"># Feature branches</div>
                                <div><span class="terminal-prompt">$</span> <span class="terminal-command">git checkout -b feature/user-authentication</span></div>
                                <div><span class="terminal-prompt">$</span> <span class="terminal-command">git checkout -b feature/JIRA-123-payment-gateway</span></div>
                                <br>
                                <div class="comment"># Bugfix branches</div>
                                <div><span class="terminal-prompt">$</span> <span class="terminal-command">git checkout -b fix/memory-leak-in-parser</span></div>
                                <div><span class="terminal-prompt">$</span> <span class="terminal-command">git checkout -b hotfix/critical-security-patch</span></div>
                                <br>
                                <div class="comment"># Release branches</div>
                                <div><span class="terminal-prompt">$</span> <span class="terminal-command">git checkout -b release/v2.3.0</span></div>
                            </div>
                        </div>
                        
                        <div class="pitfall">
                            <div class="pitfall-title">‚ö†Ô∏è Common Mistake</div>
                            <p>Using spaces in branch names: <code style="background: rgba(0,0,0,0.3); padding: 0.2rem 0.4rem; border-radius: 4px;">git branch new feature</code> creates three branches: "new", "feature", and an error. Always use hyphens or underscores.</p>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Exercise: Identify the Strategy</h2>
                        <p>Match the branch naming pattern to the appropriate workflow:</p>
                        
                        <div class="drag-container">
                            <div class="drag-source" id="dragSource">
                                <div class="drag-item" draggable="true" data-target="gitflow">release/v1.0.0</div>
                                <div class="drag-item" draggable="true" data-target="github">feature/login-page</div>
                                <div class="drag-item" draggable="true" data-target="hotfix">hotfix/api-outage</div>
                                <div class="drag-item" draggable="true" data-target="trunk">user-profile-refactor</div>
                            </div>
                            <div class="drag-target" id="dragTarget">
                                <div style="color: var(--text-secondary); text-align: center; margin-top: 50%;">
                                    Drop branch names here to categorize<br>
                                    (GitFlow, GitHub Flow, Hotfix, Trunk-based)
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="checkCategorization()">Check Answers</button>
                        <div id="categoryFeedback" style="margin-top: 1rem;"></div>
                    </div>

                    <div class="card">
                        <span class="badge badge-interactive">Quiz</span>
                        <h2 class="card-title">Branching Knowledge Check</h2>
                        <div class="quiz-container" id="branchQuiz">
                            <!-- Quiz injected via JS -->
                        </div>
                    </div>
                `
            },
            'merge-rebase': {
                title: "Merge vs Rebase: The Eternal Debate",
                subtitle: "Understand when to use each and the consequences of your choice",
                content: `
                    <div class="card">
                        <h2 class="card-title">Visual Comparison</h2>
                        <p>Click through the scenario to see how history differs between merge and rebase:</p>
                        
                        <div class="scenario-container">
                            <div class="scenario-step active" id="step1">
                                <h3 style="margin-bottom: 1rem;">Scenario: Feature Branch Ready for Main</h3>
                                <p>You've been working on a feature branch for 3 days. Main has moved forward. You want to integrate your changes.</p>
                                <div class="terminal" style="margin-top: 1rem;">
                                    <div class="terminal-content">
                                        <div class="terminal-output">main:    A---B---C</div>
                                        <div class="terminal-output">feature:      D---E</div>
                                    </div>
                                </div>
                                <button class="btn btn-primary" onclick="nextStep(2)">Next: See Merge Result ‚Üí</button>
                            </div>
                            
                            <div class="scenario-step" id="step2">
                                <h3 style="margin-bottom: 1rem;">Option A: Git Merge (--no-ff)</h3>
                                <div class="code-comparison">
                                    <div class="code-block merge">
                                        <div class="code-header">Command</div>
                                        <div class="terminal-command">git checkout main</div>
                                        <div class="terminal-command">git merge --no-ff feature</div>
                                    </div>
                                    <div class="code-block merge">
                                        <div class="code-header">Result History</div>
                                        <div style="color: var(--accent-blue);">
                                            A---B---C-------F (merge commit)<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;/<br>
                                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;D---E
                                        </div>
                                    </div>
                                </div>
                                <p style="margin: 1rem 0;"><strong>Pros:</strong> Preserves history, easy to revert, shows parallel work<br>
                                <strong>Cons:</strong> "Messy" history with merge bubbles</p>
                                <button class="btn btn-secondary" onclick="nextStep(3)">See Rebase Alternative ‚Üí</button>
                            </div>
                            
                            <div class="scenario-step" id="step3">
                                <h3 style="margin-bottom: 1rem;">Option B: Git Rebase (Interactive)</h3>
                                <div class="code-comparison">
                                    <div class="code-block rebase">
                                        <div class="code-header">Command</div>
                                        <div class="terminal-command">git checkout feature</div>
                                        <div class="terminal-command">git rebase -i main</div>
                                    </div>
                                    <div class="code-block rebase">
                                        <div class="code-header">Result History</div>
                                        <div style="color: var(--accent-purple);">
                                            A---B---C---D'---E' (linear)<br>
                                            <br>
                                            <span style="font-size: 0.8rem;">* D' and E' are new commits with new hashes</span>
                                        </div>
                                    </div>
                                </div>
                                <p style="margin: 1rem 0;"><strong>Pros:</strong> Clean linear history, easier to bisect<br>
                                <strong>Cons:</strong> Rewrites history (dangerous if pushed), loses merge context</p>
                                
                                <div class="pitfall">
                                    <div class="pitfall-title">üö® Golden Rule</div>
                                    <p>Never rebase commits that have been pushed to a shared remote branch. This creates divergence and forces others to resolve conflicts you created.</p>
                                </div>
                                <button class="btn btn-primary" onclick="nextStep(4)">Advanced Scenario ‚Üí</button>
                            </div>
                            
                            <div class="scenario-step" id="step4">
                                <h3 style="margin-bottom: 1rem;">The "Golden Commit" Strategy</h3>
                                <p>Many competitive organizations use a hybrid approach:</p>
                                <div class="terminal">
                                    <div class="terminal-content">
                                        <div class="comment"># 1. Rebase feature onto main for clean history</div>
                                        <div class="terminal-command">git rebase main</div>
                                        <br>
                                        <div class="comment"># 2. Squash into logical commits (if needed)</div>
                                        <div class="terminal-command">git rebase -i HEAD~3</div>
                                        <br>
                                        <div class="comment"># 3. Fast-forward merge to main (linear history)</div>
                                        <div class="terminal-command">git checkout main</div>
                                        <div class="terminal-command">git merge --ff-only feature</div>
                                    </div>
                                </div>
                                <div class="pro-tip">
                                    <div class="pro-tip-title">üí° Pro Tip</div>
                                    <p>Use <code>git merge --ff-only</code> to ensure you never create merge commits accidentally. If it can't fast-forward, you know you need to rebase first.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <span class="badge badge-danger">Conflict Resolution</span>
                        <h2 class="card-title">Merge Conflict Simulator</h2>
                        <p>Practice resolving conflicts. Choose the correct resolution strategy:</p>
                        
                        <div style="background-color: #000; padding: 1rem; border-radius: 8px; margin: 1rem 0; font-family: var(--font-mono);">
                            <div style="color: var(--accent-red);"><<<<<<< HEAD (Current Change)</div>
                            <div style="color: #e6edf3;">console.log("Hello World");</div>
                            <div style="color: var(--text-secondary);">=======</div>
                            <div style="color: #e6edf3;">console.log("Hello Universe");</div>
                            <div style="color: var(--accent-green);">>>>>>>> feature-branch (Incoming Change)</div>
                        </div>
                        
                        <div class="quiz-options" style="margin-top: 1rem;">
                            <div class="quiz-option" onclick="selectConflictResolution(this, 'wrong')">
                                <span>A</span> Keep both: <code>console.log("Hello World"); console.log("Hello Universe");</code>
                            </div>
                            <div class="quiz-option" onclick="selectConflictResolution(this, 'correct')">
                                <span>B</span> Choose based on feature requirements and remove conflict markers
                            </div>
                            <div class="quiz-option" onclick="selectConflictResolution(this, 'wrong')">
                                <span>C</span> Run <code>git push --force</code> to overwrite the conflict
                            </div>
                        </div>
                        
                        <div id="conflictFeedback" class="quiz-feedback"></div>
                    </div>
                `
            },
            workflows: {
                title: "Enterprise Collaboration Workflows",
                subtitle: "GitFlow, GitHub Flow, and Trunk-Based Development",
                content: `
                    <div class="card">
                        <h2 class="card-title">Workflow Comparison Matrix</h2>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
                                <thead>
                                    <tr style="background-color: var(--bg-tertiary);">
                                        <th style="padding: 1rem; text-align: left; border: 1px solid var(--border-color);">Feature</th>
                                        <th style="padding: 1rem; text-align: left; border: 1px solid var(--border-color);">GitFlow</th>
                                        <th style="padding: 1rem; text-align: left; border: 1px solid var(--border-color);">GitHub Flow</th>
                                        <th style="padding: 1rem; text-align: left; border: 1px solid var(--border-color);">Trunk-Based</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Complexity</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">High</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Low</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Medium</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Release Cycle</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Scheduled</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Continuous</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Continuous</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Long-lived Branches</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">develop, release/*</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">main only</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">main only</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Best For</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Enterprise, Versioned SW</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">Web Apps, Startups</td>
                                        <td style="padding: 1rem; border: 1px solid var(--border-color);">CI/CD Mature Teams</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Interactive: Design the Workflow</h2>
                        <p>You're the Tech Lead at a fintech startup with 50 developers. Choose your workflow:</p>
                        
                        <div class="quiz-container">
                            <div class="quiz-question">1. Your team needs to support multiple production versions simultaneously. Which workflow?</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="checkWorkflowAnswer(this, 'gitflow')">
                                    GitFlow - Supports multiple release branches and hotfixes
                                </div>
                                <div class="quiz-option" onclick="checkWorkflowAnswer(this, 'github')">
                                    GitHub Flow - Simple, single main branch
                                </div>
                                <div class="quiz-option" onclick="checkWorkflowAnswer(this, 'trunk')">
                                    Trunk-Based - Everyone commits to main daily
                                </div>
                            </div>
                        </div>

                        <div class="quiz-container" style="margin-top: 2rem;">
                            <div class="quiz-question">2. You deploy to production 10 times per day. Best choice?</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="checkWorkflowAnswer(this, 'trunk')">
                                    Trunk-Based Development with feature flags
                                </div>
                                <div class="quiz-option" onclick="checkWorkflowAnswer(this, 'gitflow')">
                                    GitFlow with release branches
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <span class="badge badge-warning">Pull Request Mastery</span>
                        <h2 class="card-title">Code Review Anti-Patterns</h2>
                        
                        <div class="terminal">
                            <div class="terminal-content">
                                <div class="comment"># Anti-Pattern 1: The Giant PR</div>
                                <div class="terminal-error">+2,400 lines changed across 47 files</div>
                                <div class="terminal-output">Review time: Never (sits in queue for weeks)</div>
                                <br>
                                <div class="comment"># Solution: Split into stacked PRs</div>
                                <div class="terminal-success">PR 1: Database schema (100 lines)</div>
                                <div class="terminal-success">PR 2: API endpoints (200 lines)</div>
                                <div class="terminal-success">PR 3: Frontend integration (150 lines)</div>
                            </div>
                        </div>

                        <div class="pitfall" style="margin-top: 1rem;">
                            <div class="pitfall-title">‚ò†Ô∏è The "Merge Hell" Scenario</div>
                            <p>Developer A and B both branch from main. A merges first. B doesn't pull before pushing, creates a merge commit, then force pushes to "fix" it. <strong>Don't be B.</strong></p>
                            <div style="margin-top: 0.5rem; font-family: var(--font-mono); font-size: 0.9rem; color: var(--accent-red);">
                                git push --force-with-lease  # Safe alternative
                            </div>
                        </div>
                    </div>
                `
            },
            hooks: {
                title: "Git Hooks Automation",
                subtitle: "Automate quality control and enforce standards",
                content: `
                    <div class="card">
                        <h2 class="card-title">Hook Execution Flow</h2>
                        <div style="background-color: var(--bg-tertiary); padding: 2rem; border-radius: 8px; font-family: var(--font-mono); line-height: 2;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin: 0.5rem 0;">
                                <span style="color: var(--accent-blue);">pre-commit</span>
                                <span style="color: var(--text-secondary);">‚Üí</span>
                                <span>Run tests, linting</span>
                                <span style="color: var(--accent-red);">(Can abort commit)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin: 0.5rem 0;">
                                <span style="color: var(--accent-blue);">prepare-commit-msg</span>
                                <span style="color: var(--text-secondary);">‚Üí</span>
                                <span>Auto-generate commit message template</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin: 0.5rem 0;">
                                <span style="color: var(--accent-blue);">commit-msg</span>
                                <span style="color: var(--text-secondary);">‚Üí</span>
                                <span>Validate commit message format</span>
                                <span style="color: var(--accent-red);">(Can abort)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin: 0.5rem 0;">
                                <span style="color: var(--accent-blue);">post-commit</span>
                                <span style="color: var(--text-secondary);">‚Üí</span>
                                <span>Notifications, metrics</span>
                            </div>
                            <div style="margin: 1rem 0; border-left: 2px solid var(--border-color); padding-left: 1rem;">
                                <span style="color: var(--accent-purple);">pre-push</span>
                                <span style="color: var(--text-secondary);">‚Üí</span>
                                <span>Run integration tests before pushing</span>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Practical Hook: Conventional Commits</h2>
                        <p>Enforce commit message standards (like Angular convention):</p>
                        
                        <div class="terminal">
                            <div class="terminal-header">
                                <span style="color: var(--text-secondary); font-size: 0.8rem;">.git/hooks/commit-msg</span>
                            </div>
                            <div class="terminal-content">
                                <div><span class="keyword">#!/bin/bash</span></div>
                                <div><span class="comment"># Enforce conventional commits</span></div>
                                <div><span class="function">COMMIT_MSG_FILE</span>=$1</div>
                                <div><span class="function">COMMIT_MSG</span>=$(cat $COMMIT_MSG_FILE)</div>
                                <br>
                                <div><span class="keyword">if !</span> [[ <span class="string">"$COMMIT_MSG"</span> =~ ^(feat|fix|docs|style|refactor|test|chore)(\\(.+\\))?:\ .+ ]]; <span class="keyword">then</span></div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">echo</span> <span class="string">"ERROR: Commit message must follow conventional commits"</span></div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">echo</span> <span class="string">"Example: feat(auth): add OAuth2 login"</span></div>
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">exit</span> 1</div>
                                <div><span class="keyword">fi</span></div>
                            </div>
                        </div>

                        <div class="pro-tip">
                            <div class="pro-tip-title">üí° Husky + lint-staged</div>
                            <p>For Node.js projects, use <strong>husky</strong> to manage hooks and <strong>lint-staged</strong> to run linters only on staged files. This keeps commits fast while maintaining quality.</p>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Exercise: Pre-push Hook Logic</h2>
                        <p>Which checks belong in pre-push vs pre-commit?</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                            <div style="background-color: var(--bg-tertiary); padding: 1rem; border-radius: 8px; min-height: 200px;" 
                                 ondrop="dropHook(event)" ondragover="allowDrop(event)" data-phase="pre-commit">
                                <h4 style="margin-bottom: 1rem; color: var(--accent-blue);">pre-commit (Fast)</h4>
                            </div>
                            <div style="background-color: var(--bg-tertiary); padding: 1rem; border-radius: 8px; min-height: 200px;"
                                 ondrop="dropHook(event)" ondragover="allowDrop(event)" data-phase="pre-push">
                                <h4 style="margin-bottom: 1rem; color: var(--accent-purple);">pre-push (Thorough)</h4>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                            <div class="drag-item" draggable="true" ondragstart="dragHook(event)" data-type="unit-tests">Unit Tests</div>
                            <div class="drag-item" draggable="true" ondragstart="dragHook(event)" data-type="e2e-tests">E2E Tests</div>
                            <div class="drag-item" draggable="true" ondragstart="dragHook(event)" data-type="linting">ESLint/Prettier</div>
                            <div class="drag-item" draggable="true" ondragstart="dragHook(event)" data-type="security-scan">Security Audit</div>
                            <div class="drag-item" draggable="true" ondragstart="dragHook(event)" data-type="type-check">TypeScript Check</div>
                        </div>
                        
                        <button class="btn btn-primary" style="margin-top: 1rem;" onclick="checkHookPlacement()">Verify Setup</button>
                        <div id="hookFeedback"></div>
                    </div>
                `
            },
            pitfalls: {
                title: "Git Disasters & How to Avoid Them",
                subtitle: "Learn from others' mistakes before you make them",
                content: `
                    <div class="card" style="border: 2px solid var(--accent-red);">
                        <h2 class="card-title" style="color: var(--accent-red);">The Hall of Shame</h2>
                        
                        <div style="margin: 2rem 0; padding: 1.5rem; background-color: rgba(248, 81, 73, 0.1); border-radius: 8px;">
                            <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">1. git push --force on main</h3>
                            <p style="margin-bottom: 1rem;">Overwrote 3 days of work for 12 developers. The CTO was not happy.</p>
                            <div class="terminal">
                                <div class="terminal-content">
                                    <div class="terminal-error">git push --force origin main</div>
                                    <div class="terminal-error"># ++++++ (forced update)</div>
                                    <div class="terminal-error"># 47 commits vanished</div>
                                </div>
                            </div>
                            <div class="pro-tip" style="margin-top: 1rem;">
                                <strong>Safe Alternative:</strong> <code>git push --force-with-lease</code> - fails if someone else pushed
                            </div>
                        </div>

                        <div style="margin: 2rem 0; padding: 1.5rem; background-color: rgba(248, 81, 73, 0.1); border-radius: 8px;">
                            <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">2. Committing Secrets</h3>
                            <p>Committed AWS keys to a public repo. Bots scanned and exploited within 2 minutes.</p>
                            <div class="terminal">
                                <div class="terminal-content">
                                    <div class="terminal-command">git add config.js</div>
                                    <div class="terminal-command">git commit -m "add config"</div>
                                    <div class="terminal-error"># AWS_ACCESS_KEY_ID=AKIA...</div>
                                    <div class="terminal-error"># Now in git history forever (even if deleted)</div>
                                </div>
                            </div>
                            <div class="pro-tip" style="margin-top: 1rem;">
                                <strong>Solution:</strong> Use <code>git-secrets</code> or <code>pre-commit</code> hook with <code>detect-secrets</code>
                            </div>
                        </div>

                        <div style="margin: 2rem 0; padding: 1.5rem; background-color: rgba(248, 81, 73, 0.1); border-radius: 8px;">
                            <h3 style="color: var(--accent-red); margin-bottom: 0.5rem;">3. git reset --hard</h3>
                            <p>Lost 6 hours of uncommitted work because "the IDE was acting weird."</p>
                            <div class="terminal">
                                <div class="terminal-content">
                                    <div class="terminal-command">git status</div>
                                    <div class="terminal-output"># modified: src/components/...</div>
                                    <div class="terminal-error">git reset --hard HEAD</div>
                                    <div class="terminal-error"># Poof. Gone forever.</div>
                                </div>
                            </div>
                            <div class="pro-tip" style="margin-top: 1rem;">
                                <strong>Recovery:</strong> <code>git reflog</code> can save you if committed, but uncommitted work is lost. Use <code>git stash</code> or <code>git reset --soft</code>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">Emergency Recovery Procedures</h2>
                        <div class="terminal">
                            <div class="terminal-header">
                                <span style="color: var(--text-secondary);">emergency-recovery.sh</span>
                            </div>
                            <div class="terminal-content">
                                <div class="comment"># Scenario 1: Deleted branch (not merged)</div>
                                <div class="terminal-command">git reflog</div>
                                <div class="terminal-command">git checkout -b recovered-branch abc1234</div>
                                <br>
                                <div class="comment"># Scenario 2: Bad merge (undo)</div>
                                <div class="terminal-command">git reset --hard ORIG_HEAD</div>
                                <br>
                                <div class="comment"># Scenario 3: Amend without changing message</div>
                                <div class="terminal-command">git commit --amend --no-edit</div>
                                <br>
                                <div class="comment"># Scenario 4: Cherry-pick a fix from main</div>
                                <div class="terminal-command">git cherry-pick abc1234</div>
                            </div>
                        </div>
                    </div>
                `
            },
            final: {
                title: "Final Challenge: The Production Incident",
                subtitle: "Apply everything you've learned in a realistic scenario",
                content: `
                    <div class="card">
                        <h2 class="card-title">Scenario: Friday 5 PM Deployment</h2>
                        <p style="margin-bottom: 1rem;">You're the senior developer on call. The team just deployed v2.5.0 to production and critical bugs are reported. You need to:</p>
                        
                        <ol style="margin-left: 2rem; line-height: 2;">
                            <li>Quickly revert production to stable state</li>
                            <li>Preserve the bug fixes (some commits are good)</li>
                            <li>Ensure the hotfix follows proper workflow</li>
                            <li>Prevent this from happening again (hooks?)</li>
                        </ol>

                        <div class="terminal" style="margin: 2rem 0;">
                            <div class="terminal-content">
                                <div class="terminal-output">Current situation:</div>
                                <div class="terminal-output">main: v2.4.0 --- v2.5.0 (BAD)</div>
                                <div class="terminal-output">           \</div>
                                <div class="terminal-output">            hotfix-branch (you are here)</div>
                            </div>
                        </div>

                        <div class="quiz-container">
                            <div class="quiz-question">Step 1: Immediate production safety</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="checkFinalAnswer(this, 1, 'A')">
                                    A) git revert HEAD on main and push
                                </div>
                                <div class="quiz-option" onclick="checkFinalAnswer(this, 1, 'B')">
                                    B) git reset --hard v2.4.0 and force push
                                </div>
                                <div class="quiz-option" onclick="checkFinalAnswer(this, 1, 'C')">
                                    C) git checkout v2.4.0 and detach HEAD
                                </div>
                            </div>
                            <div id="final-feedback-1" class="quiz-feedback"></div>
                        </div>

                        <div class="quiz-container" id="step2" style="display: none;">
                            <div class="quiz-question">Step 2: Long-term fix strategy</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="checkFinalAnswer(this, 2, 'A')">
                                    A) Cherry-pick good commits to new hotfix branch, leave bad ones
                                </div>
                                <div class="quiz-option" onclick="checkFinalAnswer(this, 2, 'B')">
                                    B) git rebase -i and drop bad commits, force push
                                </div>
                            </div>
                            <div id="final-feedback-2" class="quiz-feedback"></div>
                        </div>

                        <div id="victory" style="display: none; margin-top: 2rem; text-align: center; padding: 2rem; background-color: rgba(35, 134, 54, 0.2); border-radius: 12px; border: 2px solid var(--accent-green);">
                            <h2 style="color: var(--accent-green); margin-bottom: 1rem;">üéâ Incident Resolved!</h2>
                            <p>You've successfully navigated a production crisis using proper Git workflows.</p>
                            <div style="margin-top: 1.5rem;">
                                <button class="btn btn-primary" onclick="resetAll()">Restart Learning Path</button>
                            </div>
                        </div>
                    </div>
                `
            }
        };

        // Initialization
        function init() {
            loadModule('branching');
            setupDragAndDrop();
        }

        function loadModule(moduleId) {
            state.currentModule = moduleId;
            const module = modules[moduleId];
            const main = document.getElementById('mainContent');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if(item.textContent.toLowerCase().includes(moduleId.split('-')[0])) {
                    item.classList.add('active');
                }
            });

            // Render content
            main.innerHTML = `
                <div class="module-header">
                    <h1 class="module-title">${module.title}</h1>
                    <p class="module-subtitle">${module.subtitle}</p>
                </div>
                ${module.content}
            `;

            // Initialize specific components
            if(moduleId === 'branching') {
                initGitCanvas();
                initBranchQuiz();
            } else if(moduleId === 'hooks') {
                setupHookDragDrop();
            }
            
            updateProgress();
        }

        // Git Canvas Visualization
        function initGitCanvas() {
            const canvas = document.getElementById('gitCanvas');
            if(!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            // Initial state
            state.gitVisualization = {
                branches: [
                    {name: 'main', x: 50, y: 200, color: '#238636', commits: [{id: 'a1b2c3', msg: 'initial'}]}
                ],
                currentBranch: 'main',
                head: 'a1b2c3'
            };

            drawGitGraph(ctx, canvas);
        }

        function drawGitGraph(ctx, canvas) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const viz = state.gitVisualization;
            let xOffset = 50;
            
            // Draw branches
            viz.branches.forEach((branch, idx) => {
                const x = xOffset + (idx * 150);
                const color = branch.color || '#58a6ff';
                
                // Branch line
                ctx.beginPath();
                ctx.moveTo(x, 50);
                ctx.lineTo(x, 350);
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Branch label
                ctx.fillStyle = color;
                ctx.font = 'bold 14px sans-serif';
                ctx.fillText(branch.name, x - 20, 30);
                
                // Commits
                branch.commits.forEach((commit, cidx) => {
                    const y = 100 + (cidx * 60);
                    
                    // Commit circle
                    ctx.beginPath();
                    ctx.arc(x, y, 15, 0, Math.PI * 2);
                    ctx.fillStyle = viz.head === commit.id ? '#f0883e' : color;
                    ctx.fill();
                    
                    // HEAD label
                    if(viz.head === commit.id && viz.currentBranch === branch.name) {
                        ctx.fillStyle = '#f0883e';
                        ctx.font = 'bold 12px sans-serif';
                        ctx.fillText('HEAD', x + 25, y + 4);
                    }
                    
                    // Commit message
                    ctx.fillStyle = '#c9d1d9';
                    ctx.font = '12px monospace';
                    ctx.fillText(commit.id, x - 20, y + 35);
                });
            });
        }

        function gitAction(action) {
            const viz = state.gitVisualization;
            const canvas = document.getElementById('gitCanvas');
            const ctx = canvas.getContext('2d');
            
            switch(action) {
                case 'commit':
                    const currentBranch = viz.branches.find(b => b.name === viz.currentBranch);
                    const newId = Math.random().toString(36).substr(2, 7);
                    currentBranch.commits.push({
                        id: newId,
                        msg: 'new commit'
                    });
                    viz.head = newId;
                    break;
                    
                case 'branch':
                    const colors = ['#a371f7', '#f0883e', '#58a6ff', '#f778ba'];
                    viz.branches.push({
                        name: `feature-${viz.branches.length}`,
                        commits: [],
                        color: colors[viz.branches.length % colors.length]
                    });
                    break;
                    
                case 'checkout':
                    const nextIdx = (viz.branches.findIndex(b => b.name === viz.currentBranch) + 1) % viz.branches.length;
                    viz.currentBranch = viz.branches[nextIdx].name;
                    if(viz.branches[nextIdx].commits.length > 0) {
                        viz.head = viz.branches[nextIdx].commits[viz.branches[nextIdx].commits.length - 1].id;
                    }
                    break;
                    
                case 'reset':
                    viz.branches = [{name: 'main', commits: [{id: 'a1b2c3', msg: 'initial'}], color: '#238636'}];
                    viz.currentBranch = 'main';
                    viz.head = 'a1b2c3';
                    break;
            }
            
            drawGitGraph(ctx, canvas);
            updateBranchInfo();
        }

        function updateBranchInfo() {
            const viz = state.gitVisualization;
            const info = document.getElementById('branchInfo');
            if(info) {
                info.innerHTML = `Current: <span style="color: var(--accent-green)">${viz.currentBranch}</span> | HEAD: <span style="color: var(--accent-yellow)">${viz.head}</span>`;
            }
        }

        // Quiz System
        function initBranchQuiz() {
            const quizData = [
                {
                    question: "Which command creates AND switches to a new branch in one step?",
                    options: [
                        "git branch new-feature",
                        "git checkout new-feature",
                        "git checkout -b new-feature",
                        "git switch new-feature"
                    ],
                    correct: 2,
                    explanation: "git checkout -b (or git switch -c) creates and switches in one atomic operation."
                },
                {
                    question: "What happens to uncommitted changes when you switch branches?",
                    options: [
                        "They are automatically committed",
                        "They are lost forever",
                        "They follow you to the new branch or block the switch",
                        "They are stashed automatically"
                    ],
                    correct: 2,
                    explanation: "Git either carries changes forward if compatible, or blocks the switch to prevent conflicts."
                }
            ];

            renderQuiz('branchQuiz', quizData);
        }

        function renderQuiz(containerId, questions) {
            const container = document.getElementById(containerId);
            if(!container) return;

            let html = '';
            questions.forEach((q, idx) => {
                html += `
                    <div class="quiz-question">${idx + 1}. ${q.question}</div>
                    <div class="quiz-options" id="q${idx}">
                        ${q.options.map((opt, oidx) => `
                            <div class="quiz-option" onclick="selectQuizOption(this, ${idx}, ${oidx}, ${q.correct}, '${q.explanation}')">
                                <input type="radio" name="q${idx}" value="${oidx}">
                                <span>${opt}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div id="feedback${idx}" class="quiz-feedback"></div>
                `;
            });
            container.innerHTML = html;
        }

        function selectQuizOption(element, qIdx, selectedIdx, correctIdx, explanation) {
            const parent = element.parentElement;
            const feedback = document.getElementById(`feedback${qIdx}`);
            
            // Reset styling
            parent.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'wrong');
                opt.style.pointerEvents = 'none';
            });
            
            if(selectedIdx === correctIdx) {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = `<strong>Correct!</strong> ${explanation}`;
            } else {
                element.classList.add('wrong');
                parent.children[correctIdx].classList.add('correct');
                feedback.className = 'quiz-feedback show wrong';
                feedback.innerHTML = `<strong>Not quite.</strong> ${explanation}`;
            }
        }

        // Workflow Logic
        function nextStep(step) {
            document.querySelectorAll('.scenario-step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
        }

        function selectConflictResolution(element, type) {
            const feedback = document.getElementById('conflictFeedback');
            const parent = element.parentElement;
            
            parent.querySelectorAll('.quiz-option').forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.classList.remove('correct', 'wrong');
            });
            
            if(type === 'correct') {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = "<strong>Correct!</strong> Always analyze the feature requirements. Sometimes you need both, sometimes one. Never force push to resolve conflicts!";
            } else {
                element.classList.add('wrong');
                feedback.className = 'quiz-feedback show wrong';
                if(type === 'wrong') {
                    feedback.innerHTML = "<strong>Never force push to resolve conflicts!</strong> This overwrites remote history and breaks your team's repository.";
                } else {
                    feedback.innerHTML = "<strong>Not necessarily.</strong> Blindly keeping both changes might introduce bugs. Understand the context first.";
                }
            }
        }

        function checkWorkflowAnswer(element, type) {
            const parent = element.parentElement;
            parent.querySelectorAll('.quiz-option').forEach(opt => opt.style.pointerEvents = 'none');
            
            if((type === 'gitflow' && element.textContent.includes('GitFlow')) ||
               (type === 'trunk' && element.textContent.includes('Trunk'))) {
                element.classList.add('correct');
                element.style.borderColor = 'var(--accent-green)';
            } else {
                element.classList.add('wrong');
            }
        }

        // Drag and Drop
        function setupDragAndDrop() {
            // Setup for category exercise
            document.addEventListener('dragstart', (e) => {
                if(e.target.classList.contains('drag-item')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.dataset.target || e.target.textContent);
                    e.dataTransfer.setData('element', e.target.outerHTML);
                }
            });
            
            document.addEventListener('dragend', (e) => {
                if(e.target.classList.contains('drag-item')) {
                    e.target.classList.remove('dragging');
                }
            });
        }

        function checkCategorization() {
            const feedback = document.getElementById('categoryFeedback');
            feedback.innerHTML = '<div class="pro-tip"><strong>Key Insight:</strong> release/* branches indicate GitFlow (scheduled releases). Short-lived feature/* branches suggest GitHub Flow. Direct commits to main with flags = Trunk-Based. Hotfix/* can exist in any workflow but is formalized in GitFlow.</div>';
        }

        // Hooks Exercise
        function setupHookDragDrop() {
            // Handled by global drag handlers
        }

        function allowDrop(e) {
            e.preventDefault();
        }

        function dropHook(e) {
            e.preventDefault();
            const data = e.dataTransfer.getData('text/plain');
            const el = document.createElement('div');
            el.className = 'drag-item';
            el.textContent = data;
            el.draggable = true;
            e.target.appendChild(el);
        }

        function dragHook(e) {
            e.dataTransfer.setData('text/plain', e.target.textContent);
        }

        function checkHookPlacement() {
            const feedback = document.getElementById('hookFeedback');
            feedback.innerHTML = `
                <div style="margin-top: 1rem; padding: 1rem; background-color: var(--bg-tertiary); border-radius: 8px;">
                    <strong>Correct Setup:</strong><br>
                    <span style="color: var(--accent-blue);">pre-commit:</span> Linting, Type Check (fast feedback)<br>
                    <span style="color: var(--accent-purple);">pre-push:</span> Unit tests, E2E tests, Security scan (thorough validation)
                </div>
            `;
        }

        // Final Challenge
        function checkFinalAnswer(element, step, answer) {
            const feedback = document.getElementById(`final-feedback-${step}`);
            const parent = element.parentElement;
            
            parent.querySelectorAll('.quiz-option').forEach(opt => opt.style.pointerEvents = 'none');
            
            if(step === 1 && answer === 'A') {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = "<strong>Correct!</strong> git revert creates a new commit that undoes changes, preserving history. Never force push to fix production!";
                document.getElementById('step2').style.display = 'block';
            } else if(step === 1 && answer === 'B') {
                element.classList.add('wrong');
                feedback.className = 'quiz-feedback show wrong';
                feedback.innerHTML = "<strong>Dangerous!</strong> Force pushing to main rewrites shared history. Other developers will have divergent branches.";
            } else if(step === 2 && answer === 'A') {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = "<strong>Perfect!</strong> Cherry-picking allows surgical precision. Rebasing published history is a team anti-pattern.";
                document.getElementById('victory').style.display = 'block';
                updateProgress(100);
            } else if(step === 2 && answer === 'B') {
                element.classList.add('wrong');
                feedback.className = 'quiz-feedback show wrong';
                feedback.innerHTML = "<strong>Risky!</strong> Interactive rebase + force push alters published history. Use this only on private branches.";
            }
        }

        // Progress Tracking
        function updateProgress(override) {
            if(override) {
                state.progress = override;
            } else {
                // Calculate based on completed interactions
                state.progress = Math.min(85, state.progress + 15);
            }
            
            document.getElementById('progressBar').style.width = state.progress + '%';
            document.getElementById('progressText').textContent = state.progress + '%';
        }

        function resetAll() {
            state.progress = 0;
            state.completedModules = [];
            loadModule('branching');
        }

        // Initialize
        window.onload = init;
    </script>
</body>
</html>