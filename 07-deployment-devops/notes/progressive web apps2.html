<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Master Progressive Web Apps through interactive challenges">
    <title>PWA Mastery Dojo | Level Up Your Skills</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUFdBIE1hc3RlcnkgRG9qbyIsInNob3J0X25hbWUiOiJQV0EgRG9qbyIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGYxNzJhIiwidGhlbWVfY29sb3IiOiIjM2I4MmY2IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qQXdJaUJtYVd4c1BTSXlNQ0lnZW1sbGJqcGlkV3h6UGp4a1pXWnpQbng4Wld4bWNtRnRaVDBpYzNabGNtbG1hV1Z6SWo0OFpHVm1jejQ4TDJSbFpuTStQSFJwZEd4bFBsSmxjWFZwWTJnZ1VtOXZkQ0JFWld4MElFZHZiMlFnVW05dmRDQkJaRzFwYmlJZ2VEMGlNakVpSUhrOUlqSXhJaUIzYVdSMGFEMGlNakFpSUdOc2FYQXRiM0owWDBkbGRFZHZiMlFpTHo0OEwzTjJaejQ9Iiwic2l6ZXMiOiIxOTJ4MTkyIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.3);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --border: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Grid Background Animation */
        .grid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
        }

        header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
            font-size: 0.875rem;
        }

        .status-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .status-indicator.online {
            border-color: var(--success);
            color: var(--success);
        }

        .status-indicator.offline {
            border-color: var(--error);
            color: var(--error);
        }

        .pulse {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            padding: 3rem 0;
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.25rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Level Grid */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .level-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .level-card:hover::before {
            transform: scaleX(1);
        }

        .level-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px -10px var(--accent-glow);
        }

        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .level-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .level-number {
            font-size: 0.875rem;
            color: var(--accent);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .level-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .level-status.completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .level-desc {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Interactive Sections */
        .workshop {
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
            padding: 2rem;
            margin-bottom: 2rem;
            display: none;
        }

        .workshop.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .workshop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .back-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .back-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Lifecycle Visualizer */
        .lifecycle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
            padding: 2rem;
            background: var(--bg-primary);
            border-radius: 8px;
            position: relative;
            overflow-x: auto;
        }

        .lifecycle-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            z-index: 2;
            min-width: 120px;
        }

        .step-node {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: 3px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
            position: relative;
        }

        .step-node.active {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.2);
            box-shadow: 0 0 20px var(--accent-glow);
            animation: pulse 2s infinite;
        }

        .step-node.error {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.2);
        }

        .step-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .lifecycle-line {
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--bg-tertiary);
            z-index: 1;
        }

        .lifecycle-progress {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.5s;
        }

        /* Code Editor Simulation */
        .code-playground {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        @media (max-width: 768px) {
            .code-playground {
                grid-template-columns: 1fr;
            }
        }

        .editor {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow: hidden;
        }

        .editor-header {
            background: #161b22;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #30363d;
            font-size: 0.875rem;
            color: #8b949e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-body {
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            min-height: 200px;
            white-space: pre-wrap;
            color: #e6edf3;
        }

        .line-numbers {
            color: #484f58;
            user-select: none;
            margin-right: 1rem;
            display: inline-block;
            text-align: right;
            min-width: 20px;
        }

        .keyword { color: #ff7b72; }
        .function { color: #d2a8ff; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; font-style: italic; }
        .variable { color: #79c0ff; }

        .preview {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            position: relative;
        }

        .preview-label {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--bg-secondary);
            padding: 0 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        button.secondary {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
        }

        button.secondary:hover {
            background: var(--bg-primary);
        }

        button.danger {
            background: var(--error);
        }

        /* Caching Strategy Simulator */
        .cache-sim {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .network-diagram {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 2rem 0;
            position: relative;
            min-height: 200px;
        }

        .node {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            text-align: center;
            padding: 0.5rem;
            z-index: 2;
            transition: all 0.3s;
        }

        .node.active {
            border-color: var(--accent);
            box-shadow: 0 0 20px var(--accent-glow);
            transform: scale(1.1);
        }

        .connection {
            position: absolute;
            height: 2px;
            background: var(--bg-tertiary);
            transform-origin: left center;
            z-index: 1;
        }

        .packet {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--accent);
            border-radius: 50%;
            z-index: 3;
            display: none;
        }

        /* Quiz Section */
        .quiz-container {
            margin: 2rem 0;
        }

        .quiz-question {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--accent);
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .quiz-option {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quiz-option:hover {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .quiz-option.wrong {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }

        .quiz-option input {
            accent-color: var(--accent);
        }

        /* Pitfall Cards */
        .pitfall-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .pitfall-card {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            position: relative;
        }

        .pitfall-card::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: -10px;
            right: 10px;
            font-size: 1.5rem;
        }

        .pitfall-title {
            color: var(--error);
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pitfall-example {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.75rem;
            margin: 0.5rem 0;
            overflow-x: auto;
            border-left: 3px solid var(--error);
        }

        .solution {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Manifest Builder */
        .manifest-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 6px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .json-preview {
            background: #0d1117;
            color: #a5d6ff;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        /* Console Output */
        .console {
            background: #000;
            color: #0f0;
            font-family: 'Consolas', monospace;
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-size: 0.875rem;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
        }

        .console-line {
            margin: 0.25rem 0;
            padding-left: 1rem;
            position: relative;
        }

        .console-line::before {
            content: '>';
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        .console-line.error {
            color: var(--error);
        }

        .console-line.success {
            color: var(--success);
        }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent);
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #8b5cf6);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .lifecycle-container { flex-direction: column; gap: 1rem; }
            .lifecycle-line { display: none; }
            .manifest-builder { grid-template-columns: 1fr; }
        }

        /* Animations */
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--accent);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none;
            animation: slideIn 0.3s;
            z-index: 1000;
            max-width: 400px;
        }

        .toast.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="grid-bg"></div>
    
    <header>
        <div class="logo">
            <span>‚ö°</span>
            <span>PWA Mastery Dojo</span>
        </div>
        <div class="status-bar">
            <div class="status-indicator" id="networkStatus">
                <span class="pulse"></span>
                <span id="networkText">Online</span>
            </div>
            <button onclick="toggleOffline()" class="secondary" style="padding: 0.5rem 1rem; font-size: 0.75rem;">
                Toggle Offline
            </button>
        </div>
    </header>

    <main>
        <!-- Dashboard -->
        <div id="dashboard" class="active-section">
            <div class="hero">
                <h1>Master Progressive Web Apps</h1>
                <p class="subtitle">From service worker lifecycle to advanced caching strategies. Build production-ready PWAs that work offline, load instantly, and feel like native apps.</p>
                <div style="margin-top: 2rem;">
                    <span class="badge">üèóÔ∏è Architecture</span>
                    <span class="badge">‚ö° Performance</span>
                    <span class="badge">üîß Service Workers</span>
                    <span class="badge">üì± Installable</span>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="overallProgress" style="width: 0%"></div>
            </div>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem; font-size: 0.875rem;">
                Your Progress: <span id="progressText">0%</span> Complete
            </p>

            <div class="levels-grid">
                <div class="level-card" onclick="openLevel('manifest')">
                    <div class="level-header">
                        <span class="level-number">Level 1</span>
                        <div class="level-status" id="status-manifest">‚óã</div>
                    </div>
                    <h3>The Manifest</h3>
                    <p class="level-desc">Web App Manifest, icons, display modes, and installation prompts. The entry point to PWA-hood.</p>
                </div>

                <div class="level-card" onclick="openLevel('lifecycle')">
                    <div class="level-header">
                        <span class="level-number">Level 2</span>
                        <div class="level-status" id="status-lifecycle">‚óã</div>
                    </div>
                    <h3>Service Worker Lifecycle</h3>
                    <p class="level-desc">Registration, installation, activation, and the waiting phase. Understanding the engine room.</p>
                </div>

                <div class="level-card" onclick="openLevel('caching')">
                    <div class="level-header">
                        <span class="level-number">Level 3</span>
                        <div class="level-status" id="status-caching">‚óã</div>
                    </div>
                    <h3>Caching Strategies</h3>
                    <p class="level-desc">Cache First, Network First, Stale While Revalidate. Master the Cache API patterns.</p>
                </div>

                <div class="level-card" onclick="openLevel('offline')">
                    <div class="level-header">
                        <span class="level-number">Level 4</span>
                        <div class="level-status" id="status-offline">‚óã</div>
                    </div>
                    <h3>Offline Patterns</h3>
                    <p class="level-desc">Offline fallbacks, background sync, and handling network resilience like a pro.</p>
                </div>

                <div class="level-card" onclick="openLevel('pitfalls')">
                    <div class="level-header">
                        <span class="level-number">Level 5</span>
                        <div class="level-status" id="status-pitfalls">‚óã</div>
                    </div>
                    <h3>Anti-Patterns & Pitfalls</h3>
                    <p class="level-desc">Common mistakes that break PWAs in production. Learn what NOT to do.</p>
                </div>

                <div class="level-card" onclick="openLevel('mastery')">
                    <div class="level-header">
                        <span class="level-number">Final Challenge</span>
                        <div class="level-status" id="status-mastery">‚óã</div>
                    </div>
                    <h3>Production Mastery</h3>
                    <p class="level-desc">Build a complete offline-first application with all patterns combined.</p>
                </div>
            </div>
        </div>

        <!-- Level 1: Manifest -->
        <div id="level-manifest" class="workshop">
            <div class="workshop-header">
                <h2>Level 1: Web App Manifest</h2>
                <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            </div>

            <p>The manifest is a JSON file that tells the browser about your app: name, icons, theme colors, and display behavior. Without it, your app is just a website.</p>

            <div class="manifest-builder">
                <div>
                    <h3 style="margin-bottom: 1rem;">Manifest Builder</h3>
                    <div class="form-group">
                        <label>App Name</label>
                        <input type="text" id="appName" value="My Awesome App" oninput="updateManifest()">
                    </div>
                    <div class="form-group">
                        <label>Short Name</label>
                        <input type="text" id="shortName" value="Awesome App" oninput="updateManifest()">
                    </div>
                    <div class="form-group">
                        <label>Theme Color</label>
                        <input type="color" id="themeColor" value="#3b82f6" oninput="updateManifest()" style="height: 40px;">
                    </div>
                    <div class="form-group">
                        <label>Display Mode</label>
                        <select id="displayMode" onchange="updateManifest()">
                            <option value="standalone">standalone (like native app)</option>
                            <option value="fullscreen">fullscreen (immersive)</option>
                            <option value="minimal-ui">minimal-ui (minimal browser UI)</option>
                            <option value="browser">browser (regular browser)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Start URL</label>
                        <input type="text" id="startUrl" value="/" oninput="updateManifest()">
                    </div>
                </div>
                <div>
                    <h3 style="margin-bottom: 1rem;">Generated Manifest</h3>
                    <div class="json-preview" id="manifestPreview"></div>
                    <button onclick="downloadManifest()" style="margin-top: 1rem; width: 100%;">Download manifest.json</button>
                </div>
            </div>

            <div class="quiz-container">
                <h3>Quick Quiz</h3>
                <div class="quiz-question">
                    <p><strong>Why should you provide a 512x512 icon in the manifest?</strong></p>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q1"> It's required for the app to install
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, true)">
                            <input type="radio" name="q1"> Splash screens on Android use it for high-res displays
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="q1"> It improves SEO rankings
                        </label>
                    </div>
                </div>
            </div>

            <button onclick="completeLevel('manifest')" style="margin-top: 2rem;">Mark Level Complete ‚úì</button>
        </div>

        <!-- Level 2: Lifecycle -->
        <div id="level-lifecycle" class="workshop">
            <div class="workshop-header">
                <h2>Level 2: Service Worker Lifecycle</h2>
                <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            </div>

            <p>Service Workers have a complex lifecycle. Understanding <code>install</code>, <code>activate</code>, and <code>fetch</code> events is crucial. One mistake in lifecycle management can leave users with stale code forever.</p>

            <h3 style="margin: 2rem 0 1rem;">Interactive Lifecycle Visualizer</h3>
            <div class="lifecycle-container">
                <div class="lifecycle-line">
                    <div class="lifecycle-progress" id="lifecycleProgress"></div>
                </div>
                
                <div class="lifecycle-step">
                    <div class="step-node" id="step-register">1</div>
                    <span class="step-label">Register</span>
                </div>
                <div class="lifecycle-step">
                    <div class="step-node" id="step-install">2</div>
                    <span class="step-label">Install</span>
                </div>
                <div class="lifecycle-step">
                    <div class="step-node" id="step-waiting">3</div>
                    <span class="step-label">Waiting</span>
                </div>
                <div class="lifecycle-step">
                    <div class="step-node" id="step-activate">4</div>
                    <span class="step-label">Activate</span>
                </div>
                <div class="lifecycle-step">
                    <div class="step-node" id="step-control">5</div>
                    <span class="step-label">Controlling</span>
                </div>
            </div>

            <div class="controls">
                <button onclick="simulateLifecycle('normal')">Simulate Normal Flow</button>
                <button onclick="simulateLifecycle('skip')">Simulate skipWaiting()</button>
                <button onclick="simulateLifecycle('error')" class="danger">Simulate Error</button>
            </div>

            <div class="console" id="lifecycleConsole">
                <div class="console-line">Ready to simulate lifecycle...</div>
            </div>

            <h3 style="margin: 2rem 0 1rem;">Critical Concepts</h3>
            <div class="code-playground">
                <div class="editor">
                    <div class="editor-header">service-worker.js</div>
                    <div class="editor-body">
<span class="keyword">const</span> <span class="variable">CACHE_NAME</span> = <span class="string">'v1'</span>;

<span class="comment">// Install: Cache assets</span>
self.<span class="function">addEventListener</span>(<span class="string">'install'</span>, <span class="variable">event</span> => {
    <span class="variable">event</span>.<span class="function">waitUntil</span>(
        <span class="variable">caches</span>.<span class="function">open</span>(<span class="variable">CACHE_NAME</span>)
            .<span class="function">then</span>(<span class="variable">cache</span> => <span class="variable">cache</span>.<span class="function">addAll</span>([
                <span class="string">'/'</span>,
                <span class="string">'/styles.css'</span>
            ]))
    );
    <span class="comment">// Force activation (use with caution)</span>
    <span class="comment">// self.skipWaiting();</span>
});

<span class="comment">// Activate: Clean up old caches</span>
self.<span class="function">addEventListener</span>(<span class="string">'activate'</span>, <span class="variable">event</span> => {
    <span class="variable">event</span>.<span class="function">waitUntil</span>(
        <span class="variable">caches</span>.<span class="function">keys</span>().<span class="function">then</span>(<span class="variable">cacheNames</span> => {
            <span class="keyword">return</span> <span class="variable">Promise</span>.<span class="function">all</span>(
                <span class="variable">cacheNames</span>
                    .<span class="function">filter</span>(<span class="variable">name</span> => <span class="variable">name</span> !== <span class="variable">CACHE_NAME</span>)
                    .<span class="function">map</span>(<span class="variable">name</span> => <span class="variable">caches</span>.<span class="function">delete</span>(<span class="variable">name</span>))
            );
        })
    );
});
                    </div>
                </div>
                <div class="preview">
                    <span class="preview-label">Key Points</span>
                    <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                        <li style="margin-bottom: 0.5rem;"><strong>Registration:</strong> Must be in main thread, check for browser support first</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Waiting Phase:</strong> New SW waits until all tabs close. Use skipWaiting() to force, but handle gracefully</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Scope:</strong> SW only controls pages in its directory or subdirectories</li>
                        <li style="margin-bottom: 0.5rem;"><strong>Claim:</strong> Use clients.claim() in activate to control pages immediately</li>
                    </ul>
                </div>
            </div>

            <button onclick="completeLevel('lifecycle')" style="margin-top: 2rem;">Mark Level Complete ‚úì</button>
        </div>

        <!-- Level 3: Caching -->
        <div id="level-caching" class="workshop">
            <div class="workshop-header">
                <h2>Level 3: Caching Strategies</h2>
                <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            </div>

            <p>Choosing the wrong caching strategy is the #1 cause of PWA bugs. API calls shouldn't be cached forever. Assets shouldn't always fetch from network.</p>

            <h3 style="margin: 2rem 0 1rem;">Strategy Simulator</h3>
            <div class="controls">
                <select id="strategySelect" onchange="updateStrategy()">
                    <option value="cache-first">Cache First (Cache Falling Back to Network)</option>
                    <option value="network-first">Network First (Network Falling Back to Cache)</option>
                    <option value="stale">Stale While Revalidate</option>
                    <option value="network-only">Network Only</option>
                    <option value="cache-only">Cache Only</option>
                </select>
                <button onclick="runSimulation()">Run Simulation</button>
            </div>

            <div class="cache-sim">
                <div class="network-diagram" id="networkDiagram">
                    <div class="node" id="node-browser">Browser</div>
                    <div class="node" id="node-sw">Service Worker</div>
                    <div class="node" id="node-cache">Cache Storage</div>
                    <div class="node" id="node-network">Network</div>
                </div>
                <div id="strategyExplanation" style="padding: 1rem; background: var(--bg-secondary); border-radius: 4px; margin-top: 1rem;">
                    Select a strategy and run simulation...
                </div>
            </div>

            <h3 style="margin: 2rem 0 1rem;">Implementation Patterns</h3>
            <div class="editor">
                <div class="editor-header" id="codeHeader">Cache First Pattern</div>
                <div class="editor-body" id="codeContent">
<span class="comment">// Cache First: Good for static assets, bad for API calls</span>
<span class="variable">event</span>.<span class="function">respondWith</span>(
    <span class="variable">caches</span>.<span class="function">match</span>(<span class="variable">event</span>.<span class="variable">request</span>)
        .<span class="function">then</span>(<span class="variable">response</span> => {
            <span class="keyword">if</span> (<span class="variable">response</span>) {
                <span class="keyword">return</span> <span class="variable">response</span>; <span class="comment">// Return cached version</span>
            }
            <span class="keyword">return</span> <span class="function">fetch</span>(<span class="variable">event</span>.<span class="variable">request</span>)
                .<span class="function">then</span>(<span class="variable">networkResponse</span> => {
                    <span class="comment">// Optionally cache the new response</span>
                    <span class="keyword">return</span> <span class="variable">networkResponse</span>;
                });
        })
);
                </div>
            </div>

            <button onclick="completeLevel('caching')" style="margin-top: 2rem;">Mark Level Complete ‚úì</button>
        </div>

        <!-- Level 4: Offline Patterns -->
        <div id="level-offline" class="workshop">
            <div class="workshop-header">
                <h2>Level 4: Advanced Offline Patterns</h2>
                <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            </div>

            <h3>Background Sync</h3>
            <p>Defer actions until connectivity returns. Essential for "offline-first" apps.</p>
            
            <div class="code-playground">
                <div class="editor">
                    <div class="editor-header">main.js</div>
                    <div class="editor-body">
<span class="comment">// Register sync when user submits form</span>
<span class="keyword">async function</span> <span class="function">submitForm</span>(<span class="variable">data</span>) {
    <span class="keyword">try</span> {
        <span class="keyword">await</span> <span class="function">saveToIndexedDB</span>(<span class="variable">data</span>);
        
        <span class="comment">// Register for sync</span>
        <span class="keyword">const</span> <span class="variable">registration</span> = <span class="keyword">await</span> <span class="variable">navigator</span>.<span class="variable">serviceWorker</span>.<span class="variable">ready</span>;
        <span class="keyword">await</span> <span class="variable">registration</span>.<span class="variable">sync</span>.<span class="function">register</span>(<span class="string">'submit-form'</span>);
        
        <span class="function">showMessage</span>(<span class="string">'Will sync when online'</span>);
    } <span class="keyword">catch</span> (<span class="variable">err</span>) {
        <span class="variable">console</span>.<span class="function">error</span>(<span class="variable">err</span>);
    }
}
                    </div>
                </div>
                <div class="editor">
                    <div class="editor-header">service-worker.js</div>
                    <div class="editor-body">
<span class="variable">self</span>.<span class="function">addEventListener</span>(<span class="string">'sync'</span>, <span class="variable">event</span> => {
    <span class="keyword">if</span> (<span class="variable">event</span>.<span class="variable">tag</span> === <span class="string">'submit-form'</span>) {
        <span class="variable">event</span>.<span class="function">waitUntil</span>(
            <span class="function">getFromIndexedDB</span>()
                .<span class="function">then</span>(<span class="variable">data</span> => <span class="function">sendToServer</span>(<span class="variable">data</span>))
                .<span class="function">then</span>(() => <span class="function">clearIndexedDB</span>())
        );
    }
});
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 2rem;">Offline Fallback Pattern</h3>
            <div class="editor">
                <div class="editor-header">Offline Fallback Implementation</div>
                <div class="editor-body">
<span class="variable">event</span>.<span class="function">respondWith</span>(
    <span class="function">fetch</span>(<span class="variable">event</span>.<span class="variable">request</span>)
        .<span class="function">catch</span>(() => {
            <span class="keyword">return</span> <span class="variable">caches</span>.<span class="function">match</span>(<span class="variable">event</span>.<span class="variable">request</span>)
                .<span class="function">then</span>(<span class="variable">response</span> => {
                    <span class="keyword">if</span> (<span class="variable">response</span>) <span class="keyword">return</span> <span class="variable">response</span>;
                    
                    <span class="comment">// If HTML request, return offline page</span>
                    <span class="keyword">if</span> (<span class="variable">event</span>.<span class="variable">request</span>.<span class="variable">mode</span> === <span class="string">'navigate'</span>) {
                        <span class="keyword">return</span> <span class="variable">caches</span>.<span class="function">match</span>(<span class="string">'/offline.html'</span>);
                    }
                    
                    <span class="comment">// For images, return placeholder</span>
                    <span class="keyword">if</span> (<span class="variable">event</span>.<span class="variable">request</span>.<span class="variable">destination</span> === <span class="string">'image'</span>) {
                        <span class="keyword">return</span> <span class="variable">caches</span>.<span class="function">match</span>(<span class="string">'/placeholder.png'</span>);
                    }
                });
        })
);
                </div>
            </div>

            <button onclick="completeLevel('offline')" style="margin-top: 2rem;">Mark Level Complete ‚úì</button>
        </div>

        <!-- Level 5: Pitfalls -->
        <div id="level-pitfalls" class="workshop">
            <div class="workshop-header">
                <h2>Level 5: Deadly Pitfalls</h2>
                <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            </div>

            <p>These mistakes have cost engineers their weekends. Study them carefully.</p>

            <div class="pitfall-grid">
                <div class="pitfall-card">
                    <div class="pitfall-title">The Infinite Loop</div>
                    <p>Fetching inside a fetch handler without checking the request causes recursion.</p>
                    <div class="pitfall-example">
self.addEventListener('fetch', event => {
    event.respondWith(
        fetch(event.request) // ‚ö†Ô∏è If this fails, infinite loop!
    );
});
                    </div>
                    <div class="solution">
                        <strong>Fix:</strong> Always handle errors and avoid unconditional fetch in handler.
                    </div>
                </div>

                <div class="pitfall-card">
                    <div class="pitfall-title">Cache Versioning Hell</div>
                    <p>Hardcoding cache names means users never get updates.</p>
                    <div class="pitfall-example">
const CACHE_NAME = 'static-v1'; // Never changes?

// User gets stale assets forever because 
// old SW controls page and cache name matches
                    </div>
                    <div class="solution">
                        <strong>Fix:</strong> Use build timestamps or versions: <code>static-${BUILD_ID}</code>
                    </div>
                </div>

                <div class="pitfall-card">
                    <div class="pitfall-title">Opaque Response Trap</div>
                    <p>CDNs with CORS return opaque responses that consume 7MB quota regardless of size.</p>
                    <div class="pitfall-example">
cache.add('https://cdn.example.com/image.jpg');
// Response is opaque, Quota exceeded errors ensue
                    </div>
                    <div class="solution">
                        <strong>Fix:</strong> Use <code>{mode: 'cors'}</code> or avoid caching cross-origin resources.
                    </div>
                </div>

                <div class="pitfall-card">
                    <div class="pitfall-title">The Waiting Game</div>
                    <p>New Service Worker waits forever because old tabs are open.</p>
                    <div class="pitfall-example">
// User never sees updates because 
// skipWaiting() wasn't called and 
// tabs weren't closed
                    </div>
                    <div class="solution">
                        <strong>Fix:</strong> Show "Update Available" UI and use skipWaiting() strategically.
                    </div>
                </div>
            </div>

            <div class="quiz-container">
                <h3>Spot the Bug</h3>
                <div class="quiz-question">
                    <p>What's wrong with this code?</p>
                    <div class="pitfall-example" style="margin: 1rem 0;">
event.respondWith(
    caches.match(event.request).then(response => {
        return response || fetch(event.request).then(fetchResponse => {
            return caches.open('dynamic').then(cache => {
                cache.put(event.request, fetchResponse.clone());
                return fetchResponse;
            });
        });
    })
);
                    </div>
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="bug"> Nothing, this is correct
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, true)">
                            <input type="radio" name="bug"> It doesn't handle fetch failures (no .catch())
                        </label>
                        <label class="quiz-option" onclick="checkAnswer(this, false)">
                            <input type="radio" name="bug"> It caches all requests including POST requests
                        </label>
                    </div>
                </div>
            </div>

            <button onclick="completeLevel('pitfalls')" style="margin-top: 2rem;">Mark Level Complete ‚úì</button>
        </div>

        <!-- Final Challenge -->
        <div id="level-mastery" class="workshop">
            <div class="workshop-header">
                <h2>Final Challenge: Build a Production PWA</h2>
                <button class="back-btn" onclick="showDashboard()">‚Üê Back to Dashboard</button>
            </div>

            <p>Combine everything. Build a Note-taking app that:</p>
            <ul style="margin: 1rem 0 2rem 2rem; color: var(--text-secondary);">
                <li>Works completely offline</li>
                <li>Syncs when coming back online (Background Sync)</li>
                <li>Shows "Update Available" when new SW is ready</li>
                <li>Uses proper cache versioning</li>
                <li>Handles network timeouts gracefully</li>
            </ul>

            <div class="editor">
                <div class="editor-header">Challenge Checklist</div>
                <div class="editor-body" style="color: var(--text-secondary);">
‚òê Implement Cache First for static assets with proper versioning
‚òê Implement Network First for API calls with timeout (3s)
‚òê Store pending notes in IndexedDB
‚òê Register Background Sync when offline
‚òê Show visual indicator when app is offline
‚òê Handle SW updates gracefully (no forced refresh)
‚òê Implement "Add to Home Screen" prompt
                </div>
            </div>

            <button onclick="completeLevel('mastery')" style="margin-top: 2rem; background: linear-gradient(135deg, var(--success), #059669);">
                Complete Mastery Challenge üèÜ
            </button>
        </div>
    </main>

    <div class="toast" id="toast"></div>

    <script>
        // State Management
        const progress = {
            manifest: false,
            lifecycle: false,
            caching: false,
            offline: false,
            pitfalls: false,
            mastery: false
        };

        // Network Status Monitoring
        function updateOnlineStatus() {
            const indicator = document.getElementById('networkStatus');
            const text = document.getElementById('networkText');
            
            if (navigator.onLine) {
                indicator.classList.remove('offline');
                indicator.classList.add('online');
                text.textContent = 'Online';
            } else {
                indicator.classList.remove('online');
                indicator.classList.add('offline');
                text.textContent = 'Offline';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        function toggleOffline() {
            // Simulate offline for testing
            showToast('In DevTools: Network tab ‚Üí Offline checkbox');
        }

        // Navigation
        function showDashboard() {
            document.querySelectorAll('.workshop').forEach(w => w.classList.remove('active'));
            document.getElementById('dashboard').style.display = 'block';
            updateOverallProgress();
        }

        function openLevel(levelId) {
            document.getElementById('dashboard').style.display = 'none';
            document.querySelectorAll('.workshop').forEach(w => w.classList.remove('active'));
            document.getElementById(`level-${levelId}`).classList.add('active');
            
            if (levelId === 'manifest') updateManifest();
        }

        function completeLevel(level) {
            progress[level] = true;
            document.getElementById(`status-${level}`).textContent = '‚úì';
            document.getElementById(`status-${level}`).classList.add('completed');
            
            const messages = {
                manifest: 'Manifest mastered! Your app is installable.',
                lifecycle: 'Lifecycle understood! You control the matrix.',
                caching: 'Caching guru! Assets are optimized.',
                offline: 'Offline expert! Your app works anywhere.',
                pitfalls: 'Pitfalls avoided! Production ready.',
                mastery: 'PWA MASTER! üéâ You are ready for that job!'
            };
            
            showToast(messages[level]);
            updateOverallProgress();
        }

        function updateOverallProgress() {
            const levels = Object.keys(progress);
            const completed = levels.filter(l => progress[l]).length;
            const percentage = (completed / levels.length) * 100;
            
            document.getElementById('overallProgress').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${Math.round(percentage)}%`;
        }

        // Manifest Builder
        function updateManifest() {
            const manifest = {
                name: document.getElementById('appName').value,
                short_name: document.getElementById('shortName').value,
                theme_color: document.getElementById('themeColor').value,
                background_color: document.getElementById('themeColor').value,
                display: document.getElementById('displayMode').value,
                start_url: document.getElementById('startUrl').value,
                icons: [
                    {
                        src: "/icon-192.png",
                        sizes: "192x192",
                        type: "image/png"
                    },
                    {
                        src: "/icon-512.png",
                        sizes: "512x512",
                        type: "image/png",
                        purpose: "any maskable"
                    }
                ]
            };
            
            document.getElementById('manifestPreview').textContent = JSON.stringify(manifest, null, 2);
        }

        function downloadManifest() {
            const content = document.getElementById('manifestPreview').textContent;
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'manifest.json';
            a.click();
            showToast('manifest.json downloaded!');
        }

        // Lifecycle Simulator
        function simulateLifecycle(type) {
            const steps = ['step-register', 'step-install', 'step-waiting', 'step-activate', 'step-control'];
            const consoleDiv = document.getElementById('lifecycleConsole');
            consoleDiv.innerHTML = '';
            
            function log(msg, type = 'normal') {
                const line = document.createElement('div');
                line.className = `console-line ${type}`;
                line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
                consoleDiv.appendChild(line);
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
            }

            // Reset
            steps.forEach(step => {
                document.getElementById(step).classList.remove('active', 'error');
            });
            document.getElementById('lifecycleProgress').style.width = '0%';

            // Animation sequence
            let delay = 0;
            const stepTime = 800;

            // Register
            setTimeout(() => {
                document.getElementById('step-register').classList.add('active');
                document.getElementById('lifecycleProgress').style.width = '20%';
                log('Service Worker registered');
            }, delay++ * stepTime);

            // Install
            setTimeout(() => {
                if (type === 'error') {
                    document.getElementById('step-install').classList.add('error');
                    log('Install failed: Cache.addAll() rejected', 'error');
                    return;
                }
                document.getElementById('step-install').classList.add('active');
                document.getElementById('lifecycleProgress').style.width = '40%';
                log('Install event: Caching assets...', 'success');
                log('Caches opened and populated');
            }, delay++ * stepTime);

            if (type === 'error') return;

            // Waiting
            setTimeout(() => {
                document.getElementById('step-waiting').classList.add('active');
                document.getElementById('lifecycleProgress').style.width = '60%';
                if (type === 'skip') {
                    log('skipWaiting() called - bypassing waiting phase', 'success');
                } else {
                    log('Waiting: Old tabs still using previous version');
                    log('New SW will activate when all tabs close');
                }
            }, delay++ * stepTime);

            // Activate
            setTimeout(() => {
                document.getElementById('step-activate').classList.add('active');
                document.getElementById('lifecycleProgress').style.width = '80%';
                log('Activate event: Cleaning old caches...', 'success');
                if (type === 'skip') {
                    log('clients.claim() called - controlling pages immediately');
                }
            }, delay++ * stepTime);

            // Control
            setTimeout(() => {
                document.getElementById('step-control').classList.add('active');
                document.getElementById('lifecycleProgress').style.width = '100%';
                log('Service Worker is now controlling pages', 'success');
                log('Fetch events will now be intercepted');
            }, delay++ * stepTime);
        }

        // Caching Strategy Simulator
        const strategies = {
            'cache-first': {
                name: 'Cache First',
                desc: 'Check cache first. If miss, go to network. Best for: Static assets, App Shell.',
                code: `// Cache First
caches.match(request).then(response => {
    return response || fetch(request);
})`
            },
            'network-first': {
                name: 'Network First',
                desc: 'Try network first. If fail, use cache. Best for: API calls, Fresh content.',
                code: `// Network First
fetch(request).catch(() => {
    return caches.match(request);
})`
            },
            'stale': {
                name: 'Stale While Revalidate',
                desc: 'Return cache immediately, update cache in background. Best for: Content that can be slightly outdated.',
                code: `// Stale While Revalidate
caches.match(request).then(response => {
    const fetchPromise = fetch(request).then(networkResponse => {
        caches.open('dynamic').then(cache => {
            cache.put(request, networkResponse.clone());
        });
        return networkResponse;
    });
    return response || fetchPromise;
})`
            },
            'network-only': {
                name: 'Network Only',
                desc: 'Always fetch. No caching. Best for: Real-time data, Analytics.',
                code: `// Network Only
fetch(request)`
            },
            'cache-only': {
                name: 'Cache Only',
                desc: 'Always use cache. If miss, fail. Best for: Offline-first apps with pre-cached assets.',
                code: `// Cache Only
caches.match(request)`
            }
        };

        function updateStrategy() {
            const strat = document.getElementById('strategySelect').value;
            document.getElementById('strategyExplanation').innerHTML = 
                `<strong>${strategies[strat].name}</strong><br>${strategies[strat].desc}`;
            document.getElementById('codeHeader').textContent = `${strategies[strat].name} Pattern`;
            document.getElementById('codeContent').innerHTML = 
                `<span class="comment">${strategies[strat].desc}</span>\n${strategies[strat].code
                    .replace(/const|let|var|return|if|else|function|async|await|new/g, '<span class="keyword">$&</span>')
                    .replace(/ caches|fetch|match|then|catch|put|open|addEventListener/g, ' <span class="function">$&</span>')
                    .replace(/'(.*?)'/g, '<span class="string">\'$1\'</span>')
                    .replace(/\.(response|request|clone)/g, '.<span class="variable">$1</span>')}`;
        }

        function runSimulation() {
            const strat = document.getElementById('strategySelect').value;
            const nodes = ['node-browser', 'node-sw', 'node-cache', 'node-network'];
            
            // Reset
            nodes.forEach(n => document.getElementById(n).classList.remove('active'));
            
            // Animation based on strategy
            const sequence = [];
            
            if (strat === 'cache-first') {
                sequence.push(['node-browser', 'node-sw'], ['node-sw', 'node-cache']);
                // Hit or miss simulation
                setTimeout(() => {
                    const hit = Math.random() > 0.3;
                    if (hit) {
                        showToast('Cache HIT! ‚ö° Instant response');
                        sequence.push(['node-cache', 'node-sw'], ['node-sw', 'node-browser']);
                    } else {
                        showToast('Cache MISS üåê Fetching from network...');
                        sequence.push(['node-sw', 'node-network'], ['node-network', 'node-sw'], ['node-sw', 'node-browser']);
                    }
                    animateSequence(sequence);
                }, 500);
            } else if (strat === 'network-first') {
                sequence.push(['node-browser', 'node-sw'], ['node-sw', 'node-network']);
                setTimeout(() => {
                    if (navigator.onLine) {
                        showToast('Network success, updating cache');
                        sequence.push(['node-network', 'node-sw'], ['node-sw', 'node-browser']);
                    } else {
                        showToast('Network fail, fallback to cache');
                        sequence.push(['node-sw', 'node-cache'], ['node-cache', 'node-sw'], ['node-sw', 'node-browser']);
                    }
                    animateSequence(sequence);
                }, 500);
            } else {
                // Generic animation for others
                showToast('See console for strategy flow');
            }
        }

        function animateSequence(steps) {
            let delay = 0;
            steps.forEach((step, idx) => {
                setTimeout(() => {
                    step.forEach(nodeId => {
                        const node = document.getElementById(nodeId);
                        node.classList.add('active');
                        setTimeout(() => node.classList.remove('active'), 400);
                    });
                }, delay);
                delay += 500;
            });
        }

        // Quiz System
        function checkAnswer(element, isCorrect) {
            // Reset siblings
            const siblings = element.parentElement.querySelectorAll('.quiz-option');
            siblings.forEach(sib => {
                sib.classList.remove('correct', 'wrong');
                sib.style.pointerEvents = 'none';
            });
            
            if (isCorrect) {
                element.classList.add('correct');
                showToast('Correct! üéâ');
            } else {
                element.classList.add('wrong');
                showToast('Not quite. Review the material and try again.');
            }
        }

        // Toast Notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Service Worker Registration (for this app itself)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Inline SW for demonstration
                const swCode = `
                    const CACHE_NAME = 'pwa-dojo-v1';
                    const urlsToCache = [
                        '/',
                        '/styles.css'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) return response;
                                    return fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'text/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('SW registered:', registration);
                    })
                    .catch(error => {
                        console.log('SW registration failed:', error);
                    });
            });
        }

        // Initialize
        updateOnlineStatus();
        updateManifest();
    </script>
</body>
</html>